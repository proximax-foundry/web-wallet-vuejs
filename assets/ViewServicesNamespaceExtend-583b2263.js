import{_ as xe,u as Ce,q as De,D as Ne,r as s,c as l,n as r,b9 as Fe,ba as Pe,E as f,K as Te,aI as Ie,H as i,V as Le,ao as G,w as x,I as Se,a as A,aH as W,bb as oe,k as M,o as g,b as v,e as n,t as o,s as N,f as F,B as J,Q as Ae,ag as Me,F as Be,h as Ee,z as Ve,W as We}from"./index-ac5f7446.js";import{_ as He}from"./PasswordInput.vue_vue_type_script_setup_true_lang-85d9fba6.js";import{D as Ue}from"./DurationInputClean-d146c6f5.js";import{_ as Re}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-51050422.js";import{N as P}from"./namespaceUtils-2421a8ec.js";import{t as je}from"./jdenticon-module-0719d88f.js";import{M as qe}from"./multisigUtils-9af1ee54.js";import{_ as ze}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const Oe={name:"ViewServicesNamespaceExtend",components:{PasswordInput:He,DurationInputClean:Ue,TransactionFeeDisplay:Re},props:{namespaceId:String,address:String},setup(t){const{t:h}=Ce(),K=De();Ne();const e=s(null),H=s(!1),u=s("1"),k=s(""),B=s(""),y=s(!1),T=s(!1),U="^[^ ]{8,}$",c=s(!1),w=s(""),le=s(!1),re=s(!1),C=s(""),E=s(0),R=s(0),V=s(0),j=s(!1),I=l(()=>r.currentNetworkProfileConfig?Math.floor(Fe.configReturn(r.currentNetworkProfileConfig.maxNamespaceDuration,Pe.DAY)):0),ie=l(()=>f.readBlockHeight),ce=l(()=>f.nativeToken.label);(async()=>{const a=Te.buildAPIEndpoint(r.selectedAPIEndpoint,r.currentNetworkProfile?r.currentNetworkProfile.httpPort:3e3),d=new Ie(a);E.value=await d.chainAPI.getBlockchainHeight()})();const de=l(()=>{let a=[];const d=P.listRootNamespaces(p.value);return a.push.apply(a,d),a}),ue=l(()=>f.nativeToken.label),D=l(()=>r.currentNetworkProfileConfig?u.value>0?i.convertToExact(r.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*P.calculateDuration(u.value),f.nativeToken.divisibility):i.convertToExact(r.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,f.nativeToken.divisibility):0),ge=l(()=>i.toCurrencyFormat(D.value,6)),ve=l(()=>r.currentNetworkProfileConfig?i.convertToExact(r.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),me=l(()=>r.currentNetworkProfileConfig?i.amountFormatterSimple(r.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),q=l(()=>r.currentNetworkProfile?i.convertToExact(Le.getLockFundFee(),f.nativeToken.divisibility):0),L=l(()=>(m.value?m.value.cosignerList.length:0)==0&&G(p.value)),fe=s(q.value.toString()),z=l(()=>ve.value+q.value),he=l(()=>!(k.value.match(U)&&!H.value&&!ne.value&&!L.value)),X=s(""),p=s(""),O=s(""),Q=s(""),Z=l(()=>x.currentLoggedInWallet?x.currentLoggedInWallet.selectDefaultAccount():null),be=s(Z.value?G(Z.value.address):!1),$=i.createAddress(t.address).plain();let b=l(()=>x.currentLoggedInWallet?x.currentLoggedInWallet.accounts.find(a=>a.address==$)||x.currentLoggedInWallet.others.find(a=>a.address==$):null);b.value&&(X.value=b.value.name,p.value=b.value.address,O.value=i.toCurrencyFormat(b.value.balance,f.nativeToken.divisibility),Q.value=b.value.balance);let ee=new Se("ThemeStyleConfig");ee.init();const we=s(je(t.address,40,ee.jdenticonConfig));if(b.value){let a=b.value.namespaces.find(d=>d.idHex===t.namespaceId);if(a!=null){R.value=a.endHeight;const d=a.name.split(".");d.length>1?w.value=d[0]:w.value=a.name}}const ae=s("0"),S=s(0);try{ae.value=i.convertToCurrency(P.getRootNamespaceTransactionFee(w.value,u.value),f.nativeToken.divisibility),S.value=i.convertToExact(P.getRootNamespaceTransactionFee(w.value,u.value),f.nativeToken.divisibility)}catch{}let Y=!1;A(u,a=>{if(a>I.value)u.value=I.value;else{let d=R.value-E.value,_=0;V.value=Math.ceil(d/(24*60*4)),parseInt(a)+V.value>I.value?(_=I.value-V.value,u.value=_.toString(),j.value=!0,Y=!0):(Y||(j.value=!1),Y=!1)}});const ke=()=>{u.value="1"},te=l(()=>G(i.createAddress(t.address).plain())?parseFloat(z.value)+D.value+S.value:D.value+S.value),ye=l(()=>i.amountFormatterSimple(te.value,0));A(te,a=>{O.value<a&&!L.value?y.value=!0:y.value=!1}),A(ie,a=>{E.value=a});const pe=()=>{if(!We.verifyWalletPassword(x.currentLoggedInWallet.name,r.chainNetworkName,k.value)){B.value=h("general.walletPasswordInvalid",{name:x.currentLoggedInWallet.name});return}se.value?P.extendNamespaceMultisig(se.value,k.value,w.value,u.value,p.value):P.extendNamespace(p.value,k.value,w.value,u.value),K.push({name:"ViewAccountPendingTransactions",params:{address:p.value}})},m=l(()=>{if(b.value)if(r.currentNetworkProfileConfig){let a=qe.getCosignerInWallet(b.value?b.value.publicKey:""),d=[];return a.cosignerList.forEach(_=>{d.push({publicKey:_,name:W(_).name,balance:W(_).balance,address:W(_).address})}),a.cosignerList=d,{hasCosigner:a.hasCosigner,cosignerList:a.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});C.value=m.value&&m.value.cosignerList.length>0?m.value.cosignerList[0].address:"",A(m,a=>{a&&a.cosignerList.length>0&&(C.value=a.cosignerList.length>0?m.value.cosignerList[0].address:"")});const ne=l(()=>L.value?Q.value<D.value+S.value:Q.value<D.value+S.value+z.value);A(L,a=>{a?(y.value=!0,T.value=!0):(y.value=!1,T.value=!1)});const se=l(()=>m.value.cosignerList.length>0?m.value.cosignerList.length>1?C.value:W(m.value.cosignerList[0].publicKey).address:""),_e=l(()=>{let a=oe(C.value)?oe(C.value).balance:0;return i.toCurrencyFormat(a)});return{namespaceSelect:e,selectedAccName:X,selectedAccAdd:p,balance:O,showNoBalance:ne,err:B,walletPassword:k,disableCreate:he,showPasswdError:c,disabledPassword:y,showDuration:le,disabledDuration:T,duration:u,showDurationErr:H,isMultiSigBool:be,rentalFee:D,rentalFeeCurrency:ge,lockFundTxFee:q,lockFundCurrency:me,currencyName:ue,lockFundTxFeeCurrency:fe,lockFundTotalFee:z,totalFeeFormatted:ye,selectNamespace:w,namespaceOption:de,extendNamespace:pe,transactionFee:ae,getMultiSigCosigner:m,cosignerBalanceInsufficient:re,cosignerAddress:C,isNotCosigner:L,block:E,endBlock:R,numDaysleft:V,showMaxDaysLabel:j,svgString:we,Helper:i,currentNativeTokenName:ce,maxDurationInDays:I,setDefaultDuration:ke,checkCosignBalance:_e}}},Qe={class:"w-10/12 ml-auto mr-auto"},Ye={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Ge={class:"xl:col-span-2 p-6 lg:p-12"},Je={class:"lg:flex lg:justify-between lg:items-center"},Ke={class:"font-semibold mb-4 inline-block mt-1"},Xe={class:"flex items-center"},Ze=["innerHTML"],$e={class:"ml-2"},ea={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},aa={class:"font-bold text-black text-sm"},ta={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},na={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},sa={class:"inline-block text-xs"},oa={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},la={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},ra={class:"inline-block text-xs"},ia={key:2,class:"error error_box"},ca={class:"text-right w-full"},da={key:0,class:"inline-block"},ua={class:"text-tsm text-left mt-3"},ga={key:0,class:"font-bold"},va={key:0,class:"error"},ma={key:1,class:"font-bold"},fa=["value"],ha={key:2,class:"error"},ba={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},wa=n("img",{src:ze},null,-1),ka={class:"ml-1"},ya={class:"uppercase text-blue-primary font-semibold text-xxs"},pa={class:"text-black text-sm font-bold"},_a={key:3,class:"text-xs inline-block text-gray-400"},xa={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Ca={class:"text-xs text-white my-5"},Da=["disabled"],Na={class:"text-center"};function Fa(t,h,K,e,H,u){const k=M("font-awesome-icon"),B=M("DurationInputClean"),y=M("TransactionFeeDisplay"),T=M("PasswordInput"),U=M("router-link");return g(),v("div",null,[n("div",Qe,[n("div",Ye,[n("div",Ge,[n("div",Je,[n("div",Ke,o(t.$t("general.extendDuration")),1),n("div",Xe,[n("div",{innerHTML:e.svgString,class:"inline-block"},null,8,Ze),n("div",$e,[n("div",ea,o(t.$t("namespace.namespaceCreatedBy")),1),n("div",aa,o(e.selectedAccName),1)])])]),e.showNoBalance?(g(),v("div",ta,[n("div",na,[N(k,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),n("div",sa,o(t.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(g(),v("div",oa,[n("div",la,[N(k,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),n("div",ra,o(t.$t("general.noCosigner")),1)])):F("",!0),e.err!=""?(g(),v("div",ia,o(e.err),1)):F("",!0),n("div",ca,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(g(),v("div",da,[n("div",ua,[J(o(t.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(g(),v("span",ga,[J(o(e.getMultiSigCosigner.cosignerList[0].name)+" ("+o(t.$t("general.balance"))+": "+o(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+o(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(g(),v("span",va,"- "+o(t.$t("general.insufficientBalance")),1)):F("",!0)])):(g(),v("span",ma,[Ae(n("select",{"onUpdate:modelValue":h[0]||(h[0]=c=>e.cosignerAddress=c)},[(g(!0),v(Be,null,Ee(e.getMultiSigCosigner.cosignerList,(c,w)=>(g(),v("option",{value:c.address,key:w},o(c.name)+" ("+o(t.$t("general.balance"))+": "+o(c.balance)+" "+o(e.currentNativeTokenName)+")",9,fa))),128))],512),[[Me,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(g(),v("div",ha,"- "+o(t.$t("general.insufficientBalance")),1)):F("",!0)])])):F("",!0)]),n("div",ba,[wa,n("div",ka,[n("div",ya,o(t.$t("general.namespace")),1),n("div",pa,o(e.selectNamespace),1)])]),N(B,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":h[1]||(h[1]=c=>e.duration=c),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:t.$t("namespace.duration"),showError:e.showDurationErr,toolTip:t.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+t.$t("general.year"):""} (${e.maxDurationInDays}`+t.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(g(),v("div",_a,o(t.$t("namespace.durationMsg2"))+" "+o(e.maxDurationInDays-e.numDaysleft)+" "+o(t.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):F("",!0)]),n("div",xa,[N(y,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),n("div",Ca,o(t.$t("general.enterPasswordContinue")),1),N(T,{placeholder:t.$t("general.password"),errorMessage:t.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":h[2]||(h[2]=c=>e.walletPassword=c),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),n("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:h[3]||(h[3]=(...c)=>e.extendNamespace&&e.extendNamespace(...c))},o(t.$t("general.extendDuration")),9,Da),n("div",Na,[N(U,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Ve(()=>[J(o(t.$t("general.cancel")),1)]),_:1})])])])])])}const Wa=xe(Oe,[["render",Fa]]);export{Wa as default};
