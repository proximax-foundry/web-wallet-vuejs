import{d as oe,j as ue,g as v,c as l,w as r,n as M,H as R,A as p,B as de,D as C,k as ce,x as m,r as W,o as Z,f as j,l as d,b as U,e as f,t as N,i as ve,h as H,s as me,F as ge}from"./index-2c45a7ef.js";import{a as x}from"./accountUtils-53c69855.js";import{T as pe}from"./TransactionLayout-d00a15b3.js";import{_ as fe}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-edfc58a0.js";import{M as G}from"./multisigUtils-d0b9e991.js";import{_ as be}from"./AddressInputClean.vue_vue_type_style_index_0_lang-41b9087c.js";import{_ as ke}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-fc383c4d.js";import{_ as ye}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-fac7ebd1.js";import{T as V}from"./transactionState-1ddd1cc3.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-a7dc29d8.js";import"./jdenticon-module-eb1215b2.js";import"./functions-edc91899.js";import"./TextInput-a8bef4d1.js";import"./TextInputClean-d9b842de.js";import"./icon-key-5b3f7dda.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-7f116348.js";import"./proximax-logo-ecfc3767.js";const Ae={key:0,class:"text-tsm flex gap-2 items-center"},he={class:"font-semibold mt-3"},Le={class:"flex flex-col"},we={class:"flex mt-3 gap-1"},Te=["disabled"],Ie=["disabled"],Ce={class:"text-center"},Ne="^[0-9A-Za-z]{40}$",xe="^[0-9A-Za-z-]{46}$",_e=oe({__name:"ViewAccountAliasAddressToNamespace",props:{address:{}},setup(c){const{t:A}=ue(),F=v({name:"",value:""}),_=[{value:"Link",label:A("general.link")},{value:"Unlink",label:A("general.unlink")}],n=v({value:"Link",label:A("general.link")}),i=v(null),h=e=>{let t=r.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length,multisigInfo:a.multisigInfo})),s=r.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0,multisigInfo:a.multisigInfo}));return t.concat(s).find(a=>a.publicKey==e)},L=l(()=>{var e;return((e=r.currentLoggedInWallet)==null?void 0:e.accounts.find(t=>t.address==c.address))||r.currentLoggedInWallet.others.find(t=>t.address==c.address)}),q=v(""),u=v(""),I=v(!0),B=v(""),P=l(()=>M.currentNetworkProfileConfig?R.convertToExact(M.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility):0),D=l(()=>M.currentNetworkProfile?R.convertToExact(de.getLockFundFee(),p.nativeToken.divisibility):0);r.currentLoggedInWallet&&r.currentLoggedInWallet.name;const w=v(0),K=l(()=>{let e=p.nativeToken.divisibility;return g.value.hasCosigner?e==0?Math.trunc(w.value+P.value+D.value):Math.round((w.value+P.value+D.value)*Math.pow(10,p.nativeToken.divisibility))/Math.pow(10,p.nativeToken.divisibility):w.value}),E=l(()=>L.value?L.value.balance:0),J=l(()=>p.nativeToken.divisibility),Q=l(()=>r.currentLoggedInWallet?R.toCurrencyFormat(E.value,J.value):"0"),z=l(()=>{var e=!1;return g.value.hasCosigner?h(b.value)&&(h(b.value).balance<K.value?e=!0:e=!1):E.value<K.value&&(e=!0),e}),X=l(()=>!(z.value==!1&&u.value!=""&&i.value.value!=null&&I.value==!1)),Y=l(()=>x.namespaceOption(c.address,n.value.value)),ee=l(()=>{var t,s;return(((t=r.currentLoggedInWallet)==null?void 0:t.accounts.find(a=>a.address==c.address))||((s=r.currentLoggedInWallet)==null?void 0:s.others.find(a=>a.address==c.address))).namespaces.filter(a=>a.active==!0)}),g=l(()=>{if(M.currentNetworkProfileConfig){const t=G.getCosignerInWallet(L.value.publicKey?L.value.publicKey:"").cosignerList.map(a=>({publicKey:a,name:h(a).name,balance:h(a).balance,address:h(a).address}));let s=!1;return t.length>0&&(s=!0),{hasCosigner:s,cosignerList:t}}else return{hasCosigner:!1,cosignerList:[]}}),ae=l(()=>g.value.cosignerList.map(e=>({name:e.name,value:e.publicKey}))),b=v("");C(F,e=>{e.value!=""?b.value=e.value:b.value=""},{deep:!0});const O=l(()=>L.value?G.getCosignerInWallet(L.value.publicKey).cosignerList.length>0:!1),S=l(()=>!!(!O.value&&g.value.hasCosigner||!ee.value.length));C(n,()=>{u.value="",i.value=null},{immediate:!0}),C(i,e=>{var a;const s=x.getNamespaceListByAddress(c.address).find(k=>{var T;return k.name===((T=i.value)==null?void 0:T.value)});if(n.value.value=="Unlink"&&e!=null)u.value=m.Address.createFromRawAddress(s.linkedId).pretty();else if(n.value.value=="Link"&&u.value!=""&&e.value!=null){let k=m.Address.createFromRawAddress(u.value).plain();w.value=x.getLinkNamespaceToAddressTransactionFee(g.value.hasCosigner,k,(a=i.value)==null?void 0:a.value,n.value.value)/Math.pow(10,p.nativeToken.divisibility)}}),C(u,e=>{var t;if(e.length==46&&e.match(xe)||e.length==40&&e.match(Ne))if(x.verifyAddress(c.address,u.value).isPassed==!1)B.value="Invalid Address",I.value=!0;else{let a=m.Address.createFromRawAddress(e).plain();w.value=x.getLinkNamespaceToAddressTransactionFee(g.value.hasCosigner,a,(t=i.value)==null?void 0:t.value,n.value.value)/Math.pow(10,p.nativeToken.divisibility),B.value="",I.value=!1}else I.value=!0});const te=ce(),se=()=>{var o;let e=r.currentLoggedInWallet.accounts.find(y=>y.address==c.address)?r.currentLoggedInWallet.accounts.find(y=>y.address==c.address):r.currentLoggedInWallet.others.find(y=>y.address==c.address);q.value="";const t=p.buildTxn,s=n.value.value=="Link"?m.AliasActionType.Link:m.AliasActionType.Unlink,a=new m.NamespaceId((o=i.value)==null?void 0:o.value),k=m.Address.createFromRawAddress(u.value),T=t.addressAliasBuilder().actionType(s).namespaceId(a).address(k).build();if(b.value){let y=r.currentLoggedInWallet.accounts.find(ie=>ie.publicKey==b.value).address;V.selectedAddress=y,V.selectedMultisigAddress=e.address}else V.selectedAddress=e.address;V.unsignedTransactionPayload=T.serialize(),te.push({name:"ViewConfirmTransaction"})},le=l(()=>{let e=h(b.value);return e?e.balance:0});C(g,e=>{e.cosignerList.length&&(F.value={name:e.cosignerList[0].name,value:e.cosignerList[0].publicKey})},{immediate:!0});const $=v(!1),ne=e=>{$.value=!1,u.value=e.data},re=l(()=>{const e=r.currentLoggedInWallet;if(!e)return[];const t=[...e.accounts,...e.others];return e.contacts.length?[{key:"0",label:A("general.ownerAcc"),selectable:!1,children:t.map((s,a)=>({key:"0-"+a.toString(),label:s.name,data:m.Address.createFromRawAddress(s.address).pretty(),selectable:!0}))},{key:"1",label:A("general.contact"),selectable:!1,children:e.contacts.map((s,a)=>({key:"1-"+a.toString(),label:s.name,data:m.Address.createFromRawAddress(s.address).pretty(),selectable:!0}))}]:[{key:"0",label:A("general.ownerAcc"),selectable:!1,children:t.map((s,a)=>({key:"0-"+a.toString(),label:s.name,data:m.Address.createFromRawAddress(s.address).pretty(),selectable:!0}))}]});return(e,t)=>{const s=W("Sidebar"),a=W("Dropdown"),k=W("font-awesome-icon"),T=W("router-link");return Z(),j(ge,null,[d(s,{visible:$.value,"onUpdate:visible":t[0]||(t[0]=o=>$.value=o),baseZIndex:1e4,position:"full"},{default:U(()=>[d(ye,{contacts:re.value,onNodeSelect:ne},null,8,["contacts"])]),_:1},8,["visible"]),d(fe,{address:e.address,selected:"details"},null,8,["address"]),d(pe,null,{white:U(()=>[g.value.cosignerList.length?(Z(),j("div",Ae,[f("div",null,N(e.$t("general.initiateBy"))+":",1),d(a,{modelValue:F.value,"onUpdate:modelValue":t[1]||(t[1]=o=>F.value=o),options:ae.value,class:"text-tsm","option-label":"name"},null,8,["modelValue","options"])])):ve("",!0),f("div",he,N(n.value.value=="Link"?e.$t("general.linkToNamespace"):e.$t("namespace.manageNamespace")),1),f("div",Le,[d(a,{class:"my-3",placeholder:e.$t("namespace.selectAction"),modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value=o),options:_,"option-label":"label",disabled:S.value},null,8,["placeholder","modelValue","disabled"]),d(a,{placeholder:e.$t("namespace.selectNamespace"),modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=o=>i.value=o),"option-label":"label",options:Y.value,"option-disabled":"disabled",disabled:S.value},null,8,["placeholder","modelValue","options","disabled"])]),f("div",we,[d(be,{placeholder:e.$t("general.addAccAddress"),modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=o=>u.value=o),errorMessage:B.value,showError:I.value,disabled:S.value||n.value.value=="Unlink"||i.value==null},null,8,["placeholder","modelValue","errorMessage","showError","disabled"]),f("button",{class:"border rounded-md cursor-pointer flex flex-col justify-around p-2",onClick:t[5]||(t[5]=o=>$.value=!0),disabled:S.value||n.value.value=="Unlink"||i.value==null},[d(k,{icon:"id-card-alt",class:H([i.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","ml-auto mr-auto"])},null,8,["class"]),f("div",{class:H([i.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","text-xxs font-semibold uppercase"])},N(e.$t("general.select")),3)],8,Te)])]),navy:U(()=>[d(ke,{"transaction-fee":String(w.value),"total-fee-formatted":String(K.value),"get-multi-sig-cosigner":g.value,"check-cosign-balance":String(le.value),"lock-fund-currency":String(P.value),"lock-fund-tx-fee":String(D.value),balance:Q.value,"selected-acc-add":e.address,"is-cosigner":O.value,"fund-status":z.value},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add","is-cosigner","fund-status"]),t[6]||(t[6]=f("div",{class:"mt-3"},null,-1)),f("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:se,disabled:X.value},N(n.value.value=="Unlink"?e.$t("namespace.unlinkNamespace"):e.$t("general.linkToNamespace")),9,Ie),f("div",Ce,[d(T,{to:{name:"ViewAccountDetails",params:{address:e.address}},class:"content-center text-xs text-white underline"},{default:U(()=>[me(N(e.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}}});export{_e as default};
