import{_ as Ve,u as Ke,l as Le,r as i,w as F,H as O,B as m,c as y,n as Z,S as de,a as K,z as P,i as x,o as N,b as D,e as l,m as k,t as g,f as j,F as Be,g as We,v as ve,ar as Oe,O as me,R as pe,x as je,h as Re,W as fe,I as He,J as qe}from"./index-8a270fd9.js";import{_ as ze}from"./PasswordInput.vue_vue_type_script_setup_true_lang-133d9fe7.js";import{T as Je}from"./TextInput-eba3d63b.js";import{_ as Ze,a as Ge}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-e2d933f1.js";import{T as Qe}from"./TextInputClean-af1a7c6f.js";import{M as G}from"./multisigUtils-7e8c1c9b.js";import{_ as Xe}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-7f0a7aa6.js";import{A as Ye,_ as $e}from"./AccountTabs.vue_vue_type_script_setup_true_lang-061fe7b7.js";import{T as re}from"./transactionState-74c0b1e9.js";import{_ as et}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-e8bbf2b2.js";import"./functions-530edc40.js";import"./icon-key-5b3f7dda.js";const tt={name:"ViewConvertAccountMultisig",components:{PasswordInput:ze,TextInput:Je,TextInputClean:Qe,SelectAccountAndContact:Xe,AccountComponent:Ye,AccountTabs:$e,TransactionFeeDisplay:Ze},props:{address:String},setup(c){const{t:o}=Ke(),L=Le();Re().appContext.config.globalProperties.emitter;const _=i(""),M=i(""),B=i(""),U=i(!1),S=i(""),X=i(!1),R="^[^ ]{8,}$",p=i(1),f=i(1),d=i(0),v=i(0),Y="^[0-9A-Fa-f]{64}$",a=i([]),n=i([]),b=i([]),$=i([]),h=i([]),ee=i([]),W=i(!1),ge=i(!1),H=F.currentLoggedInWallet?F.currentLoggedInWallet.selectDefaultAccount():null,be=i(H?H.address:""),ye=i(O.toCurrencyFormat(H?H.balance:0,m.nativeToken.divisibility)),te=y(()=>O.convertToCurrency(Z.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility)),ae=y(()=>Z.currentNetworkProfile?O.convertToExact(de.getLockFundFee(),m.nativeToken.divisibility):0),q=i(0),u=y(()=>F.currentLoggedInWallet?F.currentLoggedInWallet.accounts.find(e=>e.address===c.address):null);let le=y(()=>{if(u.value)return G.checkIsMultiSig(u.value.address)}),z=()=>{u.value&&(q.value=G.getAggregateFee(u.value.publicKey,a.value,p.value,f.value))};z();const V=y(()=>{let e=m.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(q.value)+parseFloat(te.value)+ae.value):Math.round((parseFloat(q.value)+parseFloat(te.value)+ae.value)*Math.pow(10,e))/Math.pow(10,e)}),_e=y(()=>m.nativeToken.label),he=y(()=>m.nativeToken.divisibility);y(()=>F.currentLoggedInWallet?O.toCurrencyFormat(u.value.balance,he.value):"0");const ce=y(()=>{if(!u.value)return!1;const e=F.currentLoggedInWallet;let s=e.accounts.map(A=>({name:A.name,publicKey:A.publicKey})),r=e.contacts;var T=[],w=0;return T.push({key:"0",label:o("general.ownerAcc"),selectable:!1,children:[]}),s.forEach(A=>{T[0].children.push({key:"0-"+w.toString(),label:A.name,data:A.publicKey}),w++}),w=0,T.push({key:"1",label:o("general.contact"),selectable:!1,children:[]}),r!=null&&r.forEach(A=>{T[1].children.push({key:"1-"+w.toString(),label:A.name,data:A.address}),w++}),T});function we(e,s){ie(s),b.value[s]=e.label,e.key[0]=="1"?Ae(e.data,s):a.value[s]=e.data,a.value[s]=e.data,ee.value[s]=!1,n.value[s][e.key]=!0,e.selectable=!1}function Ae(e,s){try{G.verifyContactPublicKey(e).then(r=>{r.status==!0?a.value[s]=r.publicKey:_.value=o("multisig.noPublicKey")})}catch{_.value=o("multisig.noPublicKey")}}const ie=e=>{if(Object.keys(n.value[e]).length!==0){let s=Object.keys(n.value[e])[0].split("-");ce.value[s[0]].children[s[1]].selectable=!0,n.value[e]={}}},xe=y(()=>le.value||W.value||!S.value.match(R)||a.value.length==0||_.value||h.value.every(e=>e==!1)==!1||f.value==0||p.value==0||u.value.balance<V.value),ke=y(()=>{if(!u.value)return!1;var e=!1;if(u.value.balance>=V.value&&!W.value){for(var s=0;s<a.value.length;s++)if(h.value[s]!=""){e=!0;break}else if(a.value[s].length<40){e=!0;break}}else e=!0;return e}),ue=()=>{a.value=[],$.value=[],h.value=[],S.value="",p.value=1,d.value=0,f.value=1,v.value=0,M.value=""},Ce=async()=>{const e=F.currentLoggedInWallet;if(!fe.verifyWalletPassword(e.name,Z.chainNetworkName,S.value))B.value=o("general.walletPasswordInvalid",{name:F.currentLoggedInWallet.name});else{let r={};const T=[],w=e.accounts.find(E=>E.name===u.value.name);if(!w)throw new Error("Account not found");const A=fe.decryptPrivateKey(new P.Password(S.value),w.encrypted,w.iv),Ee=P.Account.createFromPrivateKey(A,m.networkType,1);if(!m.chainAPI)throw new Error("Service unavailable");let J=null;for(const E of a.value){if(E.length==64)J=P.PublicAccount.createFromPublicKey(E,m.networkType);else if(E.length==40||E.length==46){const Ue=P.Address.createFromRawAddress(E);try{const ne=await m.chainAPI.accountAPI.getAccountInfo(Ue);J=P.PublicAccount.createFromPublicKey(ne.publicKey,m.networkType)}catch(ne){console.log(ne)}}J&&T.push(new P.MultisigCosignatoryModification(P.MultisigCosignatoryModificationType.Add,J))}if(!m.buildTxn)throw new Error("Service unavailable");const Me=m.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(p.value).minRemovalDelta(f.value).modifications(T).build();r=de.signTxnWithPassword(u.value.address,Ee.address.plain(),S.value,Me),B.value="",ue(),re.lockHashPayload=r.hashLockTxnPayload,re.transactionPayload=r.txnPayload,re.selectedAddress=c.address,L.push({name:"ViewConfirmTransaction"})}};K(()=>[...a.value],async e=>{let s=!1;if(M.value="",a.value.length>0)for(var r=0;r<a.value.length;r++)a.value[r].length==64?a.value[r]==u.value.publicKey&&s==!1?(s=!0,h.value[r]=!0,_.value=o("multisig.selectedAccErr")):!a.value[r].match(Y)&&a.value[r].length==64?h.value[r]=!0:(h.value[r]=!1,Array.from(new Set(e)).length!=e.length?_.value=o("multisig.duplicatedCosigner"):s==!1&&(_.value="",await De(a.value[r])?M.value="":M.value="Input public key does not exist")):h.value[r]=!0;else _.value=""},{deep:!0}),K(()=>[...h.value],e=>{e.every(s=>s==!1)&&z()},{deep:!0});const Te=()=>{a.value.push(""),n.value.push({}),h.value.push(!1),d.value+=1,v.value+=1},Pe=e=>{d.value>0&&(d.value-=1),v.value>0&&(v.value-=1),f.value>v.value&&(f.value=v.value),p.value>d.value&&(p.value=d.value),ie(e),a.value.splice(e,1),n.value.splice(e,1),b.value.splice(e,1),ee.value.splice(e,1),$.value.splice(e,1),h.value.splice(e,1)},Se=e=>{p.value*10*~~(d.value/10)+e.charCode-48>d.value&&e.preventDefault()};let oe=o("multisig.deletionExceedMax"),se=o("multisig.approvalExceedMax"),C="";K(p,e=>{z(),d.value==0&&e>1||e>d.value&&e!=1&&d.value!=0?C=se:d.value>0&&e<=0?C=o("multisig.approvalAtLeastOne"):f.value>v.value&&f.value!=1&&v.value!=0?C=oe:C=""});const Ie=e=>{f.value*10*~~(v.value/10)+e.charCode-48>v.value&&e.preventDefault()};let I="";K(f,e=>{z(),v.value==0&&e>1||e>v.value&&e!=1&&v.value!=0?I=oe:v.value>0&&e<=0?I=o("multisig.deletionAtLeastOne"):p.value>d.value&&p.value!=1&&d.value!=0?I=se:I=""}),K([p,f],()=>{C!=""&&I!=""?_.value=C+`
`+I:C!=""?_.value=C:_.value=I});const Fe=y(()=>W.value||le.value);u.value&&G.onPartial(P.PublicAccount.createFromPublicKey(u.value.publicKey,m.networkType)).then(e=>W.value=e),u.value&&u.value.balance<V.value&&(U.value=!0),K(u,e=>{e&&(e.balance<V.value?U.value=!0:U.value=!1)});const Ne=y(()=>O.amountFormatterSimple(V.value,0)),De=async e=>{const s=P.PublicAccount.createFromPublicKey(e,m.networkType);try{return!!await m.chainAPI.accountAPI.getAccountInfo(s.address)}catch{return!1}};return{networkState:Z,toggleContact:ee,contact:ce,space:ge,currentNativeTokenName:_e,contactName:b,err:_,disableSend:xe,numApproveTransaction:p,numDeleteUser:f,maxNumApproveTransaction:d,maxNumDeleteUser:v,fundStatus:U,acc:u,passwd:S,showPasswdError:X,showAddressError:h,addCoSig:Te,coSign:a,addCoSigButton:ke,selectedNode:n,deleteCoSigAddressInput:Pe,onNodeSelect:we,selectedAddresses:$,clear:ue,convertAccount:Ce,disabledPassword:Fe,onPartial:W,isMultisig:le,passwdPattern:R,validateApproval:Se,validateDelete:Ie,lockFundCurrency:te,lockFundTxFee:ae,aggregateFee:q,totalFee:V,totalFeeFormatted:Ne,selectedAccAdd:be,accBalance:ye,passwordErr:B,inputPkNotExist:M}}},Q=c=>(He("data-v-a98307cd"),c=c(),qe(),c),at={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},lt={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},ot={class:"lg:col-span-2 py-6 pr-6"},st={class:"text-xs font-semibold pl-6"},nt={class:"pl-6"},rt={key:0,class:"error error_box mb-5 whitespace-pre"},ct={key:1,class:"flex gap-2 bg-yellow-50 py-2 rounded-md px-2 my-3 mb-5"},it=Q(()=>l("img",{src:Ge,class:"w-5 h-5"},null,-1)),ut={class:"text-xs font-bold pt-1"},dt={key:2,class:"error error_box mb-5"},vt=Q(()=>l("div",{class:"mt-4"},null,-1)),mt={class:"flex flex-col gap-2"},pt={class:"flex"},ft=["onClick"],gt={key:0,class:"mt-16"},bt=["onClick"],yt={class:"text-xxs text-blue-primary font-semibold uppercase"},_t={key:0},ht=["disabled"],wt=Q(()=>l("div",{class:"ml-6 my-7 gray-line"},null,-1)),At={class:"pl-6 text-xs font-semibold mb-3"},xt={class:"flex gap-2 pl-6"},kt={class:"border w-6/12"},Ct={class:"border-b-2 text-xxs text-center py-1 uppercase"},Tt={class:"flex justify-around"},Pt=["disabled"],St=["max"],It=["disabled"],Ft={class:"text-xxs border-t-2 text-center py-1 uppercase"},Nt={class:"border w-6/12"},Dt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Et={class:"flex justify-around"},Mt=["disabled"],Ut=["max"],Vt=["disabled"],Kt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Lt={class:"bg-navy-primary p-6 lg:col-span-1"},Bt=Q(()=>l("div",{class:"mt-5"},null,-1)),Wt={class:"font-semibold text-xs text-white mb-1.5"},Ot={class:"mt-3"},jt=["disabled"],Rt={class:"text-center"};function Ht(c,o,L,t,_,M){const B=x("AccountComponent"),U=x("AccountTabs"),S=x("TextInput"),X=x("TextInputClean"),R=x("font-awesome-icon"),p=x("SelectAccountAndContact"),f=x("Sidebar"),d=x("TransactionFeeDisplay"),v=x("PasswordInput"),Y=x("router-link");return N(),D("div",null,[l("div",at,[k(B,{address:L.address,class:"mb-6"},null,8,["address"]),k(U,{address:L.address,selected:"multisig"},null,8,["address"]),l("div",lt,[l("div",ot,[l("div",st,g(c.$t("multisig.manageCosignatories")),1),l("div",nt,[t.err!=""?(N(),D("div",rt,g(t.err),1)):j("",!0),t.inputPkNotExist!=""?(N(),D("div",ct,[it,l("div",ut,g(t.inputPkNotExist),1)])):j("",!0),t.passwordErr!=""?(N(),D("div",dt,g(t.passwordErr),1)):j("",!0)]),vt,l("div",mt,[(N(!0),D(Be,null,We(t.coSign,(a,n)=>(N(),D("div",{key:n},[l("div",pt,[l("img",{src:et,onClick:b=>t.deleteCoSigAddressInput(n),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,ft),k(S,{class:"w-5/12 mr-2",placeholder:c.$t("multisig.cosignatory")+`${n+1}`,modelValue:t.contactName[n],"onUpdate:modelValue":b=>t.contactName[n]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),k(X,{class:"w-7/12 mr-2",placeholder:c.$t("general.publicKey"),errorMessage:c.$t("general.invalidInput"),showError:t.showAddressError[n],modelValue:t.coSign[n],"onUpdate:modelValue":b=>t.coSign[n]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[n]==!0?(N(),D("div",gt)):j("",!0),l("div",{onClick:b=>t.toggleContact[n]=!t.toggleContact[n],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[k(R,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),l("div",yt,g(c.$t("general.select")),1)],8,bt)]),t.toggleContact[n]?(N(),D("div",_t,[k(f,{visible:t.toggleContact[n],"onUpdate:visible":b=>t.toggleContact[n]=b,baseZIndex:1e4,position:"full"},{default:ve(()=>[k(p,Oe(n,{contacts:t.contact,index:n,selectedNode:t.selectedNode[n],onNodeSelect:b=>t.onNodeSelect(b,n)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):j("",!0)]))),128))]),l("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:o[0]||(o[0]=(...a)=>t.addCoSig&&t.addCoSig(...a)),disabled:t.addCoSigButton},"+"+g(c.$t("multisig.addNewCosignatory")),9,ht),wt,l("div",At,g(c.$t("general.scheme")),1),l("div",xt,[l("div",kt,[l("div",Ct,g(c.$t("multisig.transactionsApproval")),1),l("div",Tt,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[1]||(o[1]=a=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,Pt),me(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[2]||(o[2]=(...a)=>t.validateApproval&&t.validateApproval(...a)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":o[3]||(o[3]=a=>t.numApproveTransaction=a)},null,40,St),[[pe,t.numApproveTransaction]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:o[4]||(o[4]=a=>t.numApproveTransaction++)},"+",8,It)]),l("div",Ft,g(c.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),l("div",Nt,[l("div",Dt,g(c.$t("multisig.accountDeletionApproval")),1),l("div",Et,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[5]||(o[5]=a=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,Mt),me(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[6]||(o[6]=(...a)=>t.validateDelete&&t.validateDelete(...a)),max:t.maxNumDeleteUser,"onUpdate:modelValue":o[7]||(o[7]=a=>t.numDeleteUser=a)},null,40,Ut),[[pe,t.numDeleteUser]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:o[8]||(o[8]=a=>t.numDeleteUser++)},"+",8,Vt)]),l("div",Kt,g(c.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),l("div",Lt,[k(d,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),Bt,l("div",Wt,g(c.$t("general.enterPasswordContinue")),1),k(v,{placeholder:c.$t("general.enterPassword"),errorMessage:c.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":o[9]||(o[9]=a=>t.passwd=a),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),l("div",Ot,[l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:o[10]||(o[10]=a=>t.convertAccount()),disabled:t.disableSend},g(c.$t("multisig.updateCosignatories")),9,jt)]),l("div",Rt,[k(Y,{to:{name:"ViewMultisigHome",params:{address:L.address}},class:"content-center text-xs text-white underline"},{default:ve(()=>[je(g(c.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const na=Ve(tt,[["render",Ht],["__scopeId","data-v-a98307cd"]]);export{na as default};
