import{d as Ce,c as M,r as F,H as p,n as X,B as o,R as O,z as n,w as x,A as Be,a as R,l as Ve,i as Ue,o as g,b as y,e as a,f as w,m as P,t as s,y as u,v as $e,x as We,h as Oe,W as ke,be as Re}from"./index-63d33769.js";import{_ as Fe}from"./proximax-logo-ecfc3767.js";import{_ as Ke,a as je,I as Xe}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-540af0e8.js";import{_ as ze}from"./PasswordInput.vue_vue_type_script_setup_true_lang-739fdc90.js";import"./jdenticon-module-ba46c3b9.js";const qe={class:"border-2 xl:grid xl:grid-cols-3"},Je={class:"xl:col-span-2 p-12"},Qe=a("div",null,"SDA-SDA Exchange ",-1),Ye={key:0,class:"text-xs mt-3 text-blue-primary"},Ze=a("div",{class:"text-blue-primary mt-3"},"Available Amount",-1),et=a("div",{class:"text-blue-primary mt-3"},"Minimum Offer ",-1),tt={class:"text-blue-primary mt-3"},at={key:1,class:"text-red-500 text-xs"},it={key:2,class:"text-red-500 text-xs"},st={class:"mt-2 text-xs text-gray-600"},ot={class:"flex mt-2"},lt={class:"text-gray-600 text-xs"},nt={key:0,class:"text-red-500 text-xs ml-2"},ct={key:3,class:"text-gray-600 text-xs mt-2"},rt=a("div",{class:"text-blue-primary mt-3"},"Actual offer",-1),ut={key:4},dt={key:5},vt={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},mt={key:0},pt={class:"font-bold text-xs text-blue-primary uppercase"},gt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},yt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},ft=["innerHTML"],ht={class:"flex"},bt={class:"ml-1 text-blue-400 font-bold"},xt=a("img",{src:Fe,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),_t={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},wt=a("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Gt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Tt={class:"ml-1 text-blue-400 text-xs"},At=a("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),It={class:"font-bold text-xs text-blue-primary uppercase"},Mt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},kt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Ft=["innerHTML"],Dt={class:"flex"},Nt={class:"ml-1 text-blue-400 font-bold"},Lt=a("img",{src:Fe,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),Et=a("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Ht={key:1},Pt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},St=a("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Ct={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Bt={class:"ml-1 text-blue-400 text-xs"},Vt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Ut={class:"font-semibold lg:col-span-2 col-span-3"},$t=["innerHTML"],Wt={class:"ml-1 text-blue-400"},Ot={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Rt={class:"font-semibold lg:col-span-2 col-span-3"},Kt=["innerHTML"],jt={class:"ml-1 text-blue-400"},Xt={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},zt={class:"font-semibold lg:col-span-2 col-span-3"},qt=["innerHTML"],Jt={class:"ml-1 text-blue-400"},Qt=a("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Yt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Zt=a("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"},"Total",-1),ea=["innerHTML"],ta={class:"ml-1 text-blue-400"},aa={class:"font-semibold text-xs text-white mb-1.5"},ia={class:"text-center"},ua=Ce({__name:"ViewExchange",props:{type:String,owner:String,pair:String},setup(De){const z=(t,i)=>{const l=(m,b)=>b===0?m:l(b,m%b),v=l(t,i),r=t/v,f=i/v;return[r,f]},_=M(()=>{var t,i,l;return parseFloat(c.value)<A.value[0]/Math.pow(10,(t=e.value)==null?void 0:t.mosaicGetDivisibility)?0:parseFloat(c.value)*Math.pow(10,(i=e.value)==null?void 0:i.mosaicGetDivisibility)%A.value[0]/Math.pow(10,(l=e.value)==null?void 0:l.mosaicGetDivisibility)}),Ne=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],c=F("0"),D=M(()=>parseFloat(c.value)*j.value-_.value*j.value),q=Oe().appContext.config.globalProperties.emitter,N=F(""),G=F(null),T=F(null),J=M(()=>p.convertToExact(X.currentNetworkProfileConfig.lockedFundsPerAggregate,o.nativeToken.divisibility)),Q=M(()=>p.convertToExact(O.getLockFundFee(),o.nativeToken.divisibility)),S=M(()=>{var v,r,f,m;if(!o.isReady)return 0;const t=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(parseFloat(c.value)*Math.pow(10,((v=e.value)==null?void 0:v.mosaicGetDivisibility)??0)),new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(D.value*Math.pow(10,((r=e.value)==null?void 0:r.mosaicGiveDivisibility)??0)),(f=e.value)==null?void 0:f.deadline)],o.networkType);if(!I.value)return((m=t.maxFee)==null?void 0:m.compact())/Math.pow(10,o.nativeToken.divisibility);const i=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(b=>b.address==T.value),l=[t.toAggregateV1(n.PublicAccount.createFromPublicKey(i.publicKey,o.networkType))];return o.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,o.nativeToken.divisibility)});q.on("select-account",t=>{G.value=t}),q.on("select-multisig-account",t=>{T.value=t});const d=t=>{const i=Ne.find(l=>l.namespace==t);return i?i.name:t},K=M(()=>I.value?Math.round((J.value+Q.value+S.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()?Math.round((parseFloat(c.value)-_.value+S.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):S.value),L=De,e=F(null),j=F(0),h=Be(),Y=L.pair.split("/")[L.type=="Sell"?0:1],Z=L.pair.split("/")[L.type=="Sell"?1:0],k=F(0),ee=t=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==t)||x.currentLoggedInWallet.others.find(l=>l.address==t);return i?E(i.balance):0},E=t=>{let i=t.toString().split(".");return i[1]!=null?'<span class="font-semibold text-sm">'+i[0]+'</span>.<span class="font-semibold text-xs">'+i[1]+"</span>":'<span class="font-semibold text-sm">'+i[0]+"</span>"},A=M(()=>{if(!e.value)return z(0,0);const t=e.value.initialMosaicGiveAmount.compact(),i=e.value.initialMosaicGetAmount.compact();return z(i,t)});R(e,t=>{t.mosaicGetDivisibility&&(c.value=(A.value[0]/Math.pow(10,t.mosaicGetDivisibility)).toString())},{deep:!0});const I=M(()=>T.value!=null),Le=async()=>{if(!Y||!Z){h.add({severity:"error",summary:"Error",detail:"Invalid",group:"br-custom",life:1e3});return}const t=new n.ExchangeSdaHttp(o.nodeFullURL),i=await Re(t.getAccountSdaExchangeOffers(n.Address.createFromRawAddress(L.owner)));if(e.value=i.sdaOfferBalances.find(r=>r.mosaicIdGive.toHex()==Y&&r.mosaicIdGet.toHex()==Z),!e.value){h.add({severity:"error",summary:"Error",detail:"Offer not found",group:"br-custom",life:1e3});return}const l=await o.chainAPI.assetAPI.getMosaicsNames([e.value.mosaicIdGet,e.value.mosaicIdGive]),v=await o.chainAPI.assetAPI.getMosaics([e.value.mosaicIdGet,e.value.mosaicIdGive]);e.value.mosaicGetName=l[0].names.length?l[0].names[0].name:e.value.mosaicIdGet.toHex(),e.value.mosaicGiveName=l[1].names.length?l[1].names[0].name:e.value.mosaicIdGive.toHex(),e.value.mosaicGetDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGet.toHex()).divisibility,e.value.mosaicGiveDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGive.toHex()).divisibility,j.value=e.value.initialMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)/(e.value.initialMosaicGetAmount.compact()/Math.pow(10,e.value.mosaicGetDivisibility))},te=async t=>{try{const l=(await o.chainAPI.accountAPI.getAccountInfo(n.Address.createFromRawAddress(t))).mosaics.find(v=>v.id.toHex()==e.value.mosaicIdGet.toHex());if(!l){k.value=0;return}k.value=l.amount.compact()/Math.pow(10,e.value.mosaicGetDivisibility)}catch{k.value=0}};R(c,t=>{isNaN(parseFloat(t))&&(c.value="0")}),R([G,T],([t,i])=>{k.value=0,t!=null&&i==null?te(t):t!=null&&i!=null&&te(i)});const Ee=R(o,async(t,i)=>{t.isReady&&(await Le(),Ee())},{immediate:!0}),He=t=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==t)||x.currentLoggedInWallet.others.find(l=>l.address==t);return i?i.balance:0},Pe=Ve(),Se=async()=>{if(G.value==null){h.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(parseFloat(c.value)<A.value[0]/Math.pow(10,e.value.mosaicGetDivisibility)){h.add({severity:"error",summary:"Error",detail:"Less than minimum offer amount",group:"br-custom",life:1e3});return}if(parseFloat(c.value)-_.value>k.value){h.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))/Math.pow(10,e.value.mosaicGiveDivisibility)>e.value.currentMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)){h.add({severity:"error",summary:"Error",detail:"Exceed available amount of "+d(e.value.mosaicGiveName),group:"br-custom",life:1e3});return}const t=He(G.value);if(I.value&&t<K.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()&&!I.value&&t<K.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(N.value.length<8){h.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!ke.verifyWalletPassword(x.currentLoggedInWallet.name,X.chainNetworkName,N.value)){h.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const i=x.currentLoggedInWallet.accounts.find(m=>m.address==G.value),l=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(e.value.mosaicIdGet,n.UInt64.fromUint(Math.trunc((parseFloat(c.value)-_.value)*Math.pow(10,e.value.mosaicGetDivisibility))),e.value.mosaicIdGive,n.UInt64.fromUint(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))),n.UInt64.fromUint(57600))],o.networkType),v=ke.decryptPrivateKey(new n.Password(N.value),i.encrypted,i.iv);N.value="";const r=n.Account.createFromPrivateKeyV1(v,o.networkType),f=X.currentNetworkProfile.generationHash;if(I.value){const m=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find($=>$.address==T.value),b=[l.toAggregateV1(n.PublicAccount.createFromPublicKey(m.publicKey,o.networkType))],C=await o.chainAPI.nodeAPI.getNodeTime(),B=o.buildTxn.aggregateBonded(b,new n.UInt64(C.sendTimeStamp)),H=r.preV2Sign(B,f),V=O.lockFundTx(H),U=r.preV2Sign(V,f);O.announceLF_AND_addAutoAnnounceABT(U,H)}else{const m=r.preV2Sign(l,f);await O.announceTransaction(m)}Pe.push({name:"ViewAccountPendingTransactions",params:{address:r.address.plain()}})};return(t,i)=>{var v,r,f,m,b,C,B,H,V,U,$,ae,ie,se,oe,le,ne,ce,re,ue,de,ve,me,pe,ge,ye,fe,he,be,xe,_e,we,Ge,Te,Ae,Ie,Me;const l=Ue("router-link");return g(),y("div",null,[a("div",qe,[a("div",Je,[Qe,G.value?w("",!0):(g(),y("div",Ye,"Select Account to Create / Initiate Transaction")),P(Ke),P(je,{class:"md:mt-3","selected-address":G.value},null,8,["selected-address"]),Ze,a("div",null,s(u(p).toCurrencyFormat(((v=e.value)==null?void 0:v.currentMosaicGiveAmount.compact())/Math.pow(10,(r=e.value)==null?void 0:r.mosaicGiveDivisibility),(f=e.value)==null?void 0:f.mosaicGiveDivisibility))+" "+s(d((m=e.value)==null?void 0:m.mosaicGiveName)),1),et,a("div",null,s(u(p).toCurrencyFormat(A.value[0]/Math.pow(10,(b=e.value)==null?void 0:b.mosaicGetDivisibility),(C=e.value)==null?void 0:C.mosaicGetDivisibility))+" "+s(d((B=e.value)==null?void 0:B.mosaicGetName))+" : "+s(u(p).toCurrencyFormat(A.value[1]/Math.pow(10,(H=e.value)==null?void 0:H.mosaicGiveDivisibility),(V=e.value)==null?void 0:V.mosaicGiveDivisibility))+" "+s(d((U=e.value)==null?void 0:U.mosaicGiveName)),1),a("div",tt,"Amount to give ("+s(d(($=e.value)==null?void 0:$.mosaicGetName))+") ",1),P(Xe,{placeholder:"Asset Amount",modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=W=>c.value=W),decimal:((ae=e.value)==null?void 0:ae.mosaicGetDivisibility)??0},null,8,["modelValue","decimal"]),parseFloat(c.value)>k.value?(g(),y("div",at,"Insufficient Balance")):w("",!0),parseFloat(c.value)<A.value[0]/Math.pow(10,(ie=e.value)==null?void 0:ie.mosaicGetDivisibility)?(g(),y("div",it,"Less than minimum offer amount ")):w("",!0),a("div",st,"Available to give: "+s(u(p).toCurrencyFormat(k.value,(se=e.value)==null?void 0:se.mosaicGetDivisibility))+" "+s(d((oe=e.value)==null?void 0:oe.mosaicGetName)),1),a("div",ot,[a("div",lt," I will receive "+s(u(p).toCurrencyFormat(D.value,(le=e.value)==null?void 0:le.mosaicGiveDivisibility))+" "+s(d((ne=e.value)==null?void 0:ne.mosaicGiveName)),1),Math.trunc(D.value*Math.pow(10,(ce=e.value)==null?void 0:ce.mosaicGiveDivisibility))/Math.pow(10,(re=e.value)==null?void 0:re.mosaicGiveDivisibility)>((ue=e.value)==null?void 0:ue.currentMosaicGiveAmount.compact())/Math.pow(10,(de=e.value)==null?void 0:de.mosaicGiveDivisibility)?(g(),y("div",nt," (Exceed Available Amount of "+s(d((ve=e.value)==null?void 0:ve.mosaicGiveName))+")",1)):w("",!0)]),Math.trunc(_.value*Math.pow(10,(me=e.value)==null?void 0:me.mosaicGetDivisibility))/Math.pow(10,(pe=e.value)==null?void 0:pe.mosaicGetDivisibility)>0?(g(),y("div",ct,s(u(p).toCurrencyFormat(_.value,(ge=e.value)==null?void 0:ge.mosaicGetDivisibility))+" "+s(d((ye=e.value)==null?void 0:ye.mosaicGetName))+" will be ignored ",1)):w("",!0),rt,parseFloat(c.value)>=A.value[0]/Math.pow(10,(fe=e.value)==null?void 0:fe.mosaicGetDivisibility)?(g(),y("div",ut,s(u(p).toCurrencyFormat(parseFloat(c.value)-_.value,(he=e.value)==null?void 0:he.mosaicGetDivisibility))+" "+s(d((be=e.value)==null?void 0:be.mosaicGetName))+" : "+s(u(p).toCurrencyFormat(D.value,(xe=e.value)==null?void 0:xe.mosaicGiveDivisibility))+" "+s(d((_e=e.value)==null?void 0:_e.mosaicGiveName)),1)):(g(),y("div",dt," 0 "+s(d((we=e.value)==null?void 0:we.mosaicGetName))+" : 0 "+s(d((Ge=e.value)==null?void 0:Ge.mosaicGiveName)),1))]),a("div",vt,[T.value?(g(),y("div",mt,[a("div",pt,s(t.$t("general.multisigAcc")),1),a("div",gt,[a("div",yt,s(t.$t("general.currentBalance")),1),a("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:ee(T.value)},null,8,ft),a("div",ht,[a("div",bt,s(u(o).nativeToken.label),1),xt])]),a("div",_t,[wt,a("span",Gt,s(u(p).toCurrencyFormat(parseFloat(c.value)-_.value,(Te=e.value)==null?void 0:Te.mosaicGetDivisibility)),1),a("span",Tt,s(d((Ae=e.value)==null?void 0:Ae.mosaicGetName)),1)]),At])):w("",!0),a("div",It,s(t.$t("general.signerAcc")),1),a("div",Mt,[a("div",kt,s(t.$t("general.currentBalance")),1),a("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:ee(G.value)},null,8,Ft),a("div",Dt,[a("div",Nt,s(u(o).nativeToken.label),1),Lt])]),Et,T.value?w("",!0):(g(),y("div",Ht,[a("div",Pt,[St,a("span",Ct,s(u(p).toCurrencyFormat(parseFloat(c.value)-_.value,(Ie=e.value)==null?void 0:Ie.mosaicGetDivisibility)),1),a("span",Bt,s(d((Me=e.value)==null?void 0:Me.mosaicGetName)),1)])])),a("div",Vt,[a("div",Ut,s(I.value?t.$t("general.aggregateFee"):t.$t("general.transactionFee")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(S.value)},null,8,$t),a("div",Wt,s(u(o).nativeToken.label),1)]),I.value?(g(),y("div",Ot,[a("div",Rt,s(t.$t("general.lockFund")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(J.value??0)},null,8,Kt),a("div",jt,s(u(o).nativeToken.label),1)])):w("",!0),I.value?(g(),y("div",Xt,[a("div",zt,s(t.$t("general.lockFundTxFee")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(Q.value??0)},null,8,qt),a("div",Jt,s(u(o).nativeToken.label),1)])):w("",!0),Qt,a("div",Yt,[Zt,a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(K.value)},null,8,ea),a("div",ta,s(u(o).nativeToken.label),1)]),a("div",aa,s(t.$t("general.enterPasswordContinue")),1),P(ze,{placeholder:t.$t("general.enterPassword"),modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=W=>N.value=W),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),a("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[2]||(i[2]=W=>Se())}," Sell "),a("div",ia,[P(l,{to:{name:"ViewExchangeListing"},class:"content-center text-xs text-white underline"},{default:$e(()=>[We(s(t.$t("general.cancel")),1)]),_:1})])])])])}}});export{ua as default};
