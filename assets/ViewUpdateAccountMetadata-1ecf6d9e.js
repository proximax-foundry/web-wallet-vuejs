import{l as Re,r as y,D as Oe,c as v,w as d,H as F,B as f,a as A,u as Qe,n as C,S as $,z as r,am as I,W as Ze,_ as je,i as H,M as Xe,b as c,e as a,m as K,v as ge,t as h,f as _,x as ee,O as R,aa as qe,F as ve,g as me,V as ye,o as i}from"./index-0eee6556.js";import{_ as ze}from"./PasswordInput.vue_vue_type_script_setup_true_lang-dc7399c3.js";import{M as te}from"./multisigUtils-f41449b8.js";import{A as Ge,_ as Je}from"./AccountTabs.vue_vue_type_script_setup_true_lang-0225cdb1.js";import{M as Ye}from"./MetadataInput-91ea78c2.js";import{_ as $e}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-c6dd1329.js";import{t as et}from"./jdenticon-module-f0c94090.js";import{U as tt}from"./UTF8-c3f6e74b.js";import{T as ae}from"./transactionState-497d3593.js";import{_ as at}from"./chevron_left-0423cb29.js";import"./functions-dc3759af.js";import"./TextInput-c42477d7.js";import"./TextInputClean-a3282f77.js";import"./icon-key-5b3f7dda.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const lt={name:"ViewUpdateAccountMetadata",props:{targetPublicKey:String,scopedMetadataKey:String},components:{AccountComponent:Ge,MetadataInput:Ye,PasswordInput:ze,AccountTabs:Je,TransactionFeeDisplay:$e},setup(o){const u=Re();let O=y(!1),t=y(!0),w=y(1),b=y(null),M=y(!1),T=y(""),g=y(""),m=y(null),x,D,L,s;const p=y(""),P=y(""),le=new Oe("ThemeStyleConfig");le.init();const fe=v(()=>et(m.value?m.value.address:"",40,le.jdenticonConfig)),pe=v(()=>m.value?d.currentLoggedInWallet.convertAddressToName(m.value.address,!0):""),ne=y([]),B=d.currentLoggedInWallet?d.currentLoggedInWallet.selectDefaultAccount():null,Q=y(B?B.address:""),he=y(F.toCurrencyFormat(B?B.balance:0,f.nativeToken.divisibility)),se=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=se(e)),e),Z=e=>{e=se(e);let n=r.Convert.hexToUint8(e);return tt.isNotUTF8(n)||(e=r.Convert.decodeHexToUtf8(e)),e},be=()=>{let e=new r.MetadataQueryParams;e.metadataType=r.MetadataType.ACCOUNT,e.targetKey=b.value,f.chainAPI.metadataAPI.searchMetadatas(e).then(n=>{n.metadataEntries.forEach(l=>{ne.value.push({value:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?l.scopedMetadataKey.toHex():Z(l.scopedMetadataKey.toHex()),type:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?2:1})})})},xe=v(()=>m.value?m.value.address:"0".repeat(40)),_e=()=>{o.targetPublicKey.length===64&&r.Convert.isHexString(o.targetPublicKey)&&(b.value=r.PublicAccount.createFromPublicKey(o.targetPublicKey,f.networkType),x.targetPublicKey(b.value)),d.currentLoggedInWallet&&(m.value=d.currentLoggedInWallet.accounts.find(e=>e.publicKey===o.targetPublicKey)||d.currentLoggedInWallet.others.find(e=>e.publicKey===o.targetPublicKey),m.value&&(M.value=!!m.value.getDirectParentMultisig().length))},Me=v(()=>d.currentLoggedInWallet&&b.value?d.currentLoggedInWallet.others.find(e=>e.publicKey===o.targetPublicKey):null);A(Me,async e=>{if(e){if(!d.currentLoggedInWallet)return;m.value=d.currentLoggedInWallet.accounts.find(n=>n.publicKey===o.targetPublicKey)||d.currentLoggedInWallet.others.find(n=>n.publicKey===o.targetPublicKey),m.value&&(M.value=!!m.value.getDirectParentMultisig().length)}},{deep:!0});const Te=()=>{if(o.scopedMetadataKey)if(t.value=!1,g.value=o.scopedMetadataKey,o.scopedMetadataKey.length===16&&r.Convert.isHexString(o.scopedMetadataKey))w.value=2,T.value=o.scopedMetadataKey,x.scopedMetadataKey(r.UInt64.fromHex(T.value));else{let e=r.Convert.utf8ToHex(o.scopedMetadataKey);const n=e.length/2;e.length&&n<=8&&(w.value=1,e.length/2<8&&(e=e+"00".repeat(8-n)),T.value=e,x.scopedMetadataKey(r.UInt64.fromHex(T.value)))}},Ke=async()=>{x=f.buildTxn.accountMetadataBuilder();const e=await f.chainAPI.nodeAPI.getNodeTime();D=f.buildTxn.aggregateBondedBuilder(new r.UInt64(e.sendTimeStamp))},we=async()=>{if(b.value&&T.value){let e=new r.MetadataQueryParams;e.metadataType=r.MetadataType.ACCOUNT,e.targetKey=b.value,e.scopedMetadataKey=r.UInt64.fromHex(T.value);let n=await f.chainAPI.metadataAPI.searchMetadatas(e);n.metadataEntries.length&&(p.value=n.metadataEntries[0].value)}x.oldValue(p.value)},ke=()=>{x.value(P.value)},j=()=>{L=x.calculateDifferences().build()},X=()=>{L&&(s=D.innerTransactions([L.toAggregateV1(b.value)]).build())},q=()=>{s&&(S.value=s.maxFee.compact()/Math.pow(10,f.nativeToken.divisibility))},Pe=v(()=>f.nativeToken.label),{t:Ae}=Qe(),V=y(""),oe=y(""),re=d.currentLoggedInWallet?d.currentLoggedInWallet.name:"",z=v(()=>C.currentNetworkProfileConfig?F.convertToExact(C.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),Ce=v(()=>C.currentNetworkProfileConfig?F.convertToCurrency(C.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),G=v(()=>C.currentNetworkProfile?F.convertToExact($.getLockFundFee(),f.nativeToken.divisibility):0),Ie="^[^ ]{8,}$",Ve=y(!1),J=v(()=>w.value==1?r.Convert.utf8ToHex(g.value).length/2>8:g.value.length>16?!0:g.value.length%2===1),de=v(()=>Fe.value<Y.value),Se=v(()=>J.value==!0||g.value==""||P.value==""||!V.value.match(Ie)||de.value==!0),W=v(()=>{if(!d.currentLoggedInWallet)return[];let e=d.currentLoggedInWallet.accounts.map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!!l.getDirectParentMultisig().length})),n=d.currentLoggedInWallet.others.filter(l=>l.type==="MULTISIG").map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!0}));return e.concat(n)});A(w,e=>{ce(),e==2&&(r.Convert.isHexString(g.value)||(g.value=""))});const ce=async()=>{if(J.value||g.value.length==0)return;let e="";if(w.value==1){let E=r.Convert.utf8ToHex(g.value);e=E+"00".repeat((16-E.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let n=new r.MetadataQueryParams;n.targetKey=b.value,n.metadataType=r.MetadataType.ACCOUNT,n.scopedMetadataKey=r.UInt64.fromHex(e);let l=await f.chainAPI.metadataAPI.searchMetadatas(n);l.metadataEntries.length?p.value=l.metadataEntries[0].value:p.value=""},Ue=async()=>{if(!d.currentLoggedInWallet)return;if(!Ze.verifyWalletPassword(d.currentLoggedInWallet.name,C.chainNetworkName,V.value)){oe.value=Ae("general.walletPasswordInvalid",{name:re});return}let e="",n;if(w.value==1){let U=r.Convert.utf8ToHex(g.value);e=U+"00".repeat((16-U.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let l=x.targetPublicKey(b.value).scopedMetadataKey(r.UInt64.fromHex(e)).value(P.value).oldValue(p.value).calculateDifferences().build(),E=f.buildTxn.aggregateCompleteBuilder().innerTransactions([l.toAggregateV1(b.value)]).build(),ue=d.currentLoggedInWallet.accounts.find(U=>U.publicKey==b.value.publicKey).address;if(M.value){let U=d.currentLoggedInWallet.accounts.find(Ee=>Ee.publicKey==k.value).address,De=[l.toAggregateV1(b.value)];const Be=await f.chainAPI.nodeAPI.getNodeTime();n=$.signTxnWithPassword(U,ue,V.value,null,De,new r.UInt64(Be.sendTimeStamp))}else n=$.signTxnWithPassword(ue,null,V.value,E);g.value="",p.value="",P.value="",V.value="",ae.lockHashPayload=n.hashLockTxnPayload,ae.transactionPayload=n.txnPayload,ae.selectedAddress=b.value.address.plain(),u.push({name:"ViewConfirmTransaction"})},S=y(0),Y=v(()=>{let e=f.nativeToken.divisibility;return M.value?e==0?Math.trunc(z.value+G.value+S.value):Math.round((z.value+G.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),N=v(()=>!d.currentLoggedInWallet||!b.value?[]:te.getCosignerInWallet(o.targetPublicKey).cosignerList.length?W.value?te.getCosignerInWallet(o.targetPublicKey).cosignerList.map(e=>{let n=W.value.find(l=>l.publicKey==e);return{name:n.name,publicKey:e,balance:n.balance}}):[]:[]),k=y("");N.value.length>0&&(k.value=N.value[0].publicKey),A(()=>N,e=>{e.value.length&&(k.value=N.value[0].publicKey)},{deep:!0});const Fe=v(()=>d.currentLoggedInWallet?M.value?k.value?I(k.value).balance:0:m.value?m.value.balance:0:0),He=v(()=>S.value.toString()),Le=v(()=>F.amountFormatterSimple(Y.value,0)),We=v(()=>{if(C.currentNetworkProfileConfig){let e=te.getCosignerInWallet(W.value.find(l=>l.address==Q.value)?W.value.find(l=>l.address==Q.value).publicKey:""),n=[];return e.cosignerList.forEach(l=>{n.push({publicKey:l,name:I(l).name,balance:I(l).balance,address:I(l).address})}),e.cosignerList=n,e}else return{hasCosigner:!1,cosignerList:[]}}),Ne=v(()=>{let e=I(k.value)?I(k.value).balance:0;return F.toCurrencyFormat(e,3)});A(p,e=>{x.oldValue(e),j(),X(),q()}),A(P,e=>{x.value(e),j(),X(),q()}),A(g,e=>{e==""&&(p.value="")});const ie=async()=>{await Ke(),_e(),await Te(),await we(),await ke(),j(),X(),q(),be()};if(f.isReady)ie();else{let e=A(f,n=>{n.isReady&&(ie(),e())})}return{findAcc:I,totalFee:Y,err:oe,walletPassword:V,showPasswdError:Ve,accounts:W,updateMetadata:Ue,targetAccIsMultisig:M,lockFundCurrency:Ce,lockFund:z,aggregateFee:S,lockFundTxFee:G,walletName:re,currentNativeTokenName:Pe,oldValue:p,newValue:P,cosigners:N,scopedMetadataKeyType:w,svgString:fe,accountName:pe,accountAddress:xe,disableAddBtn:Se,showBalanceErr:de,showScopedKeyErr:J,inputScopedMetadataKey:g,checkOldValue:ce,selectedCosigner:k,showKeys:O,existingScopedMetadataKeys:ne,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:He,totalFeeFormatted:Le,selectedAccAdd:Q,accBalance:he,getMultiSigCosigner:We,checkCosignBalance:Ne}}},nt={class:"flex cursor-pointer"},st=a("img",{src:at},null,-1),ot={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},rt={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-5"},dt={class:"lg:col-span-3 py-6 px-6"},ct={class:"pl-6"},it={key:0,class:"error error_box mb-5"},ut={key:0,class:"text-left mt-2 mb-5"},gt={key:0},vt={class:"text-tsm"},mt={key:0,class:"font-bold"},yt={key:1,class:"font-bold"},ft=["value"],pt={key:1,class:"error"},ht=a("div",{class:"font-semibold mb-4"},"Update Account Metadata",-1),bt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},xt={class:"flex items-center gap-2"},_t=["innerHTML"],Mt={class:"flex flex-col gap-0.5"},Tt=a("div",{class:"uppercase text-xxs text-blue-primary"},"Selected Account",-1),Kt={class:"font-semibold"},wt={key:1,class:"mt-2"},kt=["onClick"],Pt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},At={key:1,class:"text-xs py-2 pl-2 w-full"},Ct={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},It={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},Vt={key:2},St={class:"flex gap-3"},Ut={class:"flex gap-2"},Ft=a("label",{for:"regular"},"UTF-8",-1),Ht={class:"flex gap-2"},Lt=a("label",{for:"hexa"},"Hexadecimal",-1),Wt={key:3,class:"my-3"},Nt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Dt={class:"flex flex-col gap-0.5"},Bt=a("div",{class:"uppercase text-xxs text-blue-primary"},"Selected Scoped Metadata Key",-1),Et={class:"flex"},Rt={class:"font-semibold"},Ot={class:"ml-3 text-gray-400 font-semibold"},Qt={class:"flex"},Zt={key:0,class:"font-semibold"},jt={key:1,class:"ml-3 text-gray-400 font-semibold"},Xt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},qt=a("div",{class:"uppercase text-xxs text-blue-primary"},"CURRENT VALUE",-1),zt={class:"font-semibold"},Gt={class:"bg-navy-primary p-6 lg:col-span-2"},Jt={class:"text-xs text-white my-5"},Yt=["disabled"],$t={class:"text-center"};function ea(o,u,O,t,w,b){const M=H("router-link"),T=H("AccountComponent"),g=H("AccountTabs"),m=H("MetadataInput"),x=H("TransactionFeeDisplay"),D=H("PasswordInput"),L=Xe("debounce");return i(),c("div",null,[a("div",nt,[st,K(M,{to:{name:"ViewDashboard"},class:"text-blue-primary text-xs mt-0.5"},{default:ge(()=>[ee(h(o.$t("general.back")),1)]),_:1})]),a("div",ot,[K(T,{address:t.accountAddress,class:"mb-10"},null,8,["address"]),K(g,{address:t.accountAddress,selected:"metadata"},null,8,["address"]),a("div",rt,[a("div",dt,[a("div",ct,[t.err!=""?(i(),c("div",it,h(t.err),1)):_("",!0)]),t.targetAccIsMultisig?(i(),c("div",ut,[t.cosigners.length>0?(i(),c("div",gt,[a("div",vt,[ee(h(o.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(i(),c("span",mt,h(t.cosigners[0].name),1)):(i(),c("span",yt,[R(a("select",{class:"","onUpdate:modelValue":u[0]||(u[0]=s=>t.selectedCosigner=s)},[(i(!0),c(ve,null,me(t.cosigners,(s,p)=>(i(),c("option",{value:t.findAcc(s.publicKey).publicKey,key:p},h(s.name),9,ft))),128))],512),[[qe,t.selectedCosigner]])]))])])):(i(),c("div",pt,h(o.$t("general.noCosigner")),1))])):_("",!0),ht,a("div",bt,[a("div",xt,[a("div",{innerHTML:t.svgString},null,8,_t),a("div",Mt,[Tt,a("div",Kt,h(t.accountName),1)])])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(i(),c("div",wt,[a("div",{onClick:u[1]||(u[1]=s=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(i(!0),c(ve,null,me(t.existingScopedMetadataKeys,(s,p)=>(i(),c("div",{key:p},[t.showKeys?(i(),c("div",{key:0,class:"flex justify-center cursor-pointer",onClick:P=>(t.scopedMetadataKeyType=s.type,t.inputScopedMetadataKey=s.value,t.checkOldValue(),t.showKeys=!1)},[p%2==0?(i(),c("div",Pt,h(s.value),1)):_("",!0),p%2==1?(i(),c("div",At,h(s.value),1)):_("",!0),p%2==0?(i(),c("div",Ct,h(o.$t("general.select")),1)):_("",!0),p%2==1?(i(),c("div",It,h(o.$t("general.select")),1)):_("",!0)],8,kt)):_("",!0)]))),128))])):_("",!0),t.scopedMetadataKeySelectable?(i(),c("div",Vt,[R(K(m,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":u[2]||(u[2]=s=>t.inputScopedMetadataKey=s),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[L,t.checkOldValue,"1000"]]),a("div",St,[a("div",Ut,[R(a("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":u[3]||(u[3]=s=>t.scopedMetadataKeyType=s)},null,512),[[ye,t.scopedMetadataKeyType]]),Ft]),a("div",Ht,[R(a("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":u[4]||(u[4]=s=>t.scopedMetadataKeyType=s)},null,512),[[ye,t.scopedMetadataKeyType]]),Lt])]),K(m,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":u[5]||(u[5]=s=>t.oldValue=s),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(i(),c("div",Wt,[a("div",Nt,[a("div",Dt,[Bt,a("div",Et,[a("div",Rt,h(O.scopedMetadataKey),1),a("div",Ot,h(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),a("div",Qt,[t.scopedMetadataKeyType==1?(i(),c("div",Zt,h(t.scopedMetadataKeyHex),1)):_("",!0),t.scopedMetadataKeyType==1?(i(),c("div",jt,"HEX")):_("",!0)])])]),a("div",Xt,[qt,a("div",zt,h(t.oldValue),1)])])),K(m,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":u[6]||(u[6]=s=>t.newValue=s),placeholder:"New Value"},null,8,["modelValue"])]),a("div",Gt,[K(x,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),a("div",Jt,h(o.$t("general.enterPasswordContinue")),1),K(D,{placeholder:o.$t("general.enterPassword"),errorMessage:o.$t("general.passwordRequired"),modelValue:t.walletPassword,"onUpdate:modelValue":u[7]||(u[7]=s=>t.walletPassword=s),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","errorMessage","modelValue"]),a("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[8]||(u[8]=s=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Account Metadata ",8,Yt),a("div",$t,[K(M,{to:{name:"ViewAccountMetadata",params:{address:t.accountAddress}},class:"content-center text-xs text-white underline"},{default:ge(()=>[ee(h(o.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const pa=je(lt,[["render",ea]]);export{pa as default};
