import{_ as _e,j as Ce,k as we,y as De,g as a,c as o,n as i,b9 as Te,ba as Ne,A as u,G as Fe,b3 as Le,H as c,B as Se,aq as G,w as N,I as Ae,D as F,au as E,bb as re,r as L,o as d,a as Ie,b as Y,e as l,t as n,f,l as S,i as C,s as J,O as Pe,ak as Be,F as Me,K as Ee,x as Ve}from"./index-aa0744c5.js";import{T as Ue}from"./TransactionLayout-9e9b336b.js";import{D as He}from"./DurationInputClean-ae0ba1d6.js";import{_ as Re}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-bd78a3af.js";import{N as A}from"./namespaceUtils-dfdab709.js";import{t as We}from"./jdenticon-module-cb5aedf5.js";import{M as je}from"./multisigUtils-214331ec.js";import{T as V}from"./transactionState-8ad9374f.js";import{_ as Oe}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-fe55d3fa.js";import"./proximax-logo-ecfc3767.js";const qe={name:"ViewServicesNamespaceExtend",components:{DurationInputClean:He,TransactionFeeDisplay:Re,TransactionLayout:Ue},props:{namespaceId:String,address:String},setup(s){Ce();const b=we();De();const K=a(null),e=a(!1),g=a("1"),Q=a(""),y=a(!1),w=a(!1),U=a(!1),p=a(""),H=a(!1),m=a(!1),k=a(""),I=a(0),R=a(0),P=a(0),W=a(!1),D=o(()=>i.currentNetworkProfileConfig?Math.floor(Te.configReturn(i.currentNetworkProfileConfig.maxNamespaceDuration,Ne.DAY)):0),ie=o(()=>u.readBlockHeight),ce=o(()=>u.nativeToken.label);(async()=>{const t=Fe.buildAPIEndpoint(i.selectedAPIEndpoint,i.currentNetworkProfile?i.currentNetworkProfile.httpPort:3e3),r=new Le(t);I.value=await r.chainAPI.getBlockchainHeight()})();const ue=o(()=>{let t=[];const r=A.listRootNamespaces(_.value);return t.push.apply(t,r),t}),de=o(()=>u.nativeToken.label),B=o(()=>i.currentNetworkProfileConfig?g.value>0?c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*A.calculateDuration(g.value),u.nativeToken.divisibility):c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,u.nativeToken.divisibility):0),ge=o(()=>c.toCurrencyFormat(B.value,6)),me=o(()=>i.currentNetworkProfileConfig?c.convertToExact(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),ve=o(()=>i.currentNetworkProfileConfig?c.amountFormatterSimple(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),j=o(()=>i.currentNetworkProfile?c.convertToExact(Se.getLockFundFee(),u.nativeToken.divisibility):0),M=o(()=>(v.value?v.value.cosignerList.length:0)==0&&G(_.value)),fe=a(j.value.toString()),O=o(()=>me.value+j.value),be=o(()=>!(!e.value&&!oe.value&&!M.value)),X=a(""),_=a(""),q=a(""),Z=a(""),$=o(()=>N.currentLoggedInWallet?N.currentLoggedInWallet.selectDefaultAccount():null),he=a($.value?G($.value.address):!1),ee=c.createAddress(s.address).plain();let h=o(()=>N.currentLoggedInWallet?N.currentLoggedInWallet.accounts.find(t=>t.address==ee)||N.currentLoggedInWallet.others.find(t=>t.address==ee):null);h.value&&(X.value=h.value.name,_.value=h.value.address,q.value=c.toCurrencyFormat(h.value.balance,u.nativeToken.divisibility),Z.value=h.value.balance);let te=new Ae("ThemeStyleConfig");te.init();const ke=a(We(s.address,40,te.jdenticonConfig));if(h.value){let t=h.value.namespaces.find(r=>r.idHex===s.namespaceId);if(t!=null){R.value=t.endHeight;const r=t.name.split(".");r.length>1?p.value=r[0]:p.value=t.name}}const ae=a("0"),T=a(0);try{ae.value=c.convertToCurrency(A.getRootNamespaceTransactionFee(p.value,g.value),u.nativeToken.divisibility),T.value=c.convertToExact(A.getRootNamespaceTransactionFee(p.value,g.value),u.nativeToken.divisibility)}catch{}let z=!1;F(g,t=>{if(t>D.value)g.value=D.value;else{let r=R.value-I.value,x=0;P.value=Math.ceil(r/(24*60*4)),parseInt(t)+P.value>D.value?(x=D.value-P.value,g.value=x.toString(),W.value=!0,z=!0):(z||(W.value=!1),z=!1)}});const ye=()=>{g.value="1"},ne=o(()=>G(c.createAddress(s.address).plain())?parseFloat(O.value)+B.value+T.value:B.value+T.value),pe=o(()=>c.amountFormatterSimple(ne.value,0));F(ne,t=>{q.value<t&&!M.value?y.value=!0:y.value=!1}),F(ie,t=>{I.value=t});const xe=()=>{const r=u.buildTxn.registerRootNamespace(p.value,Ve.UInt64.fromUint(A.calculateDuration(Number(g.value)))).serialize();le.value?(V.selectedAddress=le.value,V.selectedMultisigAddress=_.value):V.selectedAddress=_.value,V.unsignedTransactionPayload=r,b.push({name:"ViewConfirmTransaction"})},v=o(()=>{if(h.value)if(i.currentNetworkProfileConfig){let t=je.getCosignerInWallet(h.value?h.value.publicKey:""),r=[];return t.cosignerList.forEach(x=>{r.push({publicKey:x,name:E(x).name,balance:E(x).balance,address:E(x).address})}),t.cosignerList=r,{hasCosigner:t.hasCosigner,cosignerList:t.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});k.value=v.value&&v.value.cosignerList.length>0?v.value.cosignerList[0].address:"",F(v,t=>{t&&t.cosignerList.length>0&&(k.value=t.cosignerList.length>0?v.value.cosignerList[0].address:"")});const se=o(()=>{let t=re(k.value)?re(k.value).balance:0;return c.toCurrencyFormat(t)}),oe=o(()=>k.value.length<=0?Z.value<T.value:Number(se.value)<T.value+O.value);F(M,t=>{t?(y.value=!0,w.value=!0):(y.value=!1,w.value=!1)});const le=o(()=>v.value.cosignerList.length>0?v.value.cosignerList.length>1?k.value:E(v.value.cosignerList[0].publicKey).address:"");return{namespaceSelect:K,selectedAccName:X,selectedAccAdd:_,balance:q,showNoBalance:oe,err:Q,disableCreate:be,showPasswdError:U,disabledPassword:y,showDuration:H,disabledDuration:w,duration:g,showDurationErr:e,isMultiSigBool:he,rentalFee:B,rentalFeeCurrency:ge,lockFundTxFee:j,lockFundCurrency:ve,currencyName:de,lockFundTxFeeCurrency:fe,lockFundTotalFee:O,totalFeeFormatted:pe,selectNamespace:p,namespaceOption:ue,extendNamespace:xe,transactionFee:ae,getMultiSigCosigner:v,cosignerBalanceInsufficient:m,cosignerAddress:k,isNotCosigner:M,block:I,endBlock:R,numDaysleft:P,showMaxDaysLabel:W,svgString:ke,Helper:c,currentNativeTokenName:ce,maxDurationInDays:D,setDefaultDuration:ye,checkCosignBalance:se}}},ze={class:"lg:flex lg:justify-between lg:items-center"},Ge={class:"font-semibold mb-4 inline-block mt-1"},Ye={class:"flex items-center"},Je=["innerHTML"],Ke={class:"ml-2"},Qe={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},Xe={class:"font-bold text-black text-sm"},Ze={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},$e={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},et={class:"inline-block text-xs"},tt={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},at={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},nt={class:"inline-block text-xs"},st={key:2,class:"error error_box"},ot={class:"text-right w-full"},lt={key:0,class:"inline-block"},rt={class:"text-tsm text-left mt-3"},it={key:0,class:"font-bold"},ct={key:0,class:"error"},ut={key:1,class:"font-bold"},dt=["value"],gt={key:2,class:"error"},mt={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},vt={class:"ml-1"},ft={class:"uppercase text-blue-primary font-semibold text-xxs"},bt={class:"text-black text-sm font-bold"},ht={key:3,class:"text-xs inline-block text-gray-400"},kt=["disabled"],yt={class:"text-center"};function pt(s,b,K,e,g,Q){const y=L("font-awesome-icon"),w=L("DurationInputClean"),U=L("TransactionFeeDisplay"),p=L("router-link"),H=L("TransactionLayout");return d(),Ie(H,{class:"mt-8"},{white:Y(()=>[l("div",ze,[l("div",Ge,n(s.$t("general.extendDuration")),1),l("div",Ye,[l("div",{innerHTML:e.svgString,class:"inline-block"},null,8,Je),l("div",Ke,[l("div",Qe,n(s.$t("namespace.namespaceCreatedBy")),1),l("div",Xe,n(e.selectedAccName),1)])])]),e.showNoBalance?(d(),f("div",Ze,[l("div",$e,[S(y,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),l("div",et,n(s.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(d(),f("div",tt,[l("div",at,[S(y,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),l("div",nt,n(s.$t("general.noCosigner")),1)])):C("",!0),e.err!=""?(d(),f("div",st,n(e.err),1)):C("",!0),l("div",ot,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(d(),f("div",lt,[l("div",rt,[J(n(s.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(d(),f("span",it,[J(n(e.getMultiSigCosigner.cosignerList[0].name)+" ("+n(s.$t("general.balance"))+": "+n(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+n(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(d(),f("span",ct,"- "+n(s.$t("general.insufficientBalance")),1)):C("",!0)])):(d(),f("span",ut,[Pe(l("select",{"onUpdate:modelValue":b[0]||(b[0]=m=>e.cosignerAddress=m)},[(d(!0),f(Me,null,Ee(e.getMultiSigCosigner.cosignerList,(m,k)=>(d(),f("option",{value:m.address,key:k},n(m.name)+" ("+n(s.$t("general.balance"))+": "+n(m.balance)+" "+n(e.currentNativeTokenName)+") ",9,dt))),128))],512),[[Be,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(d(),f("div",gt," - "+n(s.$t("general.insufficientBalance")),1)):C("",!0)])])):C("",!0)]),l("div",mt,[b[3]||(b[3]=l("img",{src:Oe},null,-1)),l("div",vt,[l("div",ft,n(s.$t("general.namespace")),1),l("div",bt,n(e.selectNamespace),1)])]),S(w,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":b[1]||(b[1]=m=>e.duration=m),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:s.$t("namespace.duration"),showError:e.showDurationErr,toolTip:s.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+s.$t("general.year"):""} (${e.maxDurationInDays}`+s.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(d(),f("div",ht,n(s.$t("namespace.durationMsg2"))+" "+n(e.maxDurationInDays-e.numDaysleft)+" "+n(s.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):C("",!0)]),navy:Y(()=>[S(U,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:b[2]||(b[2]=(...m)=>e.extendNamespace&&e.extendNamespace(...m))},n(s.$t("general.extendDuration")),9,kt),l("div",yt,[S(p,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Y(()=>[J(n(s.$t("general.cancel")),1)]),_:1})])]),_:1})}const Pt=_e(qe,[["render",pt]]);export{Pt as default};
