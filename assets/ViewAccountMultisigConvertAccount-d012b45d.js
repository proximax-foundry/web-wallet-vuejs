import"./vue-86063517.js";import{u as Ae}from"./vue-router-21fffbbf.js";import{P as ke}from"./PasswordInput-92cf8ee7.js";import{T as Ce}from"./TextInput-50fcd4b9.js";import{T as xe}from"./TransactionFeeDisplay-701702cc.js";import{T as Te}from"./TextInputClean-e28e968a.js";import{M as V}from"./multisigUtils-8ddc00ce.js";import{_ as Se,w as C,H as E,A as x,n as Y,f as Fe}from"./index-71c561bd.js";import{S as Ne}from"./SelectAccountAndContact-69b376c6.js";import{A as Ie,a as Pe}from"./AccountTabs-3292ce5c.js";import{d as De}from"./tsjs-xpx-chain-sdk-84426b6a.js";import{u as Me}from"./vue-i18n-728f748b.js";import{_ as Ue}from"./icon-delete-red-ce8ded12.js";import{r as c,c as _,w as K,B as w,o as T,z as S,A as o,a as A,g as y,e as q,F as Ve,k as Ee,m as ae,y as Ke,p as le,L as re,l as Le,u as Be,aW as We,aT as je}from"./@vue-a9ecc9f1.js";import"./@js-joda-d98eb16f.js";import"./proximax-logo-ecfc3767.js";import"./rxjs-1250b26d.js";import"./tslib-8dbab242.js";import"./crypto-js-e64ac54c.js";import"./crypto-browserify-4fd8cccd.js";import"./randombytes-685e9383.js";import"./node-stdlib-browser-23a8bc7f.js";import"./buffer-6d367910.js";import"./base64-js-50a5cdf9.js";import"./ieee754-44f7831e.js";import"./process-2209b2b3.js";import"./safe-buffer-c463177b.js";import"./create-hash-92c04a28.js";import"./inherits-804453d8.js";import"./md5.js-8d474739.js";import"./hash-base-bb85fc42.js";import"./readable-stream-2241ee9e.js";import"./events-86ccc6d8.js";import"./util-06f7ff32.js";import"./is-arguments-86164331.js";import"./has-tostringtag-7c6352d6.js";import"./has-symbols-cd7870b9.js";import"./call-bind-9e7f09da.js";import"./get-intrinsic-f35014ba.js";import"./has-proto-8ede3a55.js";import"./function-bind-68631a08.js";import"./has-ab8e2922.js";import"./is-generator-function-06dfaf9d.js";import"./which-typed-array-cf6b6a29.js";import"./for-each-f57c5052.js";import"./is-callable-7492318c.js";import"./available-typed-arrays-61974ec7.js";import"./gopd-bab4d6bd.js";import"./is-typed-array-037eef20.js";import"./util-deprecate-c3aabb3c.js";import"./string_decoder-ef7b01fe.js";import"./ripemd160-58dcfa02.js";import"./sha.js-cea3da2e.js";import"./cipher-base-aee0e03d.js";import"./stream-browserify-7496a08f.js";import"./create-hmac-e8b5ea4a.js";import"./browserify-sign-a708a95f.js";import"./browserify-rsa-bfbdcbb6.js";import"./bn.js-1ae23332.js";import"./elliptic-75e883ee.js";import"./minimalistic-assert-4cc49674.js";import"./minimalistic-crypto-utils-6f869a51.js";import"./brorand-03f0f79d.js";import"./hash.js-4f5dfe73.js";import"./hmac-drbg-87799258.js";import"./parse-asn1-465c125b.js";import"./asn1.js-405e93e4.js";import"./safer-buffer-2ac6237e.js";import"./evp_bytestokey-e91543fa.js";import"./browserify-aes-ce20a0e6.js";import"./buffer-xor-87a7236a.js";import"./pbkdf2-e2ae8643.js";import"./browserify-cipher-c4c37ca3.js";import"./browserify-des-3f7e64d9.js";import"./des.js-d262604a.js";import"./diffie-hellman-c8260aab.js";import"./miller-rabin-de27bf02.js";import"./create-ecdh-ffe720e9.js";import"./public-encrypt-fc0568a2.js";import"./randomfill-2874e5f1.js";import"./mathjs-2a513dae.js";import"./@babel-484168fe.js";import"./typed-function-4896e4f1.js";import"./decimal.js-d133ee8e.js";import"./complex.js-cf2520e8.js";import"./fraction.js-39e7906a.js";import"./javascript-natural-sort-c4dd0c27.js";import"./escape-latex-c8a96e7a.js";import"./seedrandom-c8f991ad.js";import"./tiny-emitter-56d49cfd.js";import"./js-sha3-d7d4f583.js";import"./crypto-random-string-d158262e.js";import"./jose-92e5544c.js";import"./primevue-35724b2c.js";import"./vue-loading-overlay-b89251b1.js";import"./jspdf-30014160.js";import"./fflate-8981c52c.js";import"./vue-debounce-3bbbf8c6.js";import"./mitt-f7ef348c.js";/* empty css                   */import"./maska-6f10db43.js";import"./@fortawesome-014b81f2.js";import"./vue3-blocks-tree-e53499e3.js";import"./@noble-f8eff84a.js";import"./utf8-c941a4a0.js";import"./bip39-936aefa9.js";import"./axios-b48d2c29.js";import"./flatbuffers-edc4f8d7.js";import"./ws-0a714537.js";import"./@intlify-16888cd3.js";import"./jdenticon-e4458e79.js";import"./functions-3b5b4af7.js";import"./icon-key-5b3f7dda.js";const Oe={name:"ViewConvertAccountMultisig",components:{PasswordInput:ke,TextInput:Ce,TextInputClean:Te,SelectAccountAndContact:Ne,AccountComponent:Ie,AccountTabs:Pe,TransactionFeeDisplay:xe},props:{address:String},setup(s){const{t:a}=Me(),P=Ae();Be().appContext.config.globalProperties.emitter;const u=c(""),L=c(""),F=c(!1),N=c(""),H=c(!1),B="^[^ ]{8,}$",f=c(1),g=c(1),d=c(0),m=c(0),R="^[0-9A-Fa-f]{64}$",i=c([]),l=c([]),n=c([]),b=c([]),h=c([]),z=c([]),D=c(!1),se=c(!1),W=C.currentLoggedInWallet?C.currentLoggedInWallet.selectDefaultAccount():null,ne=c(W?W.address:""),ie=c(E.toCurrencyFormat(W?W.balance:0,x.nativeToken.divisibility)),Z=_(()=>E.convertToCurrency(Y.currentNetworkProfileConfig.lockedFundsPerAggregate,x.nativeToken.divisibility)),G=_(()=>Y.currentNetworkProfile?E.convertToExact(Fe.getLockFundFee(),x.nativeToken.divisibility):0),j=c(0),p=_(()=>C.currentLoggedInWallet?C.currentLoggedInWallet.accounts.find(e=>e.address===s.address):null);let J=_(()=>{if(p.value)return V.checkIsMultiSig(p.value.address)}),O=()=>{p.value&&(j.value=V.getAggregateFee(p.value.publicKey,i.value,f.value,g.value))};O();const M=_(()=>{let e=x.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(j.value)+parseFloat(Z.value)+G.value):Math.round((parseFloat(j.value)+parseFloat(Z.value)+G.value)*Math.pow(10,e))/Math.pow(10,e)}),ce=_(()=>x.nativeToken.label),ue=_(()=>x.nativeToken.divisibility);_(()=>C.currentLoggedInWallet?E.toCurrencyFormat(p.value.balance,ue.value):"0");const ee=_(()=>{if(!p.value)return!1;const e=C.currentLoggedInWallet;let r=e.accounts.map(k=>({name:k.name,publicKey:k.publicKey})),v=e.contacts;var I=[],U=0;return I.push({key:"0",label:a("general.ownerAcc"),selectable:!1,children:[]}),r.forEach(k=>{I[0].children.push({key:"0-"+U.toString(),label:k.name,data:k.publicKey}),U++}),U=0,I.push({key:"1",label:a("general.contact"),selectable:!1,children:[]}),v!=null&&v.forEach(k=>{I[1].children.push({key:"1-"+U.toString(),label:k.name,data:k.address}),U++}),I});function de(e,r){te(r),n.value[r]=e.label,e.key[0]=="1"?me(e.data,r):i.value[r]=e.data,i.value[r]=e.data,z.value[r]=!1,l.value[r][e.key]=!0,e.selectable=!1}function me(e,r){try{V.verifyContactPublicKey(e).then(v=>{v.status==!0?i.value[r]=v.publicKey:u.value=a("multisig.noPublicKey")})}catch{u.value=a("multisig.noPublicKey")}}const te=e=>{if(Object.keys(l.value[e]).length!==0){let r=Object.keys(l.value[e])[0].split("-");ee.value[r[0]].children[r[1]].selectable=!0,l.value[e]={}}},ve=_(()=>J.value||D.value||!N.value.match(B)||i.value.length==0||u.value||h.value.every(e=>e==!1)==!1||g.value==0||f.value==0),pe=_(()=>{if(!p.value)return!1;var e=!1;if(p.value.balance>=M.value&&!D.value){for(var r=0;r<i.value.length;r++)if(h.value[r]!=""){e=!0;break}else if(i.value[r].length<40){e=!0;break}}else e=!0;return e}),oe=()=>{i.value=[],b.value=[],h.value=[],N.value="",f.value=1,d.value=0,g.value=1,m.value=0},fe=async()=>{await V.convertAccount(i.value,f.value,g.value,p.value.name,N.value)?(L.value="",oe(),P.push({name:"ViewAccountPendingTransactions",params:{address:s.address}})):L.value=a("general.walletPasswordInvalid",{name:C.currentLoggedInWallet.name})};K(()=>[...i.value],e=>{let r=!1;if(i.value.length>0)for(var v=0;v<i.value.length;v++)i.value[v].length==64?i.value[v]==p.value.publicKey&&r==!1?(r=!0,h.value[v]=!0,u.value=a("multisig.selectedAccErr")):!i.value[v].match(R)&&i.value[v].length==64?h.value[v]=!0:(h.value[v]=!1,Array.from(new Set(e)).length!=e.length?u.value=a("multisig.duplicatedCosigner"):r==!1&&(u.value="")):h.value[v]=!0;else u.value=""},{deep:!0}),K(()=>[...h.value],e=>{e.every(r=>r==!1)&&O()},{deep:!0});const ge=()=>{i.value.push(""),l.value.push({}),h.value.push(!1),d.value+=1,m.value+=1},be=e=>{d.value>0&&(d.value-=1),m.value>0&&(m.value-=1),g.value>m.value&&(g.value=m.value),f.value>d.value&&(f.value=d.value),te(e),i.value.splice(e,1),l.value.splice(e,1),n.value.splice(e,1),z.value.splice(e,1),b.value.splice(e,1),h.value.splice(e,1)},_e=e=>{f.value*10*~~(d.value/10)+e.charCode-48>d.value&&e.preventDefault()};let Q=a("multisig.deletionExceedMax"),X=a("multisig.approvalExceedMax");K(f,e=>{O(),d.value==0&&e>1||e>d.value&&e!=1&&d.value!=0?u.value=X:d.value>0&&e<=0?u.value=a("multisig.approvalAtLeastOne"):g.value>m.value&&g.value!=1&&m.value!=0?u.value=Q:u.value=""});const ye=e=>{g.value*10*~~(m.value/10)+e.charCode-48>m.value&&e.preventDefault()};K(g,e=>{O(),m.value==0&&e>1||e>m.value&&e!=1&&m.value!=0?u.value=Q:m.value>0&&e<=0?u.value=a("multisig.deletionAtLeastOne"):f.value>d.value&&f.value!=1&&d.value!=0?u.value=X:u.value=""});const he=_(()=>D.value||J.value);p.value&&V.onPartial(De.PublicAccount.createFromPublicKey(p.value.publicKey,x.networkType)).then(e=>D.value=e),p.value&&p.value.balance<M.value&&(F.value=!0),K(p,e=>{e&&(e.balance<M.value?F.value=!0:F.value=!1)});const we=_(()=>E.amountFormatterSimple(M.value,0));return{networkState:Y,toggleContact:z,contact:ee,space:se,currentNativeTokenName:ce,contactName:n,err:u,disableSend:ve,numApproveTransaction:f,numDeleteUser:g,maxNumApproveTransaction:d,maxNumDeleteUser:m,fundStatus:F,acc:p,passwd:N,showPasswdError:H,showAddressError:h,addCoSig:ge,coSign:i,addCoSigButton:pe,selectedNode:l,deleteCoSigAddressInput:be,onNodeSelect:de,selectedAddresses:b,clear:oe,convertAccount:fe,disabledPassword:he,onPartial:D,isMultisig:J,passwdPattern:B,validateApproval:_e,validateDelete:ye,lockFundCurrency:Z,lockFundTxFee:G,aggregateFee:j,totalFee:M,totalFeeFormatted:we,selectedAccAdd:ne,accBalance:ie,passwordErr:L}}},$=s=>(We("data-v-5171e1f5"),s=s(),je(),s),qe={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},He={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},Re={class:"lg:col-span-2 py-6 pr-6"},ze={class:"text-xs font-semibold pl-6"},Ze={class:"pl-6"},Ge={key:0,class:"error error_box mb-5"},Je={key:1,class:"error error_box mb-5"},Qe=$(()=>o("div",{class:"mt-4"},null,-1)),Xe={class:"flex flex-col gap-2"},Ye={class:"flex"},$e=["onClick"],et={key:0,class:"mt-16"},tt=["onClick"],ot={class:"text-xxs text-blue-primary font-semibold uppercase"},at={key:0},lt=["disabled"],rt=$(()=>o("div",{class:"ml-6 my-7 gray-line"},null,-1)),st={class:"pl-6 text-xs font-semibold mb-3"},nt={class:"flex gap-2 pl-6"},it={class:"border w-6/12"},ct={class:"border-b-2 text-xxs text-center py-1 uppercase"},ut={class:"flex justify-around"},dt=["disabled"],mt=["max"],vt=["disabled"],pt={class:"text-xxs border-t-2 text-center py-1 uppercase"},ft={class:"border w-6/12"},gt={class:"border-b-2 text-xxs text-center py-1 uppercase"},bt={class:"flex justify-around"},_t=["disabled"],yt=["max"],ht=["disabled"],wt={class:"text-xxs border-t-2 text-center py-1 uppercase"},At={class:"bg-navy-primary p-6 lg:col-span-1"},kt=$(()=>o("div",{class:"mt-5"},null,-1)),Ct={class:"font-semibold text-xs text-white mb-1.5"},xt={class:"mt-3"},Tt=["disabled"],St={class:"text-center"};function Ft(s,a,P,t,u,L){const F=w("AccountComponent"),N=w("AccountTabs"),H=w("TextInput"),B=w("TextInputClean"),f=w("font-awesome-icon"),g=w("SelectAccountAndContact"),d=w("Sidebar"),m=w("TransactionFeeDisplay"),R=w("PasswordInput"),i=w("router-link");return T(),S("div",null,[o("div",qe,[A(F,{address:P.address,class:"mb-6"},null,8,["address"]),A(N,{address:P.address,selected:"multisig"},null,8,["address"]),o("div",He,[o("div",Re,[o("div",ze,y(s.$t("multisig.manageCosignatories")),1),o("div",Ze,[t.err!=""?(T(),S("div",Ge,y(t.err),1)):q("v-if",!0),t.passwordErr!=""?(T(),S("div",Je,y(t.passwordErr),1)):q("v-if",!0)]),Qe,o("div",Xe,[(T(!0),S(Ve,null,Ee(t.coSign,(l,n)=>(T(),S("div",{key:n},[o("div",Ye,[o("img",{src:Ue,onClick:b=>t.deleteCoSigAddressInput(n),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,$e),A(H,{class:"w-5/12 mr-2",placeholder:s.$t("multisig.cosignatory")+`${n+1}`,modelValue:t.contactName[n],"onUpdate:modelValue":b=>t.contactName[n]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),A(B,{class:"w-7/12 mr-2",placeholder:s.$t("general.publicKey"),errorMessage:s.$t("general.invalidInput"),showError:t.showAddressError[n],modelValue:t.coSign[n],"onUpdate:modelValue":b=>t.coSign[n]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[n]==!0?(T(),S("div",et)):q("v-if",!0),o("div",{onClick:b=>t.toggleContact[n]=!t.toggleContact[n],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[A(f,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),o("div",ot,y(s.$t("general.select")),1)],8,tt)]),t.toggleContact[n]?(T(),S("div",at,[A(d,{visible:t.toggleContact[n],"onUpdate:visible":b=>t.toggleContact[n]=b,baseZIndex:1e4,position:"full"},{default:ae(()=>[A(g,Ke(n,{contacts:t.contact,index:n,selectedNode:t.selectedNode[n],onNodeSelect:b=>t.onNodeSelect(b,n)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):q("v-if",!0)]))),128))]),o("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:a[0]||(a[0]=(...l)=>t.addCoSig&&t.addCoSig(...l)),disabled:t.addCoSigButton},"+"+y(s.$t("multisig.addNewCosignatory")),9,lt),rt,o("div",st,y(s.$t("general.scheme")),1),o("div",nt,[o("div",it,[o("div",ct,y(s.$t("multisig.transactionsApproval")),1),o("div",ut,[o("button",{class:"text-blue-primary disabled:opacity-50",onClick:a[1]||(a[1]=l=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,dt),le(o("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:a[2]||(a[2]=(...l)=>t.validateApproval&&t.validateApproval(...l)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":a[3]||(a[3]=l=>t.numApproveTransaction=l)},null,40,mt),[[re,t.numApproveTransaction]]),o("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:a[4]||(a[4]=l=>t.numApproveTransaction++)},"+",8,vt)]),o("div",pt,y(s.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),o("div",ft,[o("div",gt,y(s.$t("multisig.accountDeletionApproval")),1),o("div",bt,[o("button",{class:"text-blue-primary disabled:opacity-50",onClick:a[5]||(a[5]=l=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,_t),le(o("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:a[6]||(a[6]=(...l)=>t.validateDelete&&t.validateDelete(...l)),max:t.maxNumDeleteUser,"onUpdate:modelValue":a[7]||(a[7]=l=>t.numDeleteUser=l)},null,40,yt),[[re,t.numDeleteUser]]),o("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:a[8]||(a[8]=l=>t.numDeleteUser++)},"+",8,ht)]),o("div",wt,y(s.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),o("div",At,[A(m,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),kt,o("div",Ct,y(s.$t("general.enterPasswordContinue")),1),A(R,{placeholder:s.$t("general.enterPassword"),errorMessage:s.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":a[9]||(a[9]=l=>t.passwd=l),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),o("div",xt,[o("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:a[10]||(a[10]=l=>t.convertAccount()),disabled:t.disableSend},y(s.$t("multisig.updateCosignatories")),9,Tt)]),o("div",St,[A(i,{to:{name:"ViewMultisigHome",params:{address:P.address}},class:"content-center text-xs text-white underline"},{default:ae(()=>[Le(y(s.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Va=Se(Oe,[["render",Ft],["__scopeId","data-v-5171e1f5"],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/account/submodule/multisig/views/ViewAccountMultisigConvertAccount.vue"]]);export{Va as default};
