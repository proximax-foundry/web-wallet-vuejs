import{l as Re,r as v,D as Qe,c as m,w as c,H as L,B as y,z as o,a as P,u as Oe,n as C,S as ee,am as A,W as je,_ as Ze,i as E,M as Xe,b as d,e as l,m as S,t as f,f as M,x as ge,O as Q,aa as qe,F as ve,g as me,V as fe,v as ze,o as i}from"./index-717d9e27.js";import{_ as Ge}from"./PasswordInput.vue_vue_type_script_setup_true_lang-b21bff19.js";import{_ as Je}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-ff0c8e03.js";import{M as te}from"./multisigUtils-7c4b24e8.js";import{t as Ye}from"./jdenticon-module-702c110f.js";import{M as $e}from"./MetadataInput-e153a4b1.js";import{U as et}from"./UTF8-d20f2be6.js";import{T as ae}from"./transactionState-465c7708.js";import{_ as tt}from"./icon-namespace-e5424a8b.js";import"./proximax-logo-ecfc3767.js";import"./icon-info-8b4f1351.js";const at={name:"ViewUpdateNamespaceMetadata",props:{targetId:String,scopedMetadataKey:String},components:{MetadataInput:$e,PasswordInput:Ge,TransactionFeeDisplay:Je},setup(r){const u=Re();let O=v(!1),t=v(!0),K=v(1),p=v(null),x=v(null),w=v(!1),T=v(""),g=v(""),h=v(null),b,s,_,B;const I=v(""),V=v(""),le=new Qe("ThemeStyleConfig");le.init();const ye=m(()=>Ye(h.value?h.value.address:"",40,le.jdenticonConfig)),pe=m(()=>h.value?c.currentLoggedInWallet.convertAddressToName(h.value.address,!0):""),ne=v([]),D=c.currentLoggedInWallet?c.currentLoggedInWallet.selectDefaultAccount():null,j=v(D?D.address:""),he=v(L.toCurrencyFormat(D?D.balance:0,y.nativeToken.divisibility)),se=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=se(e)),e),Z=e=>{e=se(e);let a=o.Convert.hexToUint8(e);return et.isNotUTF8(a)||(e=o.Convert.decodeHexToUtf8(e)),e},be=()=>{let e=new o.MetadataQueryParams;e.metadataType=o.MetadataType.NAMESPACE,e.targetId=x.value,y.chainAPI.metadataAPI.searchMetadatas(e).then(a=>{a.metadataEntries.forEach(n=>{ne.value.push({value:n.scopedMetadataKey.toHex()==Z(n.scopedMetadataKey.toHex())?n.scopedMetadataKey.toHex():Z(n.scopedMetadataKey.toHex()),type:n.scopedMetadataKey.toHex()==Z(n.scopedMetadataKey.toHex())?2:1})})})},xe=async()=>{if(r.targetId.length===16&&o.Convert.isHexString(r.targetId)){let a=o.UInt64.fromHex(r.targetId),n=new o.NamespaceId([a.lower,a.higher]);x.value=n,b.targetNamespaceId(x.value)}else try{let a=new o.NamespaceId(r.targetId);x.value=a,b.targetNamespaceId(x.value)}catch{return}let e=await y.chainAPI.namespaceAPI.getNamespace(x.value);p.value=e.owner,b.targetPublicKey(p.value),c.currentLoggedInWallet&&(h.value=c.currentLoggedInWallet.accounts.find(a=>a.publicKey===e.owner.publicKey)||c.currentLoggedInWallet.others.find(a=>a.publicKey===e.owner.publicKey),h.value&&(w.value=!!h.value.getDirectParentMultisig().length))},_e=m(()=>h.value?r.targetId.length==16&&o.Convert.isHexString(r.targetId)?h.value.namespaces.find(a=>a.idHex==r.targetId).name:r.targetId:""),Me=m(()=>c.currentLoggedInWallet&&p.value?c.currentLoggedInWallet.others.find(e=>e.publicKey===p.value.publicKey):null);P(Me,async e=>{e&&(h.value=c.currentLoggedInWallet.accounts.find(a=>a.publicKey===p.value.publicKey)||c.currentLoggedInWallet.others.find(a=>a.publicKey===p.value.publicKey),h.value&&(w.value=!!h.value.getDirectParentMultisig().length))},{deep:!0});const we=()=>{if(r.scopedMetadataKey)if(t.value=!1,g.value=r.scopedMetadataKey,r.scopedMetadataKey.length===16&&o.Convert.isHexString(r.scopedMetadataKey))K.value=2,T.value=r.scopedMetadataKey,b.scopedMetadataKey(o.UInt64.fromHex(T.value));else{K.value=1;let e=o.Convert.utf8ToHex(r.scopedMetadataKey);const a=e.length/2;e.length&&a<=8&&(e.length/2<8&&(e=e+"00".repeat(8-a)),T.value=e,b.scopedMetadataKey(o.UInt64.fromHex(T.value)))}},Te=async()=>{b=y.buildTxn.namespaceMetadataBuilder();const e=await y.chainAPI.nodeAPI.getNodeTime();s=y.buildTxn.aggregateBondedBuilder(new o.UInt64(e.sendTimeStamp))},Ie=async()=>{if(x.value&&T.value){let e=new o.MetadataQueryParams;e.targetId=x.value,e.metadataType=o.MetadataType.NAMESPACE,e.scopedMetadataKey=o.UInt64.fromHex(T.value);let a=await y.chainAPI.metadataAPI.searchMetadatas(e);a.metadataEntries.length&&(I.value=a.metadataEntries[0].value)}b.oldValue(I.value)},Ke=()=>{b.value(V.value)},X=()=>{_=b.calculateDifferences().build()},q=()=>{_&&(B=s.innerTransactions([_.toAggregateV1(p.value)]).build())},z=()=>{B&&(H.value=B.maxFee.compact()/Math.pow(10,y.nativeToken.divisibility))},oe=async()=>{await Te(),await xe(),we(),await Ie(),Ke(),X(),q(),z(),be()};if(y.isReady)oe();else{let e=P(y,a=>{a.isReady&&(oe(),e())})}const ke=m(()=>y.nativeToken.label),{t:Pe}=Oe(),N=v(""),re=v(""),de=c.currentLoggedInWallet?c.currentLoggedInWallet.name:"",G=m(()=>C.currentNetworkProfileConfig?L.convertToExact(C.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),Ce=m(()=>C.currentNetworkProfileConfig?L.convertToCurrency(C.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),J=m(()=>C.currentNetworkProfile?L.convertToExact(ee.getLockFundFee(),y.nativeToken.divisibility):0),Ae="^[^ ]{8,}$",Se=v(!1),Y=m(()=>K.value==1?o.Convert.utf8ToHex(g.value).length/2>8:g.value.length>16?!0:g.value.length%2===1),ie=m(()=>He.value<$.value),Ve=m(()=>Y.value==!0||g.value==""||V.value==""||!N.value.match(Ae)||ie.value==!0),U=m(()=>{if(!c.currentLoggedInWallet)return[];let e=c.currentLoggedInWallet.accounts.map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!!n.getDirectParentMultisig().length})),a=c.currentLoggedInWallet.others.filter(n=>n.type==="MULTISIG").map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!0}));return e.concat(a)}),H=v(0);P(K,e=>{ce(),e==2&&(o.Convert.isHexString(g.value)||(g.value=""))});const ce=async()=>{if(Y.value||g.value.length==0)return;let e="";if(K.value==1){let R=o.Convert.utf8ToHex(g.value);e=R+"00".repeat((16-R.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let a=new o.MetadataQueryParams;a.targetId=x.value,a.metadataType=o.MetadataType.NAMESPACE,a.scopedMetadataKey=o.UInt64.fromHex(e);let n=await y.chainAPI.metadataAPI.searchMetadatas(a);n.metadataEntries.length?I.value=n.metadataEntries[0].value:I.value=""},Ne=async()=>{if(!c.currentLoggedInWallet)return;if(!je.verifyWalletPassword(c.currentLoggedInWallet.name,C.chainNetworkName,N.value)){re.value=Pe("general.walletPasswordInvalid",{name:de});return}let e="",a;if(K.value==1){let F=o.Convert.utf8ToHex(g.value);e=F+"00".repeat((16-F.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let n=b.targetPublicKey(p.value).targetNamespaceId(x.value).scopedMetadataKey(o.UInt64.fromHex(e)).value(V.value).oldValue(I.value).calculateDifferences().build(),R=y.buildTxn.aggregateCompleteBuilder().innerTransactions([n.toAggregateV1(p.value)]).build(),ue=c.currentLoggedInWallet.accounts.find(F=>F.publicKey==p.value.publicKey).address;if(w.value){let F=c.currentLoggedInWallet.accounts.find(De=>De.publicKey==k.value).address,Ee=[n.toAggregateV1(p.value)];const Be=await y.chainAPI.nodeAPI.getNodeTime();a=await ee.signTxnWithPassword(F,ue,N.value,null,Ee,new o.UInt64(Be.sendTimeStamp))}else a=await ee.signTxnWithPassword(ue,null,N.value,R);g.value="",I.value="",V.value="",N.value="",ae.lockHashPayload=a.hashLockTxnPayload,ae.transactionPayload=a.txnPayload,ae.selectedAddress=p.value.address.plain(),u.push({name:"ViewConfirmTransaction"})},$=m(()=>{let e=y.nativeToken.divisibility;return w.value?e==0?Math.trunc(G.value+J.value+H.value):Math.round((G.value+J.value+H.value)*Math.pow(10,e))/Math.pow(10,e):H.value}),W=m(()=>!c.currentLoggedInWallet||!p.value?[]:te.getCosignerInWallet(p.value.publicKey).cosignerList.length?U.value?te.getCosignerInWallet(p.value.publicKey).cosignerList.map(e=>{let a=U.value.find(n=>n.publicKey==e);return{name:a.name,publicKey:e,balance:a.balance}}):[]:[]),k=v("");W.value.length>0&&(k.value=W.value[0].publicKey),P(()=>W,e=>{e.value.length&&(k.value=W.value[0].publicKey)},{deep:!0});const He=m(()=>c.currentLoggedInWallet?w.value?k.value?A(k.value).balance:0:h.value?h.value.balance:0:0),Fe=m(()=>H.value.toString()),Le=m(()=>L.amountFormatterSimple($.value,0)),Ue=m(()=>{if(C.currentNetworkProfileConfig){let e=te.getCosignerInWallet(U.value.find(n=>n.address==j.value)?U.value.find(n=>n.address==j.value).publicKey:""),a=[];return e.cosignerList.forEach(n=>{a.push({publicKey:n,name:A(n).name,balance:A(n).balance,address:A(n).address})}),e.cosignerList=a,e}else return{hasCosigner:!1,cosignerList:[]}}),We=m(()=>{let e=A(k.value)?A(k.value).balance:0;return L.toCurrencyFormat(e,3)});return P(I,e=>{b.oldValue(e),X(),q(),z()}),P(V,e=>{b.value(e),X(),q(),z()}),P(g,e=>{e==""&&(I.value="")}),{findAcc:A,totalFee:$,err:re,walletPassword:N,showPasswdError:Se,accounts:U,updateMetadata:Ne,targetAccIsMultisig:w,lockFundCurrency:Ce,lockFund:G,aggregateFee:H,lockFundTxFee:J,walletName:de,currentNativeTokenName:ke,oldValue:I,newValue:V,cosigners:W,scopedMetadataKeyType:K,svgString:ye,accountName:pe,disableAddBtn:Ve,showBalanceErr:ie,showScopedKeyErr:Y,inputScopedMetadataKey:g,checkOldValue:ce,selectedCosigner:k,namespaceName:_e,existingScopedMetadataKeys:ne,showKeys:O,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:Fe,totalFeeFormatted:Le,selectedAccAdd:j,accBalance:he,getMultiSigCosigner:Ue,checkCosignBalance:We}}},lt={class:"w-10/12 ml-auto mr-auto"},nt={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},st={class:"xl:col-span-2 p-12"},ot=l("div",{class:"font-semibold mb-4"},"Update Namespace Metadata",-1),rt={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},dt={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},it={class:"inline-block text-xs"},ct={key:1,class:"error error_box mb-5"},ut={class:"flex items-center"},gt=["innerHTML"],vt={class:"ml-2"},mt={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},ft={class:"font-bold text-black text-sm"},yt={key:2,class:"text-left mt-2 mb-5 ml-4"},pt={key:0},ht={class:"text-tsm"},bt={key:0,class:"font-bold"},xt={key:1,class:"font-bold"},_t=["value"],Mt={key:1,class:"error"},wt={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},Tt=l("img",{src:tt},null,-1),It={class:"ml-1"},Kt=l("div",{class:"uppercase text-blue-primary font-semibold text-xxs"},"NAMESPACE",-1),kt={class:"text-black text-sm font-bold"},Pt={key:3,class:"mt-2"},Ct=["onClick"],At={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},St={key:1,class:"text-xs py-2 pl-2 w-full"},Vt={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},Nt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},Ht={key:4},Ft={class:"flex gap-3"},Lt={class:"flex gap-2"},Ut=l("label",{for:"regular"},"UTF-8",-1),Wt={class:"flex gap-2"},Et=l("label",{for:"hexa"},"Hexadecimal",-1),Bt={key:5,class:"my-3"},Dt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Rt={class:"flex flex-col gap-0.5"},Qt=l("div",{class:"uppercase text-xxs font-semibold text-blue-primary"},"Selected Scoped Metadata Key",-1),Ot={class:"flex"},jt={class:"font-semibold"},Zt={class:"ml-3 text-gray-400 font-semibold"},Xt={class:"flex"},qt={key:0,class:"font-semibold"},zt={key:1,class:"ml-3 text-gray-400 font-semibold"},Gt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Jt=l("div",{class:"uppercase text-xxs text-blue-primary font-semibold"},"CURRENT VALUE",-1),Yt={class:"font-semibold"},$t={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},ea={class:"text-xs text-white my-5"},ta=["disabled"],aa={class:"text-center"};function la(r,u,O,t,K,p){const x=E("font-awesome-icon"),w=E("MetadataInput"),T=E("TransactionFeeDisplay"),g=E("PasswordInput"),h=E("router-link"),b=Xe("debounce");return i(),d("div",null,[l("div",lt,[l("div",nt,[l("div",st,[ot,t.showBalanceErr?(i(),d("div",rt,[l("div",dt,[S(x,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),l("div",it,f(r.$t("general.insufficientBalance")),1)])):M("",!0),t.err!=""?(i(),d("div",ct,f(t.err),1)):M("",!0),l("div",ut,[l("div",{innerHTML:t.svgString,class:"inline-block"},null,8,gt),l("div",vt,[l("div",mt,f(r.$t("namespace.namespaceCreatedBy")),1),l("div",ft,f(t.accountName),1)])]),t.targetAccIsMultisig?(i(),d("div",yt,[t.cosigners.length>0?(i(),d("div",pt,[l("div",ht,[ge(f(r.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(i(),d("span",bt,f(t.cosigners[0].name),1)):(i(),d("span",xt,[Q(l("select",{class:"","onUpdate:modelValue":u[0]||(u[0]=s=>t.selectedCosigner=s)},[(i(!0),d(ve,null,me(t.cosigners,(s,_)=>(i(),d("option",{value:t.findAcc(s.publicKey).publicKey,key:_},f(s.name),9,_t))),128))],512),[[qe,t.selectedCosigner]])]))])])):(i(),d("div",Mt,f(r.$t("general.noCosigner")),1))])):M("",!0),l("div",wt,[Tt,l("div",It,[Kt,l("div",kt,f(t.namespaceName),1)])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(i(),d("div",Pt,[l("div",{onClick:u[1]||(u[1]=s=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(i(!0),d(ve,null,me(t.existingScopedMetadataKeys,(s,_)=>(i(),d("div",{key:_},[t.showKeys?(i(),d("div",{key:0,class:"flex justify-center cursor-pointer",onClick:B=>(t.scopedMetadataKeyType=s.type,t.inputScopedMetadataKey=s.value,t.checkOldValue(),t.showKeys=!1)},[_%2==0?(i(),d("div",At,f(s.value),1)):M("",!0),_%2==1?(i(),d("div",St,f(s.value),1)):M("",!0),_%2==0?(i(),d("div",Vt,f(r.$t("general.select")),1)):M("",!0),_%2==1?(i(),d("div",Nt,f(r.$t("general.select")),1)):M("",!0)],8,Ct)):M("",!0)]))),128))])):M("",!0),t.scopedMetadataKeySelectable?(i(),d("div",Ht,[Q(S(w,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":u[2]||(u[2]=s=>t.inputScopedMetadataKey=s),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[b,t.checkOldValue,"1000"]]),l("div",Ft,[l("div",Lt,[Q(l("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":u[3]||(u[3]=s=>t.scopedMetadataKeyType=s)},null,512),[[fe,t.scopedMetadataKeyType]]),Ut]),l("div",Wt,[Q(l("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":u[4]||(u[4]=s=>t.scopedMetadataKeyType=s)},null,512),[[fe,t.scopedMetadataKeyType]]),Et])]),S(w,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":u[5]||(u[5]=s=>t.oldValue=s),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(i(),d("div",Bt,[l("div",Dt,[l("div",Rt,[Qt,l("div",Ot,[l("div",jt,f(O.scopedMetadataKey),1),l("div",Zt,f(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),l("div",Xt,[t.scopedMetadataKeyType==1?(i(),d("div",qt,f(t.scopedMetadataKeyHex),1)):M("",!0),t.scopedMetadataKeyType==1?(i(),d("div",zt,"HEX")):M("",!0)])])]),l("div",Gt,[Jt,l("div",Yt,f(t.oldValue),1)])])),S(w,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":u[6]||(u[6]=s=>t.newValue=s),placeholder:"New Value"},null,8,["modelValue"])]),l("div",$t,[S(T,{"transaction-fee":String(t.transactionFee),"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("div",ea,f(r.$t("general.enterPasswordContinue")),1),S(g,{placeholder:r.$t("general.enterPassword"),errorMessage:r.$t("general.passwordRequired"),modelValue:t.walletPassword,"onUpdate:modelValue":u[7]||(u[7]=s=>t.walletPassword=s),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","errorMessage","modelValue"]),l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[8]||(u[8]=s=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Namespace Metadata ",8,ta),l("div",aa,[S(h,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:ze(()=>[ge(f(r.$t("general.cancel")),1)]),_:1})])])])])])}const fa=Ze(at,[["render",la]]);export{fa as default};
