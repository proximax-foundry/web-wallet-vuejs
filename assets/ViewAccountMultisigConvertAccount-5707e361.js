import{_ as Ae,u as ke,q as Ce,g as xe,r as c,w as C,H as V,E as x,c as _,n as Y,P as Te,a as E,B as Se,k as w,o as T,b as S,e as a,s as A,t as y,f as q,F as Fe,i as Ne,z as le,ay as Ie,S as oe,a2 as se,A as Pe,p as De,j as Me}from"./index-f81de996.js";import{P as Ue}from"./PasswordInput-0dd59ef4.js";import{T as Ve}from"./TextInput-3c8a9d79.js";import{T as Ee}from"./TransactionFeeDisplay-b8f2fa3e.js";import{T as Ke}from"./TextInputClean-1671b736.js";import{M as K}from"./multisigUtils-558cd5cc.js";import{S as Le}from"./SelectAccountAndContact-3ddeaa9f.js";import{A as Be,a as je}from"./AccountTabs-9e5c8eeb.js";import{_ as We}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./icon-new-page-link-270844f6.js";import"./jdenticon-module-7161194d.js";import"./functions-ee8fa276.js";import"./icon-key-5b3f7dda.js";const Oe={name:"ViewConvertAccountMultisig",components:{PasswordInput:Ue,TextInput:Ve,TextInputClean:Ke,SelectAccountAndContact:Le,AccountComponent:Be,AccountTabs:je,TransactionFeeDisplay:Ee},props:{address:String},setup(n){const{t:l}=ke(),P=Ce();xe().appContext.config.globalProperties.emitter;const u=c(""),L=c(""),F=c(!1),N=c(""),H=c(!1),B="^[^ ]{8,}$",g=c(1),f=c(1),d=c(0),v=c(0),R="^[0-9A-Fa-f]{64}$",i=c([]),o=c([]),r=c([]),b=c([]),h=c([]),z=c([]),D=c(!1),ne=c(!1),j=C.currentLoggedInWallet?C.currentLoggedInWallet.selectDefaultAccount():null,re=c(j?j.address:""),ie=c(V.toCurrencyFormat(j?j.balance:0,x.nativeToken.divisibility)),Z=_(()=>V.convertToCurrency(Y.currentNetworkProfileConfig.lockedFundsPerAggregate,x.nativeToken.divisibility)),G=_(()=>Y.currentNetworkProfile?V.convertToExact(Te.getLockFundFee(),x.nativeToken.divisibility):0),W=c(0),p=_(()=>C.currentLoggedInWallet?C.currentLoggedInWallet.accounts.find(e=>e.address===n.address):null);let J=_(()=>{if(p.value)return K.checkIsMultiSig(p.value.address)}),O=()=>{p.value&&(W.value=K.getAggregateFee(p.value.publicKey,i.value,g.value,f.value))};O();const M=_(()=>{let e=x.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(W.value)+parseFloat(Z.value)+G.value):Math.round((parseFloat(W.value)+parseFloat(Z.value)+G.value)*Math.pow(10,e))/Math.pow(10,e)}),ce=_(()=>x.nativeToken.label),ue=_(()=>x.nativeToken.divisibility);_(()=>C.currentLoggedInWallet?V.toCurrencyFormat(p.value.balance,ue.value):"0");const ee=_(()=>{if(!p.value)return!1;const e=C.currentLoggedInWallet;let s=e.accounts.map(k=>({name:k.name,publicKey:k.publicKey})),m=e.contacts;var I=[],U=0;return I.push({key:"0",label:l("general.ownerAcc"),selectable:!1,children:[]}),s.forEach(k=>{I[0].children.push({key:"0-"+U.toString(),label:k.name,data:k.publicKey}),U++}),U=0,I.push({key:"1",label:l("general.contact"),selectable:!1,children:[]}),m!=null&&m.forEach(k=>{I[1].children.push({key:"1-"+U.toString(),label:k.name,data:k.address}),U++}),I});function de(e,s){te(s),r.value[s]=e.label,e.key[0]=="1"?ve(e.data,s):i.value[s]=e.data,i.value[s]=e.data,z.value[s]=!1,o.value[s][e.key]=!0,e.selectable=!1}function ve(e,s){try{K.verifyContactPublicKey(e).then(m=>{m.status==!0?i.value[s]=m.publicKey:u.value=l("multisig.noPublicKey")})}catch{u.value=l("multisig.noPublicKey")}}const te=e=>{if(Object.keys(o.value[e]).length!==0){let s=Object.keys(o.value[e])[0].split("-");ee.value[s[0]].children[s[1]].selectable=!0,o.value[e]={}}},me=_(()=>J.value||D.value||!N.value.match(B)||i.value.length==0||u.value||h.value.every(e=>e==!1)==!1||f.value==0||g.value==0),pe=_(()=>{if(!p.value)return!1;var e=!1;if(p.value.balance>=M.value&&!D.value){for(var s=0;s<i.value.length;s++)if(h.value[s]!=""){e=!0;break}else if(i.value[s].length<40){e=!0;break}}else e=!0;return e}),ae=()=>{i.value=[],b.value=[],h.value=[],N.value="",g.value=1,d.value=0,f.value=1,v.value=0},ge=async()=>{await K.convertAccount(i.value,g.value,f.value,p.value.name,N.value)?(L.value="",ae(),P.push({name:"ViewAccountPendingTransactions",params:{address:n.address}})):L.value=l("general.walletPasswordInvalid",{name:C.currentLoggedInWallet.name})};E(()=>[...i.value],e=>{let s=!1;if(i.value.length>0)for(var m=0;m<i.value.length;m++)i.value[m].length==64?i.value[m]==p.value.publicKey&&s==!1?(s=!0,h.value[m]=!0,u.value=l("multisig.selectedAccErr")):!i.value[m].match(R)&&i.value[m].length==64?h.value[m]=!0:(h.value[m]=!1,Array.from(new Set(e)).length!=e.length?u.value=l("multisig.duplicatedCosigner"):s==!1&&(u.value="")):h.value[m]=!0;else u.value=""},{deep:!0}),E(()=>[...h.value],e=>{e.every(s=>s==!1)&&O()},{deep:!0});const fe=()=>{i.value.push(""),o.value.push({}),h.value.push(!1),d.value+=1,v.value+=1},be=e=>{d.value>0&&(d.value-=1),v.value>0&&(v.value-=1),f.value>v.value&&(f.value=v.value),g.value>d.value&&(g.value=d.value),te(e),i.value.splice(e,1),o.value.splice(e,1),r.value.splice(e,1),z.value.splice(e,1),b.value.splice(e,1),h.value.splice(e,1)},_e=e=>{g.value*10*~~(d.value/10)+e.charCode-48>d.value&&e.preventDefault()};let Q=l("multisig.deletionExceedMax"),X=l("multisig.approvalExceedMax");E(g,e=>{O(),d.value==0&&e>1||e>d.value&&e!=1&&d.value!=0?u.value=X:d.value>0&&e<=0?u.value=l("multisig.approvalAtLeastOne"):f.value>v.value&&f.value!=1&&v.value!=0?u.value=Q:u.value=""});const ye=e=>{f.value*10*~~(v.value/10)+e.charCode-48>v.value&&e.preventDefault()};E(f,e=>{O(),v.value==0&&e>1||e>v.value&&e!=1&&v.value!=0?u.value=Q:v.value>0&&e<=0?u.value=l("multisig.deletionAtLeastOne"):g.value>d.value&&g.value!=1&&d.value!=0?u.value=X:u.value=""});const he=_(()=>D.value||J.value);p.value&&K.onPartial(Se.PublicAccount.createFromPublicKey(p.value.publicKey,x.networkType)).then(e=>D.value=e),p.value&&p.value.balance<M.value&&(F.value=!0),E(p,e=>{e&&(e.balance<M.value?F.value=!0:F.value=!1)});const we=_(()=>V.amountFormatterSimple(M.value,0));return{networkState:Y,toggleContact:z,contact:ee,space:ne,currentNativeTokenName:ce,contactName:r,err:u,disableSend:me,numApproveTransaction:g,numDeleteUser:f,maxNumApproveTransaction:d,maxNumDeleteUser:v,fundStatus:F,acc:p,passwd:N,showPasswdError:H,showAddressError:h,addCoSig:fe,coSign:i,addCoSigButton:pe,selectedNode:o,deleteCoSigAddressInput:be,onNodeSelect:de,selectedAddresses:b,clear:ae,convertAccount:ge,disabledPassword:he,onPartial:D,isMultisig:J,passwdPattern:B,validateApproval:_e,validateDelete:ye,lockFundCurrency:Z,lockFundTxFee:G,aggregateFee:W,totalFee:M,totalFeeFormatted:we,selectedAccAdd:re,accBalance:ie,passwordErr:L}}},$=n=>(De("data-v-5171e1f5"),n=n(),Me(),n),qe={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},He={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},Re={class:"lg:col-span-2 py-6 pr-6"},ze={class:"text-xs font-semibold pl-6"},Ze={class:"pl-6"},Ge={key:0,class:"error error_box mb-5"},Je={key:1,class:"error error_box mb-5"},Qe=$(()=>a("div",{class:"mt-4"},null,-1)),Xe={class:"flex flex-col gap-2"},Ye={class:"flex"},$e=["onClick"],et={key:0,class:"mt-16"},tt=["onClick"],at={class:"text-xxs text-blue-primary font-semibold uppercase"},lt={key:0},ot=["disabled"],st=$(()=>a("div",{class:"ml-6 my-7 gray-line"},null,-1)),nt={class:"pl-6 text-xs font-semibold mb-3"},rt={class:"flex gap-2 pl-6"},it={class:"border w-6/12"},ct={class:"border-b-2 text-xxs text-center py-1 uppercase"},ut={class:"flex justify-around"},dt=["disabled"],vt=["max"],mt=["disabled"],pt={class:"text-xxs border-t-2 text-center py-1 uppercase"},gt={class:"border w-6/12"},ft={class:"border-b-2 text-xxs text-center py-1 uppercase"},bt={class:"flex justify-around"},_t=["disabled"],yt=["max"],ht=["disabled"],wt={class:"text-xxs border-t-2 text-center py-1 uppercase"},At={class:"bg-navy-primary p-6 lg:col-span-1"},kt=$(()=>a("div",{class:"mt-5"},null,-1)),Ct={class:"font-semibold text-xs text-white mb-1.5"},xt={class:"mt-3"},Tt=["disabled"],St={class:"text-center"};function Ft(n,l,P,t,u,L){const F=w("AccountComponent"),N=w("AccountTabs"),H=w("TextInput"),B=w("TextInputClean"),g=w("font-awesome-icon"),f=w("SelectAccountAndContact"),d=w("Sidebar"),v=w("TransactionFeeDisplay"),R=w("PasswordInput"),i=w("router-link");return T(),S("div",null,[a("div",qe,[A(F,{address:P.address,class:"mb-6"},null,8,["address"]),A(N,{address:P.address,selected:"multisig"},null,8,["address"]),a("div",He,[a("div",Re,[a("div",ze,y(n.$t("multisig.manageCosignatories")),1),a("div",Ze,[t.err!=""?(T(),S("div",Ge,y(t.err),1)):q("v-if",!0),t.passwordErr!=""?(T(),S("div",Je,y(t.passwordErr),1)):q("v-if",!0)]),Qe,a("div",Xe,[(T(!0),S(Fe,null,Ne(t.coSign,(o,r)=>(T(),S("div",{key:r},[a("div",Ye,[a("img",{src:We,onClick:b=>t.deleteCoSigAddressInput(r),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,$e),A(H,{class:"w-5/12 mr-2",placeholder:n.$t("multisig.cosignatory")+`${r+1}`,modelValue:t.contactName[r],"onUpdate:modelValue":b=>t.contactName[r]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),A(B,{class:"w-7/12 mr-2",placeholder:n.$t("general.publicKey"),errorMessage:n.$t("general.invalidInput"),showError:t.showAddressError[r],modelValue:t.coSign[r],"onUpdate:modelValue":b=>t.coSign[r]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[r]==!0?(T(),S("div",et)):q("v-if",!0),a("div",{onClick:b=>t.toggleContact[r]=!t.toggleContact[r],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[A(g,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),a("div",at,y(n.$t("general.select")),1)],8,tt)]),t.toggleContact[r]?(T(),S("div",lt,[A(d,{visible:t.toggleContact[r],"onUpdate:visible":b=>t.toggleContact[r]=b,baseZIndex:1e4,position:"full"},{default:le(()=>[A(f,Ie(r,{contacts:t.contact,index:r,selectedNode:t.selectedNode[r],onNodeSelect:b=>t.onNodeSelect(b,r)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):q("v-if",!0)]))),128))]),a("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:l[0]||(l[0]=(...o)=>t.addCoSig&&t.addCoSig(...o)),disabled:t.addCoSigButton},"+"+y(n.$t("multisig.addNewCosignatory")),9,ot),st,a("div",nt,y(n.$t("general.scheme")),1),a("div",rt,[a("div",it,[a("div",ct,y(n.$t("multisig.transactionsApproval")),1),a("div",ut,[a("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[1]||(l[1]=o=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,dt),oe(a("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[2]||(l[2]=(...o)=>t.validateApproval&&t.validateApproval(...o)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":l[3]||(l[3]=o=>t.numApproveTransaction=o)},null,40,vt),[[se,t.numApproveTransaction]]),a("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:l[4]||(l[4]=o=>t.numApproveTransaction++)},"+",8,mt)]),a("div",pt,y(n.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),a("div",gt,[a("div",ft,y(n.$t("multisig.accountDeletionApproval")),1),a("div",bt,[a("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[5]||(l[5]=o=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,_t),oe(a("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[6]||(l[6]=(...o)=>t.validateDelete&&t.validateDelete(...o)),max:t.maxNumDeleteUser,"onUpdate:modelValue":l[7]||(l[7]=o=>t.numDeleteUser=o)},null,40,yt),[[se,t.numDeleteUser]]),a("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:l[8]||(l[8]=o=>t.numDeleteUser++)},"+",8,ht)]),a("div",wt,y(n.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),a("div",At,[A(v,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),kt,a("div",Ct,y(n.$t("general.enterPasswordContinue")),1),A(R,{placeholder:n.$t("general.enterPassword"),errorMessage:n.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":l[9]||(l[9]=o=>t.passwd=o),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),a("div",xt,[a("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:l[10]||(l[10]=o=>t.convertAccount()),disabled:t.disableSend},y(n.$t("multisig.updateCosignatories")),9,Tt)]),a("div",St,[A(i,{to:{name:"ViewMultisigHome",params:{address:P.address}},class:"content-center text-xs text-white underline"},{default:le(()=>[Pe(y(n.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const qt=Ae(Oe,[["render",Ft],["__scopeId","data-v-5171e1f5"],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/account/submodule/multisig/views/ViewAccountMultisigConvertAccount.vue"]]);export{qt as default};
