import{d as R,r as x,c as B,a as N,i as X,M as O,o as y,b as M,e as o,j as A,f as G,O as U,k as D,v as m,x as F,m as u,y as p,t as g,B as s,z as n,be as L}from"./index-1ac46190.js";import{s as h,a as z}from"./column.esm-6125290f.js";import{_ as j}from"./InputId.vue_vue_type_style_index_0_lang-a43f5e7b.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";const q={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5 border-2 p-3"},K={class:"flex text-xs flex-wrap font-semibold gap-3 mb-3"},W={key:0,class:"text-sm text-blue-primary"},J={key:2,class:"flex justify-center"},Q=["disabled"],Y={class:"flex"},Z={class:"mr-1"},ee={class:"text-blue-primary"},te={class:"flex"},ae={class:"mr-1"},ie={class:"text-blue-primary"},se={class:"flex"},oe={class:"mr-1"},ne=o("button",{class:"blue-btn py-2 px-3"},"Exchange",-1),pe=R({__name:"ViewExchangeListing",setup(ce){const d=x(""),P=x(!0),E=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],$=t=>t.substring(0,4)+"..."+t.substring(t.length-4,t.length+1),b=t=>{const a=E.find(r=>r.namespace==t);return a?a.name:t.length==16?t.substring(0,4)+"...":t},c=x(!1),S=async()=>{try{new n.NamespaceId(d.value).fullName;const t=await s.chainAPI.namespaceAPI.getLinkedMosaicId(new n.NamespaceId(d.value));d.value=t.toHex();const a=await s.chainAPI.assetAPI.getMosaic(t),r=await s.chainAPI.assetAPI.getMosaicsNames([t]);c.value=!0;return}catch{c.value=!1}try{const t=new n.MosaicId(d.value.toUpperCase()),a=await s.chainAPI.assetAPI.getMosaic(t),r=await s.chainAPI.assetAPI.getMosaicsNames([t]);c.value=!0}catch{c.value=!1}},i=x("xpx"),f=x([]),H=x([]),_=async()=>{let t=[],a;i.value=="others"&&c.value&&(a=d.value),i.value=="xpx"&&(a=s.nativeToken.assetId),i.value=="metx"&&(a=(await s.chainAPI.namespaceAPI.getLinkedMosaicId(new n.NamespaceId("prx.metx"))).id.toHex());const r=new n.ExchangeSdaHttp(s.nodeFullURL);t=await L(r.getExchangeSdaOffers(n.SdaExchangeOfferType.GET,new n.MosaicId(a)));for(let e=0;e<t.length;e++){const l=await s.chainAPI.assetAPI.getMosaicsNames([t[e].mosaicIdGet,t[e].mosaicIdGive]),I=await s.chainAPI.assetAPI.getMosaics([t[e].mosaicIdGet,t[e].mosaicIdGive]);t[e].mosaicGetName=l[0].names.length?l[0].names[0].name:t[e].mosaicIdGet.toHex(),t[e].mosaicGiveName=l[1].names.length?l[1].names[0].name:t[e].mosaicIdGive.toHex(),t[e].mosaicGetDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGet.toHex()).divisibility,t[e].mosaicGiveDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGive.toHex()).divisibility}const w=await s.chainAPI.chainAPI.getBlockchainHeight();f.value=t.map(e=>({owner:e.owner.address.pretty(),idPair:`${e.mosaicIdGive.toHex()}/${e.mosaicIdGet.toHex()}`,deadline:new Date(Date.now()+(e.deadline.compact()-w)*15e3).toLocaleString(),pair:`${b(e.mosaicGiveName)}/${b(e.mosaicGetName)} `,giveAmount:e.currentMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility),getAmount:e.currentMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility),rate:e.initialMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility)/(e.initialMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility))}))},T=async()=>{await k(),await _(),P.value=!0},k=async()=>{let t=[],a;i.value=="others"&&c.value&&(a=d.value),i.value=="xpx"&&(a=s.nativeToken.assetId),i.value=="metx"&&(a=(await s.chainAPI.namespaceAPI.getLinkedMosaicId(new n.NamespaceId("prx.metx"))).id.toHex());const r=new n.ExchangeSdaHttp(s.nodeFullURL);t=await L(r.getExchangeSdaOffers(n.SdaExchangeOfferType.GIVE,new n.MosaicId(a)));for(let e=0;e<t.length;e++){const l=await s.chainAPI.assetAPI.getMosaicsNames([t[e].mosaicIdGet,t[e].mosaicIdGive]),I=await s.chainAPI.assetAPI.getMosaics([t[e].mosaicIdGet,t[e].mosaicIdGive]);t[e].mosaicGetName=l[0].names.length?l[0].names[0].name:t[e].mosaicIdGet.toHex(),t[e].mosaicGiveName=l[1].names.length?l[1].names[0].name:t[e].mosaicIdGive.toHex(),t[e].mosaicGetDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGet.toHex()).divisibility,t[e].mosaicGiveDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGive.toHex()).divisibility}const w=await s.chainAPI.chainAPI.getBlockchainHeight();H.value=t.map(e=>({owner:e.owner.address.pretty(),idPair:`${e.mosaicIdGet.toHex()}/${e.mosaicIdGive.toHex()}`,deadline:new Date(Date.now()+(e.deadline.compact()-w)*15e3).toLocaleString(),pair:`${b(e.mosaicGetName)}/${b(e.mosaicGiveName)} `,giveAmount:e.currentMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility),getAmount:e.currentMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility),rate:e.initialMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility)/(e.initialMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility))}))},C=B(()=>[...f.value.map(t=>({type:"Sell",owner:t.owner,idPair:t.idPair,deadline:t.deadline,pair:t.pair,giveAmount:t.giveAmount,getAmount:t.getAmount,rate:t.rate})),...H.value.map(t=>({type:"Buy",owner:t.owner,idPair:t.idPair,deadline:t.deadline,pair:t.pair,giveAmount:t.giveAmount,getAmount:t.getAmount,rate:t.rate}))].sort((t,a)=>new Date(a.deadline).getTime()-new Date(t.deadline).getTime()));N(i,async t=>{t=="others"&&!c.value?P.value=!1:(await _(),await k())});const V=N(s,async t=>{t.isReady&&(await _(),await k(),V())},{immediate:!0});return(t,a)=>{const r=X("router-link"),w=O("debounce");return y(),M("div",null,[o("div",q,[o("div",K,[o("button",{onClick:a[0]||(a[0]=e=>i.value="xpx"),class:A([`${i.value=="xpx"?"border-b-2  text-blue-primary border-blue-primary":""}`,"w-12 text-center py-3 word-break"])},"XPX",2),o("button",{onClick:a[1]||(a[1]=e=>i.value="metx"),class:A([`${i.value=="metx"?"border-b-2  text-blue-primary border-blue-primary":""}`,"w-12 text-center py-3 word-break"])},"METX",2),o("button",{onClick:a[2]||(a[2]=e=>i.value="others"),class:A([`${i.value=="others"?"border-b-2  text-blue-primary border-blue-primary":""}`,"w-12 text-center py-3 word-break"])},"OTHERS",2)]),i.value=="others"?(y(),M("div",W,"Input Asset ID/ Namespace")):G("",!0),i.value=="others"?U((y(),D(j,{key:1,class:"mt-3",modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),"show-error":!c.value},null,8,["modelValue","show-error"])),[[w,S,"1000"]]):G("",!0),i.value=="others"?(y(),M("div",J,[o("button",{disabled:!c.value,onClick:a[4]||(a[4]=e=>T()),class:"disabled:opacity-50 bg-blue-primary my-3 px-6 py-1.5 rounded-lg text-white font-semibold"},"Search listing",8,Q)])):G("",!0),P.value||i.value!="others"?(y(),D(p(z),{key:3,value:C.value,paginator:!0,rows:10,responsiveLayout:"scroll",scrollDirection:"horizontal",alwaysShowPaginator:!1,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries",class:"w-full"},{empty:m(()=>[F(" No exchanges found. ")]),default:m(()=>[u(p(h),{field:"deadline",header:"Deadline"}),u(p(h),{field:"type",header:"Type"},{body:m(({data:e})=>[o("div",{class:A(e.type=="Sell"?"text-red-500":"text-green-500")},g(e.type),3)]),_:1}),u(p(h),{field:"rate",header:"Price"},{body:m(({data:e})=>[o("div",Y,[o("div",Z,g(e.rate),1),o("div",ee,g(e.pair),1)])]),_:1}),u(p(h),{field:"giveAmount",header:"SDA Amount"},{body:m(({data:e})=>[o("div",te,[o("div",ae,g(e.giveAmount),1),o("div",ie,g(e.pair.split("/")[0]),1)])]),_:1}),u(p(h),{field:"getAmount",header:`${i.value.toUpperCase()} Amount`},{body:m(({data:e})=>[o("div",se,[o("div",oe,g(e.getAmount),1)])]),_:1},8,["header"]),u(p(h),{field:"owner",header:"Maker"},{body:m(({data:e})=>[o("div",null,g($(e.owner)),1)]),_:1}),u(p(h),{header:"Action"},{body:m(({data:e})=>[u(r,{to:{name:"ViewExchange",query:{p:e.idPair,o:e.owner,t:e.type}}},{default:m(()=>[ne]),_:2},1032,["to"])]),_:1})]),_:1},8,["value"])):G("",!0)])])}}});export{pe as default};
