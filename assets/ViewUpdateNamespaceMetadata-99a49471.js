import{l as Le,r as m,D as Ue,c as g,w as c,H as N,B as y,z as o,a as k,u as Ee,n as P,S as Be,am as C,_ as We,i as W,M as De,b as i,e as l,m as H,t as f,f as x,x as ie,O as D,aa as Re,F as de,g as ce,V as ue,v as Qe,o as d}from"./index-c4169c47.js";import{_ as Oe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-922aeae2.js";import{_ as je}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-a8d3d89b.js";import{M as ee}from"./multisigUtils-384f1125.js";import{t as ze}from"./jdenticon-module-92eb974d.js";import{M as Ze}from"./MetadataInput-f477ad7c.js";import{U as Xe}from"./UTF8-f52ef166.js";import{T as R}from"./transactionState-deb70f9f.js";import{_ as Ge}from"./icon-namespace-e5424a8b.js";import"./proximax-logo-ecfc3767.js";import"./icon-info-8b4f1351.js";const qe={name:"ViewUpdateNamespaceMetadata",props:{targetId:String,scopedMetadataKey:String},components:{MetadataInput:Ze,PasswordInput:Oe,TransactionFeeDisplay:je},setup(r){const v=Le();let Q=m(!1),t=m(!0),I=m(1),b=m(null),h=m(null),_=m(!1),T=m(""),u=m(""),p=m(null),s,M,U,O;const K=m(""),A=m(""),te=new Ue("ThemeStyleConfig");te.init();const ge=g(()=>ze(p.value?p.value.address:"",40,te.jdenticonConfig)),ve=g(()=>p.value?c.currentLoggedInWallet.convertAddressToName(p.value.address,!0):""),ae=m([]),E=c.currentLoggedInWallet?c.currentLoggedInWallet.selectDefaultAccount():null,j=m(E?E.address:""),me=m(N.toCurrencyFormat(E?E.balance:0,y.nativeToken.divisibility)),le=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=le(e)),e),z=e=>{e=le(e);let a=o.Convert.hexToUint8(e);return Xe.isNotUTF8(a)||(e=o.Convert.decodeHexToUtf8(e)),e},fe=()=>{let e=new o.MetadataQueryParams;e.metadataType=o.MetadataType.NAMESPACE,e.targetId=h.value,y.chainAPI.metadataAPI.searchMetadatas(e).then(a=>{a.metadataEntries.forEach(n=>{ae.value.push({value:n.scopedMetadataKey.toHex()==z(n.scopedMetadataKey.toHex())?n.scopedMetadataKey.toHex():z(n.scopedMetadataKey.toHex()),type:n.scopedMetadataKey.toHex()==z(n.scopedMetadataKey.toHex())?2:1})})})},ye=async()=>{if(r.targetId.length===16&&o.Convert.isHexString(r.targetId)){let a=o.UInt64.fromHex(r.targetId),n=new o.NamespaceId([a.lower,a.higher]);h.value=n,s.targetNamespaceId(h.value)}else try{let a=new o.NamespaceId(r.targetId);h.value=a,s.targetNamespaceId(h.value)}catch{return}let e=await y.chainAPI.namespaceAPI.getNamespace(h.value);b.value=e.owner,s.targetPublicKey(b.value),c.currentLoggedInWallet&&(p.value=c.currentLoggedInWallet.accounts.find(a=>a.publicKey===e.owner.publicKey)||c.currentLoggedInWallet.others.find(a=>a.publicKey===e.owner.publicKey),p.value&&(_.value=!!p.value.getDirectParentMultisig().length))},pe=g(()=>p.value?r.targetId.length==16&&o.Convert.isHexString(r.targetId)?p.value.namespaces.find(a=>a.idHex==r.targetId).name:r.targetId:""),be=g(()=>c.currentLoggedInWallet&&b.value?c.currentLoggedInWallet.others.find(e=>e.publicKey===b.value.publicKey):null);k(be,async e=>{e&&(p.value=c.currentLoggedInWallet.accounts.find(a=>a.publicKey===b.value.publicKey)||c.currentLoggedInWallet.others.find(a=>a.publicKey===b.value.publicKey),p.value&&(_.value=!!p.value.getDirectParentMultisig().length))},{deep:!0});const he=()=>{if(r.scopedMetadataKey)if(t.value=!1,u.value=r.scopedMetadataKey,r.scopedMetadataKey.length===16&&o.Convert.isHexString(r.scopedMetadataKey))I.value=2,T.value=r.scopedMetadataKey,s.scopedMetadataKey(o.UInt64.fromHex(T.value));else{I.value=1;let e=o.Convert.utf8ToHex(r.scopedMetadataKey);const a=e.length/2;e.length&&a<=8&&(e.length/2<8&&(e=e+"00".repeat(8-a)),T.value=e,s.scopedMetadataKey(o.UInt64.fromHex(T.value)))}},xe=async()=>{s=y.buildTxn.namespaceMetadataBuilder();const e=await y.chainAPI.nodeAPI.getNodeTime();M=y.buildTxn.aggregateBondedBuilder(new o.UInt64(e.sendTimeStamp))},_e=async()=>{if(h.value&&T.value){let e=new o.MetadataQueryParams;e.targetId=h.value,e.metadataType=o.MetadataType.NAMESPACE,e.scopedMetadataKey=o.UInt64.fromHex(T.value);let a=await y.chainAPI.metadataAPI.searchMetadatas(e);a.metadataEntries.length&&(K.value=a.metadataEntries[0].value)}s.oldValue(K.value)},Me=()=>{s.value(A.value)},Z=()=>{U=s.calculateDifferences().build()},X=()=>{U&&(O=M.innerTransactions([U.toAggregateV1(b.value)]).build())},G=()=>{O&&(S.value=O.maxFee.compact()/Math.pow(10,y.nativeToken.divisibility))},ne=async()=>{await xe(),await ye(),he(),await _e(),Me(),Z(),X(),G(),fe()};if(y.isReady)ne();else{let e=k(y,a=>{a.isReady&&(ne(),e())})}const Te=g(()=>y.nativeToken.label);Ee();const Ke=m(""),Ie=c.currentLoggedInWallet?c.currentLoggedInWallet.name:"",q=g(()=>P.currentNetworkProfileConfig?N.convertToExact(P.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),we=g(()=>P.currentNetworkProfileConfig?N.convertToCurrency(P.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),J=g(()=>P.currentNetworkProfile?N.convertToExact(Be.getLockFundFee(),y.nativeToken.divisibility):0),ke=m(!1),Y=g(()=>I.value==1?o.Convert.utf8ToHex(u.value).length/2>8:u.value.length>16?!0:u.value.length%2===1),se=g(()=>Se.value<$.value),Ce=g(()=>Y.value==!0||u.value==""||A.value==""||se.value==!0),F=g(()=>{if(!c.currentLoggedInWallet)return[];let e=c.currentLoggedInWallet.accounts.map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!!n.getDirectParentMultisig().length})),a=c.currentLoggedInWallet.others.filter(n=>n.type==="MULTISIG").map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!0}));return e.concat(a)}),S=m(0);k(I,e=>{oe(),e==2&&(o.Convert.isHexString(u.value)||(u.value=""))});const oe=async()=>{if(Y.value||u.value.length==0)return;let e="";if(I.value==1){let B=o.Convert.utf8ToHex(u.value);e=B+"00".repeat((16-B.length)/2)}else e="00".repeat((16-u.value.length)/2)+u.value;let a=new o.MetadataQueryParams;a.targetId=h.value,a.metadataType=o.MetadataType.NAMESPACE,a.scopedMetadataKey=o.UInt64.fromHex(e);let n=await y.chainAPI.metadataAPI.searchMetadatas(a);n.metadataEntries.length?K.value=n.metadataEntries[0].value:K.value=""},Ae=async()=>{if(!c.currentLoggedInWallet)return;let e="",a;if(I.value==1){let V=o.Convert.utf8ToHex(u.value);e=V+"00".repeat((16-V.length)/2)}else e="00".repeat((16-u.value.length)/2)+u.value;let n=s.targetPublicKey(b.value).targetNamespaceId(h.value).scopedMetadataKey(o.UInt64.fromHex(e)).value(A.value).oldValue(K.value).calculateDifferences().build(),B=y.buildTxn.aggregateCompleteBuilder().innerTransactions([n.toAggregateV1(b.value)]).build().serialize(),re=c.currentLoggedInWallet.accounts.find(V=>V.publicKey==b.value.publicKey).address;if(_.value){let V=c.currentLoggedInWallet.accounts.find(Fe=>Fe.publicKey==w.value).address;a=n.toAggregateV1(b.value).serialize(),R.selectedAddress=V,R.selectedMultisigAddress=re}else a=B,R.selectedAddress=re;u.value="",K.value="",A.value="",R.unsignedTransactionPayload=a,v.push({name:"ViewConfirmTransaction"})},$=g(()=>{let e=y.nativeToken.divisibility;return _.value?e==0?Math.trunc(q.value+J.value+S.value):Math.round((q.value+J.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),L=g(()=>!c.currentLoggedInWallet||!b.value?[]:ee.getCosignerInWallet(b.value.publicKey).cosignerList.length?F.value?ee.getCosignerInWallet(b.value.publicKey).cosignerList.map(e=>{let a=F.value.find(n=>n.publicKey==e);return{name:a.name,publicKey:e,balance:a.balance}}):[]:[]),w=m("");L.value.length>0&&(w.value=L.value[0].publicKey),k(()=>L,e=>{e.value.length&&(w.value=L.value[0].publicKey)},{deep:!0});const Se=g(()=>c.currentLoggedInWallet?_.value?w.value?C(w.value).balance:0:p.value?p.value.balance:0:0),Ve=g(()=>S.value.toString()),Ne=g(()=>N.amountFormatterSimple($.value,0)),Pe=g(()=>{if(P.currentNetworkProfileConfig){let e=ee.getCosignerInWallet(F.value.find(n=>n.address==j.value)?F.value.find(n=>n.address==j.value).publicKey:""),a=[];return e.cosignerList.forEach(n=>{a.push({publicKey:n,name:C(n).name,balance:C(n).balance,address:C(n).address})}),e.cosignerList=a,e}else return{hasCosigner:!1,cosignerList:[]}}),He=g(()=>{let e=C(w.value)?C(w.value).balance:0;return N.toCurrencyFormat(e,3)});return k(K,e=>{s.oldValue(e),Z(),X(),G()}),k(A,e=>{s.value(e),Z(),X(),G()}),k(u,e=>{e==""&&(K.value="")}),{findAcc:C,totalFee:$,err:Ke,showPasswdError:ke,accounts:F,updateMetadata:Ae,targetAccIsMultisig:_,lockFundCurrency:we,lockFund:q,aggregateFee:S,lockFundTxFee:J,walletName:Ie,currentNativeTokenName:Te,oldValue:K,newValue:A,cosigners:L,scopedMetadataKeyType:I,svgString:ge,accountName:ve,disableAddBtn:Ce,showBalanceErr:se,showScopedKeyErr:Y,inputScopedMetadataKey:u,checkOldValue:oe,selectedCosigner:w,namespaceName:pe,existingScopedMetadataKeys:ae,showKeys:Q,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:Ve,totalFeeFormatted:Ne,selectedAccAdd:j,accBalance:me,getMultiSigCosigner:Pe,checkCosignBalance:He}}},Je={class:"w-10/12 ml-auto mr-auto"},Ye={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},$e={class:"xl:col-span-2 p-12"},et=l("div",{class:"font-semibold mb-4"},"Update Namespace Metadata",-1),tt={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},at={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},lt={class:"inline-block text-xs"},nt={key:1,class:"error error_box mb-5"},st={class:"flex items-center"},ot=["innerHTML"],rt={class:"ml-2"},it={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},dt={class:"font-bold text-black text-sm"},ct={key:2,class:"text-left mt-2 mb-5 ml-4"},ut={key:0},gt={class:"text-tsm"},vt={key:0,class:"font-bold"},mt={key:1,class:"font-bold"},ft=["value"],yt={key:1,class:"error"},pt={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},bt=l("img",{src:Ge},null,-1),ht={class:"ml-1"},xt=l("div",{class:"uppercase text-blue-primary font-semibold text-xxs"},"NAMESPACE",-1),_t={class:"text-black text-sm font-bold"},Mt={key:3,class:"mt-2"},Tt=["onClick"],Kt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},It={key:1,class:"text-xs py-2 pl-2 w-full"},wt={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},kt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},Ct={key:4},At={class:"flex gap-3"},St={class:"flex gap-2"},Vt=l("label",{for:"regular"},"UTF-8",-1),Nt={class:"flex gap-2"},Pt=l("label",{for:"hexa"},"Hexadecimal",-1),Ht={key:5,class:"my-3"},Ft={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Lt={class:"flex flex-col gap-0.5"},Ut=l("div",{class:"uppercase text-xxs font-semibold text-blue-primary"},"Selected Scoped Metadata Key",-1),Et={class:"flex"},Bt={class:"font-semibold"},Wt={class:"ml-3 text-gray-400 font-semibold"},Dt={class:"flex"},Rt={key:0,class:"font-semibold"},Qt={key:1,class:"ml-3 text-gray-400 font-semibold"},Ot={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},jt=l("div",{class:"uppercase text-xxs text-blue-primary font-semibold"},"CURRENT VALUE",-1),zt={class:"font-semibold"},Zt={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Xt=["disabled"],Gt={class:"text-center"};function qt(r,v,Q,t,I,b){const h=W("font-awesome-icon"),_=W("MetadataInput"),T=W("TransactionFeeDisplay"),u=W("router-link"),p=De("debounce");return d(),i("div",null,[l("div",Je,[l("div",Ye,[l("div",$e,[et,t.showBalanceErr?(d(),i("div",tt,[l("div",at,[H(h,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),l("div",lt,f(r.$t("general.insufficientBalance")),1)])):x("",!0),t.err!=""?(d(),i("div",nt,f(t.err),1)):x("",!0),l("div",st,[l("div",{innerHTML:t.svgString,class:"inline-block"},null,8,ot),l("div",rt,[l("div",it,f(r.$t("namespace.namespaceCreatedBy")),1),l("div",dt,f(t.accountName),1)])]),t.targetAccIsMultisig?(d(),i("div",ct,[t.cosigners.length>0?(d(),i("div",ut,[l("div",gt,[ie(f(r.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(d(),i("span",vt,f(t.cosigners[0].name),1)):(d(),i("span",mt,[D(l("select",{class:"","onUpdate:modelValue":v[0]||(v[0]=s=>t.selectedCosigner=s)},[(d(!0),i(de,null,ce(t.cosigners,(s,M)=>(d(),i("option",{value:t.findAcc(s.publicKey).publicKey,key:M},f(s.name),9,ft))),128))],512),[[Re,t.selectedCosigner]])]))])])):(d(),i("div",yt,f(r.$t("general.noCosigner")),1))])):x("",!0),l("div",pt,[bt,l("div",ht,[xt,l("div",_t,f(t.namespaceName),1)])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(d(),i("div",Mt,[l("div",{onClick:v[1]||(v[1]=s=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(d(!0),i(de,null,ce(t.existingScopedMetadataKeys,(s,M)=>(d(),i("div",{key:M},[t.showKeys?(d(),i("div",{key:0,class:"flex justify-center cursor-pointer",onClick:U=>(t.scopedMetadataKeyType=s.type,t.inputScopedMetadataKey=s.value,t.checkOldValue(),t.showKeys=!1)},[M%2==0?(d(),i("div",Kt,f(s.value),1)):x("",!0),M%2==1?(d(),i("div",It,f(s.value),1)):x("",!0),M%2==0?(d(),i("div",wt,f(r.$t("general.select")),1)):x("",!0),M%2==1?(d(),i("div",kt,f(r.$t("general.select")),1)):x("",!0)],8,Tt)):x("",!0)]))),128))])):x("",!0),t.scopedMetadataKeySelectable?(d(),i("div",Ct,[D(H(_,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":v[2]||(v[2]=s=>t.inputScopedMetadataKey=s),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[p,t.checkOldValue,"1000"]]),l("div",At,[l("div",St,[D(l("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":v[3]||(v[3]=s=>t.scopedMetadataKeyType=s)},null,512),[[ue,t.scopedMetadataKeyType]]),Vt]),l("div",Nt,[D(l("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":v[4]||(v[4]=s=>t.scopedMetadataKeyType=s)},null,512),[[ue,t.scopedMetadataKeyType]]),Pt])]),H(_,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":v[5]||(v[5]=s=>t.oldValue=s),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(d(),i("div",Ht,[l("div",Ft,[l("div",Lt,[Ut,l("div",Et,[l("div",Bt,f(Q.scopedMetadataKey),1),l("div",Wt,f(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),l("div",Dt,[t.scopedMetadataKeyType==1?(d(),i("div",Rt,f(t.scopedMetadataKeyHex),1)):x("",!0),t.scopedMetadataKeyType==1?(d(),i("div",Qt,"HEX")):x("",!0)])])]),l("div",Ot,[jt,l("div",zt,f(t.oldValue),1)])])),H(_,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":v[6]||(v[6]=s=>t.newValue=s),placeholder:"New Value"},null,8,["modelValue"])]),l("div",Zt,[H(T,{"transaction-fee":String(t.transactionFee),"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 mt-3 disabled:opacity-50 disabled:cursor-auto",onClick:v[7]||(v[7]=s=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Namespace Metadata ",8,Xt),l("div",Gt,[H(u,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Qe(()=>[ie(f(r.$t("general.cancel")),1)]),_:1})])])])])])}const ia=We(qe,[["render",qt]]);export{ia as default};
