import{d as oe,u as ie,r as m,c as t,w as o,n as T,H as D,B as f,S as de,a as x,l as ue,z as b,i as F,o as O,b as Z,m as u,v as j,e as r,t as L,f as ce,j as H,x as ve,W as me}from"./index-1b5cb3ad.js";import{_ as ge}from"./PasswordInput.vue_vue_type_script_setup_true_lang-fe362266.js";import{a as C}from"./accountUtils-acbd9810.js";import{A as fe,_ as pe}from"./AccountTabs.vue_vue_type_script_setup_true_lang-ac62edea.js";import{M as q}from"./multisigUtils-605a6b8c.js";import{_ as be}from"./AddressInputClean.vue_vue_type_style_index_0_lang-68939340.js";import{_ as ke}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-85c2e424.js";import{_ as he}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-4177e0ea.js";import"./jdenticon-module-bd90392b.js";import"./functions-167a9be0.js";import"./TextInput-3160db26.js";import"./TextInputClean-5afdc1cb.js";import"./icon-key-5b3f7dda.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";import"./proximax-logo-ecfc3767.js";const ye={class:"w-10/12 mx-auto mt-5"},we={class:"border-2 border-t-0 filter shadow-lg xl:grid xl:grid-cols-3"},Ae={class:"lg:col-span-2 py-6 px-6"},Le={key:0,class:"text-tsm flex gap-2 items-center"},Ce={class:"font-semibold mt-3"},Ie={class:"flex flex-col"},Ne={class:"flex mt-3 gap-1"},Te={class:"bg-navy-primary p-6 lg:col-span-1"},xe={class:"font-semibold text-xs text-white mb-1.5"},$e=r("div",{class:"mt-3"},null,-1),Se=["disabled"],Pe={class:"text-center"},We="^[^ ]{8,}$",Fe="^[0-9A-Za-z]{40}$",Me="^[0-9A-Za-z-]{46}$",Qe=oe({__name:"ViewAccountAliasAddressToNamespace",props:{address:{}},setup(c){const{t:p}=ie(),$=m({name:"",value:""}),G=[{value:"Link",label:p("general.link")},{value:"Unlink",label:p("general.unlink")}],n=m({value:"Link",label:p("general.link")}),i=m(null),k=e=>{let l=o.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length,multisigInfo:a.multisigInfo})),s=o.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0,multisigInfo:a.multisigInfo}));return l.concat(s).find(a=>a.publicKey==e)},h=t(()=>{var e;return((e=o.currentLoggedInWallet)==null?void 0:e.accounts.find(l=>l.address==c.address))||o.currentLoggedInWallet.others.find(l=>l.address==c.address)}),K=m(""),y=m(""),v=m(""),I=m(!0),M=m(""),V=t(()=>T.currentNetworkProfileConfig?D.convertToExact(T.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),U=t(()=>T.currentNetworkProfile?D.convertToExact(de.getLockFundFee(),f.nativeToken.divisibility):0),R=o.currentLoggedInWallet?o.currentLoggedInWallet.name:"",w=m(0),B=t(()=>{let e=f.nativeToken.divisibility;return g.value.hasCosigner?e==0?Math.trunc(w.value+V.value+U.value):Math.round((w.value+V.value+U.value)*Math.pow(10,f.nativeToken.divisibility))/Math.pow(10,f.nativeToken.divisibility):w.value}),E=t(()=>h.value?h.value.balance:0),J=t(()=>f.nativeToken.divisibility),Q=t(()=>o.currentLoggedInWallet?D.toCurrencyFormat(E.value,J.value):"0"),_=t(()=>{var e=!1;return g.value.hasCosigner?k(A.value)&&(k(A.value).balance<B.value?e=!0:e=!1):E.value<B.value&&(e=!0),e}),X=t(()=>!(_.value==!1&&y.value.match(We)&&v.value!=""&&i.value.value!=null&&I.value==!1)),Y=t(()=>C.namespaceOption(c.address,n.value.value)),ee=t(()=>{var l,s;return(((l=o.currentLoggedInWallet)==null?void 0:l.accounts.find(a=>a.address==c.address))||((s=o.currentLoggedInWallet)==null?void 0:s.others.find(a=>a.address==c.address))).namespaces.filter(a=>a.active==!0)}),g=t(()=>{if(T.currentNetworkProfileConfig){const l=q.getCosignerInWallet(h.value.publicKey?h.value.publicKey:"").cosignerList.map(a=>({publicKey:a,name:k(a).name,balance:k(a).balance,address:k(a).address}));let s=!1;return l.length>0&&(s=!0),{hasCosigner:s,cosignerList:l}}else return{hasCosigner:!1,cosignerList:[]}}),ae=t(()=>g.value.cosignerList.map(e=>({name:e.name,value:e.publicKey}))),A=m("");x($,e=>{e.value!=""?A.value=e.value:A.value=""},{deep:!0});const z=t(()=>h.value?q.getCosignerInWallet(h.value.publicKey).cosignerList.length>0:!1),S=t(()=>!!(!z.value&&g.value.hasCosigner||!ee.value.length));x(n,()=>{v.value="",i.value=null},{immediate:!0}),x(i,e=>{var a;const s=C.getNamespaceListByAddress(c.address).find(N=>{var W;return N.name===((W=i.value)==null?void 0:W.value)});if(n.value.value=="Unlink"&&e!=null)v.value=b.Address.createFromRawAddress(s.linkedId).pretty();else if(n.value.value=="Link"&&v.value!=""&&e.value!=null){let N=b.Address.createFromRawAddress(v.value).plain();w.value=C.getLinkNamespaceToAddressTransactionFee(g.value.hasCosigner,N,(a=i.value)==null?void 0:a.value,n.value.value)/Math.pow(10,f.nativeToken.divisibility)}}),x(v,e=>{var l;if(e.length==46&&e.match(Me)||e.length==40&&e.match(Fe))if(C.verifyAddress(c.address,v.value).isPassed==!1)M.value="Invalid Address",I.value=!0;else{let a=b.Address.createFromRawAddress(e).plain();w.value=C.getLinkNamespaceToAddressTransactionFee(g.value.hasCosigner,a,(l=i.value)==null?void 0:l.value,n.value.value)/Math.pow(10,f.nativeToken.divisibility),M.value="",I.value=!1}else I.value=!0});const le=ue(),se=async()=>{var e;if(!me.verifyWalletPassword(R,T.chainNetworkName,y.value))K.value=p("general.walletPasswordInvalid",{name:R}),y.value="";else{let l=o.currentLoggedInWallet.accounts.find(a=>a.address==c.address)?o.currentLoggedInWallet.accounts.find(a=>a.address==c.address):o.currentLoggedInWallet.others.find(a=>a.address==c.address);K.value="";const s=await f.chainAPI.nodeAPI.getNodeTime();C.linkNamespaceToAddress(A.value,g.value.hasCosigner,l,y.value,(e=i.value)==null?void 0:e.value,n.value.value,v.value,new b.UInt64(s.sendTimeStamp)),le.push({name:"ViewAccountPendingTransactions",params:{address:c.address}})}},te=t(()=>{let e=k(A.value);return e?e.balance:0});x(g,e=>{e.cosignerList.length&&($.value={name:e.cosignerList[0].name,value:e.cosignerList[0].publicKey})},{immediate:!0});const P=m(!1),ne=e=>{P.value=!1,v.value=e.data},re=t(()=>{const e=o.currentLoggedInWallet;if(!e)return[];const l=[...e.accounts,...e.others];return e.contacts.length?[{key:"0",label:p("general.ownerAcc"),selectable:!1,children:l.map((s,a)=>({key:"0-"+a.toString(),label:s.name,data:b.Address.createFromRawAddress(s.address).pretty(),selectable:!0}))},{key:"1",label:p("general.contact"),selectable:!1,children:e.contacts.map((s,a)=>({key:"1-"+a.toString(),label:s.name,data:b.Address.createFromRawAddress(s.address).pretty(),selectable:!0}))}]:[{key:"0",label:p("general.ownerAcc"),selectable:!1,children:l.map((s,a)=>({key:"0-"+a.toString(),label:s.name,data:b.Address.createFromRawAddress(s.address).pretty(),selectable:!0}))}]});return(e,l)=>{const s=F("Sidebar"),a=F("Dropdown"),N=F("font-awesome-icon"),W=F("router-link");return O(),Z("div",null,[u(s,{visible:P.value,"onUpdate:visible":l[0]||(l[0]=d=>P.value=d),baseZIndex:1e4,position:"full"},{default:j(()=>[u(he,{contacts:re.value,onNodeSelect:ne},null,8,["contacts"])]),_:1},8,["visible"]),r("div",ye,[u(fe,{address:e.address,class:"mb-6"},null,8,["address"]),u(pe,{address:e.address,selected:"details"},null,8,["address"]),r("div",we,[r("div",Ae,[g.value.cosignerList.length?(O(),Z("div",Le,[r("div",null,L(e.$t("general.initiateBy"))+":",1),u(a,{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=d=>$.value=d),options:ae.value,class:"text-tsm","option-label":"name"},null,8,["modelValue","options"])])):ce("",!0),r("div",Ce,L(n.value.value=="Link"?e.$t("general.linkToNamespace"):e.$t("namespace.manageNamespace")),1),r("div",Ie,[u(a,{class:"my-3",placeholder:e.$t("namespace.selectAction"),modelValue:n.value,"onUpdate:modelValue":l[2]||(l[2]=d=>n.value=d),options:G,"option-label":"label",disabled:S.value},null,8,["placeholder","modelValue","disabled"]),u(a,{placeholder:e.$t("namespace.selectNamespace"),modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=d=>i.value=d),"option-label":"label",options:Y.value,"option-disabled":"disabled",disabled:S.value},null,8,["placeholder","modelValue","options","disabled"])]),r("div",Ne,[u(be,{placeholder:e.$t("general.addAccAddress"),modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=d=>v.value=d),errorMessage:M.value,showError:I.value,disabled:S.value||n.value.value=="Unlink"||i.value==null},null,8,["placeholder","modelValue","errorMessage","showError","disabled"]),r("div",{class:"border rounded-md cursor-pointer flex flex-col justify-around p-2",onClick:l[5]||(l[5]=d=>P.value=!0)},[u(N,{icon:"id-card-alt",class:H([i.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","ml-auto mr-auto"])},null,8,["class"]),r("div",{class:H([i.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","text-xxs font-semibold uppercase"])},L(e.$t("general.select")),3)])])]),r("div",Te,[u(ke,{"transaction-fee":String(w.value),"total-fee-formatted":String(B.value),"get-multi-sig-cosigner":g.value,"check-cosign-balance":String(te.value),"lock-fund-currency":String(V.value),"lock-fund-tx-fee":String(U.value),balance:Q.value,"selected-acc-add":e.address,"is-cosigner":z.value,"fund-status":_.value},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add","is-cosigner","fund-status"]),r("div",xe,L(e.$t("general.enterPasswordContinue")),1),u(ge,{placeholder:e.$t("general.enterPassword"),errorMessage:e.$t("general.passwordRequired"),modelValue:y.value,"onUpdate:modelValue":l[6]||(l[6]=d=>y.value=d),icon:"lock",disabled:S.value},null,8,["placeholder","errorMessage","modelValue","disabled"]),$e,r("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:se,disabled:X.value},L(n.value.value=="Unlink"?e.$t("namespace.unlinkNamespace"):e.$t("general.linkToNamespace")),9,Se),r("div",Pe,[u(W,{to:{name:"ViewAccountDetails",params:{address:e.address}},class:"content-center text-xs text-white underline"},{default:j(()=>[ve(L(e.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}}});export{Qe as default};
