import{d as Y,u as ee,A as ae,r as o,l as te,w as v,H as R,c as f,a as I,i as T,o as A,b as k,e as l,m as g,v as L,x as V,t as n,f as S,O as se,R as oe,y as le,a$ as re,F as de,z as $,B as W,W as ne}from"./index-ca9ee916.js";import{_ as ue}from"./icon-save-307f50b1.js";import{T as U}from"./TextInputClean-09777343.js";import{A as ie}from"./addressBookUtils-0d3294bf.js";const ce={class:"w-9/12 ml-auto mr-auto mt-5"},ve={class:"flex text-xs font-semibold border-b-2 menu_title_div"},me={class:"border border-gray-100 p-5 filter drop-shadow-xl mt-10 bg-white"},pe={class:"text-md mb-5 font-semibold"},be={key:0,class:"error error_box mb-5"},fe={class:"py-3 px-0 flex flex-wrap items-center gap-2"},ge=["disabled"],we=l("img",{src:ue,class:"mr-2"},null,-1),ye={key:1},Ae={key:0,class:"px-3 py-2 mt-1 bg-red-300"},ke={key:1,class:"px-3 py-2 mt-1 bg-green-100"},he={class:"flex flex-col justify-center items-center"},xe={class:"mt-2 text-xs font-semibold"},Ce={key:0,class:"error error_box mb-3"},Be=["placeholder"],_e=["disabled"],Ie="^[0-9A-Za-z]{1,}$",Ke=Y({__name:"ViewServicesAddressBookEditContact",props:{contactAddress:{},contactPublicKey:{}},setup(F){const C=F,{t:r}=ee(),D=ae(),b=o(""),B=o(!0),E=o(""),O=te(),m=v.currentLoggedInWallet.contacts.find(e=>R.createAddress(e.address).pretty()==C.contactAddress),w=o(m!=null&&m.group?{value:m.group,label:m.group}:{value:"",label:""}),i=o(""),z=f(()=>!i.value.match(Ie)),p=o(m?m.name:""),t=o(C.contactAddress),u=o(""),y=o("");u.value=t.value;const G=o(!1),_=o(!1);C.contactPublicKey=="true"&&(G.value=!0);const H=f(()=>t.value.length==64),h=o([r("addressBook.work"),r("addressBook.friend"),r("addressBook.family"),r("addressBook.employee"),r("addressBook.director")]),N=f(()=>[{value:"-none-",label:" - "},{value:"Custom",label:r("addressBook.custom")}].concat(h.value.map(e=>({value:e,label:e})))),j=f(()=>!(B.value&&p.value!="")),M=f(()=>!B.value&&u.value!=""),q=f(()=>u.value!=""&&p.value==""||t.value!=""&&p.value==""),Z=f(()=>{let e=r("general.invalidInput");return E.value?E.value:e}),K=async e=>{try{let a=await W.chainAPI.accountAPI.getAccountInfo($.Address.createFromRawAddress(e));a.publicKey=="0000000000000000000000000000000000000000000000000000000000000000"?(y.value=null,_.value=!0):(y.value=a.publicKey,_.value=!0)}catch{y.value=null,_.value=!0}};I(t,()=>{if(v.currentLoggedInWallet)if(t.value.length<=63||t.value.length>=65){u.value=t.value;const e=v.currentLoggedInWallet.accounts.find(d=>d.default==!0),a=ie.verifyNetworkAddress(e.address,u.value);B.value=a.isPassed,E.value=a.errMessage,K(u.value)}else t.value.length==64&&(B.value=!0,u.value=ne.createAddressFromPublicKey(t.value,W.networkType).plain())});const x=o(!1);I(w,e=>{e.value=="Custom"&&(x.value=!0)});const J=async()=>{const e=v.currentLoggedInWallet;t.value.length==64?y.value=t.value:await K(u.value);const a=v.currentLoggedInWallet.contacts.findIndex(c=>R.createAddress(c.address).pretty()==C.contactAddress);let d=e.contacts.filter(c=>c.name.toLowerCase()!=m.name.toLowerCase().trim()),P=d.find(c=>c.name.toLowerCase()==p.value.toLowerCase().trim()),s=e.accounts.find(c=>c.name.toLowerCase()==p.value.toLowerCase().trim()),X=d.find(c=>$.Address.createFromRawAddress(c.address).plain()==$.Address.createFromRawAddress(u.value).plain());P!=null||s!=null?b.value=r("addressBook.nameExist"):X!=null?b.value=r("addressBook.addressExist"):(v.currentLoggedInWallet.updateAddressBook(a,{name:p.value.trim(),address:$.Address.createFromRawAddress(u.value).plain(),group:w.value.value,publicKey:y.value}),v.wallets.saveMyWalletOnlytoLocalStorage(v.currentLoggedInWallet),D.add({severity:"info",summary:r("general.addressBook"),detail:r("addressBook.contactUpdated"),group:"br-custom",life:5e3}),O.push({name:"ViewServicesAddressBook"}))},Q=()=>{N.value.find(({value:e})=>e.toLowerCase()===i.value.toLowerCase())||h.value.includes(i.value.toLowerCase())?b.value=r("addressBook.groupValidation"):(h.value.push(i.value),w.value={value:i.value,label:i.value},x.value=!1,i.value="")};return I(()=>W.isReady,e=>{e&&K(u.value)}),I(()=>v.currentLoggedInWallet,e=>{if(e){const a=[...new Set(e.contacts.map(d=>d.group))].filter(d=>d!="-none-");h.value=h.value.concat(a)}},{immediate:!0}),(e,a)=>{const d=T("router-link"),P=T("Dropdown");return A(),k(de,null,[l("div",null,[l("div",ce,[l("div",ve,[g(d,{to:{name:"ViewServicesAddressBook"},class:"w-18 text-center border-b pb-3"},{default:L(()=>[V(n(e.$t("general.list")),1)]),_:1}),g(d,{to:{name:"ViewServicesAddressBookImport"},class:"w-18 text-center border-b pb-3"},{default:L(()=>[V(n(e.$t("general.import")),1)]),_:1}),g(d,{to:{name:"ViewServicesAddressBookExport"},class:"w-18 text-center border-b pb-3"},{default:L(()=>[V(n(e.$t("general.export")),1)]),_:1})]),l("div",me,[l("div",pe,n(e.$t("addressBook.editContact")),1),b.value!=""?(A(),k("div",be,n(b.value),1)):S("",!0),l("div",fe,[g(U,{placeholder:e.$t("general.name"),errorMessage:e.$t("general.nameRequired"),modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value=s),icon:"id-card-alt",showError:q.value,class:"w-52"},null,8,["placeholder","errorMessage","modelValue","showError"]),g(U,{placeholder:e.$t("general.address"),errorMessage:Z.value,modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value=s),icon:"wallet",showError:M.value,class:"w-96"},null,8,["placeholder","errorMessage","modelValue","showError"]),g(P,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=s=>w.value=s),options:N.value,"option-label":"label",placeholder:"Group "},null,8,["modelValue","options"]),l("button",{type:"submit",class:"bg-blue-primary w-fit text-white px-2 rounded-lg py-2 font-semibold disabled:opacity-50 flex items-center",disabled:j.value,onClick:a[3]||(a[3]=s=>J())},[we,V(n(e.$t("addressBook.saveAddress")),1)],8,ge)]),!G.value&&!M.value&&!H.value?(A(),k("div",ye,[!y.value&&_.value?(A(),k("div",Ae,n(e.$t("general.publicKeyNotAvailable")),1)):(A(),k("div",ke,n(e.$t("general.publicKeyAvailable")),1))])):S("",!0)])])]),g(le(re),{visible:x.value,"onUpdate:visible":a[6]||(a[6]=s=>x.value=s),modal:"",draggable:!1,dismissableMask:!0,closable:!1,class:"w-96"},{default:L(()=>[l("div",he,[l("div",xe,n(e.$t("addressBook.addCustomGroup")),1),b.value!=""?(A(),k("div",Ce,n(b.value),1)):S("",!0),se(l("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=s=>i.value=s),placeholder:e.$t("addressBook.customGroup"),class:"border border-gray-300 p-3 my-5 text-tsm text-center focus:outline-none"},null,8,Be),[[oe,i.value]]),l("button",{class:"rounded-md cursor-pointer text-xs text-white py-2 text-center ml-auto mr-auto btn-default bg-blue-primary w-14 mb-2 disabled:opacity-50",onClick:Q,disabled:z.value},n(e.$t("general.add")),9,_e),l("div",{class:"text-center cursor-pointer font-semibold text-xs text-gray-500 mt-2",onClick:a[5]||(a[5]=s=>(x.value=!1,w.value={value:"-none-",label:" - "}))},n(e.$t("general.cancel")),1)])]),_:1},8,["visible"])],64)}}});export{Ke as default};
