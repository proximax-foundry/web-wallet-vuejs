import{S as Ie}from"./SelectInputPluginClean-3104b89d.js";import{_ as Pe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-ae91cea7.js";import{_ as Se,u as Fe,c as n,w as m,r as c,n as x,H as V,E as p,V as Y,D as We,a as D,q as Me,k as _,o,b as r,e as f,s as k,B as re,t as d,Q as Ue,ag as Ve,F as ie,h as ce,f as b,z as Be,A as T,W as Ke}from"./index-8751e63b.js";import{a as C}from"./accountUtils-b4515a70.js";import{A as De,_ as Ee}from"./AccountTabs.vue_vue_type_script_setup_true_lang-922118db.js";import{M as $}from"./multisigUtils-c576010e.js";import{_ as Re}from"./AddressInputClean.vue_vue_type_style_index_0_lang-d94763ab.js";import{_ as Oe}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-2ad06d0e.js";import{T as ee}from"./transactionState-27025085.js";import"./multiselect-b3634d78.js";import"./jdenticon-module-13fa61a1.js";import"./functions-4a53b0ec.js";import"./TextInput-c11ff095.js";import"./TextInputClean-adf88db7.js";import"./icon-key-5b3f7dda.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";import"./proximax-logo-ecfc3767.js";const je={name:"ViewAccountAliasAddressToNamespace",components:{PasswordInput:Pe,SelectInputPluginClean:Ie,AccountComponent:De,AddressInputClean:Re,AccountTabs:Ee,TransactionFeeDisplay:Oe},props:{address:String},setup(t){const{t:i}=Fe(),L=n(()=>{if(!m.currentLoggedInWallet)return[];let a=m.currentLoggedInWallet.accounts.map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!!l.getDirectParentMultisig().length,multisigInfo:l.multisigInfo})),u=m.currentLoggedInWallet.others.filter(l=>l.type==="MULTISIG").map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!0,multisigInfo:l.multisigInfo}));return a.concat(u)}),e=n(()=>{if(!m.currentLoggedInWallet)return null;let a=m.currentLoggedInWallet.accounts.find(u=>u.address==t.address)||m.currentLoggedInWallet.others.find(u=>u.address==t.address);return a||null}),h=a=>L.value.find(u=>u.publicKey==a),M=c(!1);(()=>{e.value&&$.onPartial(T.PublicAccount.createFromPublicKey(e.value.publicKey,p.networkType)).then(a=>M.value=a).catch(a=>{M.value=!1})})();const E=n(()=>g.value==""),I=c(null),R=c(null),A=c(t.address),P=c(""),O=c(null),j=c(null),s=c(""),v=c(""),g=c(""),w=n(()=>{let a=!1;return m.currentLoggedInWallet&&(a=C.getMultisig(A.value)),a}),y=c(""),S=c(!0),z=c(!1),B=c(""),de="^[^ ]{8,}$",ue="^[0-9A-Za-z]{40}$",me="^[0-9A-Za-z-]{46}$",H=n(()=>x.currentNetworkProfileConfig?V.convertToExact(x.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility):0),q=n(()=>x.currentNetworkProfile?V.convertToExact(Y.getLockFundFee(),p.nativeToken.divisibility):0);We();const Z=m.currentLoggedInWallet?m.currentLoggedInWallet.name:"";let ve=c("");const F=c(0),G=n(()=>{let a=p.nativeToken.divisibility;return w.value?a==0?Math.trunc(parseFloat(F.value)+H.value+q.value):Math.round((parseFloat(F.value)+H.value+q.value)*Math.pow(10,p.nativeToken.divisibility))/Math.pow(10,p.nativeToken.divisibility):F.value}),se=n(()=>e.value?e.value.balance:0),ge=n(()=>p.nativeToken.label),fe=n(()=>p.nativeToken.divisibility),pe=n(()=>m.currentLoggedInWallet?V.toCurrencyFormat(se.value,fe.value):"0"),te=n(()=>{var a=!1;return w.value?h(W.value)&&(h(W.value).balance<G.value?a=!0:a=!1):se.value<G.value&&(a=!0),a}),be=n(()=>!(M.value==!1&&te.value==!1&&v.value.match(de)&&g.value!=null&&y.value!=""&&s.value!=null&&S.value==!1)),ye=n(()=>{let a=[];return a.push({value:"Link",label:i("general.link")},{value:"Unlink",label:i("general.unlink")}),a}),ke=n(()=>{let a=[];return g.value!=null&&(a=C.namespaceOption(A.value,g.value)),a}),Q=n(()=>m.currentLoggedInWallet?C.getNamespaceListByAddress(A.value).length==0:null),K=n(()=>{if(x.currentNetworkProfileConfig){let a=$.getCosignerInWallet(e.value.publicKey?e.value.publicKey:""),u=[];return a.cosignerList.forEach(l=>{u.push({publicKey:l,name:h(l).name,balance:h(l).balance,address:h(l).address})}),a.cosignerList=u,a}else return{hasCosigner:!1,cosignerList:[]}}),W=c(K.value.cosignerList[0]?K.value.cosignerList[0].publicKey:"");D(K,a=>{a.cosignerList.length&&(W.value=a.cosignerList[0]?a.cosignerList[0].publicKey:"")},{deep:!0});const J=n(()=>e.value?$.getCosignerInWallet(e.value.publicKey).cosignerList.length>0:!1),he=n(()=>J.value==!1&&w.value==!0||Q.value==!0||g.value=="Unlink"),Ae=n(()=>J.value==!1&&w.value==!0||Q.value==!0);D(g,(a,u)=>{a!=u&&(y.value="",I.value.clear(),s.value=null,z.value=!1)}),D(s,a=>{const l=C.getNamespaceListByAddress(A.value).find(U=>U.name===s.value);if(g.value=="Unlink"&&a!=null)y.value=T.Address.createFromRawAddress(l.linkedId).pretty();else if(g.value=="Link"&&y.value!=""&&a!=null){let U=T.Address.createFromRawAddress(y.value).plain();F.value=V.amountFormatterSimple(C.getLinkNamespaceToAddressTransactionFee(w.value,U,s.value,g.value),p.nativeToken.divisibility)}});const we=n(()=>C.getContact());D(y,a=>{if(a.length==46&&a.match(me)||a.length==40&&a.match(ue))if(C.verifyAddress(A.value,y.value).isPassed==!1)B.value="Invalid Address",S.value=!0;else{let l=T.Address.createFromRawAddress(a).plain();F.value=V.amountFormatterSimple(C.getLinkNamespaceToAddressTransactionFee(w.value,l,s.value,g.value),p.nativeToken.divisibility),B.value="",S.value=!1}else S.value=!0});const _e=Me(),Te=()=>{if(!Ke.verifyWalletPassword(Z,x.chainNetworkName,v.value))P.value=i("general.walletPasswordInvalid",{name:Z}),v.value="";else{let a={};const u=p.buildTxn,l=g.value=="Link"?T.AliasActionType.Link:T.AliasActionType.Unlink,U=new T.NamespaceId(s.value),xe=T.Address.createFromRawAddress(y.value),ne=u.addressAliasBuilder().actionType(l).namespaceId(U).address(xe).build();let oe=m.currentLoggedInWallet.accounts.find(N=>N.address==t.address)?m.currentLoggedInWallet.accounts.find(N=>N.address==t.address):m.currentLoggedInWallet.others.find(N=>N.address==t.address);if(P.value="",ve.value=g.value,w.value){let N=m.currentLoggedInWallet.accounts.find(Le=>Le.publicKey==W.value).address;a=Y.signTxnWithPassword(N,oe.address,v.value,ne)}else a=Y.signTxnWithPassword(oe.address,null,v.value,ne);le(),ee.lockHashPayload=a.hashLockTxnPayload,ee.transactionPayload=a.txnPayload,ee.selectedAddress=t.address,_e.push({name:"ViewConfirmTransaction"})}},le=()=>{z.value=!1,I.value.clear(),S.value=!1,v.value="",B.value="",P.value="",y.value=""},X=n(()=>p.networkType),Ce=n(()=>X.value==168&&x.chainNetworkName=="Sirius Testnet 1"?"https://bctestnetfaucet.xpxsirius.io/#/":X.value==168&&x.chainNetworkName=="Sirius Testnet 2"?"https://bctestnet2faucet.xpxsirius.io/#/":""),Ne=n(()=>{let a=h(W.value);return a?a.balance:0});return{currentNativeTokenName:ge,acc:e,walletState:m,clearInput:le,actionsOptions:ye,disableNamespace:Ae,selectAction:g,walletPassword:v,disableCreate:be,noNamespace:Q,namespaceOptions:ke,selectNamespace:s,showContactSelection:z,isMultiSig:w,selectContactRef:O,selectContact:j,disableContactSelection:he,namespaceAddress:y,lockFundTxFee:q,showAddressError:S,err:P,addressErrorMsg:B,trxFee:F,contact:we,walletName:Z,selectNamespaceRef:I,selectActionRef:R,aliasAddressToNamespace:Te,isCosigner:J,lockFund:H,totalFee:G,onPartial:M,walletCosignerList:K,selectedCosignPublicKey:W,findAcc:h,fundStatus:te,topUpUrl:Ce,networkType:X,disableSelectNamespace:E,checkCosignBalance:Ne,accountDisplayBalance:pe}}},ze={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},He={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-3"},qe={class:"lg:col-span-2 py-6 px-6"},Ze={key:0,class:"text-left mt-2 mb-5"},Ge={key:0},Qe={class:"text-tsm"},Je={key:0,class:"font-bold"},Xe={key:1,class:"font-bold"},Ye=["value"],$e={key:1,class:"font-semibold"},ea={key:2,class:"font-semibold"},aa={key:3,class:"error error_box mb-5"},sa={class:"flex mt-3 gap-1"},ta={class:"text-xxs text-blue-primary font-semibold uppercase"},la={key:1,class:"border rounded-md cursor-pointer flex flex-col justify-around p-2"},na={class:"text-xxs text-gray-400 font-semibold uppercase"},oa={key:4,class:"border"},ra={class:"text-xxs text-gray-300 font-semibold py-2 px-2 uppercase"},ia=["onClick"],ca={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},da={key:1,class:"text-xs py-2 pl-2 w-full"},ua={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold text-blue-primary bg-gray-100 uppercase"},ma={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold text-blue-primary uppercase"},va={class:"bg-navy-primary p-6 lg:col-span-1"},ga={class:"font-semibold text-xs text-white mb-1.5"},fa=f("div",{class:"mt-3"},null,-1),pa=["disabled"],ba=["disabled"],ya={class:"text-center"};function ka(t,i,L,e,h,M){const ae=_("AccountComponent"),E=_("AccountTabs"),I=_("SelectInputPluginClean"),R=_("AddressInputClean"),A=_("font-awesome-icon"),P=_("TransactionFeeDisplay"),O=_("PasswordInput"),j=_("router-link");return o(),r("div",null,[f("div",ze,[k(ae,{address:L.address,class:"mb-6"},null,8,["address"]),k(E,{address:L.address,selected:"details"},null,8,["address"]),f("div",He,[f("div",qe,[e.isMultiSig?(o(),r("div",Ze,[e.walletCosignerList.cosignerList.length>0?(o(),r("div",Ge,[f("div",Qe,[re(d(t.$t("general.initiateBy"))+": ",1),e.walletCosignerList.length==1?(o(),r("span",Je,d(e.walletCosignerList.cosignerList[0].name),1)):(o(),r("span",Xe,[Ue(f("select",{class:"","onUpdate:modelValue":i[0]||(i[0]=s=>e.selectedCosignPublicKey=s)},[(o(!0),r(ie,null,ce(e.walletCosignerList.cosignerList,(s,v)=>(o(),r("option",{value:e.findAcc(s.publicKey).publicKey,key:v},d(s.name),9,Ye))),128))],512),[[Ve,e.selectedCosignPublicKey]])]))])])):b("",!0)])):b("",!0),e.selectAction=="Link"?(o(),r("div",$e,d(t.$t("general.linkToNamespace")),1)):b("",!0),e.selectAction=="Unlink"?(o(),r("div",ea,d(t.$t("namespace.manageNamespace")),1)):b("",!0),e.err!=""?(o(),r("div",aa,d(e.err),1)):b("",!0),k(I,{class:"my-3",placeholder:t.$t("namespace.selectAction"),modelValue:e.selectAction,"onUpdate:modelValue":i[1]||(i[1]=s=>e.selectAction=s),options:e.actionsOptions,ref:"selectActionRef",disabled:e.disableNamespace},null,8,["placeholder","modelValue","options","disabled"]),k(I,{placeholder:t.$t("namespace.selectNamespace"),ref:"selectNamespaceRef",modelValue:e.selectNamespace,"onUpdate:modelValue":i[2]||(i[2]=s=>e.selectNamespace=s),options:e.namespaceOptions,disabled:e.disableNamespace||e.disableSelectNamespace},null,8,["placeholder","modelValue","options","disabled"]),f("div",sa,[k(R,{placeholder:t.$t("general.addAccAddress"),modelValue:e.namespaceAddress,"onUpdate:modelValue":i[3]||(i[3]=s=>e.namespaceAddress=s),errorMessage:e.addressErrorMsg,showError:e.showAddressError,disabled:e.disableNamespace||e.selectAction=="Unlink"||e.selectNamespace==null},null,8,["placeholder","modelValue","errorMessage","showError","disabled"]),e.selectNamespace!=null&&e.selectAction=="Link"?(o(),r("div",{key:0,onClick:i[4]||(i[4]=s=>e.showContactSelection=!e.showContactSelection),class:"border rounded-md cursor-pointer flex flex-col justify-around p-2"},[k(A,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),f("div",ta,d(t.$t("general.select")),1)])):(o(),r("div",la,[k(A,{icon:"id-card-alt",class:"text-gray-400 ml-auto mr-auto"}),f("div",na,d(t.$t("general.select")),1)]))]),e.showContactSelection?(o(),r("div",oa,[f("div",ra,d(t.$t("general.importFromAB")),1),(o(!0),r(ie,null,ce(e.contact,(s,v)=>(o(),r("div",{key:v,class:"cursor-pointer"},[f("div",{onClick:g=>{e.namespaceAddress=s.value,e.showContactSelection=!1},class:"flex justify-center"},[v%2==0?(o(),r("div",ca,d(s.label),1)):b("",!0),v%2==1?(o(),r("div",da,d(s.label),1)):b("",!0),v%2==0?(o(),r("div",ua,d(t.$t("general.select")),1)):b("",!0),v%2==1?(o(),r("div",ma,d(t.$t("general.select")),1)):b("",!0)],8,ia)]))),128))])):b("",!0)]),f("div",va,[k(P,{"transaction-fee":Number(e.trxFee),"total-fee-formatted":String(e.totalFee),"get-multi-sig-cosigner":e.walletCosignerList,"check-cosign-balance":String(e.checkCosignBalance),"lock-fund-currency":e.lockFund,"lock-fund-tx-fee":e.lockFundTxFee,balance:e.accountDisplayBalance,"selected-acc-add":L.address,"no-namespace":e.noNamespace,"on-partial":e.onPartial,"is-cosigner":e.isCosigner,"fund-status":e.fundStatus},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add","no-namespace","on-partial","is-cosigner","fund-status"]),f("div",ga,d(t.$t("general.enterPasswordContinue")),1),k(O,{placeholder:t.$t("general.enterPassword"),errorMessage:t.$t("general.passwordRequired"),modelValue:e.walletPassword,"onUpdate:modelValue":i[5]||(i[5]=s=>e.walletPassword=s),icon:"lock",disabled:e.disableNamespace},null,8,["placeholder","errorMessage","modelValue","disabled"]),fa,e.selectAction=="Link"?(o(),r("button",{key:0,class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[6]||(i[6]=(...s)=>e.aliasAddressToNamespace&&e.aliasAddressToNamespace(...s)),disabled:e.disableCreate},d(t.$t("general.linkToNamespace")),9,pa)):b("",!0),e.selectAction=="Unlink"?(o(),r("button",{key:1,class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[7]||(i[7]=(...s)=>e.aliasAddressToNamespace&&e.aliasAddressToNamespace(...s)),disabled:e.disableCreate},d(t.$t("namespace.unlinkNamespace")),9,ba)):b("",!0),f("div",ya,[k(j,{to:{name:"ViewAccountDetails",params:{address:L.address}},class:"content-center text-xs text-white underline"},{default:Be(()=>[re(d(t.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Ka=Se(je,[["render",ka]]);export{Ka as default};
