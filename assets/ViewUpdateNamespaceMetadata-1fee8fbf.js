import{g as m,K as Ue,c as g,w as d,H as P,A as y,x as s,D as C,j as Ee,n as H,B as Be,aw as A,k as We,_ as De,a as Re,b as ee,r as E,S as Qe,o as i,f as c,e as n,l as L,t as f,i as M,s as ce,Q as R,am as je,F as de,M as ue,ax as ge}from"./index-ac085045.js";import{_ as Oe}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-975bab2a.js";import{T as Ze}from"./TransactionLayout-5136d917.js";import{M as te}from"./multisigUtils-b7840722.js";import{t as ze}from"./jdenticon-module-2a95d186.js";import{M as Xe}from"./MetadataInput-f3cd1a18.js";import{U as Ge}from"./UTF8-62cc6a5f.js";import{T as Q}from"./transactionState-90b266b3.js";import{_ as qe}from"./icon-namespace-e5424a8b.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-4c592bc8.js";import"./proximax-logo-ecfc3767.js";import"./icon-info-8b4f1351.js";const Je={name:"ViewUpdateNamespaceMetadata",props:{targetId:String,scopedMetadataKey:String},components:{MetadataInput:Xe,TransactionFeeDisplay:Oe,TransactionLayout:Ze},setup(r){const v=We();let j=m(!1),t=m(!0),k=m(1),b=m(null),x=m(null),T=m(!1),K=m(""),u=m(""),p=m(null),h,o,_,B;const I=m(""),S=m(""),ae=new Ue("ThemeStyleConfig");ae.init();const ve=g(()=>ze(p.value?p.value.address:"",40,ae.jdenticonConfig)),me=g(()=>p.value?d.currentLoggedInWallet.convertAddressToName(p.value.address,!0):""),le=m([]),W=d.currentLoggedInWallet?d.currentLoggedInWallet.selectDefaultAccount():null,O=m(W?W.address:""),fe=m(P.toCurrencyFormat(W?W.balance:0,y.nativeToken.divisibility)),ne=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=ne(e)),e),Z=e=>{e=ne(e);let a=s.Convert.hexToUint8(e);return Ge.isNotUTF8(a)||(e=s.Convert.decodeHexToUtf8(e)),e},ye=()=>{let e=new s.MetadataQueryParams;e.metadataType=s.MetadataType.NAMESPACE,e.targetId=x.value,y.chainAPI.metadataAPI.searchMetadatas(e).then(a=>{a.metadataEntries.forEach(l=>{le.value.push({value:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?l.scopedMetadataKey.toHex():Z(l.scopedMetadataKey.toHex()),type:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?2:1})})})},pe=async()=>{if(r.targetId.length===16&&s.Convert.isHexString(r.targetId)){let a=s.UInt64.fromHex(r.targetId),l=new s.NamespaceId([a.lower,a.higher]);x.value=l,h.targetNamespaceId(x.value)}else try{let a=new s.NamespaceId(r.targetId);x.value=a,h.targetNamespaceId(x.value)}catch{return}let e=await y.chainAPI.namespaceAPI.getNamespace(x.value);b.value=e.owner,h.targetPublicKey(b.value),d.currentLoggedInWallet&&(p.value=d.currentLoggedInWallet.accounts.find(a=>a.publicKey===e.owner.publicKey)||d.currentLoggedInWallet.others.find(a=>a.publicKey===e.owner.publicKey),p.value&&(T.value=!!p.value.getDirectParentMultisig().length))},be=g(()=>p.value?r.targetId.length==16&&s.Convert.isHexString(r.targetId)?p.value.namespaces.find(a=>a.idHex==r.targetId).name:r.targetId:""),he=g(()=>d.currentLoggedInWallet&&b.value?d.currentLoggedInWallet.others.find(e=>e.publicKey===b.value.publicKey):null);C(he,async e=>{e&&(p.value=d.currentLoggedInWallet.accounts.find(a=>a.publicKey===b.value.publicKey)||d.currentLoggedInWallet.others.find(a=>a.publicKey===b.value.publicKey),p.value&&(T.value=!!p.value.getDirectParentMultisig().length))},{deep:!0});const xe=()=>{if(r.scopedMetadataKey)if(t.value=!1,u.value=r.scopedMetadataKey,r.scopedMetadataKey.length===16&&s.Convert.isHexString(r.scopedMetadataKey))k.value=2,K.value=r.scopedMetadataKey,h.scopedMetadataKey(s.UInt64.fromHex(K.value));else{k.value=1;let e=s.Convert.utf8ToHex(r.scopedMetadataKey);const a=e.length/2;e.length&&a<=8&&(e.length/2<8&&(e=e+"00".repeat(8-a)),K.value=e,h.scopedMetadataKey(s.UInt64.fromHex(K.value)))}},_e=async()=>{h=y.buildTxn.namespaceMetadataBuilder();const e=await y.chainAPI.nodeAPI.getNodeTime();o=y.buildTxn.aggregateBondedBuilder(new s.UInt64(e.sendTimeStamp))},Me=async()=>{if(x.value&&K.value){let e=new s.MetadataQueryParams;e.targetId=x.value,e.metadataType=s.MetadataType.NAMESPACE,e.scopedMetadataKey=s.UInt64.fromHex(K.value);let a=await y.chainAPI.metadataAPI.searchMetadatas(e);a.metadataEntries.length&&(I.value=a.metadataEntries[0].value)}h.oldValue(I.value)},Te=()=>{h.value(S.value)},z=()=>{_=h.calculateDifferences().build()},X=()=>{_&&(B=o.innerTransactions([_.toAggregateV1(b.value)]).build())},G=()=>{B&&(V.value=B.maxFee.compact()/Math.pow(10,y.nativeToken.divisibility))},se=async()=>{await _e(),await pe(),xe(),await Me(),Te(),z(),X(),G(),ye()};if(y.isReady)se();else{let e=C(y,a=>{a.isReady&&(se(),e())})}const Ke=g(()=>y.nativeToken.label);Ee();const Ie=m(""),ke=d.currentLoggedInWallet?d.currentLoggedInWallet.name:"",q=g(()=>H.currentNetworkProfileConfig?P.convertToExact(H.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),we=g(()=>H.currentNetworkProfileConfig?P.convertToCurrency(H.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),J=g(()=>H.currentNetworkProfile?P.convertToExact(Be.getLockFundFee(),y.nativeToken.divisibility):0),Ce=m(!1),Y=g(()=>k.value==1?s.Convert.utf8ToHex(u.value).length/2>8:u.value.length>16?!0:u.value.length%2===1),oe=g(()=>Ve.value<$.value),Ae=g(()=>Y.value==!0||u.value==""||S.value==""||oe.value==!0),F=g(()=>{if(!d.currentLoggedInWallet)return[];let e=d.currentLoggedInWallet.accounts.map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!!l.getDirectParentMultisig().length})),a=d.currentLoggedInWallet.others.filter(l=>l.type==="MULTISIG").map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!0}));return e.concat(a)}),V=m(0);C(k,e=>{re(),e==2&&(s.Convert.isHexString(u.value)||(u.value=""))});const re=async()=>{if(Y.value||u.value.length==0)return;let e="";if(k.value==1){let D=s.Convert.utf8ToHex(u.value);e=D+"00".repeat((16-D.length)/2)}else e="00".repeat((16-u.value.length)/2)+u.value;let a=new s.MetadataQueryParams;a.targetId=x.value,a.metadataType=s.MetadataType.NAMESPACE,a.scopedMetadataKey=s.UInt64.fromHex(e);let l=await y.chainAPI.metadataAPI.searchMetadatas(a);l.metadataEntries.length?I.value=l.metadataEntries[0].value:I.value=""},Se=async()=>{if(!d.currentLoggedInWallet)return;let e="",a;if(k.value==1){let N=s.Convert.utf8ToHex(u.value);e=N+"00".repeat((16-N.length)/2)}else e="00".repeat((16-u.value.length)/2)+u.value;let l=h.targetPublicKey(b.value).targetNamespaceId(x.value).scopedMetadataKey(s.UInt64.fromHex(e)).value(S.value).oldValue(I.value).calculateDifferences().build(),D=y.buildTxn.aggregateCompleteBuilder().innerTransactions([l.toAggregateV1(b.value)]).build().serialize(),ie=d.currentLoggedInWallet.accounts.find(N=>N.publicKey==b.value.publicKey).address;if(T.value){let N=d.currentLoggedInWallet.accounts.find(Fe=>Fe.publicKey==w.value).address;a=l.toAggregateV1(b.value).serialize(),Q.selectedAddress=N,Q.selectedMultisigAddress=ie}else a=D,Q.selectedAddress=ie;u.value="",I.value="",S.value="",Q.unsignedTransactionPayload=a,v.push({name:"ViewConfirmTransaction"})},$=g(()=>{let e=y.nativeToken.divisibility;return T.value?e==0?Math.trunc(q.value+J.value+V.value):Math.round((q.value+J.value+V.value)*Math.pow(10,e))/Math.pow(10,e):V.value}),U=g(()=>!d.currentLoggedInWallet||!b.value?[]:te.getCosignerInWallet(b.value.publicKey).cosignerList.length?F.value?te.getCosignerInWallet(b.value.publicKey).cosignerList.map(e=>{let a=F.value.find(l=>l.publicKey==e);return{name:a.name,publicKey:e,balance:a.balance}}):[]:[]),w=m("");U.value.length>0&&(w.value=U.value[0].publicKey),C(()=>U,e=>{e.value.length&&(w.value=U.value[0].publicKey)},{deep:!0});const Ve=g(()=>d.currentLoggedInWallet?T.value?w.value?A(w.value).balance:0:p.value?p.value.balance:0:0),Ne=g(()=>V.value.toString()),Pe=g(()=>P.amountFormatterSimple($.value,0)),He=g(()=>{if(H.currentNetworkProfileConfig){let e=te.getCosignerInWallet(F.value.find(l=>l.address==O.value)?F.value.find(l=>l.address==O.value).publicKey:""),a=[];return e.cosignerList.forEach(l=>{a.push({publicKey:l,name:A(l).name,balance:A(l).balance,address:A(l).address})}),e.cosignerList=a,e}else return{hasCosigner:!1,cosignerList:[]}}),Le=g(()=>{let e=A(w.value)?A(w.value).balance:0;return P.toCurrencyFormat(e,3)});return C(I,e=>{h.oldValue(e),z(),X(),G()}),C(S,e=>{h.value(e),z(),X(),G()}),C(u,e=>{e==""&&(I.value="")}),{findAcc:A,totalFee:$,err:Ie,showPasswdError:Ce,accounts:F,updateMetadata:Se,targetAccIsMultisig:T,lockFundCurrency:we,lockFund:q,aggregateFee:V,lockFundTxFee:J,walletName:ke,currentNativeTokenName:Ke,oldValue:I,newValue:S,cosigners:U,scopedMetadataKeyType:k,svgString:ve,accountName:me,disableAddBtn:Ae,showBalanceErr:oe,showScopedKeyErr:Y,inputScopedMetadataKey:u,checkOldValue:re,selectedCosigner:w,namespaceName:be,existingScopedMetadataKeys:le,showKeys:j,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:K,transactionFee:Ne,totalFeeFormatted:Pe,selectedAccAdd:O,accBalance:fe,getMultiSigCosigner:He,checkCosignBalance:Le}}},Ye=n("div",{class:"font-semibold mb-4"},"Update Namespace Metadata",-1),$e={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},et={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},tt={class:"inline-block text-xs"},at={key:1,class:"error error_box mb-5"},lt={class:"flex items-center"},nt=["innerHTML"],st={class:"ml-2"},ot={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},rt={class:"font-bold text-black text-sm"},it={key:2,class:"text-left mt-2 mb-5 ml-4"},ct={key:0},dt={class:"text-tsm"},ut={key:0,class:"font-bold"},gt={key:1,class:"font-bold"},vt=["value"],mt={key:1,class:"error"},ft={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},yt=n("img",{src:qe},null,-1),pt={class:"ml-1"},bt=n("div",{class:"uppercase text-blue-primary font-semibold text-xxs"}," NAMESPACE ",-1),ht={class:"text-black text-sm font-bold"},xt={key:3,class:"mt-2"},_t=["onClick"],Mt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},Tt={key:1,class:"text-xs py-2 pl-2 w-full"},Kt={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},It={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},kt={key:4},wt={class:"flex gap-3"},Ct={class:"flex gap-2"},At=n("label",{for:"regular"},"UTF-8",-1),St={class:"flex gap-2"},Vt=n("label",{for:"hexa"},"Hexadecimal",-1),Nt={key:5,class:"my-3"},Pt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Ht={class:"flex flex-col gap-0.5"},Lt=n("div",{class:"uppercase text-xxs font-semibold text-blue-primary"}," Selected Scoped Metadata Key ",-1),Ft={class:"flex"},Ut={class:"font-semibold"},Et={class:"ml-3 text-gray-400 font-semibold"},Bt={class:"flex"},Wt={key:0,class:"font-semibold"},Dt={key:1,class:"ml-3 text-gray-400 font-semibold"},Rt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Qt=n("div",{class:"uppercase text-xxs text-blue-primary font-semibold"}," CURRENT VALUE ",-1),jt={class:"font-semibold"},Ot=["disabled"],Zt={class:"text-center"};function zt(r,v,j,t,k,b){const x=E("font-awesome-icon"),T=E("MetadataInput"),K=E("TransactionFeeDisplay"),u=E("router-link"),p=E("TransactionLayout"),h=Qe("debounce");return i(),Re(p,{class:"mt-8"},{white:ee(()=>[Ye,t.showBalanceErr?(i(),c("div",$e,[n("div",et,[L(x,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),n("div",tt,f(r.$t("general.insufficientBalance")),1)])):M("",!0),t.err!=""?(i(),c("div",at,f(t.err),1)):M("",!0),n("div",lt,[n("div",{innerHTML:t.svgString,class:"inline-block"},null,8,nt),n("div",st,[n("div",ot,f(r.$t("namespace.namespaceCreatedBy")),1),n("div",rt,f(t.accountName),1)])]),t.targetAccIsMultisig?(i(),c("div",it,[t.cosigners.length>0?(i(),c("div",ct,[n("div",dt,[ce(f(r.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(i(),c("span",ut,f(t.cosigners[0].name),1)):(i(),c("span",gt,[R(n("select",{class:"","onUpdate:modelValue":v[0]||(v[0]=o=>t.selectedCosigner=o)},[(i(!0),c(de,null,ue(t.cosigners,(o,_)=>(i(),c("option",{value:t.findAcc(o.publicKey).publicKey,key:_},f(o.name),9,vt))),128))],512),[[je,t.selectedCosigner]])]))])])):(i(),c("div",mt,f(r.$t("general.noCosigner")),1))])):M("",!0),n("div",ft,[yt,n("div",pt,[bt,n("div",ht,f(t.namespaceName),1)])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(i(),c("div",xt,[n("div",{onClick:v[1]||(v[1]=o=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"}," Select Existing Scoped Metadata Key "),(i(!0),c(de,null,ue(t.existingScopedMetadataKeys,(o,_)=>(i(),c("div",{key:_},[t.showKeys?(i(),c("div",{key:0,class:"flex justify-center cursor-pointer",onClick:B=>(t.scopedMetadataKeyType=o.type,t.inputScopedMetadataKey=o.value,t.checkOldValue(),t.showKeys=!1)},[_%2==0?(i(),c("div",Mt,f(o.value),1)):M("",!0),_%2==1?(i(),c("div",Tt,f(o.value),1)):M("",!0),_%2==0?(i(),c("div",Kt,f(r.$t("general.select")),1)):M("",!0),_%2==1?(i(),c("div",It,f(r.$t("general.select")),1)):M("",!0)],8,_t)):M("",!0)]))),128))])):M("",!0),t.scopedMetadataKeySelectable?(i(),c("div",kt,[R(L(T,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":v[2]||(v[2]=o=>t.inputScopedMetadataKey=o),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[h,t.checkOldValue,"1000"]]),n("div",wt,[n("div",Ct,[R(n("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":v[3]||(v[3]=o=>t.scopedMetadataKeyType=o)},null,512),[[ge,t.scopedMetadataKeyType]]),At]),n("div",St,[R(n("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":v[4]||(v[4]=o=>t.scopedMetadataKeyType=o)},null,512),[[ge,t.scopedMetadataKeyType]]),Vt])]),L(T,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":v[5]||(v[5]=o=>t.oldValue=o),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(i(),c("div",Nt,[n("div",Pt,[n("div",Ht,[Lt,n("div",Ft,[n("div",Ut,f(j.scopedMetadataKey),1),n("div",Et,f(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),n("div",Bt,[t.scopedMetadataKeyType==1?(i(),c("div",Wt,f(t.scopedMetadataKeyHex),1)):M("",!0),t.scopedMetadataKeyType==1?(i(),c("div",Dt," HEX ")):M("",!0)])])]),n("div",Rt,[Qt,n("div",jt,f(t.oldValue),1)])])),L(T,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":v[6]||(v[6]=o=>t.newValue=o),placeholder:"New Value"},null,8,["modelValue"])]),navy:ee(()=>[L(K,{"transaction-fee":String(t.transactionFee),"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),n("button",{type:"submit",class:"w-full blue-btn px-3 py-3 mt-3 disabled:opacity-50 disabled:cursor-auto",onClick:v[7]||(v[7]=o=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Namespace Metadata ",8,Ot),n("div",Zt,[L(u,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:ee(()=>[ce(f(r.$t("general.cancel")),1)]),_:1})])]),_:1})}const oa=De(Je,[["render",zt]]);export{oa as default};
