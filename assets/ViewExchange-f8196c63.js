import{d as $e,c as I,r as F,H as p,n as j,B as o,S as O,z as n,w as x,A as We,a as K,l as Oe,i as Ke,o as g,b as y,e as t,f as w,m as S,t as s,y as d,v as Re,x as je,h as Xe,W as Le,be as ze}from"./index-9b2bf1fa.js";import{_ as Ee}from"./proximax-logo-ecfc3767.js";import{_ as qe,a as Je,I as Qe}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-aabe464a.js";import{_ as Ye}from"./PasswordInput.vue_vue_type_script_setup_true_lang-0652d022.js";import"./jdenticon-module-f6f63ff7.js";const Ze={class:"border-2 xl:grid xl:grid-cols-3"},et={class:"xl:col-span-2 p-12"},tt=t("div",null,"SDA-SDA Exchange ",-1),at={key:0,class:"text-xs mt-3 text-blue-primary"},it=t("div",{class:"text-blue-primary mt-3"},"Price",-1),st=t("div",{class:"text-blue-primary mt-3"},"Available Amount",-1),ot=t("div",{class:"text-blue-primary mt-3"},"Minimum Offer ",-1),lt={class:"text-blue-primary mt-3"},nt={key:1,class:"text-red-500 text-xs"},ct={key:2,class:"text-red-500 text-xs"},rt={class:"mt-2 text-xs text-gray-600"},ut={class:"flex mt-2"},dt={class:"text-gray-600 text-xs"},vt={key:0,class:"text-red-500 text-xs ml-2"},mt={key:3,class:"text-gray-600 text-xs mt-2"},pt=t("div",{class:"text-blue-primary mt-3"},"Actual offer",-1),gt={key:4},yt={key:5},ft={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},ht={key:0},bt={class:"font-bold text-xs text-blue-primary uppercase"},xt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},_t={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},wt=["innerHTML"],Gt={class:"flex"},Tt={class:"ml-1 text-blue-400 font-bold"},Mt=t("img",{src:Ee,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),At={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},It=t("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),kt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Ft={class:"ml-1 text-blue-400 text-xs"},Dt=t("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),Nt={class:"font-bold text-xs text-blue-primary uppercase"},Lt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},Et={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Ht=["innerHTML"],St={class:"flex"},Pt={class:"ml-1 text-blue-400 font-bold"},Ct=t("img",{src:Ee,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),Bt=t("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Vt={key:1},Ut={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},$t=t("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Wt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Ot={class:"ml-1 text-blue-400 text-xs"},Kt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Rt={class:"font-semibold lg:col-span-2 col-span-3"},jt=["innerHTML"],Xt={class:"ml-1 text-blue-400"},zt={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},qt={class:"font-semibold lg:col-span-2 col-span-3"},Jt=["innerHTML"],Qt={class:"ml-1 text-blue-400"},Yt={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Zt={class:"font-semibold lg:col-span-2 col-span-3"},ea=["innerHTML"],ta={class:"ml-1 text-blue-400"},aa=t("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),ia={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},sa=t("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"},"Total",-1),oa=["innerHTML"],la={class:"ml-1 text-blue-400"},na={class:"font-semibold text-xs text-white mb-1.5"},ca={class:"text-center"},ga=$e({__name:"ViewExchange",props:{type:String,owner:String,pair:String},setup(He){const X=(a,i)=>{const l=(m,b)=>b===0?m:l(b,m%b),v=l(a,i),r=a/v,f=i/v;return[r,f]},_=I(()=>{var a,i;return parseFloat(c.value)<M.value[0]/Math.pow(10,(a=e.value)==null?void 0:a.mosaicGetDivisibility)?0:parseFloat(c.value)*Math.pow(10,(i=e.value)==null?void 0:i.mosaicGetDivisibility)%M.value[0]}),Se=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],c=F("0"),D=I(()=>parseFloat(c.value)*C.value-_.value*C.value),z=Xe().appContext.config.globalProperties.emitter,N=F(""),G=F(null),T=F(null),q=I(()=>p.convertToExact(j.currentNetworkProfileConfig.lockedFundsPerAggregate,o.nativeToken.divisibility)),J=I(()=>p.convertToExact(O.getLockFundFee(),o.nativeToken.divisibility)),P=I(()=>{var v,r,f,m;if(!o.isReady)return 0;const a=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(parseFloat(c.value)*Math.pow(10,((v=e.value)==null?void 0:v.mosaicGiveDivisibility)??0)),new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(D.value*Math.pow(10,((r=e.value)==null?void 0:r.mosaicGetDivisibility)??0)),(f=e.value)==null?void 0:f.deadline)],o.networkType);if(!A.value)return((m=a.maxFee)==null?void 0:m.compact())/Math.pow(10,o.nativeToken.divisibility);const i=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(b=>b.address==T.value),l=[a.toAggregateV1(n.PublicAccount.createFromPublicKey(i.publicKey,o.networkType))];return o.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,o.nativeToken.divisibility)});z.on("select-account",a=>{G.value=a}),z.on("select-multisig-account",a=>{T.value=a});const u=a=>{const i=Se.find(l=>l.namespace==a);return i?i.name:a},R=I(()=>A.value?Math.round((q.value+J.value+P.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()?Math.round((parseFloat(c.value)-_.value+P.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):P.value),L=He,e=F(null),C=F(0),h=We(),Q=L.pair.split("/")[L.type=="Sell"?0:1],Y=L.pair.split("/")[L.type=="Sell"?1:0],k=F(0),Z=a=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==a)||x.currentLoggedInWallet.others.find(l=>l.address==a);return i?E(i.balance):0},E=a=>{let i=a.toString().split(".");return i[1]!=null?'<span class="font-semibold text-sm">'+i[0]+'</span>.<span class="font-semibold text-xs">'+i[1]+"</span>":'<span class="font-semibold text-sm">'+i[0]+"</span>"},M=I(()=>{if(!e.value)return X(0,0);const a=e.value.initialMosaicGiveAmount.compact(),i=e.value.initialMosaicGetAmount.compact();return X(i,a)});K(e,a=>{a.mosaicGetDivisibility&&(c.value=(M.value[0]/Math.pow(10,a.mosaicGetDivisibility)).toString())},{deep:!0});const A=I(()=>T.value!=null),Pe=async()=>{if(!Q||!Y){h.add({severity:"error",summary:"Error",detail:"Invalid",group:"br-custom",life:1e3});return}const a=new n.ExchangeSdaHttp(o.nodeFullURL),i=await ze(a.getAccountSdaExchangeOffers(n.Address.createFromRawAddress(L.owner)));if(e.value=i.sdaOfferBalances.find(r=>r.mosaicIdGive.toHex()==Q&&r.mosaicIdGet.toHex()==Y),!e.value){h.add({severity:"error",summary:"Error",detail:"Offer not found",group:"br-custom",life:1e3});return}const l=await o.chainAPI.assetAPI.getMosaicsNames([e.value.mosaicIdGet,e.value.mosaicIdGive]),v=await o.chainAPI.assetAPI.getMosaics([e.value.mosaicIdGet,e.value.mosaicIdGive]);e.value.mosaicGetName=l[0].names.length?l[0].names[0].name:e.value.mosaicIdGet.toHex(),e.value.mosaicGiveName=l[1].names.length?l[1].names[0].name:e.value.mosaicIdGive.toHex(),e.value.mosaicGetDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGet.toHex()).divisibility,e.value.mosaicGiveDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGive.toHex()).divisibility,C.value=e.value.initialMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)/(e.value.initialMosaicGetAmount.compact()/Math.pow(10,e.value.mosaicGetDivisibility))},ee=async a=>{try{const l=(await o.chainAPI.accountAPI.getAccountInfo(n.Address.createFromRawAddress(a))).mosaics.find(v=>v.id.toHex()==e.value.mosaicIdGet.toHex());if(!l){k.value=0;return}k.value=l.amount.compact()/Math.pow(10,e.value.mosaicGetDivisibility)}catch{k.value=0}};K(c,a=>{isNaN(parseFloat(a))&&(c.value="0")}),K([G,T],([a,i])=>{k.value=0,a!=null&&i==null?ee(a):a!=null&&i!=null&&ee(i)});const Ce=K(o,async(a,i)=>{a.isReady&&(await Pe(),Ce())},{immediate:!0}),Be=a=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==a)||x.currentLoggedInWallet.others.find(l=>l.address==a);return i?i.balance:0},Ve=Oe(),Ue=async()=>{if(G.value==null){h.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(parseFloat(c.value)<M.value[0]/Math.pow(10,e.value.mosaicGetDivisibility)){h.add({severity:"error",summary:"Error",detail:"Less than minimum offer amount",group:"br-custom",life:1e3});return}if(parseFloat(c.value)-_.value>k.value){h.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))/Math.pow(10,e.value.mosaicGiveDivisibility)>e.value.currentMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)){h.add({severity:"error",summary:"Error",detail:"Exceed available amount of "+u(e.value.mosaicGiveName),group:"br-custom",life:1e3});return}const a=Be(G.value);if(A.value&&a<R.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()&&!A.value&&a<R.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(N.value.length<8){h.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!Le.verifyWalletPassword(x.currentLoggedInWallet.name,j.chainNetworkName,N.value)){h.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const i=x.currentLoggedInWallet.accounts.find(m=>m.address==G.value),l=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(e.value.mosaicIdGet,n.UInt64.fromUint(Math.trunc((parseFloat(c.value)-_.value)*Math.pow(10,e.value.mosaicGetDivisibility))),e.value.mosaicIdGive,n.UInt64.fromUint(Math.trunc(D.value*Math.pow(10,e.value.mosaicGetDivisibility))),n.UInt64.fromUint(57600))],o.networkType),v=Le.decryptPrivateKey(new n.Password(N.value),i.encrypted,i.iv);N.value="";const r=n.Account.createFromPrivateKeyV1(v,o.networkType),f=j.currentNetworkProfile.generationHash;if(A.value){const m=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find($=>$.address==T.value),b=[l.toAggregateV1(n.PublicAccount.createFromPublicKey(m.publicKey,o.networkType))],B=o.buildTxn.aggregateBonded(b),H=r.preV2Sign(B,f),V=O.lockFundTx(H),U=r.preV2Sign(V,f);O.announceLF_AND_addAutoAnnounceABT(U,H)}else{const m=r.preV2Sign(l,f);await O.announceTransaction(m)}Ve.push({name:"ViewAccountPendingTransactions",params:{address:r.address.plain()}})};return(a,i)=>{var v,r,f,m,b,B,H,V,U,$,te,ae,ie,se,oe,le,ne,ce,re,ue,de,ve,me,pe,ge,ye,fe,he,be,xe,_e,we,Ge,Te,Me,Ae,Ie,ke,Fe,De,Ne;const l=Ke("router-link");return g(),y("div",null,[t("div",Ze,[t("div",et,[tt,G.value?w("",!0):(g(),y("div",at,"Select Account to Create / Initiate Transaction")),S(qe),S(Je,{class:"md:mt-3","selected-address":G.value},null,8,["selected-address"]),it,t("div",null,s(Math.trunc(C.value*Math.pow(10,(v=e.value)==null?void 0:v.mosaicGiveDivisibility))/Math.pow(10,(r=e.value)==null?void 0:r.mosaicGiveDivisibility))+" "+s(u((f=e.value)==null?void 0:f.mosaicGiveName))+"/"+s(u((m=e.value)==null?void 0:m.mosaicGetName)),1),st,t("div",null,s(d(p).toCurrencyFormat(((b=e.value)==null?void 0:b.currentMosaicGiveAmount.compact())/Math.pow(10,(B=e.value)==null?void 0:B.mosaicGiveDivisibility),(H=e.value)==null?void 0:H.mosaicGiveDivisibility))+" "+s(u((V=e.value)==null?void 0:V.mosaicGiveName)),1),ot,t("div",null,s(d(p).toCurrencyFormat(M.value[0]/Math.pow(10,(U=e.value)==null?void 0:U.mosaicGetDivisibility),($=e.value)==null?void 0:$.mosaicGetDivisibility))+" "+s(u((te=e.value)==null?void 0:te.mosaicGetName))+" : "+s(d(p).toCurrencyFormat(M.value[1]/Math.pow(10,(ae=e.value)==null?void 0:ae.mosaicGiveDivisibility),(ie=e.value)==null?void 0:ie.mosaicGiveDivisibility))+" "+s(u((se=e.value)==null?void 0:se.mosaicGiveName)),1),t("div",lt,"Amount to give ("+s(u((oe=e.value)==null?void 0:oe.mosaicGetName))+") ",1),S(Qe,{placeholder:"Asset Amount",modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=W=>c.value=W),decimal:((le=e.value)==null?void 0:le.mosaicGetDivisibility)??0},null,8,["modelValue","decimal"]),parseFloat(c.value)>k.value?(g(),y("div",nt,"Insufficient Balance")):w("",!0),parseFloat(c.value)<M.value[0]/Math.pow(10,(ne=e.value)==null?void 0:ne.mosaicGetDivisibility)?(g(),y("div",ct,"Less than minimum offer amount")):w("",!0),t("div",rt,"Available to give: "+s(d(p).toCurrencyFormat(k.value,(ce=e.value)==null?void 0:ce.mosaicGetDivisibility))+" "+s(u((re=e.value)==null?void 0:re.mosaicGetName)),1),t("div",ut,[t("div",dt," I will receive "+s(d(p).toCurrencyFormat(D.value,(ue=e.value)==null?void 0:ue.mosaicGiveDivisibility))+" "+s(u((de=e.value)==null?void 0:de.mosaicGiveName)),1),Math.trunc(D.value*Math.pow(10,(ve=e.value)==null?void 0:ve.mosaicGiveDivisibility))/Math.pow(10,(me=e.value)==null?void 0:me.mosaicGiveDivisibility)>((pe=e.value)==null?void 0:pe.currentMosaicGiveAmount.compact())/Math.pow(10,(ge=e.value)==null?void 0:ge.mosaicGiveDivisibility)?(g(),y("div",vt," (Exceed Available Amount of "+s(u((ye=e.value)==null?void 0:ye.mosaicGiveName))+")",1)):w("",!0)]),Math.trunc(_.value*Math.pow(10,(fe=e.value)==null?void 0:fe.mosaicGetDivisibility))/Math.pow(10,(he=e.value)==null?void 0:he.mosaicGetDivisibility)>0?(g(),y("div",mt,s(d(p).toCurrencyFormat(_.value,(be=e.value)==null?void 0:be.mosaicGetDivisibility))+" "+s(u((xe=e.value)==null?void 0:xe.mosaicGetName))+" will be ignored ",1)):w("",!0),pt,parseFloat(c.value)>=M.value[0]/Math.pow(10,(_e=e.value)==null?void 0:_e.mosaicGetDivisibility)?(g(),y("div",gt,s(d(p).toCurrencyFormat(parseFloat(c.value)-_.value,(we=e.value)==null?void 0:we.mosaicGetDivisibility))+" "+s(u((Ge=e.value)==null?void 0:Ge.mosaicGetName))+" : "+s(d(p).toCurrencyFormat(D.value,(Te=e.value)==null?void 0:Te.mosaicGiveDivisibility))+" "+s(u((Me=e.value)==null?void 0:Me.mosaicGiveName)),1)):(g(),y("div",yt," 0 "+s(u((Ae=e.value)==null?void 0:Ae.mosaicGetName))+" : 0 "+s(u((Ie=e.value)==null?void 0:Ie.mosaicGiveName)),1))]),t("div",ft,[T.value?(g(),y("div",ht,[t("div",bt,s(a.$t("general.multisigAcc")),1),t("div",xt,[t("div",_t,s(a.$t("general.currentBalance")),1),t("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:Z(T.value)},null,8,wt),t("div",Gt,[t("div",Tt,s(d(o).nativeToken.label),1),Mt])]),t("div",At,[It,t("span",kt,s(d(p).toCurrencyFormat(parseFloat(c.value)-_.value,(ke=e.value)==null?void 0:ke.mosaicGetDivisibility)),1),t("span",Ft,s(u((Fe=e.value)==null?void 0:Fe.mosaicGetName)),1)]),Dt])):w("",!0),t("div",Nt,s(a.$t("general.signerAcc")),1),t("div",Lt,[t("div",Et,s(a.$t("general.currentBalance")),1),t("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:Z(G.value)},null,8,Ht),t("div",St,[t("div",Pt,s(d(o).nativeToken.label),1),Ct])]),Bt,T.value?w("",!0):(g(),y("div",Vt,[t("div",Ut,[$t,t("span",Wt,s(d(p).toCurrencyFormat(parseFloat(c.value)-_.value,(De=e.value)==null?void 0:De.mosaicGetDivisibility)),1),t("span",Ot,s(u((Ne=e.value)==null?void 0:Ne.mosaicGetName)),1)])])),t("div",Kt,[t("div",Rt,s(A.value?a.$t("general.aggregateFee"):a.$t("general.transactionFee")),1),t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(P.value)},null,8,jt),t("div",Xt,s(d(o).nativeToken.label),1)]),A.value?(g(),y("div",zt,[t("div",qt,s(a.$t("general.lockFund")),1),t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(q.value??0)},null,8,Jt),t("div",Qt,s(d(o).nativeToken.label),1)])):w("",!0),A.value?(g(),y("div",Yt,[t("div",Zt,s(a.$t("general.lockFundTxFee")),1),t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(J.value??0)},null,8,ea),t("div",ta,s(d(o).nativeToken.label),1)])):w("",!0),aa,t("div",ia,[sa,t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(R.value)},null,8,oa),t("div",la,s(d(o).nativeToken.label),1)]),t("div",na,s(a.$t("general.enterPasswordContinue")),1),S(Ye,{placeholder:a.$t("general.enterPassword"),modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=W=>N.value=W),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),t("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[2]||(i[2]=W=>Ue())}," Sell "),t("div",ca,[S(l,{to:{name:"ViewExchangeListing"},class:"content-center text-xs text-white underline"},{default:Re(()=>[je(s(a.$t("general.cancel")),1)]),_:1})])])])])}}});export{ga as default};
