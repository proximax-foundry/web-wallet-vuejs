import{d as R,r as x,c as B,a as N,E as s,k as X,P as O,o as y,b as k,e as o,l as G,f as b,Q as U,m as D,z as d,B as F,s as u,C as p,t as g,A as n,bl as E,_ as j}from"./index-401acdd9.js";import{s as h,a as z}from"./column.esm-71d10fd7.js";import{I as q}from"./InputId-a149c483.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";const K={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5 border-2 p-3"},Q={class:"flex text-xs flex-wrap font-semibold gap-3 mb-3"},W={key:0,class:"text-sm text-blue-primary"},J={key:2,class:"flex justify-center"},Y=["disabled"],Z={class:"flex"},ee={class:"mr-1"},te={class:"text-blue-primary"},ae={class:"flex"},ie={class:"mr-1"},se={class:"text-blue-primary"},oe={class:"flex"},ne={class:"mr-1"},ce=o("button",{class:"blue-btn py-2 px-3"},"Exchange",-1),re=R({__name:"ViewExchangeListing",setup(le){const m=x(""),P=x(!0),L=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],S=t=>t.substring(0,4)+"..."+t.substring(t.length-4,t.length+1),A=t=>{const a=L.find(r=>r.namespace==t);return a?a.name:t.length==16?t.substring(0,4)+"...":t},c=x(!1),$=async()=>{try{new n.NamespaceId(m.value).fullName;const t=await s.chainAPI.namespaceAPI.getLinkedMosaicId(new n.NamespaceId(m.value));m.value=t.toHex();const a=await s.chainAPI.assetAPI.getMosaic(t),r=await s.chainAPI.assetAPI.getMosaicsNames([t]);c.value=!0;return}catch{c.value=!1}try{const t=new n.MosaicId(m.value.toUpperCase()),a=await s.chainAPI.assetAPI.getMosaic(t),r=await s.chainAPI.assetAPI.getMosaicsNames([t]);c.value=!0}catch{c.value=!1}},i=x("xpx"),M=x([]),H=x([]),_=async()=>{let t=[],a;i.value=="others"&&c.value&&(a=m.value),i.value=="xpx"&&(a=s.nativeToken.assetId),i.value=="metx"&&(a=(await s.chainAPI.namespaceAPI.getLinkedMosaicId(new n.NamespaceId("prx.metx"))).id.toHex());const r=new n.ExchangeSdaHttp(s.nodeFullURL);t=await E(r.getExchangeSdaOffers(n.SdaExchangeOfferType.GET,new n.MosaicId(a)));for(let e=0;e<t.length;e++){const l=await s.chainAPI.assetAPI.getMosaicsNames([t[e].mosaicIdGet,t[e].mosaicIdGive]),I=await s.chainAPI.assetAPI.getMosaics([t[e].mosaicIdGet,t[e].mosaicIdGive]);t[e].mosaicGetName=l[0].names.length?l[0].names[0].name:t[e].mosaicIdGet.toHex(),t[e].mosaicGiveName=l[1].names.length?l[1].names[0].name:t[e].mosaicIdGive.toHex(),t[e].mosaicGetDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGet.toHex()).divisibility,t[e].mosaicGiveDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGive.toHex()).divisibility}const w=await s.chainAPI.chainAPI.getBlockchainHeight();M.value=t.map(e=>({owner:e.owner.address.pretty(),idPair:`${e.mosaicIdGive.toHex()}/${e.mosaicIdGet.toHex()}`,deadline:new Date(Date.now()+(e.deadline.compact()-w)*15e3).toLocaleString(),pair:`${A(e.mosaicGiveName)}/${A(e.mosaicGetName)} `,giveAmount:e.currentMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility),getAmount:e.currentMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility),rate:e.initialMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility)/(e.initialMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility))}))},T=async()=>{await f(),await _(),P.value=!0},f=async()=>{let t=[],a;i.value=="others"&&c.value&&(a=m.value),i.value=="xpx"&&(a=s.nativeToken.assetId),i.value=="metx"&&(a=(await s.chainAPI.namespaceAPI.getLinkedMosaicId(new n.NamespaceId("prx.metx"))).id.toHex());const r=new n.ExchangeSdaHttp(s.nodeFullURL);t=await E(r.getExchangeSdaOffers(n.SdaExchangeOfferType.GIVE,new n.MosaicId(a)));for(let e=0;e<t.length;e++){const l=await s.chainAPI.assetAPI.getMosaicsNames([t[e].mosaicIdGet,t[e].mosaicIdGive]),I=await s.chainAPI.assetAPI.getMosaics([t[e].mosaicIdGet,t[e].mosaicIdGive]);t[e].mosaicGetName=l[0].names.length?l[0].names[0].name:t[e].mosaicIdGet.toHex(),t[e].mosaicGiveName=l[1].names.length?l[1].names[0].name:t[e].mosaicIdGive.toHex(),t[e].mosaicGetDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGet.toHex()).divisibility,t[e].mosaicGiveDivisibility=I.find(v=>v.mosaicId.toHex()==t[e].mosaicIdGive.toHex()).divisibility}const w=await s.chainAPI.chainAPI.getBlockchainHeight();H.value=t.map(e=>({owner:e.owner.address.pretty(),idPair:`${e.mosaicIdGet.toHex()}/${e.mosaicIdGive.toHex()}`,deadline:new Date(Date.now()+(e.deadline.compact()-w)*15e3).toLocaleString(),pair:`${A(e.mosaicGetName)}/${A(e.mosaicGiveName)} `,giveAmount:e.currentMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility),getAmount:e.currentMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility),rate:e.initialMosaicGetAmount.compact()/Math.pow(10,e.mosaicGetDivisibility)/(e.initialMosaicGiveAmount.compact()/Math.pow(10,e.mosaicGiveDivisibility))}))},V=B(()=>[...M.value.map(t=>({type:"Sell",owner:t.owner,idPair:t.idPair,deadline:t.deadline,pair:t.pair,giveAmount:t.giveAmount,getAmount:t.getAmount,rate:t.rate})),...H.value.map(t=>({type:"Buy",owner:t.owner,idPair:t.idPair,deadline:t.deadline,pair:t.pair,giveAmount:t.giveAmount,getAmount:t.getAmount,rate:t.rate}))].sort((t,a)=>new Date(a.deadline).getTime()-new Date(t.deadline).getTime()));N(i,async t=>{t=="others"&&!c.value?P.value=!1:(await _(),await f())});const C=N(s,async t=>{t.isReady&&(await _(),await f(),C())},{immediate:!0});return(t,a)=>{const r=X("router-link"),w=O("debounce");return y(),k("div",null,[o("div",K,[o("div",Q,[o("button",{onClick:a[0]||(a[0]=e=>i.value="xpx"),class:G([`${i.value=="xpx"?"border-b-2  text-blue-primary border-blue-primary":""}`,"w-12 text-center py-3 word-break"])},"XPX",2),o("button",{onClick:a[1]||(a[1]=e=>i.value="metx"),class:G([`${i.value=="metx"?"border-b-2  text-blue-primary border-blue-primary":""}`,"w-12 text-center py-3 word-break"])},"METX",2),o("button",{onClick:a[2]||(a[2]=e=>i.value="others"),class:G([`${i.value=="others"?"border-b-2  text-blue-primary border-blue-primary":""}`,"w-12 text-center py-3 word-break"])},"OTHERS",2)]),i.value=="others"?(y(),k("div",W,"Input Asset ID/ Namespace")):b("v-if",!0),i.value=="others"?U((y(),D(q,{key:1,class:"mt-3",modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value=e),"show-error":!c.value},null,8,["modelValue","show-error"])),[[w,$,"1000"]]):b("v-if",!0),i.value=="others"?(y(),k("div",J,[o("button",{disabled:!c.value,onClick:a[4]||(a[4]=e=>T()),class:"disabled:opacity-50 bg-blue-primary my-3 px-6 py-1.5 rounded-lg text-white font-semibold"},"Search listing",8,Y)])):b("v-if",!0),P.value||i.value!="others"?(y(),D(p(z),{key:3,value:V.value,paginator:!0,rows:10,responsiveLayout:"scroll",scrollDirection:"horizontal",alwaysShowPaginator:!1,paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries",class:"w-full"},{empty:d(()=>[F(" No exchanges found. ")]),default:d(()=>[u(p(h),{field:"deadline",header:"Deadline"}),u(p(h),{field:"type",header:"Type"},{body:d(({data:e})=>[o("div",{class:G(e.type=="Sell"?"text-red-500":"text-green-500")},g(e.type),3)]),_:1}),u(p(h),{field:"rate",header:"Price"},{body:d(({data:e})=>[o("div",Z,[o("div",ee,g(e.rate),1),o("div",te,g(e.pair),1)])]),_:1}),u(p(h),{field:"giveAmount",header:"SDA Amount"},{body:d(({data:e})=>[o("div",ae,[o("div",ie,g(e.giveAmount),1),o("div",se,g(e.pair.split("/")[0]),1)])]),_:1}),u(p(h),{field:"getAmount",header:`${i.value.toUpperCase()} Amount`},{body:d(({data:e})=>[o("div",oe,[o("div",ne,g(e.getAmount),1),b(` <div class="text-blue-primary">{{  data.pair.split('/')[1]  }}</div> `)])]),_:1},8,["header"]),u(p(h),{field:"owner",header:"Maker"},{body:d(({data:e})=>[o("div",null,g(S(e.owner)),1)]),_:1}),u(p(h),{header:"Action"},{body:d(({data:e})=>[u(r,{to:{name:"ViewExchange",query:{p:e.idPair,o:e.owner,t:e.type}}},{default:d(()=>[ce]),_:2},1032,["to"])]),_:1})]),_:1},8,["value"])):b("v-if",!0)])])}}}),ge=j(re,[["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/services/submodule/exchange/ViewExchangeListing.vue"]]);export{ge as default};
