import{d as le,O as ve,g as k,D as Y,r as oe,o as g,f,l as E,b as W,e,t as i,i as I,x as o,A as n,E as ie,k as ge,y as fe,c as R,H as ae,n as q,B as X,w as L,S as xe,a as _e,Q as he,v as B,s as ye,W as ne,bk as be}from"./index-ac085045.js";import{_ as re}from"./proximax-logo-ecfc3767.js";import{_ as we,a as Ie,I as Q}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-83da228e.js";import{_ as Te}from"./InputId.vue_vue_type_style_index_0_lang-4e1d8c5f.js";import{_ as Ae}from"./PasswordInput.vue_vue_type_script_setup_true_lang-354fad8f.js";import{T as ke}from"./TransactionLayout-5136d917.js";import"./jdenticon-module-2a95d186.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";const Me={key:0},Fe={class:"flex justify-between"},Le={class:"flex flex-col ml-2 text-left"},Ee=e("div",{class:"text-blue-primary font-semibold text-xxs uppercase",style:{"line-height":"9px"}}," Selected Asset",-1),Pe={class:"mt-1 text-tsm font-bold"},Ve={class:"mt-1 text-tsm font-bold"},$e={class:"account-item"},Se={class:"flex justify-between"},He={class:"mt-1 text-tsm font-bold"},Ne={class:"mt-1 text-tsm font-bold"},Ue=le({__name:"SelectInputAsset",props:{selectedAddress:{type:String,required:!1},selectedMultisigAddress:{type:String,required:!1}},emits:["select-asset","update:modelValue"],setup(J){const G=J,j=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],H=d=>{const r=j.find(u=>u.namespace==d);return r?r.name:d},{selectedAddress:z,selectedMultisigAddress:x}=ve(G),N=k([]),P=k(!1),M=async d=>{if(!n.chainAPI||!d)return;y(null),N.value=[];const r=await n.chainAPI.accountAPI.getAccountInfo(o.Address.createFromRawAddress(d));for(let u=0;u<r.mosaics.length;u++){const s=r.mosaics[u];N.value.push({id:s.id.toHex(),amount:s.amount.compact(),divisibility:0,namespace:"",isTransferable:!1,hasUpdated:!1})}},_=k(null);Y([z,x],([d,r])=>{_.value=null,d!=null&&r==null?M(d):d!=null&&r!=null&&M(r)});const c=async d=>{if(P.value)return;P.value=!0;const{first:r,last:u}=d,s=[];for(let w=r;w<u;w++)N.value[w].hasUpdated||s.push(new o.MosaicId(N.value[w].id));if(!s.length){P.value=!1;return}const b=await n.chainAPI.assetAPI.getMosaicsNames(s),F=await n.chainAPI.assetAPI.getMosaics(s);let $=0,U=0;const S=new Map;b.forEach((w,T)=>{S.set(w.mosaicId.toHex(),T)}),F.sort((w,T)=>{const D=S.get(w.mosaicId.toHex()),O=S.get(T.mosaicId.toHex());return D-O});for(let w=r;w<u;w++){if(!b[$])continue;const T=N.value.find(D=>D.id==b[$].mosaicId.toHex());T&&(T.namespace=b[$].names.length?b[$].names[0].name:"",T.amount=T.amount/Math.pow(10,F[U].divisibility),T.divisibility=F[U].divisibility,T.isTransferable=F[U].isTransferable(),T.hasUpdated=!0,$++,U++)}P.value=!1},h=ie().appContext.config.globalProperties.emitter,y=d=>{h.emit("select-asset",d),_.value=d};return(d,r)=>{const u=oe("Dropdown");return g(),f("div",null,[E(u,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=s=>_.value=s),style:{width:"100%"},options:N.value,filter:!0,filterFields:["id","namespace"],emptyFilterMessage:" ",virtualScrollerOptions:{lazy:!0,onLazyLoad:c,showLoader:!0,loading:P.value,delay:0,itemSize:38},onChange:r[1]||(r[1]=s=>{y(s.value),d.$emit("update:modelValue",s.value.value),d.$emit("select-asset",s.value.value)})},{value:W(s=>[s.value?(g(),f("div",Me,[e("div",Fe,[e("div",Le,[Ee,e("div",Pe,i(H(s.value.namespace==""?s.value.id:s.value.namespace)),1)]),e("div",Ve,"Balance: "+i(s.value.amount),1)])])):I("",!0)]),option:W(s=>[e("div",$e,[e("div",Se,[e("div",He,i(H(s.option.namespace==""?s.option.id:s.option.namespace)),1),e("div",Ne,"Balance: "+i(s.option.amount),1)])])]),_:1},8,["modelValue","options","virtualScrollerOptions"])])}}}),Ce=e("div",null,"Create SDA-SDA Exchange",-1),Be={key:0,class:"text-xs mt-3 text-blue-primary"},De=e("div",{class:"text-blue-primary text-xs mt-3"},"Asset to Give",-1),Oe={key:1,class:"text-red-500 text-xs"},Re=e("div",{class:"text-blue-primary text-xs mt-3"},"Asset to Receive",-1),We={key:2,class:"text-red-500 text-xs"},Ke={key:3,class:"text-xs"},Xe={key:4,class:"text-red-500 text-xs"},Ge={key:0},je={class:"font-bold text-xs text-blue-primary uppercase"},ze={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},qe={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Qe=["innerHTML"],Ye={class:"flex"},Je={class:"ml-1 text-blue-400 font-bold"},Ze=e("img",{src:re,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),et={key:0,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},tt=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give ",-1),st={class:"ml-auto lg:col-span-2 col-span-3"},at={class:"ml-1 text-blue-400 text-xs"},nt={key:1,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},lt=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Receive ",-1),ot={class:"ml-auto lg:col-span-2 col-span-3"},it={class:"ml-1 text-blue-400 text-xs"},rt=e("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),ct={class:"font-bold text-xs text-blue-primary uppercase"},dt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},ut={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},mt=["innerHTML"],pt={class:"flex"},vt={class:"ml-1 text-blue-400 font-bold"},gt=e("img",{src:re,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),ft=e("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),xt={key:1},_t={key:0,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},ht=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give ",-1),yt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},bt={class:"ml-1 text-blue-400 text-xs"},wt={key:1,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},It=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Receive ",-1),Tt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},At={class:"ml-1 text-blue-400 text-xs"},kt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Mt={class:"font-semibold lg:col-span-2 col-span-3"},Ft=["innerHTML"],Lt={class:"ml-1 text-blue-400"},Et={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Pt={class:"font-semibold lg:col-span-2 col-span-3"},Vt=["innerHTML"],$t={class:"ml-1 text-blue-400"},St={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Ht={class:"font-semibold lg:col-span-2 col-span-3"},Nt=["innerHTML"],Ut={class:"ml-1 text-blue-400"},Ct=e("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Bt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Dt=e("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"}," Total ",-1),Ot=["innerHTML"],Rt={class:"ml-1 text-blue-400"},Wt={class:"font-semibold text-xs text-white mb-1.5"},Kt={class:"text-center"},es=le({__name:"ViewExchangeCreate",setup(J){const G=t=>{const a=Math.floor(t/86400),l=Math.floor(t%(24*3600)/3600),p=Math.floor(t%3600/60),m=t%60;let v="";return a>0&&(v+=`${a} day${a>1?"s":""} `),l>0&&(v+=`${l} hour${l>1?"s":""} `),p>0&&(v+=`${p} min${p>1?"s":""} `),m>0&&(v+=`${m} second${m>1?"s":""}`),v.trim()},j=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],H=t=>{const a=j.find(l=>l.namespace==t);return a?a.name:t.length==16?t.substring(0,4)+"..."+t.substring(t.length-4,t.length+1):t},z=ge(),x=fe(),P=ie().appContext.config.globalProperties.emitter,M=k(null),_=k(null),c=k(null),V=k(!1),h=k("0"),y=k("0"),d=k(""),r=k(""),u=k("57600"),s=k(null),b=R(()=>_.value!=null),F=t=>{let a=t.toString().split(".");return a[1]!=null?'<span class="font-semibold text-sm">'+a[0]+'</span>.<span class="font-semibold text-xs">'+a[1]+"</span>":'<span class="font-semibold text-sm">'+a[0]+"</span>"},$=R(()=>ae.convertToExact(q.currentNetworkProfileConfig.lockedFundsPerAggregate,n.nativeToken.divisibility)),U=R(()=>ae.convertToExact(X.getLockFundFee(),n.nativeToken.divisibility)),S=R(()=>{var p,m,v;if(!n.isReady)return 0;const t=o.PlaceSdaExchangeOfferTransaction.create(o.Deadline.create(),[new o.SdaExchangeOffer(new o.MosaicId(n.nativeToken.assetId),o.UInt64.fromUint(parseFloat(h.value)*Math.pow(10,((p=c.value)==null?void 0:p.divisibility)??0)),new o.MosaicId(n.nativeToken.assetId),o.UInt64.fromUint(parseFloat(y.value)*Math.pow(10,((m=s.value)==null?void 0:m.divisibility)??0)),o.UInt64.fromUint(parseInt(u.value)))],n.networkType);if(!b.value)return((v=t.maxFee)==null?void 0:v.compact())/Math.pow(10,n.nativeToken.divisibility);const a=[...L.currentLoggedInWallet.accounts,...L.currentLoggedInWallet.others].find(A=>A.address==_.value),l=[t.toAggregateV1(o.PublicAccount.createFromPublicKey(a.publicKey,n.networkType))];return n.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,n.nativeToken.divisibility)}),w=t=>{const a=L.currentLoggedInWallet.accounts.find(l=>l.address==t)||L.currentLoggedInWallet.others.find(l=>l.address==t);return a?F(a.balance):0},T=t=>{const a=L.currentLoggedInWallet.accounts.find(l=>l.address==t)||L.currentLoggedInWallet.others.find(l=>l.address==t);return a?a.balance:0};P.on("select-account",t=>{M.value=t}),P.on("select-multisig-account",t=>{_.value=t}),P.on("select-asset",t=>{c.value=t});const D=async()=>{var t,a;try{new o.NamespaceId(r.value).fullName;const l=await n.chainAPI.namespaceAPI.getLinkedMosaicId(new o.NamespaceId(r.value));r.value=l.toHex();const p=await n.chainAPI.assetAPI.getMosaic(l),m=await n.chainAPI.assetAPI.getMosaicsNames([l]);s.value={supply:p.supply.compact(),divisibility:p.divisibility,namespace:m.length?m[0].names[0].name:l.toHex()},V.value=!0;return}catch{V.value=!1,s.value=null}try{const l=new o.MosaicId(r.value.toUpperCase()),p=await n.chainAPI.assetAPI.getMosaic(l),m=await n.chainAPI.assetAPI.getMosaicsNames([l]);s.value={supply:p.supply.compact(),divisibility:p.divisibility,namespace:((a=(t=m[0])==null?void 0:t.names[0])==null?void 0:a.name)??l.toHex()},V.value=!0}catch{V.value=!1,s.value=null}};Y(h,t=>{isNaN(parseFloat(t))&&(h.value="0")}),Y(y,t=>{isNaN(parseFloat(t))&&(y.value="0")});const O=R(()=>b.value?Math.round(($.value+U.value+S.value)*Math.pow(10,n.nativeToken.divisibility))/Math.pow(10,n.nativeToken.divisibility):c.value&&c.value.id.toLowerCase()==n.nativeToken.assetId.toLowerCase()?parseFloat(h.value)+S.value:S.value),ce=async()=>{var Z,ee;if(M.value==null){x.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(!c.value||!V.value){x.add({severity:"error",summary:"Error",detail:"Asset is not selected",group:"br-custom",life:1e3});return}if(!c.value.isTransferable){x.add({severity:"error",summary:"Error",detail:"Asset to give is not transferable",group:"br-custom",life:1e3});return}if(parseFloat(y.value)<=0||parseFloat(h.value)<=0){x.add({severity:"error",summary:"Error",detail:"Asset amount cannot be 0",group:"br-custom",life:1e3});return}if(parseFloat(h.value)>((Z=c.value)==null?void 0:Z.amount)){x.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(parseFloat(y.value)>((ee=s.value)==null?void 0:ee.supply)){x.add({severity:"error",summary:"Error",detail:"Exceeded maximum supply",group:"br-custom",life:1e3});return}if(parseInt(u.value)>57600||parseInt(u.value)<=0){x.add({severity:"error",summary:"Error",detail:"Invalid duration",group:"br-custom",life:1e3});return}const t=T(M.value);if(b.value&&t<O.value){x.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(c.value.id.toLowerCase()==n.nativeToken.assetId.toLowerCase()&&!b.value&&t<O.value){x.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(d.value.length<8){x.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!ne.verifyWalletPassword(L.currentLoggedInWallet.name,q.chainNetworkName,d.value)){x.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const a=new o.ExchangeSdaHttp(n.nodeFullURL);try{if((await be(a.getAccountSdaExchangeOffers(o.Address.createFromRawAddress(_.value??M.value)))).sdaOfferBalances.find(K=>K.mosaicIdGive.toHex().toLowerCase()==c.value.id.toLowerCase()&&K.mosaicIdGet.toHex().toLowerCase()==r.value.toLowerCase())){x.add({severity:"error",summary:"Error",detail:"You cannot create an existing pair from this account",group:"br-custom",life:1e3});return}}catch{}const l=L.currentLoggedInWallet.accounts.find(C=>C.address==M.value),p=o.PlaceSdaExchangeOfferTransaction.create(o.Deadline.create(),[new o.SdaExchangeOffer(new o.MosaicId(c.value.id),o.UInt64.fromUint(parseFloat(h.value)*Math.pow(10,c.value.divisibility)),new o.MosaicId(r.value),o.UInt64.fromUint(parseFloat(y.value)*Math.pow(10,s.value.divisibility)),o.UInt64.fromUint(parseInt(u.value)))],n.networkType),m=ne.decryptPrivateKey(new o.Password(d.value),l.encrypted,l.iv);d.value="";const v=o.Account.createFromPrivateKeyV1(m,n.networkType),A=q.currentNetworkProfile.generationHash;if(b.value){const C=[...L.currentLoggedInWallet.accounts,...L.currentLoggedInWallet.others].find(pe=>pe.address==_.value),te=[p.toAggregateV1(o.PublicAccount.createFromPublicKey(C.publicKey,n.networkType))],K=await n.chainAPI.nodeAPI.getNodeTime(),de=n.buildTxn.aggregateBonded(te,new o.UInt64(K.sendTimeStamp)),se=v.preV2Sign(de,A),ue=X.lockFundTx(se),me=v.preV2Sign(ue,A);X.announceLF_AND_addAutoAnnounceABT(me,se)}else{const C=v.preV2Sign(p,A);await X.announceTransaction(C)}z.push({name:"ViewAccountPendingTransactions",params:{address:v.address.plain()}})};return(t,a)=>{const l=oe("router-link"),p=xe("debounce");return g(),_e(ke,{class:"mt-8"},{white:W(()=>{var m,v;return[Ce,M.value?I("",!0):(g(),f("div",Be," Select Account to Create / Initiate Transaction ")),E(we),E(Ie,{class:"md:mt-3","selected-address":M.value},null,8,["selected-address"]),De,E(Ue,{"selected-address":M.value,"selected-multisig-address":_.value},null,8,["selected-address","selected-multisig-address"]),E(Q,{class:"mt-3",placeholder:"Asset Amount",modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=A=>h.value=A),decimal:c.value?c.value.divisibility:0},null,8,["modelValue","decimal"]),parseFloat(h.value)>((m=c.value)==null?void 0:m.amount)?(g(),f("div",Oe," Insufficient Balance ")):I("",!0),Re,he(E(Te,{class:"mt-3",modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=A=>r.value=A),"show-error":!V.value},null,8,["modelValue","show-error"]),[[p,D,"1000"]]),E(Q,{class:"mt-3",placeholder:"Asset Amount",modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=A=>y.value=A),decimal:s.value?s.value.divisibility:0},null,8,["modelValue","decimal"]),parseFloat(y.value)>((v=s.value)==null?void 0:v.supply)?(g(),f("div",We," Exceeded Maximum Supply ")):I("",!0),E(Q,{class:"mt-3",placeholder:"Duration (Block)",modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=A=>u.value=A),decimal:0},null,8,["modelValue"]),parseInt(u.value)<=57600?(g(),f("div",Ke," Approximately "+i(G(parseInt(u.value)*15)),1)):I("",!0),parseInt(u.value)>57600?(g(),f("div",Xe," Exceeded maximum duration ")):I("",!0)]}),navy:W(()=>[_.value?(g(),f("div",Ge,[e("div",je,i(t.$t("general.multisigAcc")),1),e("div",ze,[e("div",qe,i(t.$t("general.currentBalance")),1),e("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:w(_.value)},null,8,Qe),e("div",Ye,[e("div",Je,i(B(n).nativeToken.label),1),Ze])]),c.value?(g(),f("div",et,[tt,e("span",st,i(h.value),1),e("span",at,i(H(c.value.namespace.length?c.value.namespace:c.value.id)),1)])):I("",!0),V.value?(g(),f("div",nt,[lt,e("span",ot,i(y.value),1),e("span",it,i(H(s.value.namespace)),1)])):I("",!0),rt])):I("",!0),e("div",ct,i(t.$t("general.signerAcc")),1),e("div",dt,[e("div",ut,i(t.$t("general.currentBalance")),1),e("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:w(M.value)},null,8,mt),e("div",pt,[e("div",vt,i(B(n).nativeToken.label),1),gt])]),ft,_.value?I("",!0):(g(),f("div",xt,[c.value?(g(),f("div",_t,[ht,e("span",yt,i(h.value),1),e("span",bt,i(H(c.value.namespace.length?c.value.namespace:c.value.id)),1)])):I("",!0),V.value?(g(),f("div",wt,[It,e("span",Tt,i(y.value),1),e("span",At,i(H(s.value.namespace)),1)])):I("",!0)])),e("div",kt,[e("div",Mt,i(b.value?t.$t("general.aggregateFee"):t.$t("general.transactionFee")),1),e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:F(S.value)},null,8,Ft),e("div",Lt,i(B(n).nativeToken.label),1)]),b.value?(g(),f("div",Et,[e("div",Pt,i(t.$t("general.lockFund")),1),e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:F($.value??0)},null,8,Vt),e("div",$t,i(B(n).nativeToken.label),1)])):I("",!0),b.value?(g(),f("div",St,[e("div",Ht,i(t.$t("general.lockFundTxFee")),1),e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:F(U.value??0)},null,8,Nt),e("div",Ut,i(B(n).nativeToken.label),1)])):I("",!0),Ct,e("div",Bt,[Dt,e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:F(O.value)},null,8,Ot),e("div",Rt,i(B(n).nativeToken.label),1)]),e("div",Wt,i(t.$t("general.enterPasswordContinue")),1),E(Ae,{placeholder:t.$t("general.enterPassword"),modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=m=>d.value=m),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),e("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:a[5]||(a[5]=m=>ce())}," Sell "),e("div",Kt,[E(l,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white underline"},{default:W(()=>[ye(i(t.$t("general.cancel")),1)]),_:1})])]),_:1})}}});export{es as default};
