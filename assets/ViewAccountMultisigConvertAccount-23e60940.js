import{_ as Me,u as Ue,l as Ve,r as c,w as I,H as O,B as m,c as y,n as Z,S as Ke,a as K,z as T,i as x,o as F,b as N,e as l,m as k,t as g,f as j,F as Be,g as Le,v as de,ar as We,O as ve,R as me,x as Oe,h as je,W as pe,I as Re,J as qe}from"./index-3c3de18f.js";import{_ as He}from"./PasswordInput.vue_vue_type_script_setup_true_lang-43e7edc2.js";import{T as ze}from"./TextInput-a4175054.js";import{_ as Je,a as Ze}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-6f8f36d5.js";import{T as Ge}from"./TextInputClean-c9691dd5.js";import{M as G}from"./multisigUtils-9c947a89.js";import{_ as Qe}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-1073d805.js";import{A as Xe,_ as Ye}from"./AccountTabs.vue_vue_type_script_setup_true_lang-36c517dd.js";import{T as re}from"./transactionState-dba65b25.js";import{_ as $e}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-05002873.js";import"./functions-500208d9.js";import"./icon-key-5b3f7dda.js";const et={name:"ViewConvertAccountMultisig",components:{PasswordInput:He,TextInput:ze,TextInputClean:Ge,SelectAccountAndContact:Qe,AccountComponent:Xe,AccountTabs:Ye,TransactionFeeDisplay:Je},props:{address:String},setup(i){const{t:o}=Ue(),B=Ve();je().appContext.config.globalProperties.emitter;const _=c(""),M=c(""),L=c(""),U=c(!1),D=c(""),X=c(!1),R="^[^ ]{8,}$",p=c(1),f=c(1),d=c(0),v=c(0),Y="^[0-9A-Fa-f]{64}$",a=c([]),n=c([]),b=c([]),$=c([]),h=c([]),ee=c([]),W=c(!1),fe=c(!1),q=I.currentLoggedInWallet?I.currentLoggedInWallet.selectDefaultAccount():null,ge=c(q?q.address:""),be=c(O.toCurrencyFormat(q?q.balance:0,m.nativeToken.divisibility)),te=y(()=>O.convertToCurrency(Z.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility)),ae=y(()=>Z.currentNetworkProfile?O.convertToExact(Ke.getLockFundFee(),m.nativeToken.divisibility):0),H=c(0),u=y(()=>I.currentLoggedInWallet?I.currentLoggedInWallet.accounts.find(e=>e.address===i.address):null);let le=y(()=>{if(u.value)return G.checkIsMultiSig(u.value.address)}),z=()=>{u.value&&(H.value=G.getAggregateFee(u.value.publicKey,a.value,p.value,f.value))};z();const V=y(()=>{let e=m.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(H.value)+parseFloat(te.value)+ae.value):Math.round((parseFloat(H.value)+parseFloat(te.value)+ae.value)*Math.pow(10,e))/Math.pow(10,e)}),ye=y(()=>m.nativeToken.label),_e=y(()=>m.nativeToken.divisibility);y(()=>I.currentLoggedInWallet?O.toCurrencyFormat(u.value.balance,_e.value):"0");const ie=y(()=>{if(!u.value)return!1;const e=I.currentLoggedInWallet;let s=e.accounts.map(A=>({name:A.name,publicKey:A.publicKey})),r=e.contacts;var w=[],S=0;return w.push({key:"0",label:o("general.ownerAcc"),selectable:!1,children:[]}),s.forEach(A=>{w[0].children.push({key:"0-"+S.toString(),label:A.name,data:A.publicKey}),S++}),S=0,w.push({key:"1",label:o("general.contact"),selectable:!1,children:[]}),r!=null&&r.forEach(A=>{w[1].children.push({key:"1-"+S.toString(),label:A.name,data:A.address}),S++}),w});function he(e,s){ce(s),b.value[s]=e.label,e.key[0]=="1"?we(e.data,s):a.value[s]=e.data,a.value[s]=e.data,ee.value[s]=!1,n.value[s][e.key]=!0,e.selectable=!1}function we(e,s){try{G.verifyContactPublicKey(e).then(r=>{r.status==!0?a.value[s]=r.publicKey:_.value=o("multisig.noPublicKey")})}catch{_.value=o("multisig.noPublicKey")}}const ce=e=>{if(Object.keys(n.value[e]).length!==0){let s=Object.keys(n.value[e])[0].split("-");ie.value[s[0]].children[s[1]].selectable=!0,n.value[e]={}}},Ae=y(()=>le.value||W.value||!D.value.match(R)||a.value.length==0||_.value||h.value.every(e=>e==!1)==!1||f.value==0||p.value==0||u.value.balance<V.value),xe=y(()=>{if(!u.value)return!1;var e=!1;if(u.value.balance>=V.value&&!W.value){for(var s=0;s<a.value.length;s++)if(h.value[s]!=""){e=!0;break}else if(a.value[s].length<40){e=!0;break}}else e=!0;return e}),ue=()=>{a.value=[],$.value=[],h.value=[],D.value="",p.value=1,d.value=0,f.value=1,v.value=0,M.value=""},ke=async()=>{const e=I.currentLoggedInWallet;if(!pe.verifyWalletPassword(e.name,Z.chainNetworkName,D.value))L.value=o("general.walletPasswordInvalid",{name:I.currentLoggedInWallet.name});else{const r=[],w=e.accounts.find(E=>E.name===u.value.name);if(!w)throw new Error("Account not found");const S=pe.decryptPrivateKey(new T.Password(D.value),w.encrypted,w.iv),A=T.Account.createFromPrivateKey(S,m.networkType,1);if(!m.chainAPI)throw new Error("Service unavailable");let J=null;for(const E of a.value){if(E.length==64)J=T.PublicAccount.createFromPublicKey(E,m.networkType);else if(E.length==40||E.length==46){const Ee=T.Address.createFromRawAddress(E);try{const ne=await m.chainAPI.accountAPI.getAccountInfo(Ee);J=T.PublicAccount.createFromPublicKey(ne.publicKey,m.networkType)}catch(ne){console.log(ne)}}J&&r.push(new T.MultisigCosignatoryModification(T.MultisigCosignatoryModificationType.Add,J))}if(!m.buildTxn)throw new Error("Service unavailable");const De=m.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(p.value).minRemovalDelta(f.value).modifications(r).build();L.value="",ue(),re.unsignedTransactionPayload=De.serialize(),re.selectedAddress=u.value.address,re.selectedMultisigAddress=A.address.plain(),B.push({name:"ViewConfirmTransaction"})}};K(()=>[...a.value],async e=>{let s=!1;if(M.value="",a.value.length>0)for(var r=0;r<a.value.length;r++)a.value[r].length==64?a.value[r]==u.value.publicKey&&s==!1?(s=!0,h.value[r]=!0,_.value=o("multisig.selectedAccErr")):!a.value[r].match(Y)&&a.value[r].length==64?h.value[r]=!0:(h.value[r]=!1,Array.from(new Set(e)).length!=e.length?_.value=o("multisig.duplicatedCosigner"):s==!1&&(_.value="",await Ne(a.value[r])?M.value="":M.value="Input public key does not exist")):h.value[r]=!0;else _.value=""},{deep:!0}),K(()=>[...h.value],e=>{e.every(s=>s==!1)&&z()},{deep:!0});const Ce=()=>{a.value.push(""),n.value.push({}),h.value.push(!1),d.value+=1,v.value+=1},Te=e=>{d.value>0&&(d.value-=1),v.value>0&&(v.value-=1),f.value>v.value&&(f.value=v.value),p.value>d.value&&(p.value=d.value),ce(e),a.value.splice(e,1),n.value.splice(e,1),b.value.splice(e,1),ee.value.splice(e,1),$.value.splice(e,1),h.value.splice(e,1)},Pe=e=>{p.value*10*~~(d.value/10)+e.charCode-48>d.value&&e.preventDefault()};let oe=o("multisig.deletionExceedMax"),se=o("multisig.approvalExceedMax"),C="";K(p,e=>{z(),d.value==0&&e>1||e>d.value&&e!=1&&d.value!=0?C=se:d.value>0&&e<=0?C=o("multisig.approvalAtLeastOne"):f.value>v.value&&f.value!=1&&v.value!=0?C=oe:C=""});const Se=e=>{f.value*10*~~(v.value/10)+e.charCode-48>v.value&&e.preventDefault()};let P="";K(f,e=>{z(),v.value==0&&e>1||e>v.value&&e!=1&&v.value!=0?P=oe:v.value>0&&e<=0?P=o("multisig.deletionAtLeastOne"):p.value>d.value&&p.value!=1&&d.value!=0?P=se:P=""}),K([p,f],()=>{C!=""&&P!=""?_.value=C+`
`+P:C!=""?_.value=C:_.value=P});const Ie=y(()=>W.value||le.value);u.value&&G.onPartial(T.PublicAccount.createFromPublicKey(u.value.publicKey,m.networkType)).then(e=>W.value=e),u.value&&u.value.balance<V.value&&(U.value=!0),K(u,e=>{e&&(e.balance<V.value?U.value=!0:U.value=!1)});const Fe=y(()=>O.amountFormatterSimple(V.value,0)),Ne=async e=>{const s=T.PublicAccount.createFromPublicKey(e,m.networkType);try{return!!await m.chainAPI.accountAPI.getAccountInfo(s.address)}catch{return!1}};return{networkState:Z,toggleContact:ee,contact:ie,space:fe,currentNativeTokenName:ye,contactName:b,err:_,disableSend:Ae,numApproveTransaction:p,numDeleteUser:f,maxNumApproveTransaction:d,maxNumDeleteUser:v,fundStatus:U,acc:u,passwd:D,showPasswdError:X,showAddressError:h,addCoSig:Ce,coSign:a,addCoSigButton:xe,selectedNode:n,deleteCoSigAddressInput:Te,onNodeSelect:he,selectedAddresses:$,clear:ue,convertAccount:ke,disabledPassword:Ie,onPartial:W,isMultisig:le,passwdPattern:R,validateApproval:Pe,validateDelete:Se,lockFundCurrency:te,lockFundTxFee:ae,aggregateFee:H,totalFee:V,totalFeeFormatted:Fe,selectedAccAdd:ge,accBalance:be,passwordErr:L,inputPkNotExist:M}}},Q=i=>(Re("data-v-03248533"),i=i(),qe(),i),tt={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},at={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},lt={class:"lg:col-span-2 py-6 pr-6"},ot={class:"text-xs font-semibold pl-6"},st={class:"pl-6"},nt={key:0,class:"error error_box mb-5 whitespace-pre"},rt={key:1,class:"flex gap-2 bg-yellow-50 py-2 rounded-md px-2 my-3 mb-5"},it=Q(()=>l("img",{src:Ze,class:"w-5 h-5"},null,-1)),ct={class:"text-xs font-bold pt-1"},ut={key:2,class:"error error_box mb-5"},dt=Q(()=>l("div",{class:"mt-4"},null,-1)),vt={class:"flex flex-col gap-2"},mt={class:"flex"},pt=["onClick"],ft={key:0,class:"mt-16"},gt=["onClick"],bt={class:"text-xxs text-blue-primary font-semibold uppercase"},yt={key:0},_t=["disabled"],ht=Q(()=>l("div",{class:"ml-6 my-7 gray-line"},null,-1)),wt={class:"pl-6 text-xs font-semibold mb-3"},At={class:"flex gap-2 pl-6"},xt={class:"border w-6/12"},kt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Ct={class:"flex justify-around"},Tt=["disabled"],Pt=["max"],St=["disabled"],It={class:"text-xxs border-t-2 text-center py-1 uppercase"},Ft={class:"border w-6/12"},Nt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Dt={class:"flex justify-around"},Et=["disabled"],Mt=["max"],Ut=["disabled"],Vt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Kt={class:"pl-6"},Bt={class:"text-xs font-semibold my-3"},Lt={class:"bg-navy-primary p-6 lg:col-span-1"},Wt=Q(()=>l("div",{class:"mt-5"},null,-1)),Ot={class:"mt-3"},jt=["disabled"],Rt={class:"text-center"};function qt(i,o,B,t,_,M){const L=x("AccountComponent"),U=x("AccountTabs"),D=x("TextInput"),X=x("TextInputClean"),R=x("font-awesome-icon"),p=x("SelectAccountAndContact"),f=x("Sidebar"),d=x("PasswordInput"),v=x("TransactionFeeDisplay"),Y=x("router-link");return F(),N("div",null,[l("div",tt,[k(L,{address:B.address,class:"mb-6"},null,8,["address"]),k(U,{address:B.address,selected:"multisig"},null,8,["address"]),l("div",at,[l("div",lt,[l("div",ot,g(i.$t("multisig.manageCosignatories")),1),l("div",st,[t.err!=""?(F(),N("div",nt,g(t.err),1)):j("",!0),t.inputPkNotExist!=""?(F(),N("div",rt,[it,l("div",ct,g(t.inputPkNotExist),1)])):j("",!0),t.passwordErr!=""?(F(),N("div",ut,g(t.passwordErr),1)):j("",!0)]),dt,l("div",vt,[(F(!0),N(Be,null,Le(t.coSign,(a,n)=>(F(),N("div",{key:n},[l("div",mt,[l("img",{src:$e,onClick:b=>t.deleteCoSigAddressInput(n),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,pt),k(D,{class:"w-5/12 mr-2",placeholder:i.$t("multisig.cosignatory")+`${n+1}`,modelValue:t.contactName[n],"onUpdate:modelValue":b=>t.contactName[n]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),k(X,{class:"w-7/12 mr-2",placeholder:i.$t("general.publicKey"),errorMessage:i.$t("general.invalidInput"),showError:t.showAddressError[n],modelValue:t.coSign[n],"onUpdate:modelValue":b=>t.coSign[n]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[n]==!0?(F(),N("div",ft)):j("",!0),l("div",{onClick:b=>t.toggleContact[n]=!t.toggleContact[n],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[k(R,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),l("div",bt,g(i.$t("general.select")),1)],8,gt)]),t.toggleContact[n]?(F(),N("div",yt,[k(f,{visible:t.toggleContact[n],"onUpdate:visible":b=>t.toggleContact[n]=b,baseZIndex:1e4,position:"full"},{default:de(()=>[k(p,We(n,{contacts:t.contact,index:n,selectedNode:t.selectedNode[n],onNodeSelect:b=>t.onNodeSelect(b,n)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):j("",!0)]))),128))]),l("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:o[0]||(o[0]=(...a)=>t.addCoSig&&t.addCoSig(...a)),disabled:t.addCoSigButton},"+"+g(i.$t("multisig.addNewCosignatory")),9,_t),ht,l("div",wt,g(i.$t("general.scheme")),1),l("div",At,[l("div",xt,[l("div",kt,g(i.$t("multisig.transactionsApproval")),1),l("div",Ct,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[1]||(o[1]=a=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,Tt),ve(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[2]||(o[2]=(...a)=>t.validateApproval&&t.validateApproval(...a)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":o[3]||(o[3]=a=>t.numApproveTransaction=a)},null,40,Pt),[[me,t.numApproveTransaction]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:o[4]||(o[4]=a=>t.numApproveTransaction++)},"+",8,St)]),l("div",It,g(i.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),l("div",Ft,[l("div",Nt,g(i.$t("multisig.accountDeletionApproval")),1),l("div",Dt,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[5]||(o[5]=a=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,Et),ve(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[6]||(o[6]=(...a)=>t.validateDelete&&t.validateDelete(...a)),max:t.maxNumDeleteUser,"onUpdate:modelValue":o[7]||(o[7]=a=>t.numDeleteUser=a)},null,40,Mt),[[me,t.numDeleteUser]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:o[8]||(o[8]=a=>t.numDeleteUser++)},"+",8,Ut)]),l("div",Vt,g(i.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])]),l("div",Kt,[l("div",Bt,g(i.$t("general.enterPasswordContinue")),1),k(d,{placeholder:i.$t("general.enterPassword"),errorMessage:i.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":o[9]||(o[9]=a=>t.passwd=a),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"])])]),l("div",Lt,[k(v,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),Wt,l("div",Ot,[l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:o[10]||(o[10]=a=>t.convertAccount()),disabled:t.disableSend},g(i.$t("multisig.updateCosignatories")),9,jt)]),l("div",Rt,[k(Y,{to:{name:"ViewMultisigHome",params:{address:B.address}},class:"content-center text-xs text-white underline"},{default:de(()=>[Oe(g(i.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const na=Me(et,[["render",qt],["__scopeId","data-v-03248533"]]);export{na as default};
