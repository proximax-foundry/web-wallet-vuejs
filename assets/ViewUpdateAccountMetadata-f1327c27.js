import{g as y,K as Ue,c as g,w as i,H as L,A as m,D as C,j as We,n as F,B as De,x as r,aw as P,k as Ne,_ as Be,f as d,e as n,l as w,b as E,F as ee,r as W,S as Ee,o as u,s as te,t as p,i as M,Q as R,am as Re,M as de,ax as ue}from"./index-ac085045.js";import{_ as Qe}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-e6575e15.js";import{T as Oe}from"./TransactionLayout-5136d917.js";import{M as ae}from"./multisigUtils-b7840722.js";import{M as je}from"./MetadataInput-f3cd1a18.js";import{_ as Ze}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-975bab2a.js";import{t as ze}from"./jdenticon-module-2a95d186.js";import{U as Xe}from"./UTF8-62cc6a5f.js";import{T as Q}from"./transactionState-90b266b3.js";import{_ as Ge}from"./chevron_left-0423cb29.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-d29b9a74.js";import"./functions-c0137ee2.js";import"./TextInput-f71c8b4b.js";import"./TextInputClean-6fd2d429.js";import"./icon-key-5b3f7dda.js";import"./icon-info-8b4f1351.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-4c592bc8.js";import"./proximax-logo-ecfc3767.js";const qe={name:"ViewUpdateAccountMetadata",props:{targetPublicKey:String,scopedMetadataKey:String},components:{MetadataInput:je,TransactionFeeDisplay:Ze,AccTabLayout:Qe,TransactionLayout:Oe},setup(s){const v=Ne();let O=y(!1),t=y(!0),k=y(1),b=y(null),T=y(!1),K=y(""),c=y(""),f=y(null),h,D,o,x;const _=y(""),I=y(""),le=new Ue("ThemeStyleConfig");le.init();const ge=g(()=>ze(f.value?f.value.address:"",40,le.jdenticonConfig)),ve=g(()=>f.value?i.currentLoggedInWallet.convertAddressToName(f.value.address,!0):""),ne=y([]),N=i.currentLoggedInWallet?i.currentLoggedInWallet.selectDefaultAccount():null,j=y(N?N.address:""),ye=y(L.toCurrencyFormat(N?N.balance:0,m.nativeToken.divisibility)),oe=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=oe(e)),e),Z=e=>{e=oe(e);let l=r.Convert.hexToUint8(e);return Xe.isNotUTF8(l)||(e=r.Convert.decodeHexToUtf8(e)),e},me=()=>{let e=new r.MetadataQueryParams;e.metadataType=r.MetadataType.ACCOUNT,e.targetKey=b.value,m.chainAPI.metadataAPI.searchMetadatas(e).then(l=>{l.metadataEntries.forEach(a=>{ne.value.push({value:a.scopedMetadataKey.toHex()==Z(a.scopedMetadataKey.toHex())?a.scopedMetadataKey.toHex():Z(a.scopedMetadataKey.toHex()),type:a.scopedMetadataKey.toHex()==Z(a.scopedMetadataKey.toHex())?2:1})})})},fe=g(()=>f.value?f.value.address:"0".repeat(40)),pe=()=>{s.targetPublicKey.length===64&&r.Convert.isHexString(s.targetPublicKey)&&(b.value=r.PublicAccount.createFromPublicKey(s.targetPublicKey,m.networkType),h.targetPublicKey(b.value)),i.currentLoggedInWallet&&(f.value=i.currentLoggedInWallet.accounts.find(e=>e.publicKey===s.targetPublicKey)||i.currentLoggedInWallet.others.find(e=>e.publicKey===s.targetPublicKey),f.value&&(T.value=!!f.value.getDirectParentMultisig().length))},be=g(()=>i.currentLoggedInWallet&&b.value?i.currentLoggedInWallet.others.find(e=>e.publicKey===s.targetPublicKey):null);C(be,async e=>{if(e){if(!i.currentLoggedInWallet)return;f.value=i.currentLoggedInWallet.accounts.find(l=>l.publicKey===s.targetPublicKey)||i.currentLoggedInWallet.others.find(l=>l.publicKey===s.targetPublicKey),f.value&&(T.value=!!f.value.getDirectParentMultisig().length)}},{deep:!0});const he=()=>{if(s.scopedMetadataKey)if(t.value=!1,c.value=s.scopedMetadataKey,s.scopedMetadataKey.length===16&&r.Convert.isHexString(s.scopedMetadataKey))k.value=2,K.value=s.scopedMetadataKey,h.scopedMetadataKey(r.UInt64.fromHex(K.value));else{let e=r.Convert.utf8ToHex(s.scopedMetadataKey);const l=e.length/2;e.length&&l<=8&&(k.value=1,e.length/2<8&&(e=e+"00".repeat(8-l)),K.value=e,h.scopedMetadataKey(r.UInt64.fromHex(K.value)))}},xe=async()=>{h=m.buildTxn.accountMetadataBuilder();const e=await m.chainAPI.nodeAPI.getNodeTime();D=m.buildTxn.aggregateBondedBuilder(new r.UInt64(e.sendTimeStamp))},_e=async()=>{if(b.value&&K.value){let e=new r.MetadataQueryParams;e.metadataType=r.MetadataType.ACCOUNT,e.targetKey=b.value,e.scopedMetadataKey=r.UInt64.fromHex(K.value);let l=await m.chainAPI.metadataAPI.searchMetadatas(e);l.metadataEntries.length&&(_.value=l.metadataEntries[0].value)}h.oldValue(_.value)},Me=()=>{h.value(I.value)},z=()=>{o=h.calculateDifferences().build()},X=()=>{o&&(x=D.innerTransactions([o.toAggregateV1(b.value)]).build())},G=()=>{x&&(S.value=x.maxFee.compact()/Math.pow(10,m.nativeToken.divisibility))},Te=g(()=>m.nativeToken.label);We();const Ke=y(""),ke=i.currentLoggedInWallet?i.currentLoggedInWallet.name:"",q=g(()=>F.currentNetworkProfileConfig?L.convertToExact(F.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility):0),Ae=g(()=>F.currentNetworkProfileConfig?L.convertToCurrency(F.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility):0),J=g(()=>F.currentNetworkProfile?L.convertToExact(De.getLockFundFee(),m.nativeToken.divisibility):0),we=y(!1),Y=g(()=>k.value==1?r.Convert.utf8ToHex(c.value).length/2>8:c.value.length>16?!0:c.value.length%2===1),se=g(()=>Ie.value<$.value),Ce=g(()=>Y.value==!0||c.value==""||I.value==""||se.value==!0),H=g(()=>{if(!i.currentLoggedInWallet)return[];let e=i.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),l=i.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return e.concat(l)});C(k,e=>{re(),e==2&&(r.Convert.isHexString(c.value)||(c.value=""))});const re=async()=>{if(Y.value||c.value.length==0)return;let e="";if(k.value==1){let B=r.Convert.utf8ToHex(c.value);e=B+"00".repeat((16-B.length)/2)}else e="00".repeat((16-c.value.length)/2)+c.value;let l=new r.MetadataQueryParams;l.targetKey=b.value,l.metadataType=r.MetadataType.ACCOUNT,l.scopedMetadataKey=r.UInt64.fromHex(e);let a=await m.chainAPI.metadataAPI.searchMetadatas(l);a.metadataEntries.length?_.value=a.metadataEntries[0].value:_.value=""},Pe=async()=>{if(!i.currentLoggedInWallet)return;let e="",l;if(k.value==1){let V=r.Convert.utf8ToHex(c.value);e=V+"00".repeat((16-V.length)/2)}else e="00".repeat((16-c.value.length)/2)+c.value;let a=h.targetPublicKey(b.value).scopedMetadataKey(r.UInt64.fromHex(e)).value(I.value).oldValue(_.value).calculateDifferences().build(),B=m.buildTxn.aggregateCompleteBuilder().innerTransactions([a.toAggregateV1(b.value)]).build().serialize(),ie=i.currentLoggedInWallet.accounts.find(V=>V.publicKey==b.value.publicKey).address;if(T.value){let V=i.currentLoggedInWallet.accounts.find(He=>He.publicKey==A.value).address;l=a.toAggregateV1(b.value).serialize(),Q.selectedAddress=V,Q.selectedMultisigAddress=ie}else l=B,Q.selectedAddress=ie;c.value="",_.value="",I.value="",Q.unsignedTransactionPayload=l,v.push({name:"ViewConfirmTransaction"})},S=y(0),$=g(()=>{let e=m.nativeToken.divisibility;return T.value?e==0?Math.trunc(q.value+J.value+S.value):Math.round((q.value+J.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),U=g(()=>!i.currentLoggedInWallet||!b.value?[]:ae.getCosignerInWallet(s.targetPublicKey).cosignerList.length?H.value?ae.getCosignerInWallet(s.targetPublicKey).cosignerList.map(e=>{let l=H.value.find(a=>a.publicKey==e);return{name:l.name,publicKey:e,balance:l.balance}}):[]:[]),A=y("");U.value.length>0&&(A.value=U.value[0].publicKey),C(()=>U,e=>{e.value.length&&(A.value=U.value[0].publicKey)},{deep:!0});const Ie=g(()=>i.currentLoggedInWallet?T.value?A.value?P(A.value).balance:0:f.value?f.value.balance:0:0),Se=g(()=>S.value.toString()),Ve=g(()=>L.amountFormatterSimple($.value,0)),Le=g(()=>{if(F.currentNetworkProfileConfig){let e=ae.getCosignerInWallet(H.value.find(a=>a.address==j.value)?H.value.find(a=>a.address==j.value).publicKey:""),l=[];return e.cosignerList.forEach(a=>{l.push({publicKey:a,name:P(a).name,balance:P(a).balance,address:P(a).address})}),e.cosignerList=l,e}else return{hasCosigner:!1,cosignerList:[]}}),Fe=g(()=>{let e=P(A.value)?P(A.value).balance:0;return L.toCurrencyFormat(e,3)});C(_,e=>{h.oldValue(e),z(),X(),G()}),C(I,e=>{h.value(e),z(),X(),G()}),C(c,e=>{e==""&&(_.value="")});const ce=async()=>{await xe(),pe(),await he(),await _e(),await Me(),z(),X(),G(),me()};if(m.isReady)ce();else{let e=C(m,l=>{l.isReady&&(ce(),e())})}return{findAcc:P,totalFee:$,err:Ke,showPasswdError:we,accounts:H,updateMetadata:Pe,targetAccIsMultisig:T,lockFundCurrency:Ae,lockFund:q,aggregateFee:S,lockFundTxFee:J,walletName:ke,currentNativeTokenName:Te,oldValue:_,newValue:I,cosigners:U,scopedMetadataKeyType:k,svgString:ge,accountName:ve,accountAddress:fe,disableAddBtn:Ce,showBalanceErr:se,showScopedKeyErr:Y,inputScopedMetadataKey:c,checkOldValue:re,selectedCosigner:A,showKeys:O,existingScopedMetadataKeys:ne,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:K,transactionFee:Se,totalFeeFormatted:Ve,selectedAccAdd:j,accBalance:ye,getMultiSigCosigner:Le,checkCosignBalance:Fe}}},Je={class:"flex cursor-pointer"},Ye=n("img",{src:Ge},null,-1),$e={class:"pl-6"},et={key:0,class:"error error_box mb-5"},tt={key:0,class:"text-left mt-2 mb-5"},at={key:0},lt={class:"text-tsm"},nt={key:0,class:"font-bold"},ot={key:1,class:"font-bold"},st=["value"],rt={key:1,class:"error"},ct=n("div",{class:"font-semibold mb-4"},"Update Account Metadata",-1),it={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},dt={class:"flex items-center gap-2"},ut=["innerHTML"],gt={class:"flex flex-col gap-0.5"},vt=n("div",{class:"uppercase text-xxs text-blue-primary"}," Selected Account ",-1),yt={class:"font-semibold"},mt={key:1,class:"mt-2"},ft=["onClick"],pt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},bt={key:1,class:"text-xs py-2 pl-2 w-full"},ht={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},xt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},_t={key:2},Mt={class:"flex gap-3"},Tt={class:"flex gap-2"},Kt=n("label",{for:"regular"},"UTF-8",-1),kt={class:"flex gap-2"},At=n("label",{for:"hexa"},"Hexadecimal",-1),wt={key:3,class:"my-3"},Ct={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Pt={class:"flex flex-col gap-0.5"},It=n("div",{class:"uppercase text-xxs text-blue-primary"}," Selected Scoped Metadata Key ",-1),St={class:"flex"},Vt={class:"font-semibold"},Lt={class:"ml-3 text-gray-400 font-semibold"},Ft={class:"flex"},Ht={key:0,class:"font-semibold"},Ut={key:1,class:"ml-3 text-gray-400 font-semibold"},Wt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Dt=n("div",{class:"uppercase text-xxs text-blue-primary"},"CURRENT VALUE",-1),Nt={class:"font-semibold"},Bt=["disabled"],Et={class:"text-center"};function Rt(s,v,O,t,k,b){const T=W("router-link"),K=W("AccTabLayout"),c=W("MetadataInput"),f=W("TransactionFeeDisplay"),h=W("TransactionLayout"),D=Ee("debounce");return u(),d(ee,null,[n("div",Je,[Ye,w(T,{to:{name:"ViewDashboard"},class:"text-blue-primary text-xs mt-0.5"},{default:E(()=>[te(p(s.$t("general.back")),1)]),_:1})]),w(K,{address:t.accountAddress,selected:"metadata"},null,8,["address"]),w(h,null,{white:E(()=>[n("div",$e,[t.err!=""?(u(),d("div",et,p(t.err),1)):M("",!0)]),t.targetAccIsMultisig?(u(),d("div",tt,[t.cosigners.length>0?(u(),d("div",at,[n("div",lt,[te(p(s.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(u(),d("span",nt,p(t.cosigners[0].name),1)):(u(),d("span",ot,[R(n("select",{class:"","onUpdate:modelValue":v[0]||(v[0]=o=>t.selectedCosigner=o)},[(u(!0),d(ee,null,de(t.cosigners,(o,x)=>(u(),d("option",{value:t.findAcc(o.publicKey).publicKey,key:x},p(o.name),9,st))),128))],512),[[Re,t.selectedCosigner]])]))])])):(u(),d("div",rt,p(s.$t("general.noCosigner")),1))])):M("",!0),ct,n("div",it,[n("div",dt,[n("div",{innerHTML:t.svgString},null,8,ut),n("div",gt,[vt,n("div",yt,p(t.accountName),1)])])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(u(),d("div",mt,[n("div",{onClick:v[1]||(v[1]=o=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"}," Select Existing Scoped Metadata Key "),(u(!0),d(ee,null,de(t.existingScopedMetadataKeys,(o,x)=>(u(),d("div",{key:x},[t.showKeys?(u(),d("div",{key:0,class:"flex justify-center cursor-pointer",onClick:_=>(t.scopedMetadataKeyType=o.type,t.inputScopedMetadataKey=o.value,t.checkOldValue(),t.showKeys=!1)},[x%2==0?(u(),d("div",pt,p(o.value),1)):M("",!0),x%2==1?(u(),d("div",bt,p(o.value),1)):M("",!0),x%2==0?(u(),d("div",ht,p(s.$t("general.select")),1)):M("",!0),x%2==1?(u(),d("div",xt,p(s.$t("general.select")),1)):M("",!0)],8,ft)):M("",!0)]))),128))])):M("",!0),t.scopedMetadataKeySelectable?(u(),d("div",_t,[R(w(c,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":v[2]||(v[2]=o=>t.inputScopedMetadataKey=o),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[D,t.checkOldValue,"1000"]]),n("div",Mt,[n("div",Tt,[R(n("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":v[3]||(v[3]=o=>t.scopedMetadataKeyType=o)},null,512),[[ue,t.scopedMetadataKeyType]]),Kt]),n("div",kt,[R(n("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":v[4]||(v[4]=o=>t.scopedMetadataKeyType=o)},null,512),[[ue,t.scopedMetadataKeyType]]),At])]),w(c,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":v[5]||(v[5]=o=>t.oldValue=o),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(u(),d("div",wt,[n("div",Ct,[n("div",Pt,[It,n("div",St,[n("div",Vt,p(O.scopedMetadataKey),1),n("div",Lt,p(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),n("div",Ft,[t.scopedMetadataKeyType==1?(u(),d("div",Ht,p(t.scopedMetadataKeyHex),1)):M("",!0),t.scopedMetadataKeyType==1?(u(),d("div",Ut," HEX ")):M("",!0)])])]),n("div",Wt,[Dt,n("div",Nt,p(t.oldValue),1)])])),w(c,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":v[6]||(v[6]=o=>t.newValue=o),placeholder:"New Value"},null,8,["modelValue"])]),navy:E(()=>[w(f,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),n("button",{type:"submit",class:"w-full blue-btn px-3 py-3 mt-3 disabled:opacity-50 disabled:cursor-auto",onClick:v[7]||(v[7]=o=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Account Metadata ",8,Bt),n("div",Et,[w(T,{to:{name:"ViewAccountMetadata",params:{address:t.accountAddress}},class:"content-center text-xs text-white underline"},{default:E(()=>[te(p(s.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}const ra=Be(qe,[["render",Rt]]);export{ra as default};
