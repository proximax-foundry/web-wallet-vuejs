import{l as Ne,r as m,D as Ee,c as y,w as i,H as W,B as p,a as C,u as Re,n as A,S as ee,z as c,am as P,W as Oe,_ as Qe,i as D,M as je,b as o,e as l,m as S,t as v,f as _,x as ge,O as Q,aa as Ze,F as ve,g as me,V as ye,v as Xe,o as r}from"./index-7aba74d6.js";import{_ as qe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-f9fec5ba.js";import{M as te}from"./multisigUtils-6a100cf9.js";import{M as ze}from"./MetadataInput-58002eee.js";import{_ as Ge}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-0307b761.js";import{t as Je}from"./jdenticon-module-b0cf8aa8.js";import{U as Ye}from"./UTF8-b0ca47ce.js";import{T as ae}from"./transactionState-d2724fd2.js";import{_ as $e}from"./icon-asset-2a9ae6ea.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const et={name:"ViewUpdateAssetMetadata",props:{targetId:String,scopedMetadataKey:String},components:{MetadataInput:ze,PasswordInput:qe,TransactionFeeDisplay:Ge},setup(d){const u=Ne();let N=m(!1),t=m(!0),k=m(1),f=m(null),w=null,M=m(!1),T=m(""),g=m(""),h=m(null),b,n,x,E;const K=m(""),V=m(""),le=new Ee("ThemeStyleConfig");le.init();const fe=y(()=>Je(h.value?h.value.address:"",40,le.jdenticonConfig)),pe=y(()=>h.value?i.currentLoggedInWallet.convertAddressToName(h.value.address,!0):""),se=m([]),R=i.currentLoggedInWallet?i.currentLoggedInWallet.selectDefaultAccount():null,j=m(R?R.address:""),he=m(W.toCurrencyFormat(R?R.balance:0,p.nativeToken.divisibility)),ne=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=ne(e)),e),Z=e=>{e=ne(e);let s=c.Convert.hexToUint8(e);return Ye.isNotUTF8(s)||(e=c.Convert.decodeHexToUtf8(e)),e},be=()=>{let e=new c.MetadataQueryParams;e.metadataType=c.MetadataType.MOSAIC,e.targetId=w,p.chainAPI.metadataAPI.searchMetadatas(e).then(s=>{s.metadataEntries.forEach(a=>{se.value.push({value:a.scopedMetadataKey.toHex()==Z(a.scopedMetadataKey.toHex())?a.scopedMetadataKey.toHex():Z(a.scopedMetadataKey.toHex()),type:a.scopedMetadataKey.toHex()==Z(a.scopedMetadataKey.toHex())?2:1})})})},xe=async()=>{if(d.targetId&&d.targetId.length===16&&c.Convert.isHexString(d.targetId)){let e=new c.MosaicId(d.targetId);w=e,b.targetMosaicId(w);let s=await p.chainAPI.assetAPI.getMosaic(e);if(f.value=s.owner,b.targetPublicKey(f.value),!i.currentLoggedInWallet)return;h.value=i.currentLoggedInWallet.accounts.find(a=>a.publicKey===s.owner.publicKey)||i.currentLoggedInWallet.others.find(a=>a.publicKey===s.owner.publicKey),h.value&&(M.value=!!h.value.getDirectParentMultisig().length)}},_e=y(()=>i.currentLoggedInWallet&&f.value?i.currentLoggedInWallet.others.find(e=>e.publicKey===f.value.publicKey):null);C(_e,async e=>{e&&(h.value=i.currentLoggedInWallet.accounts.find(s=>s.publicKey===f.value.publicKey)||i.currentLoggedInWallet.others.find(s=>s.publicKey===f.value.publicKey),h.value&&(M.value=!!h.value.getDirectParentMultisig().length))},{deep:!0});const Me=()=>{if(d.scopedMetadataKey)if(t.value=!1,g.value=d.scopedMetadataKey,d.scopedMetadataKey.length===16&&c.Convert.isHexString(d.scopedMetadataKey))k.value=2,T.value=d.scopedMetadataKey,b.scopedMetadataKey(c.UInt64.fromHex(T.value));else{k.value=1;let e=c.Convert.utf8ToHex(d.scopedMetadataKey);const s=e.length/2;e.length&&s<=8&&(e.length/2<8&&(e=e+"00".repeat(8-s)),T.value=e,b.scopedMetadataKey(c.UInt64.fromHex(T.value)))}},we=()=>{b=p.buildTxn.assetMetadataBuilder(),n=p.buildTxn.aggregateBondedBuilder()},Te=async()=>{if(w&&T.value){let e=new c.MetadataQueryParams;e.targetId=w,e.metadataType=c.MetadataType.MOSAIC,e.scopedMetadataKey=c.UInt64.fromHex(T.value);let s=await p.chainAPI.metadataAPI.searchMetadatas(e);s.metadataEntries.length&&(K.value=s.metadataEntries[0].value)}b.oldValue(K.value)},Ke=()=>{b.value(V.value)},X=()=>{x=b.calculateDifferences().build()},q=()=>{x&&(E=n.innerTransactions([x.toAggregateV1(f.value)]).build())},z=()=>{E&&(F.value=E.maxFee.compact()/Math.pow(10,p.nativeToken.divisibility))},oe=async()=>{we(),await xe(),Me(),await Te(),Ke(),X(),q(),z(),be()};if(p.isReady)oe();else{let e=C(p,s=>{s.isReady&&(oe(),e())})}const ke=y(()=>p.nativeToken.label),{t:Ie}=Re(),H=m(""),re=m(""),de=i.currentLoggedInWallet?i.currentLoggedInWallet.name:"",G=y(()=>A.currentNetworkProfileConfig?W.convertToExact(A.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility):0),Ce=y(()=>A.currentNetworkProfileConfig?W.convertToCurrency(A.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility):0),J=y(()=>A.currentNetworkProfile?W.convertToExact(ee.getLockFundFee(),p.nativeToken.divisibility):0),Ae="^[^ ]{8,}$",Pe=m(!1),Y=y(()=>k.value==1?c.Convert.utf8ToHex(g.value).length/2>8:g.value.length>16?!0:g.value.length%2===1),ie=y(()=>He.value<$.value),Se=y(()=>Y.value==!0||g.value==""||V.value==""||!H.value.match(Ae)||ie.value==!0),U=y(()=>{if(!i.currentLoggedInWallet)return[];let e=i.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),s=i.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return e.concat(s)}),F=m(0);C(k,e=>{ce(),e==2&&(c.Convert.isHexString(g.value)||(g.value=""))});const ce=async()=>{if(Y.value||g.value.length==0)return;let e="";if(k.value==1){let O=c.Convert.utf8ToHex(g.value);e=O+"00".repeat((16-O.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let s=new c.MetadataQueryParams;s.targetId=w,s.metadataType=c.MetadataType.MOSAIC,s.scopedMetadataKey=c.UInt64.fromHex(e);let a=await p.chainAPI.metadataAPI.searchMetadatas(s);a.metadataEntries.length?K.value=a.metadataEntries[0].value:K.value=""},Ve=()=>{if(!i.currentLoggedInWallet)return;if(!Oe.verifyWalletPassword(i.currentLoggedInWallet.name,A.chainNetworkName,H.value)){re.value=Ie("general.walletPasswordInvalid",{name:de});return}let e="",s;if(k.value==1){let L=c.Convert.utf8ToHex(g.value);e=L+"00".repeat((16-L.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let a=b.targetPublicKey(f.value).targetMosaicId(w).scopedMetadataKey(c.UInt64.fromHex(e)).value(V.value).oldValue(K.value).calculateDifferences().build(),O=p.buildTxn.aggregateCompleteBuilder().innerTransactions([a.toAggregateV1(f.value)]).build(),ue=i.currentLoggedInWallet.accounts.find(L=>L.publicKey==f.value.publicKey).address;if(M.value){let L=i.currentLoggedInWallet.accounts.find(De=>De.publicKey==I.value).address,Be=[a.toAggregateV1(f.value)];s=ee.signTxnWithPassword(L,ue,H.value,null,Be)}else s=ee.signTxnWithPassword(ue,null,H.value,O);g.value="",K.value="",V.value="",H.value="",ae.lockHashPayload=s.hashLockTxnPayload,ae.transactionPayload=s.txnPayload,ae.selectedAddress=f.value.address.plain(),u.push({name:"ViewConfirmTransaction"})},$=y(()=>{let e=p.nativeToken.divisibility;return M.value?e==0?Math.trunc(G.value+J.value+F.value):Math.round((G.value+J.value+F.value)*Math.pow(10,e))/Math.pow(10,e):F.value}),B=y(()=>!i.currentLoggedInWallet||!f.value?[]:te.getCosignerInWallet(f.value.publicKey).cosignerList.length?U.value?te.getCosignerInWallet(f.value.publicKey).cosignerList.map(e=>{let s=U.value.find(a=>a.publicKey==e);return{name:s.name,publicKey:e,balance:s.balance}}):[]:[]),I=m("");B.value.length>0&&(I.value=B.value[0].publicKey),C(()=>B,e=>{e.value.length&&(I.value=B.value[0].publicKey)},{deep:!0});const He=y(()=>i.currentLoggedInWallet?M.value?I.value?P(I.value).balance:0:h.value?h.value.balance:0:0),Fe=y(()=>F.value.toString()),Le=y(()=>W.amountFormatterSimple($.value,0)),We=y(()=>{if(A.currentNetworkProfileConfig){let e=te.getCosignerInWallet(U.value.find(a=>a.address==j.value)?U.value.find(a=>a.address==j.value).publicKey:""),s=[];return e.cosignerList.forEach(a=>{s.push({publicKey:a,name:P(a).name,balance:P(a).balance,address:P(a).address})}),e.cosignerList=s,e}else return{hasCosigner:!1,cosignerList:[]}}),Ue=y(()=>{let e=P(I.value)?P(I.value).balance:0;return W.toCurrencyFormat(e,3)});return C(K,e=>{b.oldValue(e),X(),q(),z()}),C(V,e=>{b.value(e),X(),q(),z()}),C(g,e=>{e==""&&(K.value="")}),{findAcc:P,totalFee:$,err:re,walletPassword:H,showPasswdError:Pe,accounts:U,updateMetadata:Ve,targetAccIsMultisig:M,lockFundCurrency:Ce,lockFund:G,aggregateFee:F,lockFundTxFee:J,walletName:de,currentNativeTokenName:ke,oldValue:K,newValue:V,cosigners:B,scopedMetadataKeyType:k,svgString:fe,accountName:pe,disableAddBtn:Se,showBalanceErr:ie,showScopedKeyErr:Y,inputScopedMetadataKey:g,checkOldValue:ce,selectedCosigner:I,existingScopedMetadataKeys:se,showKeys:N,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:Fe,totalFeeFormatted:Le,selectedAccAdd:j,accBalance:he,getMultiSigCosigner:We,checkCosignBalance:Ue}}},tt={class:"w-10/12 ml-auto mr-auto"},at={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},lt={class:"xl:col-span-2 p-12"},st=l("div",{class:"font-semibold mb-4"},"Update Asset Metadata",-1),nt={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},ot={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},rt={class:"inline-block text-xs"},dt={key:1,class:"error error_box mb-5"},it={class:"flex items-center"},ct=["innerHTML"],ut={class:"ml-2"},gt={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},vt={class:"font-bold text-black text-sm"},mt={key:2,class:"text-left mt-2 mb-5 ml-4"},yt={key:0},ft={class:"text-tsm"},pt={key:0,class:"font-bold"},ht={key:1,class:"font-bold"},bt=["value"],xt={key:1,class:"error"},_t={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},Mt=l("img",{src:$e},null,-1),wt={class:"ml-1"},Tt=l("div",{class:"uppercase text-blue-primary font-semibold text-xxs"},"ASSET ID",-1),Kt={class:"text-black text-sm font-bold"},kt={key:3,class:"mt-2"},It=["onClick"],Ct={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},At={key:1,class:"text-xs py-2 pl-2 w-full"},Pt={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},St={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},Vt={key:4},Ht={class:"flex gap-3"},Ft={class:"flex gap-2"},Lt=l("label",{for:"regular"},"UTF-8",-1),Wt={class:"flex gap-2"},Ut=l("label",{for:"hexa"},"Hexadecimal",-1),Bt={key:5,class:"my-3"},Dt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Nt={class:"flex flex-col gap-0.5"},Et=l("div",{class:"uppercase text-xxs font-semibold text-blue-primary"},"Selected Scoped Metadata Key",-1),Rt={class:"flex"},Ot={class:"font-semibold"},Qt={class:"ml-3 text-gray-400 font-semibold"},jt={class:"flex"},Zt={key:0,class:"font-semibold"},Xt={key:1,class:"ml-3 text-gray-400 font-semibold"},qt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},zt=l("div",{class:"uppercase text-xxs text-blue-primary font-semibold"},"CURRENT VALUE",-1),Gt={class:"font-semibold"},Jt={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Yt={class:"text-xs text-white my-5"},$t=["disabled"],ea={class:"text-center"};function ta(d,u,N,t,k,f){const w=D("font-awesome-icon"),M=D("MetadataInput"),T=D("TransactionFeeDisplay"),g=D("PasswordInput"),h=D("router-link"),b=je("debounce");return r(),o("div",null,[l("div",tt,[l("div",at,[l("div",lt,[st,t.showBalanceErr?(r(),o("div",nt,[l("div",ot,[S(w,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),l("div",rt,v(d.$t("general.insufficientBalance")),1)])):_("",!0),t.err!=""?(r(),o("div",dt,v(t.err),1)):_("",!0),l("div",it,[l("div",{innerHTML:t.svgString,class:"inline-block"},null,8,ct),l("div",ut,[l("div",gt,v(d.$t("asset.assetCreatedBy")),1),l("div",vt,v(t.accountName),1)])]),t.targetAccIsMultisig?(r(),o("div",mt,[t.cosigners.length>0?(r(),o("div",yt,[l("div",ft,[ge(v(d.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(r(),o("span",pt,v(t.cosigners[0].name),1)):(r(),o("span",ht,[Q(l("select",{class:"","onUpdate:modelValue":u[0]||(u[0]=n=>t.selectedCosigner=n)},[(r(!0),o(ve,null,me(t.cosigners,(n,x)=>(r(),o("option",{value:t.findAcc(n.publicKey).publicKey,key:x},v(n.name),9,bt))),128))],512),[[Ze,t.selectedCosigner]])]))])])):(r(),o("div",xt,v(d.$t("general.noCosigner")),1))])):_("",!0),l("div",_t,[Mt,l("div",wt,[Tt,l("div",Kt,v(N.targetId),1)])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(r(),o("div",kt,[l("div",{onClick:u[1]||(u[1]=n=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(r(!0),o(ve,null,me(t.existingScopedMetadataKeys,(n,x)=>(r(),o("div",{key:x},[t.showKeys?(r(),o("div",{key:0,class:"flex justify-center cursor-pointer",onClick:E=>(t.scopedMetadataKeyType=n.type,t.inputScopedMetadataKey=n.value,t.checkOldValue(),t.showKeys=!1)},[x%2==0?(r(),o("div",Ct,v(n.value),1)):_("",!0),x%2==1?(r(),o("div",At,v(n.value),1)):_("",!0),x%2==0?(r(),o("div",Pt,v(d.$t("general.select")),1)):_("",!0),x%2==1?(r(),o("div",St,v(d.$t("general.select")),1)):_("",!0)],8,It)):_("",!0)]))),128))])):_("",!0),t.scopedMetadataKeySelectable?(r(),o("div",Vt,[Q(S(M,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":u[2]||(u[2]=n=>t.inputScopedMetadataKey=n),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[b,t.checkOldValue,"1000"]]),l("div",Ht,[l("div",Ft,[Q(l("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":u[3]||(u[3]=n=>t.scopedMetadataKeyType=n)},null,512),[[ye,t.scopedMetadataKeyType]]),Lt]),l("div",Wt,[Q(l("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":u[4]||(u[4]=n=>t.scopedMetadataKeyType=n)},null,512),[[ye,t.scopedMetadataKeyType]]),Ut])]),S(M,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":u[5]||(u[5]=n=>t.oldValue=n),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(r(),o("div",Bt,[l("div",Dt,[l("div",Nt,[Et,l("div",Rt,[l("div",Ot,v(N.scopedMetadataKey),1),l("div",Qt,v(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),l("div",jt,[t.scopedMetadataKeyType==1?(r(),o("div",Zt,v(t.scopedMetadataKeyHex),1)):_("",!0),t.scopedMetadataKeyType==1?(r(),o("div",Xt,"HEX")):_("",!0)])])]),l("div",qt,[zt,l("div",Gt,v(t.oldValue),1)])])),S(M,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":u[6]||(u[6]=n=>t.newValue=n),placeholder:"New Value"},null,8,["modelValue"])]),l("div",Jt,[S(T,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("div",Yt,v(d.$t("general.enterPasswordContinue")),1),S(g,{placeholder:d.$t("general.enterPassword"),errorMessage:d.$t("general.passwordRequired"),modelValue:t.walletPassword,"onUpdate:modelValue":u[7]||(u[7]=n=>t.walletPassword=n),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","errorMessage","modelValue"]),l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[8]||(u[8]=n=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Asset Metadata ",8,$t),l("div",ea,[S(h,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Xe(()=>[ge(v(d.$t("general.cancel")),1)]),_:1})])])])])])}const va=Qe(et,[["render",ta]]);export{va as default};
