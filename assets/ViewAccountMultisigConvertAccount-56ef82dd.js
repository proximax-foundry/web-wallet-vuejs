import{_ as Ee,u as Ue,l as Ke,r as u,w as F,H as W,B as g,c as y,n as J,S as ue,a as V,z as N,i as x,o as M,b as E,e as a,m as k,t as _,f as Z,F as Ve,g as Le,v as de,ar as Be,O as ve,R as me,x as We,h as Oe,W as pe,I as je,J as Re}from"./index-9b2bf1fa.js";import{_ as He}from"./PasswordInput.vue_vue_type_script_setup_true_lang-0652d022.js";import{T as qe}from"./TextInput-69ac49d8.js";import{_ as ze}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-9d60f85a.js";import{T as Je}from"./TextInputClean-27c10ec1.js";import{M as G}from"./multisigUtils-2c8f40ef.js";import{_ as Ze}from"./SelectAccountAndContact.vue_vue_type_script_setup_true_lang-fe1f83fe.js";import{A as Ge,_ as Qe}from"./AccountTabs.vue_vue_type_script_setup_true_lang-0bd4ef68.js";import{T as se}from"./transactionState-bb830ed7.js";import{_ as Xe}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-f6f63ff7.js";import"./functions-1ed67529.js";import"./icon-key-5b3f7dda.js";const Ye={name:"ViewConvertAccountMultisig",components:{PasswordInput:He,TextInput:qe,TextInputClean:Je,SelectAccountAndContact:Ze,AccountComponent:Ge,AccountTabs:Qe,TransactionFeeDisplay:ze},props:{address:String},setup(n){const{t:l}=Ue(),L=Ke();Oe().appContext.config.globalProperties.emitter;const h=u(""),O=u(""),U=u(!1),P=u(""),Q=u(!1),j="^[^ ]{8,}$",p=u(1),f=u(1),v=u(0),m=u(0),X="^[0-9A-Fa-f]{64}$",i=u([]),s=u([]),r=u([]),b=u([]),w=u([]),Y=u([]),B=u(!1),fe=u(!1),R=F.currentLoggedInWallet?F.currentLoggedInWallet.selectDefaultAccount():null,ge=u(R?R.address:""),be=u(W.toCurrencyFormat(R?R.balance:0,g.nativeToken.divisibility)),$=y(()=>W.convertToCurrency(J.currentNetworkProfileConfig.lockedFundsPerAggregate,g.nativeToken.divisibility)),ee=y(()=>J.currentNetworkProfile?W.convertToExact(ue.getLockFundFee(),g.nativeToken.divisibility):0),H=u(0),d=y(()=>F.currentLoggedInWallet?F.currentLoggedInWallet.accounts.find(e=>e.address===n.address):null);let te=y(()=>{if(d.value)return G.checkIsMultiSig(d.value.address)}),q=()=>{d.value&&(H.value=G.getAggregateFee(d.value.publicKey,i.value,p.value,f.value))};q();const K=y(()=>{let e=g.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(H.value)+parseFloat($.value)+ee.value):Math.round((parseFloat(H.value)+parseFloat($.value)+ee.value)*Math.pow(10,e))/Math.pow(10,e)}),ye=y(()=>g.nativeToken.label),_e=y(()=>g.nativeToken.divisibility);y(()=>F.currentLoggedInWallet?W.toCurrencyFormat(d.value.balance,_e.value):"0");const re=y(()=>{if(!d.value)return!1;const e=F.currentLoggedInWallet;let o=e.accounts.map(A=>({name:A.name,publicKey:A.publicKey})),c=e.contacts;var T=[],S=0;return T.push({key:"0",label:l("general.ownerAcc"),selectable:!1,children:[]}),o.forEach(A=>{T[0].children.push({key:"0-"+S.toString(),label:A.name,data:A.publicKey}),S++}),S=0,T.push({key:"1",label:l("general.contact"),selectable:!1,children:[]}),c!=null&&c.forEach(A=>{T[1].children.push({key:"1-"+S.toString(),label:A.name,data:A.address}),S++}),T});function he(e,o){ie(o),r.value[o]=e.label,e.key[0]=="1"?we(e.data,o):i.value[o]=e.data,i.value[o]=e.data,Y.value[o]=!1,s.value[o][e.key]=!0,e.selectable=!1}function we(e,o){try{G.verifyContactPublicKey(e).then(c=>{c.status==!0?i.value[o]=c.publicKey:h.value=l("multisig.noPublicKey")})}catch{h.value=l("multisig.noPublicKey")}}const ie=e=>{if(Object.keys(s.value[e]).length!==0){let o=Object.keys(s.value[e])[0].split("-");re.value[o[0]].children[o[1]].selectable=!0,s.value[e]={}}},Ae=y(()=>te.value||B.value||!P.value.match(j)||i.value.length==0||h.value||w.value.every(e=>e==!1)==!1||f.value==0||p.value==0||d.value.balance<K.value),xe=y(()=>{if(!d.value)return!1;var e=!1;if(d.value.balance>=K.value&&!B.value){for(var o=0;o<i.value.length;o++)if(w.value[o]!=""){e=!0;break}else if(i.value[o].length<40){e=!0;break}}else e=!0;return e}),ce=()=>{i.value=[],b.value=[],w.value=[],P.value="",p.value=1,v.value=0,f.value=1,m.value=0},ke=async()=>{const e=F.currentLoggedInWallet;if(!pe.verifyWalletPassword(e.name,J.chainNetworkName,P.value))O.value=l("general.walletPasswordInvalid",{name:F.currentLoggedInWallet.name});else{let c={};const T=[],S=e.accounts.find(D=>D.name===d.value.name);if(!S)throw new Error("Account not found");const A=pe.decryptPrivateKey(new N.Password(P.value),S.encrypted,S.iv),Ne=N.Account.createFromPrivateKey(A,g.networkType,1);if(!g.chainAPI)throw new Error("Service unavailable");let z=null;for(const D of i.value){if(D.length==64)z=N.PublicAccount.createFromPublicKey(D,g.networkType);else if(D.length==40||D.length==46){const Me=N.Address.createFromRawAddress(D);try{const oe=await g.chainAPI.accountAPI.getAccountInfo(Me);z=N.PublicAccount.createFromPublicKey(oe.publicKey,g.networkType)}catch(oe){console.log(oe)}}z&&T.push(new N.MultisigCosignatoryModification(N.MultisigCosignatoryModificationType.Add,z))}if(!g.buildTxn)throw new Error("Service unavailable");const De=g.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(p.value).minRemovalDelta(f.value).modifications(T).build();c=ue.signTxnWithPassword(d.value.address,Ne.address.plain(),P.value,De),O.value="",ce(),se.lockHashPayload=c.hashLockTxnPayload,se.transactionPayload=c.txnPayload,se.selectedAddress=n.address,L.push({name:"ViewConfirmTransaction"})}};V(()=>[...i.value],e=>{let o=!1;if(i.value.length>0)for(var c=0;c<i.value.length;c++)i.value[c].length==64?i.value[c]==d.value.publicKey&&o==!1?(o=!0,w.value[c]=!0,h.value=l("multisig.selectedAccErr")):!i.value[c].match(X)&&i.value[c].length==64?w.value[c]=!0:(w.value[c]=!1,Array.from(new Set(e)).length!=e.length?h.value=l("multisig.duplicatedCosigner"):o==!1&&(h.value="")):w.value[c]=!0;else h.value=""},{deep:!0}),V(()=>[...w.value],e=>{e.every(o=>o==!1)&&q()},{deep:!0});const Ce=()=>{i.value.push(""),s.value.push({}),w.value.push(!1),v.value+=1,m.value+=1},Te=e=>{v.value>0&&(v.value-=1),m.value>0&&(m.value-=1),f.value>m.value&&(f.value=m.value),p.value>v.value&&(p.value=v.value),ie(e),i.value.splice(e,1),s.value.splice(e,1),r.value.splice(e,1),Y.value.splice(e,1),b.value.splice(e,1),w.value.splice(e,1)},Se=e=>{p.value*10*~~(v.value/10)+e.charCode-48>v.value&&e.preventDefault()};let ae=l("multisig.deletionExceedMax"),le=l("multisig.approvalExceedMax"),C="";V(p,e=>{q(),v.value==0&&e>1||e>v.value&&e!=1&&v.value!=0?C=le:v.value>0&&e<=0?C=l("multisig.approvalAtLeastOne"):f.value>m.value&&f.value!=1&&m.value!=0?C=ae:C=""});const Pe=e=>{f.value*10*~~(m.value/10)+e.charCode-48>m.value&&e.preventDefault()};let I="";V(f,e=>{q(),m.value==0&&e>1||e>m.value&&e!=1&&m.value!=0?I=ae:m.value>0&&e<=0?I=l("multisig.deletionAtLeastOne"):p.value>v.value&&p.value!=1&&v.value!=0?I=le:I=""}),V([p,f],()=>{C!=""&&I!=""?h.value=C+`
`+I:C!=""?h.value=C:h.value=I});const Ie=y(()=>B.value||te.value);d.value&&G.onPartial(N.PublicAccount.createFromPublicKey(d.value.publicKey,g.networkType)).then(e=>B.value=e),d.value&&d.value.balance<K.value&&(U.value=!0),V(d,e=>{e&&(e.balance<K.value?U.value=!0:U.value=!1)});const Fe=y(()=>W.amountFormatterSimple(K.value,0));return{networkState:J,toggleContact:Y,contact:re,space:fe,currentNativeTokenName:ye,contactName:r,err:h,disableSend:Ae,numApproveTransaction:p,numDeleteUser:f,maxNumApproveTransaction:v,maxNumDeleteUser:m,fundStatus:U,acc:d,passwd:P,showPasswdError:Q,showAddressError:w,addCoSig:Ce,coSign:i,addCoSigButton:xe,selectedNode:s,deleteCoSigAddressInput:Te,onNodeSelect:he,selectedAddresses:b,clear:ce,convertAccount:ke,disabledPassword:Ie,onPartial:B,isMultisig:te,passwdPattern:j,validateApproval:Se,validateDelete:Pe,lockFundCurrency:$,lockFundTxFee:ee,aggregateFee:H,totalFee:K,totalFeeFormatted:Fe,selectedAccAdd:ge,accBalance:be,passwordErr:O}}},ne=n=>(je("data-v-52c4c01c"),n=n(),Re(),n),$e={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},et={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},tt={class:"lg:col-span-2 py-6 pr-6"},at={class:"text-xs font-semibold pl-6"},lt={class:"pl-6"},ot={key:0,class:"error error_box mb-5 whitespace-pre"},st={key:1,class:"error error_box mb-5"},nt=ne(()=>a("div",{class:"mt-4"},null,-1)),rt={class:"flex flex-col gap-2"},it={class:"flex"},ct=["onClick"],ut={key:0,class:"mt-16"},dt=["onClick"],vt={class:"text-xxs text-blue-primary font-semibold uppercase"},mt={key:0},pt=["disabled"],ft=ne(()=>a("div",{class:"ml-6 my-7 gray-line"},null,-1)),gt={class:"pl-6 text-xs font-semibold mb-3"},bt={class:"flex gap-2 pl-6"},yt={class:"border w-6/12"},_t={class:"border-b-2 text-xxs text-center py-1 uppercase"},ht={class:"flex justify-around"},wt=["disabled"],At=["max"],xt=["disabled"],kt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Ct={class:"border w-6/12"},Tt={class:"border-b-2 text-xxs text-center py-1 uppercase"},St={class:"flex justify-around"},Pt=["disabled"],It=["max"],Ft=["disabled"],Nt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Dt={class:"bg-navy-primary p-6 lg:col-span-1"},Mt=ne(()=>a("div",{class:"mt-5"},null,-1)),Et={class:"font-semibold text-xs text-white mb-1.5"},Ut={class:"mt-3"},Kt=["disabled"],Vt={class:"text-center"};function Lt(n,l,L,t,h,O){const U=x("AccountComponent"),P=x("AccountTabs"),Q=x("TextInput"),j=x("TextInputClean"),p=x("font-awesome-icon"),f=x("SelectAccountAndContact"),v=x("Sidebar"),m=x("TransactionFeeDisplay"),X=x("PasswordInput"),i=x("router-link");return M(),E("div",null,[a("div",$e,[k(U,{address:L.address,class:"mb-6"},null,8,["address"]),k(P,{address:L.address,selected:"multisig"},null,8,["address"]),a("div",et,[a("div",tt,[a("div",at,_(n.$t("multisig.manageCosignatories")),1),a("div",lt,[t.err!=""?(M(),E("div",ot,_(t.err),1)):Z("",!0),t.passwordErr!=""?(M(),E("div",st,_(t.passwordErr),1)):Z("",!0)]),nt,a("div",rt,[(M(!0),E(Ve,null,Le(t.coSign,(s,r)=>(M(),E("div",{key:r},[a("div",it,[a("img",{src:Xe,onClick:b=>t.deleteCoSigAddressInput(r),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,ct),k(Q,{class:"w-5/12 mr-2",placeholder:n.$t("multisig.cosignatory")+`${r+1}`,modelValue:t.contactName[r],"onUpdate:modelValue":b=>t.contactName[r]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),k(j,{class:"w-7/12 mr-2",placeholder:n.$t("general.publicKey"),errorMessage:n.$t("general.invalidInput"),showError:t.showAddressError[r],modelValue:t.coSign[r],"onUpdate:modelValue":b=>t.coSign[r]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[r]==!0?(M(),E("div",ut)):Z("",!0),a("div",{onClick:b=>t.toggleContact[r]=!t.toggleContact[r],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[k(p,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),a("div",vt,_(n.$t("general.select")),1)],8,dt)]),t.toggleContact[r]?(M(),E("div",mt,[k(v,{visible:t.toggleContact[r],"onUpdate:visible":b=>t.toggleContact[r]=b,baseZIndex:1e4,position:"full"},{default:de(()=>[k(f,Be(r,{contacts:t.contact,index:r,selectedNode:t.selectedNode[r],onNodeSelect:b=>t.onNodeSelect(b,r)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):Z("",!0)]))),128))]),a("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:l[0]||(l[0]=(...s)=>t.addCoSig&&t.addCoSig(...s)),disabled:t.addCoSigButton},"+"+_(n.$t("multisig.addNewCosignatory")),9,pt),ft,a("div",gt,_(n.$t("general.scheme")),1),a("div",bt,[a("div",yt,[a("div",_t,_(n.$t("multisig.transactionsApproval")),1),a("div",ht,[a("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[1]||(l[1]=s=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,wt),ve(a("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[2]||(l[2]=(...s)=>t.validateApproval&&t.validateApproval(...s)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":l[3]||(l[3]=s=>t.numApproveTransaction=s)},null,40,At),[[me,t.numApproveTransaction]]),a("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:l[4]||(l[4]=s=>t.numApproveTransaction++)},"+",8,xt)]),a("div",kt,_(n.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),a("div",Ct,[a("div",Tt,_(n.$t("multisig.accountDeletionApproval")),1),a("div",St,[a("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[5]||(l[5]=s=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,Pt),ve(a("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[6]||(l[6]=(...s)=>t.validateDelete&&t.validateDelete(...s)),max:t.maxNumDeleteUser,"onUpdate:modelValue":l[7]||(l[7]=s=>t.numDeleteUser=s)},null,40,It),[[me,t.numDeleteUser]]),a("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:l[8]||(l[8]=s=>t.numDeleteUser++)},"+",8,Ft)]),a("div",Nt,_(n.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),a("div",Dt,[k(m,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),Mt,a("div",Et,_(n.$t("general.enterPasswordContinue")),1),k(X,{placeholder:n.$t("general.enterPassword"),errorMessage:n.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":l[9]||(l[9]=s=>t.passwd=s),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),a("div",Ut,[a("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:l[10]||(l[10]=s=>t.convertAccount()),disabled:t.disableSend},_(n.$t("multisig.updateCosignatories")),9,Kt)]),a("div",Vt,[k(i,{to:{name:"ViewMultisigHome",params:{address:L.address}},class:"content-center text-xs text-white underline"},{default:de(()=>[We(_(n.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const ea=Ee(Ye,[["render",Lt],["__scopeId","data-v-52c4c01c"]]);export{ea as default};
