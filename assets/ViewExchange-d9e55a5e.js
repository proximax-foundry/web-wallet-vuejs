import{d as He,c as M,g as F,H as y,n as j,A as o,B as W,x as r,w as x,y as Pe,D as O,k as Se,r as Ce,o as f,a as Be,b as X,f as h,i as w,l as P,e as a,t as s,v,s as Ve,E as Ue,W as Te,bk as $e}from"./index-ac085045.js";import{_ as Ae}from"./proximax-logo-ecfc3767.js";import{_ as We,a as Oe,I as Ke}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-83da228e.js";import{T as Re}from"./TransactionLayout-5136d917.js";import{_ as je}from"./PasswordInput.vue_vue_type_script_setup_true_lang-354fad8f.js";import"./jdenticon-module-2a95d186.js";const Xe=a("div",null,"SDA-SDA Exchange",-1),qe={key:0,class:"text-xs mt-3 text-blue-primary"},ze=a("div",{class:"text-blue-primary mt-3"},"Available Amount",-1),Je=a("div",{class:"text-blue-primary mt-3"},"Minimum Offer",-1),Qe={class:"text-blue-primary mt-3"},Ye={key:1,class:"text-red-500 text-xs"},Ze={key:2,class:"text-red-500 text-xs"},et={class:"mt-2 text-xs text-gray-600"},tt={class:"flex mt-2"},at={class:"text-gray-600 text-xs"},it={key:0,class:"text-red-500 text-xs ml-2"},st={key:3,class:"text-gray-600 text-xs mt-2"},ot=a("div",{class:"text-blue-primary mt-3"},"Actual offer",-1),lt={key:4},nt={key:5},rt={key:0},ct={class:"font-bold text-xs text-blue-primary uppercase"},ut={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},dt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},vt=["innerHTML"],mt={class:"flex"},pt={class:"ml-1 text-blue-400 font-bold"},gt=a("img",{src:Ae,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),yt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},ft=a("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give ",-1),ht={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},bt={class:"ml-1 text-blue-400 text-xs"},xt=a("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),_t={class:"font-bold text-xs text-blue-primary uppercase"},wt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},Gt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Tt=["innerHTML"],At={class:"flex"},It={class:"ml-1 text-blue-400 font-bold"},Mt=a("img",{src:Ae,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),kt=a("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Ft={key:1},Dt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},Lt=a("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give ",-1),Nt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Et={class:"ml-1 text-blue-400 text-xs"},Ht={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Pt={class:"font-semibold lg:col-span-2 col-span-3"},St=["innerHTML"],Ct={class:"ml-1 text-blue-400"},Bt={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Vt={class:"font-semibold lg:col-span-2 col-span-3"},Ut=["innerHTML"],$t={class:"ml-1 text-blue-400"},Wt={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Ot={class:"font-semibold lg:col-span-2 col-span-3"},Kt=["innerHTML"],Rt={class:"ml-1 text-blue-400"},jt=a("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Xt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},qt=a("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"}," Total ",-1),zt=["innerHTML"],Jt={class:"ml-1 text-blue-400"},Qt={class:"font-semibold text-xs text-white mb-1.5"},Yt={class:"text-center"},la=He({__name:"ViewExchange",props:{type:String,owner:String,pair:String},setup(Ie){const q=(t,i)=>{const l=(d,g)=>g===0?d:l(g,d%g),u=l(t,i),n=t/u,p=i/u;return[n,p]},_=M(()=>{var t,i,l;return parseFloat(c.value)<A.value[0]/Math.pow(10,(t=e.value)==null?void 0:t.mosaicGetDivisibility)?0:parseFloat(c.value)*Math.pow(10,(i=e.value)==null?void 0:i.mosaicGetDivisibility)%A.value[0]/Math.pow(10,(l=e.value)==null?void 0:l.mosaicGetDivisibility)}),Me=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],c=F("0"),D=M(()=>parseFloat(c.value)*R.value-_.value*R.value),z=Ue().appContext.config.globalProperties.emitter,L=F(""),G=F(null),T=F(null),J=M(()=>y.convertToExact(j.currentNetworkProfileConfig.lockedFundsPerAggregate,o.nativeToken.divisibility)),Q=M(()=>y.convertToExact(W.getLockFundFee(),o.nativeToken.divisibility)),S=M(()=>{var u,n,p,d;if(!o.isReady)return 0;const t=r.PlaceSdaExchangeOfferTransaction.create(r.Deadline.create(),[new r.SdaExchangeOffer(new r.MosaicId(o.nativeToken.assetId),r.UInt64.fromUint(parseFloat(c.value)*Math.pow(10,((u=e.value)==null?void 0:u.mosaicGetDivisibility)??0)),new r.MosaicId(o.nativeToken.assetId),r.UInt64.fromUint(D.value*Math.pow(10,((n=e.value)==null?void 0:n.mosaicGiveDivisibility)??0)),(p=e.value)==null?void 0:p.deadline)],o.networkType);if(!I.value)return((d=t.maxFee)==null?void 0:d.compact())/Math.pow(10,o.nativeToken.divisibility);const i=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(g=>g.address==T.value),l=[t.toAggregateV1(r.PublicAccount.createFromPublicKey(i.publicKey,o.networkType))];return o.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,o.nativeToken.divisibility)});z.on("select-account",t=>{G.value=t}),z.on("select-multisig-account",t=>{T.value=t});const m=t=>{const i=Me.find(l=>l.namespace==t);return i?i.name:t},K=M(()=>I.value?Math.round((J.value+Q.value+S.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()?Math.round((parseFloat(c.value)-_.value+S.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):S.value),N=Ie,e=F(null),R=F(0),b=Pe(),Y=N.pair.split("/")[N.type=="Sell"?0:1],Z=N.pair.split("/")[N.type=="Sell"?1:0],k=F(0),ee=t=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==t)||x.currentLoggedInWallet.others.find(l=>l.address==t);return i?E(i.balance):0},E=t=>{let i=t.toString().split(".");return i[1]!=null?'<span class="font-semibold text-sm">'+i[0]+'</span>.<span class="font-semibold text-xs">'+i[1]+"</span>":'<span class="font-semibold text-sm">'+i[0]+"</span>"},A=M(()=>{if(!e.value)return q(0,0);const t=e.value.initialMosaicGiveAmount.compact(),i=e.value.initialMosaicGetAmount.compact();return q(i,t)});O(e,t=>{t.mosaicGetDivisibility&&(c.value=(A.value[0]/Math.pow(10,t.mosaicGetDivisibility)).toString())},{deep:!0});const I=M(()=>T.value!=null),ke=async()=>{if(!Y||!Z){b.add({severity:"error",summary:"Error",detail:"Invalid",group:"br-custom",life:1e3});return}const t=new r.ExchangeSdaHttp(o.nodeFullURL),i=await $e(t.getAccountSdaExchangeOffers(r.Address.createFromRawAddress(N.owner)));if(e.value=i.sdaOfferBalances.find(n=>n.mosaicIdGive.toHex()==Y&&n.mosaicIdGet.toHex()==Z),!e.value){b.add({severity:"error",summary:"Error",detail:"Offer not found",group:"br-custom",life:1e3});return}const l=await o.chainAPI.assetAPI.getMosaicsNames([e.value.mosaicIdGet,e.value.mosaicIdGive]),u=await o.chainAPI.assetAPI.getMosaics([e.value.mosaicIdGet,e.value.mosaicIdGive]);e.value.mosaicGetName=l[0].names.length?l[0].names[0].name:e.value.mosaicIdGet.toHex(),e.value.mosaicGiveName=l[1].names.length?l[1].names[0].name:e.value.mosaicIdGive.toHex(),e.value.mosaicGetDivisibility=u.find(n=>n.mosaicId.toHex()==e.value.mosaicIdGet.toHex()).divisibility,e.value.mosaicGiveDivisibility=u.find(n=>n.mosaicId.toHex()==e.value.mosaicIdGive.toHex()).divisibility,R.value=e.value.initialMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)/(e.value.initialMosaicGetAmount.compact()/Math.pow(10,e.value.mosaicGetDivisibility))},te=async t=>{try{const l=(await o.chainAPI.accountAPI.getAccountInfo(r.Address.createFromRawAddress(t))).mosaics.find(u=>u.id.toHex()==e.value.mosaicIdGet.toHex());if(!l){k.value=0;return}k.value=l.amount.compact()/Math.pow(10,e.value.mosaicGetDivisibility)}catch{k.value=0}};O(c,t=>{isNaN(parseFloat(t))&&(c.value="0")}),O([G,T],([t,i])=>{k.value=0,t!=null&&i==null?te(t):t!=null&&i!=null&&te(i)});const Fe=O(o,async(t,i)=>{t.isReady&&(await ke(),Fe())},{immediate:!0}),De=t=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==t)||x.currentLoggedInWallet.others.find(l=>l.address==t);return i?i.balance:0},Le=Se(),Ne=async()=>{if(G.value==null){b.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(parseFloat(c.value)<A.value[0]/Math.pow(10,e.value.mosaicGetDivisibility)){b.add({severity:"error",summary:"Error",detail:"Less than minimum offer amount",group:"br-custom",life:1e3});return}if(parseFloat(c.value)-_.value>k.value){b.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))/Math.pow(10,e.value.mosaicGiveDivisibility)>e.value.currentMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)){b.add({severity:"error",summary:"Error",detail:"Exceed available amount of "+m(e.value.mosaicGiveName),group:"br-custom",life:1e3});return}const t=De(G.value);if(I.value&&t<K.value){b.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()&&!I.value&&t<K.value){b.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(L.value.length<8){b.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!Te.verifyWalletPassword(x.currentLoggedInWallet.name,j.chainNetworkName,L.value)){b.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const i=x.currentLoggedInWallet.accounts.find(d=>d.address==G.value),l=r.PlaceSdaExchangeOfferTransaction.create(r.Deadline.create(),[new r.SdaExchangeOffer(e.value.mosaicIdGet,r.UInt64.fromUint(Math.trunc((parseFloat(c.value)-_.value)*Math.pow(10,e.value.mosaicGetDivisibility))),e.value.mosaicIdGive,r.UInt64.fromUint(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))),r.UInt64.fromUint(57600))],o.networkType),u=Te.decryptPrivateKey(new r.Password(L.value),i.encrypted,i.iv);L.value="";const n=r.Account.createFromPrivateKeyV1(u,o.networkType),p=j.currentNetworkProfile.generationHash;if(I.value){const d=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find($=>$.address==T.value),g=[l.toAggregateV1(r.PublicAccount.createFromPublicKey(d.publicKey,o.networkType))],C=await o.chainAPI.nodeAPI.getNodeTime(),B=o.buildTxn.aggregateBonded(g,new r.UInt64(C.sendTimeStamp)),H=n.preV2Sign(B,p),V=W.lockFundTx(H),U=n.preV2Sign(V,p);W.announceLF_AND_addAutoAnnounceABT(U,H)}else{const d=n.preV2Sign(l,p);await W.announceTransaction(d)}Le.push({name:"ViewAccountPendingTransactions",params:{address:n.address.plain()}})};return(t,i)=>{const l=Ce("router-link");return f(),Be(Re,{class:"mt-8"},{white:X(()=>{var u,n,p,d,g,C,B,H,V,U,$,ae,ie,se,oe,le,ne,re,ce,ue,de,ve,me,pe,ge,ye,fe,he,be,xe,_e,we,Ge;return[Xe,G.value?w("",!0):(f(),h("div",qe," Select Account to Create / Initiate Transaction ")),P(We),P(Oe,{class:"md:mt-3","selected-address":G.value},null,8,["selected-address"]),ze,a("div",null,s(v(y).toCurrencyFormat(((u=e.value)==null?void 0:u.currentMosaicGiveAmount.compact())/Math.pow(10,(n=e.value)==null?void 0:n.mosaicGiveDivisibility),(p=e.value)==null?void 0:p.mosaicGiveDivisibility))+" "+s(m((d=e.value)==null?void 0:d.mosaicGiveName)),1),Je,a("div",null,s(v(y).toCurrencyFormat(A.value[0]/Math.pow(10,(g=e.value)==null?void 0:g.mosaicGetDivisibility),(C=e.value)==null?void 0:C.mosaicGetDivisibility))+" "+s(m((B=e.value)==null?void 0:B.mosaicGetName))+" : "+s(v(y).toCurrencyFormat(A.value[1]/Math.pow(10,(H=e.value)==null?void 0:H.mosaicGiveDivisibility),(V=e.value)==null?void 0:V.mosaicGiveDivisibility))+" "+s(m((U=e.value)==null?void 0:U.mosaicGiveName)),1),a("div",Qe," Amount to give ("+s(m(($=e.value)==null?void 0:$.mosaicGetName))+") ",1),P(Ke,{placeholder:"Asset Amount",modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=Ee=>c.value=Ee),decimal:((ae=e.value)==null?void 0:ae.mosaicGetDivisibility)??0},null,8,["modelValue","decimal"]),parseFloat(c.value)>k.value?(f(),h("div",Ye," Insufficient Balance ")):w("",!0),parseFloat(c.value)<A.value[0]/Math.pow(10,(ie=e.value)==null?void 0:ie.mosaicGetDivisibility)?(f(),h("div",Ze," Less than minimum offer amount ")):w("",!0),a("div",et," Available to give: "+s(v(y).toCurrencyFormat(k.value,(se=e.value)==null?void 0:se.mosaicGetDivisibility))+" "+s(m((oe=e.value)==null?void 0:oe.mosaicGetName)),1),a("div",tt,[a("div",at," I will receive "+s(v(y).toCurrencyFormat(D.value,(le=e.value)==null?void 0:le.mosaicGiveDivisibility))+" "+s(m((ne=e.value)==null?void 0:ne.mosaicGiveName)),1),Math.trunc(D.value*Math.pow(10,(re=e.value)==null?void 0:re.mosaicGiveDivisibility))/Math.pow(10,(ce=e.value)==null?void 0:ce.mosaicGiveDivisibility)>((ue=e.value)==null?void 0:ue.currentMosaicGiveAmount.compact())/Math.pow(10,(de=e.value)==null?void 0:de.mosaicGiveDivisibility)?(f(),h("div",it," (Exceed Available Amount of "+s(m((ve=e.value)==null?void 0:ve.mosaicGiveName))+") ",1)):w("",!0)]),Math.trunc(_.value*Math.pow(10,(me=e.value)==null?void 0:me.mosaicGetDivisibility))/Math.pow(10,(pe=e.value)==null?void 0:pe.mosaicGetDivisibility)>0?(f(),h("div",st,s(v(y).toCurrencyFormat(_.value,(ge=e.value)==null?void 0:ge.mosaicGetDivisibility))+" "+s(m((ye=e.value)==null?void 0:ye.mosaicGetName))+" will be ignored ",1)):w("",!0),ot,parseFloat(c.value)>=A.value[0]/Math.pow(10,(fe=e.value)==null?void 0:fe.mosaicGetDivisibility)?(f(),h("div",lt,s(v(y).toCurrencyFormat(parseFloat(c.value)-_.value,(he=e.value)==null?void 0:he.mosaicGetDivisibility))+" "+s(m((be=e.value)==null?void 0:be.mosaicGetName))+" : "+s(v(y).toCurrencyFormat(D.value,(xe=e.value)==null?void 0:xe.mosaicGiveDivisibility))+" "+s(m((_e=e.value)==null?void 0:_e.mosaicGiveName)),1)):(f(),h("div",nt," 0 "+s(m((we=e.value)==null?void 0:we.mosaicGetName))+" : 0 "+s(m((Ge=e.value)==null?void 0:Ge.mosaicGiveName)),1))]}),navy:X(()=>{var u,n,p,d;return[T.value?(f(),h("div",rt,[a("div",ct,s(t.$t("general.multisigAcc")),1),a("div",ut,[a("div",dt,s(t.$t("general.currentBalance")),1),a("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:ee(T.value)},null,8,vt),a("div",mt,[a("div",pt,s(v(o).nativeToken.label),1),gt])]),a("div",yt,[ft,a("span",ht,s(v(y).toCurrencyFormat(parseFloat(c.value)-_.value,(u=e.value)==null?void 0:u.mosaicGetDivisibility)),1),a("span",bt,s(m((n=e.value)==null?void 0:n.mosaicGetName)),1)]),xt])):w("",!0),a("div",_t,s(t.$t("general.signerAcc")),1),a("div",wt,[a("div",Gt,s(t.$t("general.currentBalance")),1),a("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:ee(G.value)},null,8,Tt),a("div",At,[a("div",It,s(v(o).nativeToken.label),1),Mt])]),kt,T.value?w("",!0):(f(),h("div",Ft,[a("div",Dt,[Lt,a("span",Nt,s(v(y).toCurrencyFormat(parseFloat(c.value)-_.value,(p=e.value)==null?void 0:p.mosaicGetDivisibility)),1),a("span",Et,s(m((d=e.value)==null?void 0:d.mosaicGetName)),1)])])),a("div",Ht,[a("div",Pt,s(I.value?t.$t("general.aggregateFee"):t.$t("general.transactionFee")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(S.value)},null,8,St),a("div",Ct,s(v(o).nativeToken.label),1)]),I.value?(f(),h("div",Bt,[a("div",Vt,s(t.$t("general.lockFund")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(J.value??0)},null,8,Ut),a("div",$t,s(v(o).nativeToken.label),1)])):w("",!0),I.value?(f(),h("div",Wt,[a("div",Ot,s(t.$t("general.lockFundTxFee")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(Q.value??0)},null,8,Kt),a("div",Rt,s(v(o).nativeToken.label),1)])):w("",!0),jt,a("div",Xt,[qt,a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(K.value)},null,8,zt),a("div",Jt,s(v(o).nativeToken.label),1)]),a("div",Qt,s(t.$t("general.enterPasswordContinue")),1),P(je,{placeholder:t.$t("general.enterPassword"),modelValue:L.value,"onUpdate:modelValue":i[1]||(i[1]=g=>L.value=g),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),a("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[2]||(i[2]=g=>Ne())}," Sell "),a("div",Yt,[P(l,{to:{name:"ViewExchangeListing"},class:"content-center text-xs text-white underline"},{default:X(()=>[Ve(s(t.$t("general.cancel")),1)]),_:1})])]}),_:1})}}});export{la as default};
