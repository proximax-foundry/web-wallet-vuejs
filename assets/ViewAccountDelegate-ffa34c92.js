import{_ as be,j as pe,g,w as c,H as p,A as b,c as l,aw as v,D as j,n as w,B as ke,k as _e,y as he,b5 as Ae,G as we,r as T,o as f,f as m,l as C,b as z,e as a,t as r,i as P,s as Z,Q as Ce,am as Le,F as $,M as xe,x as S,E as Te,W as Pe}from"./index-f4fa05bb.js";import{T as Ke}from"./TransactionLayout-4fe4075f.js";import{_ as Ie}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-76415d7e.js";import{c as Fe}from"./functions-19d5b840.js";import{a as De}from"./accountUtils-642c71a2.js";import{M as V}from"./multisigUtils-5932eec1.js";import{T as W}from"./transactionState-bc435c31.js";import{_ as Be}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-72a9e44a.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-32d1fb88.js";import"./proximax-logo-ecfc3767.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-7e841700.js";import"./jdenticon-module-14cc3de9.js";import"./TextInput-ed30286c.js";import"./TextInputClean-800bfeae.js";import"./icon-key-5b3f7dda.js";const Se="/web-wallet-vuejs/assets/icon-blue-tick-41ef93f6.svg";const Ve={name:"ViewAccountDelegate",components:{TransactionFeeDisplay:Ie,AccTabLayout:Be,TransactionLayout:Ke},props:{address:String},setup(s){const{t:u}=pe(),K="^(0x|0X)?[a-fA-F0-9].{63,65}$";let t=g(""),I=g(!0);const G=g(!1),L=g(!1),k=c.currentLoggedInWallet?c.currentLoggedInWallet.selectDefaultAccount():null,x=g(k?k.address:""),M=g(p.toCurrencyFormat(k?k.balance:0,b.nativeToken.divisibility)),o=l(()=>{if(!c.currentLoggedInWallet)return null;let e=c.currentLoggedInWallet.accounts.find(i=>i.address==s.address)||c.currentLoggedInWallet.others.find(i=>i.address==s.address);return e||null}),d=()=>o.value?V.getCosignerInWallet(o.value.publicKey).cosignerList:[],A=l(()=>{let e=d(),i=[];return e.forEach(n=>{i.push({publicKey:n,name:v(n).name,balance:v(n).balance})}),i}),H=l(()=>o.value?V.getCosignerInWallet(o.value.publicKey).cosignerList.length>0:!1),y=g(A.value[0]?A.value[0].publicKey:"");j(A,e=>{e.length&&(y.value=e[0]?e[0].publicKey:"")},{deep:!0});let F=g(!1);(()=>{o.value&&V.onPartial(S.PublicAccount.createFromPublicKey(o.value.publicKey,b.networkType)).then(e=>F.value=e).catch(e=>{F.value=!1})})();const O=l(()=>w.currentNetworkProfileConfig?p.convertToExact(w.currentNetworkProfileConfig.lockedFundsPerAggregate,b.nativeToken.divisibility):0),Q=l(()=>w.currentNetworkProfile?p.convertToExact(ke.getLockFundFee(),b.nativeToken.divisibility):0),_=l(()=>o.value?!!o.value.getDirectParentMultisig().length:!1);let N=l(()=>De.getDelegateFee(_.value));const D=l(()=>_.value?N.value+O.value+Q.value:N.value),R=l(()=>o.value?o.value.balance:0),ee=l(()=>b.nativeToken.label),X=l(()=>b.nativeToken.divisibility),te=l(()=>c.currentLoggedInWallet?_.value?v(y.value)?p.toCurrencyFormat(v(y.value).balance,X.value):"0":p.toCurrencyFormat(R.value,X.value):"0"),q=l(()=>{var e=!1;return _.value?v(y.value)&&(v(y.value).balance<D.value?e=!0:e=!1):R.value<D.value&&(e=!0),e}),ne=l(()=>{let e=te.value.split(".");return e[1]!=null?{left:e[0],right:e[1]}:{left:e[0],right:null}});j(t,e=>{e.match(K)?I.value=!1:I.value=!0});const h=g(""),B=g(""),ae=g(""),le=_e(),se=he();g(s.address);const oe=Te(),ie=new Ae(we.buildAPIEndpoint(w.selectedAPIEndpoint,w.currentNetworkProfile.httpPort));oe.appContext.config.globalProperties.emitter;const re=c.currentLoggedInWallet?c.currentLoggedInWallet.name:"",ce=l(()=>!!(F.value||q.value||!H.value&&_.value)),ue=e=>{let i=document.getElementById(e).getAttribute("copyValue"),n=document.getElementById(e).getAttribute("copySubject");Fe(i),se.add({severity:"info",detail:n+" "+u("general.copied"),group:"br-custom",life:3e3})},E=async()=>{if(o.value&&o.value){const e=p.createPublicAccount(o.value.publicKey,b.networkType),i=await ie.accountAPI.getAccountInfo(e.address);h.value=i.linkedAccountKey}};E(),j(()=>o,e=>{E()},{deep:!0});const de=l(()=>{let e=!1;return h.value!=""&&(h.value==="0".repeat(64)?e=!1:h.value!=="0".repeat(64)&&(e=!0)),e}),J=async()=>{t.value=S.Account.generateNewAccount().privateKey};J();const ge=async()=>{const e=Pe.createAccountFromPrivateKey(t.value,b.networkType);e&&(B.value=e.publicKey);let i="";const n=b.buildTxn;if(h.value!=="0".repeat(64)?(i=n.accountLinkBuilder().remoteAccountKey(h.value).linkAction(S.LinkAction.Unlink).build().serialize(),L.value=""):B.value!=""&&(i=n.accountLinkBuilder().remoteAccountKey(B.value).linkAction(S.LinkAction.Link).build().serialize(),L.value=""),_.value){let U=c.currentLoggedInWallet.accounts.find(ye=>ye.publicKey==y.value).address;W.selectedAddress=U,W.selectedMultisigAddress=o.value.address}else W.selectedAddress=o.value.address;W.unsignedTransactionPayload=i,le.push({name:"ViewConfirmTransaction"})},Y=l(()=>{if(!c.currentLoggedInWallet)return[];let e=c.currentLoggedInWallet.accounts.map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!!n.getDirectParentMultisig().length})),i=c.currentLoggedInWallet.others.filter(n=>n.type==="MULTISIG").map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!0}));return e.concat(i)}),ve=l(()=>p.amountFormatterSimple(D.value,0)),fe=l(()=>{if(w.currentNetworkProfileConfig){let e=V.getCosignerInWallet(Y.value.find(n=>n.address==x.value)?Y.value.find(n=>n.address==x.value).publicKey:""),i=[];return e.cosignerList.forEach(n=>{i.push({publicKey:n,name:v(n).name,balance:v(n).balance,address:v(n).address})}),e.cosignerList=i,e}else return{hasCosigner:!1,cosignerList:[]}}),me=l(()=>{let e=v(y.value)?v(y.value).balance:0;return p.toCurrencyFormat(e,3)});return{showPrivateKeyError:I,findAcc:v,privateKey:t,currentNativeTokenName:ee,splitBalance:ne,isMultisig:_,acc:o,showPasswdError:G,walletState:c,createDelegate:ge,verifyDelegateAcc:E,delegateAcc:h,AccPublicKey:B,AccPrivateKey:ae,disableLinkBtn:ce,copy:ue,err:L,walletName:re,delegateValue:de,isCosigner:H,lockFund:O,transactionFee:N,totalFee:D,lockFundTxFee:Q,onPartial:F,walletCosignerList:A,selectedCosignPublicKey:y,fundStatus:q,generatePrivateKey:J,totalFeeFormatted:ve,selectedAccAdd:x,accBalance:M,getMultiSigCosigner:fe,checkCosignBalance:me}}},We={class:"pl-6"},Me={key:0,class:"error error_box mb-5"},Ne={key:0,class:"text-left mt-2 mb-5"},Ee={key:0},Ue={class:"text-tsm"},je={key:0,class:"font-bold"},ze={key:1,class:"font-bold"},Ge=["value"],He={key:1},Oe={class:"text-xs font-semibold"},Qe={class:"text-xxs mt-2"},Re=a("div",{class:"mt-4"},null,-1),Xe=a("div",{class:"my-7 gray-line"},null,-1),qe={class:"text-xs text-blue-primary mt-0.5 font-semibold uppercase"},Je={class:"flex"},Ye=["copyValue","copySubject"],Ze={class:"text-txs mt-1 text-red-400 border px-1.5 py-2 border-red-400 rounded-md"},$e={key:2},et={class:"text-xs font-semibold"},tt={class:"px-3 py-2 mt-3 bg-green-100"},nt=a("img",{src:Se,class:"h-3 w-3 inline-block mr-2"},null,-1),at={class:"text-xs mt-2 inline-block"},lt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50 overflow-x-auto"},st={class:"text-xs inline-block"},ot=["copyValue","copySubject"],it=a("div",{class:"mt-5"},null,-1),rt={class:"mt-3"},ct=["disabled"],ut=["disabled"],dt={class:"text-center"};function gt(s,u,K,t,I,G){const L=T("AccTabLayout"),k=T("font-awesome-icon"),x=T("TransactionFeeDisplay"),M=T("router-link"),o=T("TransactionLayout");return f(),m($,null,[C(L,{address:K.address,selected:"details"},null,8,["address"]),C(o,null,{white:z(()=>[a("div",We,[t.err!=""?(f(),m("div",Me,r(t.err),1)):P("",!0)]),t.isMultisig?(f(),m("div",Ne,[t.walletCosignerList.length>0?(f(),m("div",Ee,[a("div",Ue,[Z(r(s.$t("general.initiateBy"))+": ",1),t.walletCosignerList.length==1?(f(),m("span",je,r(t.walletCosignerList[0].name),1)):(f(),m("span",ze,[Ce(a("select",{class:"","onUpdate:modelValue":u[0]||(u[0]=d=>t.selectedCosignPublicKey=d)},[(f(!0),m($,null,xe(t.walletCosignerList,(d,A)=>(f(),m("option",{value:t.findAcc(d.publicKey).publicKey,key:A},r(d.name),9,Ge))),128))],512),[[Le,t.selectedCosignPublicKey]])]))])])):P("",!0)])):P("",!0),t.delegateValue?(f(),m("div",$e,[a("div",et,r(s.$t("delegate.accDelegated")),1),a("div",tt,[nt,a("div",at,r(s.$t("delegate.linked")),1)]),a("div",lt,[a("div",st,r(s.$t("delegate.publicKeyOfDelegate")),1),C(k,{icon:"copy",onClick:u[2]||(u[2]=d=>t.copy("delegatePublicKey")),title:s.$t("general.copy"),class:"inline-block float-right mt-1 w-5 h-5 text-blue-link cursor-pointer"},null,8,["title"]),a("div",{class:"text-xs mt-0.5 font-semibold",id:"delegatePublicKey",copyValue:t.delegateAcc,copySubject:s.$t("delegate.delegatePublicKey")},r(t.delegateAcc),9,ot)])])):(f(),m("div",He,[a("div",Oe,r(s.$t("general.delegate")),1),a("div",Qe,r(s.$t("delegate.notLinked")),1),Re,Xe,a("div",null,[a("div",qe,r(s.$t("general.privateKey")),1),a("div",Je,[a("div",{id:"private",class:"truncate text-xs mt-1 font-semibold",type:"text",copyValue:t.privateKey,copySubject:s.$t("general.privateKey")},r(t.privateKey),9,Ye),C(k,{title:s.$t("general.copy"),icon:"copy",onClick:u[1]||(u[1]=d=>t.copy("private")),class:"ml-2 pb-1 w-5 h-5 text-blue-link mt-0.5 cursor-pointer"},null,8,["title"])]),a("div",Ze,r(s.$t("general.pkWarning")),1)])]))]),navy:z(()=>[C(x,{"fund-status":t.fundStatus,"is-multisig":t.isMultisig,"is-cosigner":t.isCosigner,"on-partial":t.onPartial,"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":t.lockFund,"lock-fund-tx-fee":t.lockFundTxFee,balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig","is-cosigner","on-partial","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),it,a("div",rt,[t.delegateValue?(f(),m("button",{key:0,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[3]||(u[3]=(...d)=>t.createDelegate&&t.createDelegate(...d)),disabled:t.disableLinkBtn},r(s.$t("delegate.unlinkAcc")),9,ct)):P("",!0),t.delegateValue?P("",!0):(f(),m("button",{key:1,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[4]||(u[4]=(...d)=>t.createDelegate&&t.createDelegate(...d)),disabled:t.disableLinkBtn},r(s.$t("delegate.delegateAcc")),9,ut))]),a("div",dt,[C(M,{to:{name:"ViewAccountDetails",params:{address:K.address}},class:"content-center text-xs text-white underline"},{default:z(()=>[Z(r(s.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}const Kt=be(Ve,[["render",gt]]);export{Kt as default};
