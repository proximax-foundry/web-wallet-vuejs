import{q as Re,r as f,I as Oe,c as y,w as c,H as L,E as m,a as P,u as Qe,n as k,P as Q,B as o,at as S,W as ae,_ as je,k as D,R as Xe,o as r,b as i,e as a,s as V,t as v,f as M,A as ve,S as j,af as Ze,F as fe,i as ye,X as me,z as qe}from"./index-58a8249b.js";import{P as ze}from"./PasswordInput-25bf4cdb.js";import{M as le}from"./multisigUtils-e0589473.js";import{M as Ge}from"./MetadataInput-6f4e93ff.js";import{T as Je}from"./TransactionFeeDisplay-7c24bec3.js";import{t as Ye}from"./jdenticon-module-c2e94759.js";import{U as $e}from"./UTF8-f01f44a8.js";import{_ as et}from"./icon-asset-2a9ae6ea.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";import"./icon-new-page-link-270844f6.js";const tt={name:"ViewUpdateAssetMetadata",props:{targetId:String,scopedMetadataKey:String},components:{MetadataInput:Ge,PasswordInput:ze,TransactionFeeDisplay:Je},setup(d){const u=Re();let E=f(!1),t=f(!0),I=f(1),p=f(null),w=null,x=f(!1),T=f(""),g=f(""),b=f(null),h,n,_,R;const K=f(""),H=f(""),se=new Oe("ThemeStyleConfig");se.init();const pe=y(()=>Ye(b.value?b.value.address:"",40,se.jdenticonConfig)),be=y(()=>b.value?c.currentLoggedInWallet.convertAddressToName(b.value.address,!0):""),ne=f([]),O=c.currentLoggedInWallet?c.currentLoggedInWallet.selectDefaultAccount():null,X=f(O?O.address:""),he=f(L.toCurrencyFormat(O?O.balance:0,m.nativeToken.divisibility)),oe=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=oe(e)),e),Z=e=>{e=oe(e);let s=o.Convert.hexToUint8(e);return $e.isNotUTF8(s)||(e=o.Convert.decodeHexToUtf8(e)),e},xe=()=>{let e=new o.MetadataQueryParams;e.metadataType=o.MetadataType.MOSAIC,e.targetId=w,m.chainAPI.metadataAPI.searchMetadatas(e).then(s=>{s.metadataEntries.forEach(l=>{ne.value.push({value:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?l.scopedMetadataKey.toHex():Z(l.scopedMetadataKey.toHex()),type:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?2:1})})})},_e=async()=>{if(d.targetId&&d.targetId.length===16&&o.Convert.isHexString(d.targetId)){let e=new o.MosaicId(d.targetId);w=e,h.targetMosaicId(w);let s=await m.chainAPI.assetAPI.getMosaic(e);if(p.value=s.owner,h.targetPublicKey(p.value),!c.currentLoggedInWallet)return;b.value=c.currentLoggedInWallet.accounts.find(l=>l.publicKey===s.owner.publicKey)||c.currentLoggedInWallet.others.find(l=>l.publicKey===s.owner.publicKey),b.value&&(x.value=!!b.value.getDirectParentMultisig().length)}},Me=y(()=>c.currentLoggedInWallet&&p.value?c.currentLoggedInWallet.others.find(e=>e.publicKey===p.value.publicKey):null);P(Me,async e=>{e&&(b.value=c.currentLoggedInWallet.accounts.find(s=>s.publicKey===p.value.publicKey)||c.currentLoggedInWallet.others.find(s=>s.publicKey===p.value.publicKey),b.value&&(x.value=!!b.value.getDirectParentMultisig().length))},{deep:!0});const we=()=>{if(d.scopedMetadataKey)if(t.value=!1,g.value=d.scopedMetadataKey,d.scopedMetadataKey.length===16&&o.Convert.isHexString(d.scopedMetadataKey))I.value=2,T.value=d.scopedMetadataKey,h.scopedMetadataKey(o.UInt64.fromHex(T.value));else{I.value=1;let e=o.Convert.utf8ToHex(d.scopedMetadataKey);const s=e.length/2;e.length&&s<=8&&(e.length/2<8&&(e=e+"00".repeat(8-s)),T.value=e,h.scopedMetadataKey(o.UInt64.fromHex(T.value)))}},Te=()=>{h=m.buildTxn.assetMetadataBuilder(),n=m.buildTxn.aggregateBondedBuilder()},Ke=async()=>{if(w&&T.value){let e=new o.MetadataQueryParams;e.targetId=w,e.metadataType=o.MetadataType.MOSAIC,e.scopedMetadataKey=o.UInt64.fromHex(T.value);let s=await m.chainAPI.metadataAPI.searchMetadatas(e);s.metadataEntries.length&&(K.value=s.metadataEntries[0].value)}h.oldValue(K.value)},ke=()=>{h.value(H.value)},q=()=>{_=h.calculateDifferences().build()},z=()=>{_&&(R=n.innerTransactions([_.toAggregateV1(p.value)]).build())},G=()=>{R&&(F.value=R.maxFee.compact()/Math.pow(10,m.nativeToken.divisibility))},re=async()=>{Te(),await _e(),we(),await Ke(),ke(),q(),z(),G(),xe()};if(m.isReady)re();else{let e=P(m,s=>{s.isReady&&(re(),e())})}const Ie=y(()=>m.nativeToken.label),{t:Ae}=Qe(),U=f(""),ie=f(""),de=c.currentLoggedInWallet?c.currentLoggedInWallet.name:"",J=y(()=>k.currentNetworkProfileConfig?L.convertToExact(k.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility):0),Ce=y(()=>k.currentNetworkProfileConfig?L.convertToCurrency(k.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility):0),Y=y(()=>k.currentNetworkProfile?L.convertToExact(Q.getLockFundFee(),m.nativeToken.divisibility):0),Pe="^[^ ]{8,}$",Se=f(!1),$=y(()=>I.value==1?o.Convert.utf8ToHex(g.value).length/2>8:g.value.length>16?!0:g.value.length%2===1),ce=y(()=>Fe.value<ee.value),Ve=y(()=>$.value==!0||g.value==""||H.value==""||!U.value.match(Pe)||ce.value==!0),W=y(()=>{if(!c.currentLoggedInWallet)return[];let e=c.currentLoggedInWallet.accounts.map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!!l.getDirectParentMultisig().length})),s=c.currentLoggedInWallet.others.filter(l=>l.type==="MULTISIG").map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!0}));return e.concat(s)}),F=f(0);P(I,e=>{ue(),e==2&&(o.Convert.isHexString(g.value)||(g.value=""))});const ue=async()=>{if($.value||g.value.length==0)return;let e="";if(I.value==1){let N=o.Convert.utf8ToHex(g.value);e=N+"00".repeat((16-N.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let s=new o.MetadataQueryParams;s.targetId=w,s.metadataType=o.MetadataType.MOSAIC,s.scopedMetadataKey=o.UInt64.fromHex(e);let l=await m.chainAPI.metadataAPI.searchMetadatas(s);l.metadataEntries.length?K.value=l.metadataEntries[0].value:K.value=""},He=()=>{if(!c.currentLoggedInWallet)return;if(!ae.verifyWalletPassword(c.currentLoggedInWallet.name,k.chainNetworkName,U.value)){ie.value=Ae("general.walletPasswordInvalid",{name:de});return}let e="";if(I.value==1){let C=o.Convert.utf8ToHex(g.value);e=C+"00".repeat((16-C.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let s=h.targetPublicKey(p.value).targetMosaicId(w).scopedMetadataKey(o.UInt64.fromHex(e)).value(H.value).oldValue(K.value).calculateDifferences().build(),l=x.value?n.innerTransactions([s.toAggregateV1(p.value)]).build():m.buildTxn.aggregateCompleteBuilder().innerTransactions([s.toAggregateV1(p.value)]).build(),N=x.value?c.currentLoggedInWallet.accounts.find(C=>C.publicKey==A.value):c.currentLoggedInWallet.accounts.find(C=>C.publicKey==p.value.publicKey),Ne=ae.createPassword(U.value),De=ae.decryptPrivateKey(Ne,N.encrypted,N.iv),ge=o.Account.createFromPrivateKey(De,m.networkType,1),te=ge.preV2Sign(l,k.currentNetworkProfile.generationHash);if(x.value){let C=Q.lockFundTx(te),Ee=ge.preV2Sign(C,k.currentNetworkProfile.generationHash);Q.announceLF_AND_addAutoAnnounceABT(Ee,te)}else Q.announceTransaction(te);g.value="",K.value="",H.value="",U.value="",u.push({name:"ViewAccountPendingTransactions",params:{address:p.value.address.plain()}})},ee=y(()=>{let e=m.nativeToken.divisibility;return x.value?e==0?Math.trunc(J.value+Y.value+F.value):Math.round((J.value+Y.value+F.value)*Math.pow(10,e))/Math.pow(10,e):F.value}),B=y(()=>!c.currentLoggedInWallet||!p.value?[]:le.getCosignerInWallet(p.value.publicKey).cosignerList.length?W.value?le.getCosignerInWallet(p.value.publicKey).cosignerList.map(e=>{let s=W.value.find(l=>l.publicKey==e);return{name:s.name,publicKey:e,balance:s.balance}}):[]:[]),A=f("");B.value.length>0&&(A.value=B.value[0].publicKey),P(()=>B,e=>{e.value.length&&(A.value=B.value[0].publicKey)},{deep:!0});const Fe=y(()=>c.currentLoggedInWallet?x.value?A.value?S(A.value).balance:0:b.value?b.value.balance:0:0),Le=y(()=>F.value.toString()),Ue=y(()=>L.amountFormatterSimple(ee.value,0)),We=y(()=>{if(k.currentNetworkProfileConfig){let e=le.getCosignerInWallet(W.value.find(l=>l.address==X.value)?W.value.find(l=>l.address==X.value).publicKey:""),s=[];return e.cosignerList.forEach(l=>{s.push({publicKey:l,name:S(l).name,balance:S(l).balance,address:S(l).address})}),e.cosignerList=s,e}else return{hasCosigner:!1,cosignerList:[]}}),Be=y(()=>{let e=S(A.value)?S(A.value).balance:0;return L.toCurrencyFormat(e,3)});return P(K,e=>{h.oldValue(e),q(),z(),G()}),P(H,e=>{h.value(e),q(),z(),G()}),P(g,e=>{e==""&&(K.value="")}),{findAcc:S,totalFee:ee,err:ie,walletPassword:U,showPasswdError:Se,accounts:W,updateMetadata:He,targetAccIsMultisig:x,lockFundCurrency:Ce,lockFund:J,aggregateFee:F,lockFundTxFee:Y,walletName:de,currentNativeTokenName:Ie,oldValue:K,newValue:H,cosigners:B,scopedMetadataKeyType:I,svgString:pe,accountName:be,disableAddBtn:Ve,showBalanceErr:ce,showScopedKeyErr:$,inputScopedMetadataKey:g,checkOldValue:ue,selectedCosigner:A,existingScopedMetadataKeys:ne,showKeys:E,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:Le,totalFeeFormatted:Ue,selectedAccAdd:X,accBalance:he,getMultiSigCosigner:We,checkCosignBalance:Be}}},at={class:"w-10/12 ml-auto mr-auto"},lt={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},st={class:"xl:col-span-2 p-12"},nt=a("div",{class:"font-semibold mb-4"},"Update Asset Metadata",-1),ot={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},rt={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},it={class:"inline-block text-xs"},dt={key:1,class:"error error_box mb-5"},ct={class:"flex items-center"},ut=["innerHTML"],gt={class:"ml-2"},vt={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},ft={class:"font-bold text-black text-sm"},yt={key:2,class:"text-left mt-2 mb-5 ml-4"},mt={key:0},pt={class:"text-tsm"},bt={key:0,class:"font-bold"},ht={key:1,class:"font-bold"},xt=["value"],_t={key:1,class:"error"},Mt={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},wt=a("img",{src:et},null,-1),Tt={class:"ml-1"},Kt=a("div",{class:"uppercase text-blue-primary font-semibold text-xxs"},"ASSET ID",-1),kt={class:"text-black text-sm font-bold"},It={key:3,class:"mt-2"},At=["onClick"],Ct={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},Pt={key:1,class:"text-xs py-2 pl-2 w-full"},St={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},Vt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},Ht={key:4},Ft={class:"flex gap-3"},Lt={class:"flex gap-2"},Ut=a("label",{for:"regular"},"UTF-8",-1),Wt={class:"flex gap-2"},Bt=a("label",{for:"hexa"},"Hexadecimal",-1),Nt={key:5,class:"my-3"},Dt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Et={class:"flex flex-col gap-0.5"},Rt=a("div",{class:"uppercase text-xxs font-semibold text-blue-primary"},"Selected Scoped Metadata Key",-1),Ot={class:"flex"},Qt={class:"font-semibold"},jt={class:"ml-3 text-gray-400 font-semibold"},Xt={class:"flex"},Zt={key:0,class:"font-semibold"},qt={key:1,class:"ml-3 text-gray-400 font-semibold"},zt={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Gt=a("div",{class:"uppercase text-xxs text-blue-primary font-semibold"},"CURRENT VALUE",-1),Jt={class:"font-semibold"},Yt={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},$t={class:"text-xs text-white my-5"},ea=["disabled"],ta={class:"text-center"};function aa(d,u,E,t,I,p){const w=D("font-awesome-icon"),x=D("MetadataInput"),T=D("TransactionFeeDisplay"),g=D("PasswordInput"),b=D("router-link"),h=Xe("debounce");return r(),i("div",null,[a("div",at,[a("div",lt,[a("div",st,[nt,t.showBalanceErr?(r(),i("div",ot,[a("div",rt,[V(w,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),a("div",it,v(d.$t("general.insufficientBalance")),1)])):M("v-if",!0),t.err!=""?(r(),i("div",dt,v(t.err),1)):M("v-if",!0),a("div",ct,[a("div",{innerHTML:t.svgString,class:"inline-block"},null,8,ut),a("div",gt,[a("div",vt,v(d.$t("asset.assetCreatedBy")),1),a("div",ft,v(t.accountName),1)])]),t.targetAccIsMultisig?(r(),i("div",yt,[t.cosigners.length>0?(r(),i("div",mt,[a("div",pt,[ve(v(d.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(r(),i("span",bt,v(t.cosigners[0].name),1)):(r(),i("span",ht,[j(a("select",{class:"","onUpdate:modelValue":u[0]||(u[0]=n=>t.selectedCosigner=n)},[(r(!0),i(fe,null,ye(t.cosigners,(n,_)=>(r(),i("option",{value:t.findAcc(n.publicKey).publicKey,key:_},v(n.name),9,xt))),128))],512),[[Ze,t.selectedCosigner]])]))])])):(r(),i("div",_t,v(d.$t("general.noCosigner")),1))])):M("v-if",!0),a("div",Mt,[wt,a("div",Tt,[Kt,a("div",kt,v(E.targetId),1)])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(r(),i("div",It,[a("div",{onClick:u[1]||(u[1]=n=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(r(!0),i(fe,null,ye(t.existingScopedMetadataKeys,(n,_)=>(r(),i("div",{key:_},[t.showKeys?(r(),i("div",{key:0,class:"flex justify-center cursor-pointer",onClick:R=>(t.scopedMetadataKeyType=n.type,t.inputScopedMetadataKey=n.value,t.checkOldValue(),t.showKeys=!1)},[_%2==0?(r(),i("div",Ct,v(n.value),1)):M("v-if",!0),_%2==1?(r(),i("div",Pt,v(n.value),1)):M("v-if",!0),_%2==0?(r(),i("div",St,v(d.$t("general.select")),1)):M("v-if",!0),_%2==1?(r(),i("div",Vt,v(d.$t("general.select")),1)):M("v-if",!0)],8,At)):M("v-if",!0)]))),128))])):M("v-if",!0),t.scopedMetadataKeySelectable?(r(),i("div",Ht,[j(V(x,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":u[2]||(u[2]=n=>t.inputScopedMetadataKey=n),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[h,t.checkOldValue,"1000"]]),a("div",Ft,[a("div",Lt,[j(a("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":u[3]||(u[3]=n=>t.scopedMetadataKeyType=n)},null,512),[[me,t.scopedMetadataKeyType]]),Ut]),a("div",Wt,[j(a("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":u[4]||(u[4]=n=>t.scopedMetadataKeyType=n)},null,512),[[me,t.scopedMetadataKeyType]]),Bt])]),V(x,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":u[5]||(u[5]=n=>t.oldValue=n),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(r(),i("div",Nt,[a("div",Dt,[a("div",Et,[Rt,a("div",Ot,[a("div",Qt,v(E.scopedMetadataKey),1),a("div",jt,v(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),a("div",Xt,[t.scopedMetadataKeyType==1?(r(),i("div",Zt,v(t.scopedMetadataKeyHex),1)):M("v-if",!0),t.scopedMetadataKeyType==1?(r(),i("div",qt,"HEX")):M("v-if",!0)])])]),a("div",zt,[Gt,a("div",Jt,v(t.oldValue),1)])])),V(x,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":u[6]||(u[6]=n=>t.newValue=n),placeholder:"New Value"},null,8,["modelValue"])]),a("div",Yt,[V(T,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),a("div",$t,v(d.$t("general.enterPasswordContinue")),1),V(g,{placeholder:d.$t("general.enterPassword"),errorMessage:d.$t("general.passwordRequired"),modelValue:t.walletPassword,"onUpdate:modelValue":u[7]||(u[7]=n=>t.walletPassword=n),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","errorMessage","modelValue"]),a("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[8]||(u[8]=n=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Asset Metadata ",8,ea),a("div",ta,[V(b,{to:{name:"ViewServicesAssets"},class:"content-center text-xs text-white border-b-2 border-white"},{default:qe(()=>[ve(v(d.$t("general.cancel")),1)]),_:1})])])])])])}const fa=je(tt,[["render",aa],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/metadataTxn/views/ViewUpdateAssetMetadata.vue"]]);export{fa as default};
