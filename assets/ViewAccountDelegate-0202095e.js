import{_ as ke,u as we,r as g,w as u,H as h,B as y,c as r,am as v,a as z,n as A,S as W,l as Ae,A as Pe,aX as Ce,G as xe,i as T,o as m,b as f,e as n,m as P,t as i,f as D,x as se,O as Te,aa as Ie,F as Le,g as Ke,v as Fe,z as I,h as We,W as oe}from"./index-1b5cb3ad.js";import{_ as De}from"./PasswordInput.vue_vue_type_script_setup_true_lang-fe362266.js";import{_ as Se}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-85c2e424.js";import{c as Be}from"./functions-167a9be0.js";import{a as Ve}from"./accountUtils-acbd9810.js";import{A as Ne,_ as Me}from"./AccountTabs.vue_vue_type_script_setup_true_lang-ac62edea.js";import{M}from"./multisigUtils-605a6b8c.js";import{T as J}from"./transactionState-ea76f1bd.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-bd90392b.js";import"./TextInput-3160db26.js";import"./TextInputClean-5afdc1cb.js";import"./icon-key-5b3f7dda.js";const Ee="/web-wallet-vuejs/assets/icon-blue-tick-41ef93f6.svg";const Ue={name:"ViewAccountDelegate",components:{AccountComponent:Ne,PasswordInput:De,AccountTabs:Me,TransactionFeeDisplay:Se},props:{address:String},setup(l){const{t:c}=we(),L="^(0x|0X)?[a-fA-F0-9].{63,65}$";let e=g(""),S=g(!0);const b=g(""),E=g(!1),C=g(!1),k=u.currentLoggedInWallet?u.currentLoggedInWallet.selectDefaultAccount():null,K=g(k?k.address:""),U=g(h.toCurrencyFormat(k?k.balance:0,y.nativeToken.divisibility)),o=r(()=>{if(!u.currentLoggedInWallet)return null;let t=u.currentLoggedInWallet.accounts.find(s=>s.address==l.address)||u.currentLoggedInWallet.others.find(s=>s.address==l.address);return t||null}),d=()=>o.value?M.getCosignerInWallet(o.value.publicKey).cosignerList:[],x=r(()=>{let t=d(),s=[];return t.forEach(a=>{s.push({publicKey:a,name:v(a).name,balance:v(a).balance})}),s}),Q=r(()=>o.value?M.getCosignerInWallet(o.value.publicKey).cosignerList.length>0:!1),p=g(x.value[0]?x.value[0].publicKey:"");z(x,t=>{t.length&&(p.value=t[0]?t[0].publicKey:"")},{deep:!0});let B=g(!1);(()=>{o.value&&M.onPartial(I.PublicAccount.createFromPublicKey(o.value.publicKey,y.networkType)).then(t=>B.value=t).catch(t=>{B.value=!1})})();const Y=r(()=>A.currentNetworkProfileConfig?h.convertToExact(A.currentNetworkProfileConfig.lockedFundsPerAggregate,y.nativeToken.divisibility):0),Z=r(()=>A.currentNetworkProfile?h.convertToExact(W.getLockFundFee(),y.nativeToken.divisibility):0),_=r(()=>o.value?!!o.value.getDirectParentMultisig().length:!1);let j=r(()=>Ve.getDelegateFee(_.value));const V=r(()=>_.value?j.value+Y.value+Z.value:j.value),$=r(()=>o.value?o.value.balance:0),re=r(()=>y.nativeToken.label),ee=r(()=>y.nativeToken.divisibility),ie=r(()=>u.currentLoggedInWallet?_.value?v(p.value)?h.toCurrencyFormat(v(p.value).balance,ee.value):"0":h.toCurrencyFormat($.value,ee.value):"0"),te=r(()=>{var t=!1;return _.value?v(p.value)&&(v(p.value).balance<V.value?t=!0:t=!1):$.value<V.value&&(t=!0),t}),ce=r(()=>{let t=ie.value.split(".");return t[1]!=null?{left:t[0],right:t[1]}:{left:t[0],right:null}});z(e,t=>{t.match(L)?S.value=!1:S.value=!0});const w=g(""),N=g(""),de=g(""),ue=Ae(),ge=Pe();g(l.address);const ae="^[^ ]{8,}$",ve=We(),me=new Ce(xe.buildAPIEndpoint(A.selectedAPIEndpoint,A.currentNetworkProfile.httpPort));ve.appContext.config.globalProperties.emitter;const H=u.currentLoggedInWallet?u.currentLoggedInWallet.name:"",fe=r(()=>B.value||te.value||!Q.value&&_.value?!0:O.value?O.value?!b.value.match(ae):!0:!b.value.match(ae)),be=t=>{let s=document.getElementById(t).getAttribute("copyValue"),a=document.getElementById(t).getAttribute("copySubject");Be(s),ge.add({severity:"info",detail:a+" "+c("general.copied"),group:"br-custom",life:3e3})},G=async()=>{if(o.value&&o.value){const t=h.createPublicAccount(o.value.publicKey,y.networkType),s=await me.accountAPI.getAccountInfo(t.address);w.value=s.linkedAccountKey}};G(),z(()=>o,t=>{G()},{deep:!0});const O=r(()=>{let t=!1;return w.value!=""&&(w.value==="0".repeat(64)?t=!1:w.value!=="0".repeat(64)&&(t=!0)),t}),ne=async()=>{e.value=I.Account.generateNewAccount().privateKey};ne();const ye=async()=>{const t=oe.createAccountFromPrivateKey(e.value,y.networkType);t&&(N.value=t.publicKey);let s={};const a=y.buildTxn;if(oe.verifyWalletPassword(H,A.chainNetworkName,b.value)){if(w.value!=="0".repeat(64)){const F=a.accountLinkBuilder().remoteAccountKey(w.value).linkAction(I.LinkAction.Unlink).build();if(_.value){let R=u.currentLoggedInWallet.accounts.find(q=>q.publicKey==p.value).address;const X=await y.chainAPI.nodeAPI.getNodeTime();s=await W.signAbtWithTxnAndPassword(R,o.value.address,b.value,F,new I.UInt64(X.sendTimeStamp))}else s=await W.signTxnWithPassword(o.value.address,null,b.value,F);b.value="",C.value=""}else if(N.value!=""){const F=a.accountLinkBuilder().remoteAccountKey(N.value).linkAction(I.LinkAction.Link).build();if(_.value){let R=u.currentLoggedInWallet.accounts.find(q=>q.publicKey==p.value).address;const X=await y.chainAPI.nodeAPI.getNodeTime();s=await W.signAbtWithTxnAndPassword(R,o.value.address,b.value,F,new I.UInt64(X.sendTimeStamp))}else s=await W.signTxnWithPassword(o.value.address,null,b.value,F);b.value="",C.value=""}J.lockHashPayload=s.hashLockTxnPayload,J.transactionPayload=s.txnPayload,J.selectedAddress=l.address,ue.push({name:"ViewConfirmTransaction"})}else C.value=c("general.walletPasswordInvalid",{name:H})},le=r(()=>{if(!u.currentLoggedInWallet)return[];let t=u.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),s=u.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return t.concat(s)}),pe=r(()=>h.amountFormatterSimple(V.value,0)),_e=r(()=>{if(A.currentNetworkProfileConfig){let t=M.getCosignerInWallet(le.value.find(a=>a.address==K.value)?le.value.find(a=>a.address==K.value).publicKey:""),s=[];return t.cosignerList.forEach(a=>{s.push({publicKey:a,name:v(a).name,balance:v(a).balance,address:v(a).address})}),t.cosignerList=s,t}else return{hasCosigner:!1,cosignerList:[]}}),he=r(()=>{let t=v(p.value)?v(p.value).balance:0;return h.toCurrencyFormat(t,3)});return{showPrivateKeyError:S,findAcc:v,privateKey:e,currentNativeTokenName:re,splitBalance:ce,isMultisig:_,acc:o,walletPassword:b,showPasswdError:E,walletState:u,createDelegate:ye,verifyDelegateAcc:G,delegateAcc:w,AccPublicKey:N,AccPrivateKey:de,disableLinkBtn:fe,copy:be,err:C,walletName:H,delegateValue:O,isCosigner:Q,lockFund:Y,transactionFee:j,totalFee:V,lockFundTxFee:Z,onPartial:B,walletCosignerList:x,selectedCosignPublicKey:p,fundStatus:te,generatePrivateKey:ne,totalFeeFormatted:pe,selectedAccAdd:K,accBalance:U,getMultiSigCosigner:_e,checkCosignBalance:he}}},je={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},He={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-3"},Ge={class:"lg:col-span-2 py-6 pr-6"},Oe={class:"pl-6"},Re={key:0,class:"error error_box mb-5"},Xe={key:0,class:"text-left mt-2 mb-5 ml-6"},qe={key:0},ze={class:"text-tsm"},Je={key:0,class:"font-bold"},Qe={key:1,class:"font-bold"},Ye=["value"],Ze={key:1},$e={class:"text-xs font-semibold pl-6"},et={class:"text-xxs pl-6 mt-2"},tt=n("div",{class:"mt-4"},null,-1),at=n("div",{class:"ml-6 my-7 gray-line"},null,-1),nt={class:"pl-6"},lt={class:"text-xs text-blue-primary mt-0.5 font-semibold uppercase"},st={class:"flex"},ot=["copyValue","copySubject"],rt={class:"text-txs mt-1 text-red-400 border px-1.5 py-2 border-red-400 rounded-md"},it={key:2},ct={class:"text-xs font-semibold pl-6"},dt={class:"ml-6 px-3 py-2 mt-3 bg-green-100"},ut=n("img",{src:Ee,class:"h-3 w-3 inline-block mr-2"},null,-1),gt={class:"text-xs mt-2 inline-block"},vt={class:"border border-blue-300 rounded-md ml-6 p-3 mt-3 bg-blue-50 overflow-x-auto"},mt={class:"text-xs inline-block"},ft=["copyValue","copySubject"],bt={class:"bg-navy-primary p-6 lg:col-span-1"},yt=n("div",{class:"mt-5"},null,-1),pt={class:"font-semibold text-xs text-white mb-1.5"},_t={class:"mt-3"},ht=["disabled"],kt=["disabled"],wt={class:"text-center"};function At(l,c,L,e,S,b){const E=T("AccountComponent"),C=T("AccountTabs"),k=T("font-awesome-icon"),K=T("TransactionFeeDisplay"),U=T("PasswordInput"),o=T("router-link");return m(),f("div",null,[n("div",je,[P(E,{address:L.address,class:"mb-6"},null,8,["address"]),P(C,{address:L.address,selected:"details"},null,8,["address"]),n("div",He,[n("div",Ge,[n("div",Oe,[e.err!=""?(m(),f("div",Re,i(e.err),1)):D("",!0)]),e.isMultisig?(m(),f("div",Xe,[e.walletCosignerList.length>0?(m(),f("div",qe,[n("div",ze,[se(i(l.$t("general.initiateBy"))+": ",1),e.walletCosignerList.length==1?(m(),f("span",Je,i(e.walletCosignerList[0].name),1)):(m(),f("span",Qe,[Te(n("select",{class:"","onUpdate:modelValue":c[0]||(c[0]=d=>e.selectedCosignPublicKey=d)},[(m(!0),f(Le,null,Ke(e.walletCosignerList,(d,x)=>(m(),f("option",{value:e.findAcc(d.publicKey).publicKey,key:x},i(d.name),9,Ye))),128))],512),[[Ie,e.selectedCosignPublicKey]])]))])])):D("",!0)])):D("",!0),e.delegateValue?(m(),f("div",it,[n("div",ct,i(l.$t("delegate.accDelegated")),1),n("div",dt,[ut,n("div",gt,i(l.$t("delegate.linked")),1)]),n("div",vt,[n("div",mt,i(l.$t("delegate.publicKeyOfDelegate")),1),P(k,{icon:"copy",onClick:c[2]||(c[2]=d=>e.copy("delegatePublicKey")),title:l.$t("general.copy"),class:"inline-block float-right mt-1 w-5 h-5 text-blue-link cursor-pointer"},null,8,["title"]),n("div",{class:"text-xs mt-0.5 font-semibold",id:"delegatePublicKey",copyValue:e.delegateAcc,copySubject:l.$t("delegate.delegatePublicKey")},i(e.delegateAcc),9,ft)])])):(m(),f("div",Ze,[n("div",$e,i(l.$t("general.delegate")),1),n("div",et,i(l.$t("delegate.notLinked")),1),tt,at,n("div",nt,[n("div",lt,i(l.$t("general.privateKey")),1),n("div",st,[n("div",{id:"private",class:"truncate text-xs mt-1 font-semibold",type:"text",copyValue:e.privateKey,copySubject:l.$t("general.privateKey")},i(e.privateKey),9,ot),P(k,{title:l.$t("general.copy"),icon:"copy",onClick:c[1]||(c[1]=d=>e.copy("private")),class:"ml-2 pb-1 w-5 h-5 text-blue-link mt-0.5 cursor-pointer"},null,8,["title"])]),n("div",rt,i(l.$t("general.pkWarning")),1)])]))]),n("div",bt,[P(K,{"fund-status":e.fundStatus,"is-multisig":e.isMultisig,"is-cosigner":e.isCosigner,"on-partial":e.onPartial,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFund,"lock-fund-tx-fee":e.lockFundTxFee,balance:e.accBalance,"selected-acc-add":e.selectedAccAdd},null,8,["fund-status","is-multisig","is-cosigner","on-partial","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),yt,n("div",pt,i(l.$t("general.enterPasswordContinue")),1),P(U,{placeholder:l.$t("general.enterPassword"),errorMessage:l.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":c[3]||(c[3]=d=>e.walletPassword=d)},null,8,["placeholder","errorMessage","showError","modelValue"]),n("div",_t,[e.delegateValue?(m(),f("button",{key:0,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:c[4]||(c[4]=(...d)=>e.createDelegate&&e.createDelegate(...d)),disabled:e.disableLinkBtn},i(l.$t("delegate.unlinkAcc")),9,ht)):D("",!0),e.delegateValue?D("",!0):(m(),f("button",{key:1,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:c[5]||(c[5]=(...d)=>e.createDelegate&&e.createDelegate(...d)),disabled:e.disableLinkBtn},i(l.$t("delegate.delegateAcc")),9,kt))]),n("div",wt,[P(o,{to:{name:"ViewAccountDetails",params:{address:L.address}},class:"content-center text-xs text-white underline"},{default:Fe(()=>[se(i(l.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Mt=ke(Ue,[["render",At]]);export{Mt as default};
