import{_ as Ke,j as Ue,k as Ve,g as i,w as D,H as j,A as f,c as y,n as G,B as Le,D as V,x as S,r as T,o as _,f as h,l as C,b as J,e as s,t as b,i as L,F as Q,K as ie,ay as Be,O as me,P as fe,s as We,E as je,W as pe}from"./index-ec24e299.js";import{_ as Oe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-9fd7d2c8.js";import{T as Re}from"./TextInput-cf4d1586.js";import{_ as qe,a as He}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-38214e82.js";import{T as ze}from"./TextInputClean-e1542c5e.js";import{M as X}from"./multisigUtils-ce075a8a.js";import{_ as Ze}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-12bf42c4.js";import{T as Ge}from"./TransactionLayout-0c31618b.js";import{_ as Je}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-9934b402.js";import{T as ce}from"./transactionState-bd4bb225.js";import{_ as Qe}from"./icon-delete-red-ce8ded12.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-67ac7cc6.js";import"./proximax-logo-ecfc3767.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-4d3f24f1.js";import"./jdenticon-module-708539e7.js";import"./functions-b5bd9b3c.js";import"./icon-key-5b3f7dda.js";const Xe={name:"ViewConvertAccountMultisig",components:{PasswordInput:Oe,TextInput:Re,TextInputClean:ze,SelectAccountAndContact:Ze,TransactionFeeDisplay:qe,AccTabLayout:Je,TransactionLayout:Ge},props:{address:String},setup(c){const{t:l}=Ue(),O=Ve();je().appContext.config.globalProperties.emitter;const w=i(""),N=i([]),B=i(""),K=i(!1),E=i(""),Y=i(!1),R="^[^ ]{8,}$",p=i(1),g=i(1),v=i(0),m=i(0),$="^[0-9A-Fa-f]{64}$",a=i([]),r=i([]),u=i([]),ee=i([]),A=i([]),te=i([]),W=i(!1),ge=i(!1),q=D.currentLoggedInWallet?D.currentLoggedInWallet.selectDefaultAccount():null,be=i(q?q.address:""),ye=i(j.toCurrencyFormat(q?q.balance:0,f.nativeToken.divisibility)),ae=y(()=>j.convertToCurrency(G.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility)),le=y(()=>G.currentNetworkProfile?j.convertToExact(Le.getLockFundFee(),f.nativeToken.divisibility):0),H=i(0),d=y(()=>D.currentLoggedInWallet?D.currentLoggedInWallet.accounts.find(t=>t.address===c.address):null);let oe=y(()=>{if(d.value)return X.checkIsMultiSig(d.value.address)}),z=()=>{d.value&&(H.value=X.getAggregateFee(d.value.publicKey,a.value,p.value,g.value))};z();const U=y(()=>{let t=f.nativeToken.divisibility;return t==0?Math.trunc(parseFloat(H.value)+parseFloat(ae.value)+le.value):Math.round((parseFloat(H.value)+parseFloat(ae.value)+le.value)*Math.pow(10,t))/Math.pow(10,t)}),_e=y(()=>f.nativeToken.label),he=y(()=>f.nativeToken.divisibility);y(()=>D.currentLoggedInWallet?j.toCurrencyFormat(d.value.balance,he.value):"0");const ue=y(()=>{if(!d.value)return!1;const t=D.currentLoggedInWallet;let o=t.accounts.map(x=>({name:x.name,publicKey:x.publicKey})),n=t.contacts;var k=[],F=0;return k.push({key:"0",label:l("general.ownerAcc"),selectable:!1,children:[]}),o.forEach(x=>{k[0].children.push({key:"0-"+F.toString(),label:x.name,data:x.publicKey}),F++}),F=0,k.push({key:"1",label:l("general.contact"),selectable:!1,children:[]}),n!=null&&n.forEach(x=>{k[1].children.push({key:"1-"+F.toString(),label:x.name,data:x.address}),F++}),k});function we(t,o){de(o),u.value[o]=t.label,t.key[0]=="1"?Ae(t.data,o):a.value[o]=t.data,a.value[o]=t.data,te.value[o]=!1,r.value[o][t.key]=!0,t.selectable=!1}function Ae(t,o){try{X.verifyContactPublicKey(t).then(n=>{n.status==!0?a.value[o]=n.publicKey:w.value=l("multisig.noPublicKey")})}catch{w.value=l("multisig.noPublicKey")}}const de=t=>{if(Object.keys(r.value[t]).length!==0){let o=Object.keys(r.value[t])[0].split("-");ue.value[o[0]].children[o[1]].selectable=!0,r.value[t]={}}},ke=y(()=>oe.value||W.value||!E.value.match(R)||a.value.length==0||w.value||A.value.every(t=>t==!1)==!1||g.value==0||p.value==0||d.value.balance<U.value),xe=y(()=>{if(!d.value)return!1;var t=!1;if(d.value.balance>=U.value&&!W.value){for(var o=0;o<a.value.length;o++)if(A.value[o]!=""){t=!0;break}else if(a.value[o].length<40){t=!0;break}}else t=!0;return t}),ve=()=>{a.value=[],ee.value=[],A.value=[],E.value="",p.value=1,v.value=0,g.value=1,m.value=0,N.value=[]},Te=async()=>{const t=D.currentLoggedInWallet;if(!pe.verifyWalletPassword(t.name,G.chainNetworkName,E.value))B.value=l("general.walletPasswordInvalid",{name:D.currentLoggedInWallet.name});else{const n=[],k=t.accounts.find(M=>M.name===d.value.name);if(!k)throw new Error("Account not found");const F=pe.decryptPrivateKey(new S.Password(E.value),k.encrypted,k.iv),x=S.Account.createFromPrivateKey(F,f.networkType,1);if(!f.chainAPI)throw new Error("Service unavailable");let Z=null;for(const M of a.value){if(M.length==64)Z=S.PublicAccount.createFromPublicKey(M,f.networkType);else if(M.length==40||M.length==46){const Me=S.Address.createFromRawAddress(M);try{const re=await f.chainAPI.accountAPI.getAccountInfo(Me);Z=S.PublicAccount.createFromPublicKey(re.publicKey,f.networkType)}catch(re){console.log(re)}}Z&&n.push(new S.MultisigCosignatoryModification(S.MultisigCosignatoryModificationType.Add,Z))}if(!f.buildTxn)throw new Error("Service unavailable");const Ee=f.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(p.value).minRemovalDelta(g.value).modifications(n).build();B.value="",ve(),ce.unsignedTransactionPayload=Ee.serialize(),ce.selectedAddress=d.value.address,ce.selectedMultisigAddress=x.address.plain(),O.push({name:"ViewConfirmTransaction"})}};V(()=>[...a.value],async t=>{let o=!1;if(a.value.length>0)for(var n=0;n<a.value.length;n++)a.value[n].length==64?a.value[n]==d.value.publicKey&&o==!1?(o=!0,A.value[n]=!0,w.value=l("multisig.selectedAccErr")):!a.value[n].match($)&&a.value[n].length==64?A.value[n]=!0:(A.value[n]=!1,Array.from(new Set(t)).length!=t.length?w.value=l("multisig.duplicatedCosigner"):o==!1&&(w.value="",await De(a.value[n])||N.value.includes(a.value[n])||N.value.push(a.value[n]))):A.value[n]=!0;else w.value=""},{deep:!0}),V(()=>[...A.value],t=>{t.every(o=>o==!1)&&z()},{deep:!0});const Ce=()=>{a.value.push(""),r.value.push({}),A.value.push(!1),v.value+=1,m.value+=1},Pe=(t,o)=>{v.value>0&&(v.value-=1),m.value>0&&(m.value-=1),g.value>m.value&&(g.value=m.value),p.value>v.value&&(p.value=v.value),de(o),a.value.splice(o,1),r.value.splice(o,1),u.value.splice(o,1),te.value.splice(o,1),ee.value.splice(o,1),A.value.splice(o,1);for(let n=0;n<N.value.length;n++)t===N.value[n]&&N.value.splice(n,1)},Se=t=>{p.value*10*~~(v.value/10)+t.charCode-48>v.value&&t.preventDefault()};let se=l("multisig.deletionExceedMax"),ne=l("multisig.approvalExceedMax"),P="";V(p,t=>{z(),v.value==0&&t>1||t>v.value&&t!=1&&v.value!=0?P=ne:v.value>0&&t<=0?P=l("multisig.approvalAtLeastOne"):g.value>m.value&&g.value!=1&&m.value!=0?P=se:P=""});const Ne=t=>{g.value*10*~~(m.value/10)+t.charCode-48>m.value&&t.preventDefault()};let I="";V(g,t=>{z(),m.value==0&&t>1||t>m.value&&t!=1&&m.value!=0?I=se:m.value>0&&t<=0?I=l("multisig.deletionAtLeastOne"):p.value>v.value&&p.value!=1&&v.value!=0?I=ne:I=""}),V([p,g],()=>{P!=""&&I!=""?w.value=P+`
`+I:P!=""?w.value=P:w.value=I});const Ie=y(()=>W.value||oe.value);d.value&&X.onPartial(S.PublicAccount.createFromPublicKey(d.value.publicKey,f.networkType)).then(t=>W.value=t),d.value&&d.value.balance<U.value&&(K.value=!0),V(d,t=>{t&&(t.balance<U.value?K.value=!0:K.value=!1)});const Fe=y(()=>j.amountFormatterSimple(U.value,0)),De=async t=>{const o=S.PublicAccount.createFromPublicKey(t,f.networkType);try{return!!await f.chainAPI.accountAPI.getAccountInfo(o.address)}catch{return!1}};return{networkState:G,toggleContact:te,contact:ue,space:ge,currentNativeTokenName:_e,contactName:u,err:w,disableSend:ke,numApproveTransaction:p,numDeleteUser:g,maxNumApproveTransaction:v,maxNumDeleteUser:m,fundStatus:K,acc:d,passwd:E,showPasswdError:Y,showAddressError:A,addCoSig:Ce,coSign:a,addCoSigButton:xe,selectedNode:r,deleteCoSigAddressInput:Pe,onNodeSelect:we,selectedAddresses:ee,clear:ve,convertAccount:Te,disabledPassword:Ie,onPartial:W,isMultisig:oe,passwdPattern:R,validateApproval:Se,validateDelete:Ne,lockFundCurrency:ae,lockFundTxFee:le,aggregateFee:H,totalFee:U,totalFeeFormatted:Fe,selectedAccAdd:be,accBalance:ye,passwordErr:B,pkNotExistArray:N}}},Ye={class:"text-xs font-semibold"},$e={key:0,class:"error error_box mb-5 whitespace-pre"},et={key:1},tt={key:0,class:"flex gap-2 bg-yellow-50 py-2 rounded-md px-2 my-3"},at={class:"text-xs font-bold pt-1"},lt={key:2,class:"error error_box mb-5"},ot={class:"flex flex-col gap-2 ml-[-24px]"},st={class:"flex"},nt=["onClick"],rt={key:0,class:"mt-16"},it=["onClick"],ct={class:"text-xxs text-blue-primary font-semibold uppercase"},ut={key:0},dt=["disabled"],vt={class:"text-xs font-semibold mb-3"},mt={class:"flex gap-2"},ft={class:"border w-6/12"},pt={class:"border-b-2 text-xxs text-center py-1 uppercase"},gt={class:"flex justify-around"},bt=["disabled"],yt=["max"],_t=["disabled"],ht={class:"text-xxs border-t-2 text-center py-1 uppercase"},wt={class:"border w-6/12"},At={class:"border-b-2 text-xxs text-center py-1 uppercase"},kt={class:"flex justify-around"},xt=["disabled"],Tt=["max"],Ct=["disabled"],Pt={class:"text-xxs border-t-2 text-center py-1 uppercase"},St={class:"text-xs font-semibold my-3"},Nt={class:"mt-3"},It=["disabled"],Ft={class:"text-center"};function Dt(c,l,O,e,w,N){const B=T("AccTabLayout"),K=T("TextInput"),E=T("TextInputClean"),Y=T("font-awesome-icon"),R=T("SelectAccountAndContact"),p=T("Sidebar"),g=T("PasswordInput"),v=T("TransactionFeeDisplay"),m=T("router-link"),$=T("TransactionLayout");return _(),h(Q,null,[C(B,{address:O.address,selected:"multisig"},null,8,["address"]),C($,null,{white:J(()=>[s("div",Ye,b(c.$t("multisig.manageCosignatories")),1),s("div",null,[e.err!=""?(_(),h("div",$e,b(e.err),1)):L("",!0),e.pkNotExistArray.length>0?(_(),h("div",et,[(_(!0),h(Q,null,ie(e.pkNotExistArray,a=>(_(),h("div",null,[(_(!0),h(Q,null,ie(e.coSign,(r,u)=>(_(),h("div",{key:u},[a===r?(_(),h("div",tt,[l[11]||(l[11]=s("img",{src:He,class:"w-5 h-5"},null,-1)),s("div",at,b(e.contactName[u]?e.contactName[u]:c.$t("multisig.cosignatory")+`${u+1}`)+"'s public key does not exist ",1)])):L("",!0)]))),128))]))),256))])):L("",!0),e.passwordErr!=""?(_(),h("div",lt,b(e.passwordErr),1)):L("",!0)]),l[12]||(l[12]=s("div",{class:"mt-4"},null,-1)),s("div",ot,[(_(!0),h(Q,null,ie(e.coSign,(a,r)=>(_(),h("div",{key:r},[s("div",st,[s("img",{src:Qe,onClick:u=>e.deleteCoSigAddressInput(a,r),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,nt),C(K,{class:"w-5/12 mr-2",placeholder:c.$t("multisig.cosignatory")+`${r+1}`,modelValue:e.contactName[r],"onUpdate:modelValue":u=>e.contactName[r]=u,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),C(E,{class:"w-7/12 mr-2",placeholder:c.$t("general.publicKey"),errorMessage:c.$t("general.invalidInput"),showError:e.showAddressError[r],modelValue:e.coSign[r],"onUpdate:modelValue":u=>e.coSign[r]=u},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),e.showAddressError[r]==!0?(_(),h("div",rt)):L("",!0),s("div",{onClick:u=>e.toggleContact[r]=!e.toggleContact[r],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[C(Y,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),s("div",ct,b(c.$t("general.select")),1)],8,it)]),e.toggleContact[r]?(_(),h("div",ut,[C(p,{visible:e.toggleContact[r],"onUpdate:visible":u=>e.toggleContact[r]=u,baseZIndex:1e4,position:"full"},{default:J(()=>[C(R,Be({ref_for:!0},r,{contacts:e.contact,index:r,selectedNode:e.selectedNode[r],onNodeSelect:u=>e.onNodeSelect(u,r)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):L("",!0)]))),128))]),s("button",{class:"font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:l[0]||(l[0]=(...a)=>e.addCoSig&&e.addCoSig(...a)),disabled:e.addCoSigButton}," +"+b(c.$t("multisig.addNewCosignatory")),9,dt),l[13]||(l[13]=s("div",{class:"my-7 gray-line"},null,-1)),s("div",vt,b(c.$t("general.scheme")),1),s("div",mt,[s("div",ft,[s("div",pt,b(c.$t("multisig.transactionsApproval")),1),s("div",gt,[s("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[1]||(l[1]=a=>e.numApproveTransaction--),disabled:e.numApproveTransaction<=0}," - ",8,bt),me(s("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[2]||(l[2]=(...a)=>e.validateApproval&&e.validateApproval(...a)),max:e.maxNumApproveTransaction,"onUpdate:modelValue":l[3]||(l[3]=a=>e.numApproveTransaction=a)},null,40,yt),[[fe,e.numApproveTransaction]]),s("button",{class:"text-blue-primary disabled:opacity-50",disabled:e.numApproveTransaction>=e.maxNumApproveTransaction,onClick:l[4]||(l[4]=a=>e.numApproveTransaction++)}," + ",8,_t)]),s("div",ht,b(c.$t("multisig.ofCosignatories",{value:e.maxNumApproveTransaction})),1)]),s("div",wt,[s("div",At,b(c.$t("multisig.accountDeletionApproval")),1),s("div",kt,[s("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[5]||(l[5]=a=>e.numDeleteUser--),disabled:e.numDeleteUser<=0}," - ",8,xt),me(s("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[6]||(l[6]=(...a)=>e.validateDelete&&e.validateDelete(...a)),max:e.maxNumDeleteUser,"onUpdate:modelValue":l[7]||(l[7]=a=>e.numDeleteUser=a)},null,40,Tt),[[fe,e.numDeleteUser]]),s("button",{class:"text-blue-primary disabled:opacity-50",disabled:e.numDeleteUser>=e.maxNumDeleteUser,onClick:l[8]||(l[8]=a=>e.numDeleteUser++)}," + ",8,Ct)]),s("div",Pt,b(c.$t("multisig.ofCosignatories",{value:e.maxNumDeleteUser})),1)])]),s("div",null,[s("div",St,b(c.$t("general.enterPasswordContinue")),1),C(g,{placeholder:c.$t("general.enterPassword"),errorMessage:c.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.passwd,"onUpdate:modelValue":l[9]||(l[9]=a=>e.passwd=a),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"])])]),navy:J(()=>[C(v,{"fund-status":e.fundStatus,"is-multisig-already":e.isMultisig,"on-partial":e.onPartial,"transaction-fee":String(e.aggregateFee),"total-fee-formatted":e.totalFeeFormatted,"lock-fund-currency-convert":e.lockFundCurrency,"lock-fund-tx-fee-convert":String(e.lockFundTxFee),balance:e.accBalance,"selected-acc-add":e.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),l[14]||(l[14]=s("div",{class:"mt-5"},null,-1)),s("div",Nt,[s("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:l[10]||(l[10]=a=>e.convertAccount()),disabled:e.disableSend},b(c.$t("multisig.updateCosignatories")),9,It)]),s("div",Ft,[C(m,{to:{name:"ViewMultisigHome",params:{address:O.address}},class:"content-center text-xs text-white underline"},{default:J(()=>[We(b(c.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}const Xt=Ke(Xe,[["render",Dt],["__scopeId","data-v-666aebc0"]]);export{Xt as default};
