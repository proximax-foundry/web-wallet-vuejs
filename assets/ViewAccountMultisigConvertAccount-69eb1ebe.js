import{_ as Ke,u as Le,l as Be,r as i,w as N,H as O,B as m,c as y,n as Z,S as de,a as K,z as x,i as k,o as F,b as D,e as l,m as C,t as g,f as j,F as We,g as Oe,v as ve,ar as je,O as me,R as pe,x as Re,h as He,W as fe,I as qe,J as ze}from"./index-ab4a1fbf.js";import{_ as Je}from"./PasswordInput.vue_vue_type_script_setup_true_lang-ec55dd11.js";import{T as Ze}from"./TextInput-2965e4c9.js";import{_ as Ge,a as Qe}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-ec0f9c77.js";import{T as Xe}from"./TextInputClean-d9007778.js";import{M as G}from"./multisigUtils-d47a13d9.js";import{_ as Ye}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-9c30b59c.js";import{A as $e,_ as et}from"./AccountTabs.vue_vue_type_script_setup_true_lang-77b76db8.js";import{T as re}from"./transactionState-6b014791.js";import{_ as tt}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-2d250a76.js";import"./functions-a2eba521.js";import"./icon-key-5b3f7dda.js";const at={name:"ViewConvertAccountMultisig",components:{PasswordInput:Je,TextInput:Ze,TextInputClean:Xe,SelectAccountAndContact:Ye,AccountComponent:$e,AccountTabs:et,TransactionFeeDisplay:Ge},props:{address:String},setup(c){const{t:o}=Le(),L=Be();He().appContext.config.globalProperties.emitter;const _=i(""),M=i(""),B=i(""),U=i(!1),I=i(""),X=i(!1),R="^[^ ]{8,}$",p=i(1),f=i(1),d=i(0),v=i(0),Y="^[0-9A-Fa-f]{64}$",a=i([]),n=i([]),b=i([]),$=i([]),h=i([]),ee=i([]),W=i(!1),ge=i(!1),H=N.currentLoggedInWallet?N.currentLoggedInWallet.selectDefaultAccount():null,be=i(H?H.address:""),ye=i(O.toCurrencyFormat(H?H.balance:0,m.nativeToken.divisibility)),te=y(()=>O.convertToCurrency(Z.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility)),ae=y(()=>Z.currentNetworkProfile?O.convertToExact(de.getLockFundFee(),m.nativeToken.divisibility):0),q=i(0),u=y(()=>N.currentLoggedInWallet?N.currentLoggedInWallet.accounts.find(e=>e.address===c.address):null);let le=y(()=>{if(u.value)return G.checkIsMultiSig(u.value.address)}),z=()=>{u.value&&(q.value=G.getAggregateFee(u.value.publicKey,a.value,p.value,f.value))};z();const V=y(()=>{let e=m.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(q.value)+parseFloat(te.value)+ae.value):Math.round((parseFloat(q.value)+parseFloat(te.value)+ae.value)*Math.pow(10,e))/Math.pow(10,e)}),_e=y(()=>m.nativeToken.label),he=y(()=>m.nativeToken.divisibility);y(()=>N.currentLoggedInWallet?O.toCurrencyFormat(u.value.balance,he.value):"0");const ce=y(()=>{if(!u.value)return!1;const e=N.currentLoggedInWallet;let s=e.accounts.map(A=>({name:A.name,publicKey:A.publicKey})),r=e.contacts;var P=[],w=0;return P.push({key:"0",label:o("general.ownerAcc"),selectable:!1,children:[]}),s.forEach(A=>{P[0].children.push({key:"0-"+w.toString(),label:A.name,data:A.publicKey}),w++}),w=0,P.push({key:"1",label:o("general.contact"),selectable:!1,children:[]}),r!=null&&r.forEach(A=>{P[1].children.push({key:"1-"+w.toString(),label:A.name,data:A.address}),w++}),P});function we(e,s){ie(s),b.value[s]=e.label,e.key[0]=="1"?Ae(e.data,s):a.value[s]=e.data,a.value[s]=e.data,ee.value[s]=!1,n.value[s][e.key]=!0,e.selectable=!1}function Ae(e,s){try{G.verifyContactPublicKey(e).then(r=>{r.status==!0?a.value[s]=r.publicKey:_.value=o("multisig.noPublicKey")})}catch{_.value=o("multisig.noPublicKey")}}const ie=e=>{if(Object.keys(n.value[e]).length!==0){let s=Object.keys(n.value[e])[0].split("-");ce.value[s[0]].children[s[1]].selectable=!0,n.value[e]={}}},xe=y(()=>le.value||W.value||!I.value.match(R)||a.value.length==0||_.value||h.value.every(e=>e==!1)==!1||f.value==0||p.value==0||u.value.balance<V.value),ke=y(()=>{if(!u.value)return!1;var e=!1;if(u.value.balance>=V.value&&!W.value){for(var s=0;s<a.value.length;s++)if(h.value[s]!=""){e=!0;break}else if(a.value[s].length<40){e=!0;break}}else e=!0;return e}),ue=()=>{a.value=[],$.value=[],h.value=[],I.value="",p.value=1,d.value=0,f.value=1,v.value=0,M.value=""},Ce=async()=>{const e=N.currentLoggedInWallet;if(!fe.verifyWalletPassword(e.name,Z.chainNetworkName,I.value))B.value=o("general.walletPasswordInvalid",{name:N.currentLoggedInWallet.name});else{let r={};const P=[],w=e.accounts.find(E=>E.name===u.value.name);if(!w)throw new Error("Account not found");const A=fe.decryptPrivateKey(new x.Password(I.value),w.encrypted,w.iv),Ee=x.Account.createFromPrivateKey(A,m.networkType,1);if(!m.chainAPI)throw new Error("Service unavailable");let J=null;for(const E of a.value){if(E.length==64)J=x.PublicAccount.createFromPublicKey(E,m.networkType);else if(E.length==40||E.length==46){const Ve=x.Address.createFromRawAddress(E);try{const ne=await m.chainAPI.accountAPI.getAccountInfo(Ve);J=x.PublicAccount.createFromPublicKey(ne.publicKey,m.networkType)}catch(ne){console.log(ne)}}J&&P.push(new x.MultisigCosignatoryModification(x.MultisigCosignatoryModificationType.Add,J))}if(!m.buildTxn)throw new Error("Service unavailable");const Me=m.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(p.value).minRemovalDelta(f.value).modifications(P).build(),Ue=await m.chainAPI.nodeAPI.getNodeTime();r=de.signTxnWithPassword(u.value.address,Ee.address.plain(),I.value,Me,new x.UInt64(Ue.sendTimeStamp)),B.value="",ue(),re.lockHashPayload=r.hashLockTxnPayload,re.transactionPayload=r.txnPayload,re.selectedAddress=c.address,L.push({name:"ViewConfirmTransaction"})}};K(()=>[...a.value],async e=>{let s=!1;if(M.value="",a.value.length>0)for(var r=0;r<a.value.length;r++)a.value[r].length==64?a.value[r]==u.value.publicKey&&s==!1?(s=!0,h.value[r]=!0,_.value=o("multisig.selectedAccErr")):!a.value[r].match(Y)&&a.value[r].length==64?h.value[r]=!0:(h.value[r]=!1,Array.from(new Set(e)).length!=e.length?_.value=o("multisig.duplicatedCosigner"):s==!1&&(_.value="",await De(a.value[r])?M.value="":M.value="Input public key does not exist")):h.value[r]=!0;else _.value=""},{deep:!0}),K(()=>[...h.value],e=>{e.every(s=>s==!1)&&z()},{deep:!0});const Te=()=>{a.value.push(""),n.value.push({}),h.value.push(!1),d.value+=1,v.value+=1},Pe=e=>{d.value>0&&(d.value-=1),v.value>0&&(v.value-=1),f.value>v.value&&(f.value=v.value),p.value>d.value&&(p.value=d.value),ie(e),a.value.splice(e,1),n.value.splice(e,1),b.value.splice(e,1),ee.value.splice(e,1),$.value.splice(e,1),h.value.splice(e,1)},Ie=e=>{p.value*10*~~(d.value/10)+e.charCode-48>d.value&&e.preventDefault()};let oe=o("multisig.deletionExceedMax"),se=o("multisig.approvalExceedMax"),T="";K(p,e=>{z(),d.value==0&&e>1||e>d.value&&e!=1&&d.value!=0?T=se:d.value>0&&e<=0?T=o("multisig.approvalAtLeastOne"):f.value>v.value&&f.value!=1&&v.value!=0?T=oe:T=""});const Se=e=>{f.value*10*~~(v.value/10)+e.charCode-48>v.value&&e.preventDefault()};let S="";K(f,e=>{z(),v.value==0&&e>1||e>v.value&&e!=1&&v.value!=0?S=oe:v.value>0&&e<=0?S=o("multisig.deletionAtLeastOne"):p.value>d.value&&p.value!=1&&d.value!=0?S=se:S=""}),K([p,f],()=>{T!=""&&S!=""?_.value=T+`
`+S:T!=""?_.value=T:_.value=S});const Ne=y(()=>W.value||le.value);u.value&&G.onPartial(x.PublicAccount.createFromPublicKey(u.value.publicKey,m.networkType)).then(e=>W.value=e),u.value&&u.value.balance<V.value&&(U.value=!0),K(u,e=>{e&&(e.balance<V.value?U.value=!0:U.value=!1)});const Fe=y(()=>O.amountFormatterSimple(V.value,0)),De=async e=>{const s=x.PublicAccount.createFromPublicKey(e,m.networkType);try{return!!await m.chainAPI.accountAPI.getAccountInfo(s.address)}catch{return!1}};return{networkState:Z,toggleContact:ee,contact:ce,space:ge,currentNativeTokenName:_e,contactName:b,err:_,disableSend:xe,numApproveTransaction:p,numDeleteUser:f,maxNumApproveTransaction:d,maxNumDeleteUser:v,fundStatus:U,acc:u,passwd:I,showPasswdError:X,showAddressError:h,addCoSig:Te,coSign:a,addCoSigButton:ke,selectedNode:n,deleteCoSigAddressInput:Pe,onNodeSelect:we,selectedAddresses:$,clear:ue,convertAccount:Ce,disabledPassword:Ne,onPartial:W,isMultisig:le,passwdPattern:R,validateApproval:Ie,validateDelete:Se,lockFundCurrency:te,lockFundTxFee:ae,aggregateFee:q,totalFee:V,totalFeeFormatted:Fe,selectedAccAdd:be,accBalance:ye,passwordErr:B,inputPkNotExist:M}}},Q=c=>(qe("data-v-cf42beab"),c=c(),ze(),c),lt={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},ot={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},st={class:"lg:col-span-2 py-6 pr-6"},nt={class:"text-xs font-semibold pl-6"},rt={class:"pl-6"},ct={key:0,class:"error error_box mb-5 whitespace-pre"},it={key:1,class:"flex gap-2 bg-yellow-50 py-2 rounded-md px-2 my-3 mb-5"},ut=Q(()=>l("img",{src:Qe,class:"w-5 h-5"},null,-1)),dt={class:"text-xs font-bold pt-1"},vt={key:2,class:"error error_box mb-5"},mt=Q(()=>l("div",{class:"mt-4"},null,-1)),pt={class:"flex flex-col gap-2"},ft={class:"flex"},gt=["onClick"],bt={key:0,class:"mt-16"},yt=["onClick"],_t={class:"text-xxs text-blue-primary font-semibold uppercase"},ht={key:0},wt=["disabled"],At=Q(()=>l("div",{class:"ml-6 my-7 gray-line"},null,-1)),xt={class:"pl-6 text-xs font-semibold mb-3"},kt={class:"flex gap-2 pl-6"},Ct={class:"border w-6/12"},Tt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Pt={class:"flex justify-around"},It=["disabled"],St=["max"],Nt=["disabled"],Ft={class:"text-xxs border-t-2 text-center py-1 uppercase"},Dt={class:"border w-6/12"},Et={class:"border-b-2 text-xxs text-center py-1 uppercase"},Mt={class:"flex justify-around"},Ut=["disabled"],Vt=["max"],Kt=["disabled"],Lt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Bt={class:"bg-navy-primary p-6 lg:col-span-1"},Wt=Q(()=>l("div",{class:"mt-5"},null,-1)),Ot={class:"font-semibold text-xs text-white mb-1.5"},jt={class:"mt-3"},Rt=["disabled"],Ht={class:"text-center"};function qt(c,o,L,t,_,M){const B=k("AccountComponent"),U=k("AccountTabs"),I=k("TextInput"),X=k("TextInputClean"),R=k("font-awesome-icon"),p=k("SelectAccountAndContact"),f=k("Sidebar"),d=k("TransactionFeeDisplay"),v=k("PasswordInput"),Y=k("router-link");return F(),D("div",null,[l("div",lt,[C(B,{address:L.address,class:"mb-6"},null,8,["address"]),C(U,{address:L.address,selected:"multisig"},null,8,["address"]),l("div",ot,[l("div",st,[l("div",nt,g(c.$t("multisig.manageCosignatories")),1),l("div",rt,[t.err!=""?(F(),D("div",ct,g(t.err),1)):j("",!0),t.inputPkNotExist!=""?(F(),D("div",it,[ut,l("div",dt,g(t.inputPkNotExist),1)])):j("",!0),t.passwordErr!=""?(F(),D("div",vt,g(t.passwordErr),1)):j("",!0)]),mt,l("div",pt,[(F(!0),D(We,null,Oe(t.coSign,(a,n)=>(F(),D("div",{key:n},[l("div",ft,[l("img",{src:tt,onClick:b=>t.deleteCoSigAddressInput(n),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,gt),C(I,{class:"w-5/12 mr-2",placeholder:c.$t("multisig.cosignatory")+`${n+1}`,modelValue:t.contactName[n],"onUpdate:modelValue":b=>t.contactName[n]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),C(X,{class:"w-7/12 mr-2",placeholder:c.$t("general.publicKey"),errorMessage:c.$t("general.invalidInput"),showError:t.showAddressError[n],modelValue:t.coSign[n],"onUpdate:modelValue":b=>t.coSign[n]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[n]==!0?(F(),D("div",bt)):j("",!0),l("div",{onClick:b=>t.toggleContact[n]=!t.toggleContact[n],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[C(R,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),l("div",_t,g(c.$t("general.select")),1)],8,yt)]),t.toggleContact[n]?(F(),D("div",ht,[C(f,{visible:t.toggleContact[n],"onUpdate:visible":b=>t.toggleContact[n]=b,baseZIndex:1e4,position:"full"},{default:ve(()=>[C(p,je(n,{contacts:t.contact,index:n,selectedNode:t.selectedNode[n],onNodeSelect:b=>t.onNodeSelect(b,n)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):j("",!0)]))),128))]),l("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:o[0]||(o[0]=(...a)=>t.addCoSig&&t.addCoSig(...a)),disabled:t.addCoSigButton},"+"+g(c.$t("multisig.addNewCosignatory")),9,wt),At,l("div",xt,g(c.$t("general.scheme")),1),l("div",kt,[l("div",Ct,[l("div",Tt,g(c.$t("multisig.transactionsApproval")),1),l("div",Pt,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[1]||(o[1]=a=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,It),me(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[2]||(o[2]=(...a)=>t.validateApproval&&t.validateApproval(...a)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":o[3]||(o[3]=a=>t.numApproveTransaction=a)},null,40,St),[[pe,t.numApproveTransaction]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:o[4]||(o[4]=a=>t.numApproveTransaction++)},"+",8,Nt)]),l("div",Ft,g(c.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),l("div",Dt,[l("div",Et,g(c.$t("multisig.accountDeletionApproval")),1),l("div",Mt,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[5]||(o[5]=a=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,Ut),me(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[6]||(o[6]=(...a)=>t.validateDelete&&t.validateDelete(...a)),max:t.maxNumDeleteUser,"onUpdate:modelValue":o[7]||(o[7]=a=>t.numDeleteUser=a)},null,40,Vt),[[pe,t.numDeleteUser]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:o[8]||(o[8]=a=>t.numDeleteUser++)},"+",8,Kt)]),l("div",Lt,g(c.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),l("div",Bt,[C(d,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),Wt,l("div",Ot,g(c.$t("general.enterPasswordContinue")),1),C(v,{placeholder:c.$t("general.enterPassword"),errorMessage:c.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":o[9]||(o[9]=a=>t.passwd=a),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),l("div",jt,[l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:o[10]||(o[10]=a=>t.convertAccount()),disabled:t.disableSend},g(c.$t("multisig.updateCosignatories")),9,Rt)]),l("div",Ht,[C(Y,{to:{name:"ViewMultisigHome",params:{address:L.address}},class:"content-center text-xs text-white underline"},{default:ve(()=>[Re(g(c.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const ra=Ke(at,[["render",qt],["__scopeId","data-v-cf42beab"]]);export{ra as default};
