import{_ as Ve,j as Ke,k as Le,g as c,w as D,H as j,A as f,c as y,n as Q,B as Be,D as K,x as I,r as T,o as _,f as h,l as C,b as Z,e as s,t as b,i as L,F as G,M as ce,aB as We,Q as fe,R as pe,s as je,E as Oe,W as ge,I as Re,J as qe}from"./index-ac085045.js";import{_ as He}from"./PasswordInput.vue_vue_type_script_setup_true_lang-354fad8f.js";import{T as ze}from"./TextInput-f71c8b4b.js";import{_ as Je,a as Qe}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-975bab2a.js";import{T as Ze}from"./TextInputClean-6fd2d429.js";import{M as X}from"./multisigUtils-b7840722.js";import{_ as Ge}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-76b4b93c.js";import{T as Xe}from"./TransactionLayout-5136d917.js";import{_ as Ye}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-e6575e15.js";import{T as ue}from"./transactionState-90b266b3.js";import{_ as $e}from"./icon-delete-red-ce8ded12.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-4c592bc8.js";import"./proximax-logo-ecfc3767.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-d29b9a74.js";import"./jdenticon-module-2a95d186.js";import"./functions-c0137ee2.js";import"./icon-key-5b3f7dda.js";const et={name:"ViewConvertAccountMultisig",components:{PasswordInput:He,TextInput:ze,TextInputClean:Ze,SelectAccountAndContact:Ge,TransactionFeeDisplay:Je,AccTabLayout:Ye,TransactionLayout:Xe},props:{address:String},setup(i){const{t:o}=Ke(),O=Le();Oe().appContext.config.globalProperties.emitter;const w=c(""),P=c([]),B=c(""),U=c(!1),E=c(""),$=c(!1),R="^[^ ]{8,}$",p=c(1),g=c(1),v=c(0),m=c(0),ee="^[0-9A-Fa-f]{64}$",a=c([]),r=c([]),u=c([]),te=c([]),A=c([]),ae=c([]),W=c(!1),be=c(!1),q=D.currentLoggedInWallet?D.currentLoggedInWallet.selectDefaultAccount():null,ye=c(q?q.address:""),_e=c(j.toCurrencyFormat(q?q.balance:0,f.nativeToken.divisibility)),le=y(()=>j.convertToCurrency(Q.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility)),oe=y(()=>Q.currentNetworkProfile?j.convertToExact(Be.getLockFundFee(),f.nativeToken.divisibility):0),H=c(0),d=y(()=>D.currentLoggedInWallet?D.currentLoggedInWallet.accounts.find(t=>t.address===i.address):null);let se=y(()=>{if(d.value)return X.checkIsMultiSig(d.value.address)}),z=()=>{d.value&&(H.value=X.getAggregateFee(d.value.publicKey,a.value,p.value,g.value))};z();const V=y(()=>{let t=f.nativeToken.divisibility;return t==0?Math.trunc(parseFloat(H.value)+parseFloat(le.value)+oe.value):Math.round((parseFloat(H.value)+parseFloat(le.value)+oe.value)*Math.pow(10,t))/Math.pow(10,t)}),he=y(()=>f.nativeToken.label),we=y(()=>f.nativeToken.divisibility);y(()=>D.currentLoggedInWallet?j.toCurrencyFormat(d.value.balance,we.value):"0");const de=y(()=>{if(!d.value)return!1;const t=D.currentLoggedInWallet;let l=t.accounts.map(x=>({name:x.name,publicKey:x.publicKey})),n=t.contacts;var k=[],F=0;return k.push({key:"0",label:o("general.ownerAcc"),selectable:!1,children:[]}),l.forEach(x=>{k[0].children.push({key:"0-"+F.toString(),label:x.name,data:x.publicKey}),F++}),F=0,k.push({key:"1",label:o("general.contact"),selectable:!1,children:[]}),n!=null&&n.forEach(x=>{k[1].children.push({key:"1-"+F.toString(),label:x.name,data:x.address}),F++}),k});function Ae(t,l){ve(l),u.value[l]=t.label,t.key[0]=="1"?ke(t.data,l):a.value[l]=t.data,a.value[l]=t.data,ae.value[l]=!1,r.value[l][t.key]=!0,t.selectable=!1}function ke(t,l){try{X.verifyContactPublicKey(t).then(n=>{n.status==!0?a.value[l]=n.publicKey:w.value=o("multisig.noPublicKey")})}catch{w.value=o("multisig.noPublicKey")}}const ve=t=>{if(Object.keys(r.value[t]).length!==0){let l=Object.keys(r.value[t])[0].split("-");de.value[l[0]].children[l[1]].selectable=!0,r.value[t]={}}},xe=y(()=>se.value||W.value||!E.value.match(R)||a.value.length==0||w.value||A.value.every(t=>t==!1)==!1||g.value==0||p.value==0||d.value.balance<V.value),Te=y(()=>{if(!d.value)return!1;var t=!1;if(d.value.balance>=V.value&&!W.value){for(var l=0;l<a.value.length;l++)if(A.value[l]!=""){t=!0;break}else if(a.value[l].length<40){t=!0;break}}else t=!0;return t}),me=()=>{a.value=[],te.value=[],A.value=[],E.value="",p.value=1,v.value=0,g.value=1,m.value=0,P.value=[]},Ce=async()=>{const t=D.currentLoggedInWallet;if(!ge.verifyWalletPassword(t.name,Q.chainNetworkName,E.value))B.value=o("general.walletPasswordInvalid",{name:D.currentLoggedInWallet.name});else{const n=[],k=t.accounts.find(M=>M.name===d.value.name);if(!k)throw new Error("Account not found");const F=ge.decryptPrivateKey(new I.Password(E.value),k.encrypted,k.iv),x=I.Account.createFromPrivateKey(F,f.networkType,1);if(!f.chainAPI)throw new Error("Service unavailable");let J=null;for(const M of a.value){if(M.length==64)J=I.PublicAccount.createFromPublicKey(M,f.networkType);else if(M.length==40||M.length==46){const Ue=I.Address.createFromRawAddress(M);try{const ie=await f.chainAPI.accountAPI.getAccountInfo(Ue);J=I.PublicAccount.createFromPublicKey(ie.publicKey,f.networkType)}catch(ie){console.log(ie)}}J&&n.push(new I.MultisigCosignatoryModification(I.MultisigCosignatoryModificationType.Add,J))}if(!f.buildTxn)throw new Error("Service unavailable");const Me=f.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(p.value).minRemovalDelta(g.value).modifications(n).build();B.value="",me(),ue.unsignedTransactionPayload=Me.serialize(),ue.selectedAddress=d.value.address,ue.selectedMultisigAddress=x.address.plain(),O.push({name:"ViewConfirmTransaction"})}};K(()=>[...a.value],async t=>{let l=!1;if(a.value.length>0)for(var n=0;n<a.value.length;n++)a.value[n].length==64?a.value[n]==d.value.publicKey&&l==!1?(l=!0,A.value[n]=!0,w.value=o("multisig.selectedAccErr")):!a.value[n].match(ee)&&a.value[n].length==64?A.value[n]=!0:(A.value[n]=!1,Array.from(new Set(t)).length!=t.length?w.value=o("multisig.duplicatedCosigner"):l==!1&&(w.value="",await Ee(a.value[n])||P.value.includes(a.value[n])||P.value.push(a.value[n]))):A.value[n]=!0;else w.value=""},{deep:!0}),K(()=>[...A.value],t=>{t.every(l=>l==!1)&&z()},{deep:!0});const Se=()=>{a.value.push(""),r.value.push({}),A.value.push(!1),v.value+=1,m.value+=1},Ie=(t,l)=>{v.value>0&&(v.value-=1),m.value>0&&(m.value-=1),g.value>m.value&&(g.value=m.value),p.value>v.value&&(p.value=v.value),ve(l),a.value.splice(l,1),r.value.splice(l,1),u.value.splice(l,1),ae.value.splice(l,1),te.value.splice(l,1),A.value.splice(l,1);for(let n=0;n<P.value.length;n++)t===P.value[n]&&P.value.splice(n,1)},Pe=t=>{p.value*10*~~(v.value/10)+t.charCode-48>v.value&&t.preventDefault()};let ne=o("multisig.deletionExceedMax"),re=o("multisig.approvalExceedMax"),S="";K(p,t=>{z(),v.value==0&&t>1||t>v.value&&t!=1&&v.value!=0?S=re:v.value>0&&t<=0?S=o("multisig.approvalAtLeastOne"):g.value>m.value&&g.value!=1&&m.value!=0?S=ne:S=""});const Ne=t=>{g.value*10*~~(m.value/10)+t.charCode-48>m.value&&t.preventDefault()};let N="";K(g,t=>{z(),m.value==0&&t>1||t>m.value&&t!=1&&m.value!=0?N=ne:m.value>0&&t<=0?N=o("multisig.deletionAtLeastOne"):p.value>v.value&&p.value!=1&&v.value!=0?N=re:N=""}),K([p,g],()=>{S!=""&&N!=""?w.value=S+`
`+N:S!=""?w.value=S:w.value=N});const Fe=y(()=>W.value||se.value);d.value&&X.onPartial(I.PublicAccount.createFromPublicKey(d.value.publicKey,f.networkType)).then(t=>W.value=t),d.value&&d.value.balance<V.value&&(U.value=!0),K(d,t=>{t&&(t.balance<V.value?U.value=!0:U.value=!1)});const De=y(()=>j.amountFormatterSimple(V.value,0)),Ee=async t=>{const l=I.PublicAccount.createFromPublicKey(t,f.networkType);try{return!!await f.chainAPI.accountAPI.getAccountInfo(l.address)}catch{return!1}};return{networkState:Q,toggleContact:ae,contact:de,space:be,currentNativeTokenName:he,contactName:u,err:w,disableSend:xe,numApproveTransaction:p,numDeleteUser:g,maxNumApproveTransaction:v,maxNumDeleteUser:m,fundStatus:U,acc:d,passwd:E,showPasswdError:$,showAddressError:A,addCoSig:Se,coSign:a,addCoSigButton:Te,selectedNode:r,deleteCoSigAddressInput:Ie,onNodeSelect:Ae,selectedAddresses:te,clear:me,convertAccount:Ce,disabledPassword:Fe,onPartial:W,isMultisig:se,passwdPattern:R,validateApproval:Pe,validateDelete:Ne,lockFundCurrency:le,lockFundTxFee:oe,aggregateFee:H,totalFee:V,totalFeeFormatted:De,selectedAccAdd:ye,accBalance:_e,passwordErr:B,pkNotExistArray:P}}},Y=i=>(Re("data-v-666aebc0"),i=i(),qe(),i),tt={class:"text-xs font-semibold"},at={key:0,class:"error error_box mb-5 whitespace-pre"},lt={key:1},ot={key:0,class:"flex gap-2 bg-yellow-50 py-2 rounded-md px-2 my-3"},st=Y(()=>s("img",{src:Qe,class:"w-5 h-5"},null,-1)),nt={class:"text-xs font-bold pt-1"},rt={key:2,class:"error error_box mb-5"},it=Y(()=>s("div",{class:"mt-4"},null,-1)),ct={class:"flex flex-col gap-2 ml-[-24px]"},ut={class:"flex"},dt=["onClick"],vt={key:0,class:"mt-16"},mt=["onClick"],ft={class:"text-xxs text-blue-primary font-semibold uppercase"},pt={key:0},gt=["disabled"],bt=Y(()=>s("div",{class:"my-7 gray-line"},null,-1)),yt={class:"text-xs font-semibold mb-3"},_t={class:"flex gap-2"},ht={class:"border w-6/12"},wt={class:"border-b-2 text-xxs text-center py-1 uppercase"},At={class:"flex justify-around"},kt=["disabled"],xt=["max"],Tt=["disabled"],Ct={class:"text-xxs border-t-2 text-center py-1 uppercase"},St={class:"border w-6/12"},It={class:"border-b-2 text-xxs text-center py-1 uppercase"},Pt={class:"flex justify-around"},Nt=["disabled"],Ft=["max"],Dt=["disabled"],Et={class:"text-xxs border-t-2 text-center py-1 uppercase"},Mt={class:"text-xs font-semibold my-3"},Ut=Y(()=>s("div",{class:"mt-5"},null,-1)),Vt={class:"mt-3"},Kt=["disabled"],Lt={class:"text-center"};function Bt(i,o,O,e,w,P){const B=T("AccTabLayout"),U=T("TextInput"),E=T("TextInputClean"),$=T("font-awesome-icon"),R=T("SelectAccountAndContact"),p=T("Sidebar"),g=T("PasswordInput"),v=T("TransactionFeeDisplay"),m=T("router-link"),ee=T("TransactionLayout");return _(),h(G,null,[C(B,{address:O.address,selected:"multisig"},null,8,["address"]),C(ee,null,{white:Z(()=>[s("div",tt,b(i.$t("multisig.manageCosignatories")),1),s("div",null,[e.err!=""?(_(),h("div",at,b(e.err),1)):L("",!0),e.pkNotExistArray.length>0?(_(),h("div",lt,[(_(!0),h(G,null,ce(e.pkNotExistArray,a=>(_(),h("div",null,[(_(!0),h(G,null,ce(e.coSign,(r,u)=>(_(),h("div",{key:u},[a===r?(_(),h("div",ot,[st,s("div",nt,b(e.contactName[u]?e.contactName[u]:i.$t("multisig.cosignatory")+`${u+1}`)+"'s public key does not exist ",1)])):L("",!0)]))),128))]))),256))])):L("",!0),e.passwordErr!=""?(_(),h("div",rt,b(e.passwordErr),1)):L("",!0)]),it,s("div",ct,[(_(!0),h(G,null,ce(e.coSign,(a,r)=>(_(),h("div",{key:r},[s("div",ut,[s("img",{src:$e,onClick:u=>e.deleteCoSigAddressInput(a,r),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,dt),C(U,{class:"w-5/12 mr-2",placeholder:i.$t("multisig.cosignatory")+`${r+1}`,modelValue:e.contactName[r],"onUpdate:modelValue":u=>e.contactName[r]=u,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),C(E,{class:"w-7/12 mr-2",placeholder:i.$t("general.publicKey"),errorMessage:i.$t("general.invalidInput"),showError:e.showAddressError[r],modelValue:e.coSign[r],"onUpdate:modelValue":u=>e.coSign[r]=u},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),e.showAddressError[r]==!0?(_(),h("div",vt)):L("",!0),s("div",{onClick:u=>e.toggleContact[r]=!e.toggleContact[r],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[C($,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),s("div",ft,b(i.$t("general.select")),1)],8,mt)]),e.toggleContact[r]?(_(),h("div",pt,[C(p,{visible:e.toggleContact[r],"onUpdate:visible":u=>e.toggleContact[r]=u,baseZIndex:1e4,position:"full"},{default:Z(()=>[C(R,We({ref_for:!0},r,{contacts:e.contact,index:r,selectedNode:e.selectedNode[r],onNodeSelect:u=>e.onNodeSelect(u,r)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):L("",!0)]))),128))]),s("button",{class:"font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:o[0]||(o[0]=(...a)=>e.addCoSig&&e.addCoSig(...a)),disabled:e.addCoSigButton}," +"+b(i.$t("multisig.addNewCosignatory")),9,gt),bt,s("div",yt,b(i.$t("general.scheme")),1),s("div",_t,[s("div",ht,[s("div",wt,b(i.$t("multisig.transactionsApproval")),1),s("div",At,[s("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[1]||(o[1]=a=>e.numApproveTransaction--),disabled:e.numApproveTransaction<=0}," - ",8,kt),fe(s("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[2]||(o[2]=(...a)=>e.validateApproval&&e.validateApproval(...a)),max:e.maxNumApproveTransaction,"onUpdate:modelValue":o[3]||(o[3]=a=>e.numApproveTransaction=a)},null,40,xt),[[pe,e.numApproveTransaction]]),s("button",{class:"text-blue-primary disabled:opacity-50",disabled:e.numApproveTransaction>=e.maxNumApproveTransaction,onClick:o[4]||(o[4]=a=>e.numApproveTransaction++)}," + ",8,Tt)]),s("div",Ct,b(i.$t("multisig.ofCosignatories",{value:e.maxNumApproveTransaction})),1)]),s("div",St,[s("div",It,b(i.$t("multisig.accountDeletionApproval")),1),s("div",Pt,[s("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[5]||(o[5]=a=>e.numDeleteUser--),disabled:e.numDeleteUser<=0}," - ",8,Nt),fe(s("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[6]||(o[6]=(...a)=>e.validateDelete&&e.validateDelete(...a)),max:e.maxNumDeleteUser,"onUpdate:modelValue":o[7]||(o[7]=a=>e.numDeleteUser=a)},null,40,Ft),[[pe,e.numDeleteUser]]),s("button",{class:"text-blue-primary disabled:opacity-50",disabled:e.numDeleteUser>=e.maxNumDeleteUser,onClick:o[8]||(o[8]=a=>e.numDeleteUser++)}," + ",8,Dt)]),s("div",Et,b(i.$t("multisig.ofCosignatories",{value:e.maxNumDeleteUser})),1)])]),s("div",null,[s("div",Mt,b(i.$t("general.enterPasswordContinue")),1),C(g,{placeholder:i.$t("general.enterPassword"),errorMessage:i.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.passwd,"onUpdate:modelValue":o[9]||(o[9]=a=>e.passwd=a),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"])])]),navy:Z(()=>[C(v,{"fund-status":e.fundStatus,"is-multisig-already":e.isMultisig,"on-partial":e.onPartial,"transaction-fee":String(e.aggregateFee),"total-fee-formatted":e.totalFeeFormatted,"lock-fund-currency-convert":e.lockFundCurrency,"lock-fund-tx-fee-convert":String(e.lockFundTxFee),balance:e.accBalance,"selected-acc-add":e.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),Ut,s("div",Vt,[s("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:o[10]||(o[10]=a=>e.convertAccount()),disabled:e.disableSend},b(i.$t("multisig.updateCosignatories")),9,Kt)]),s("div",Lt,[C(m,{to:{name:"ViewMultisigHome",params:{address:O.address}},class:"content-center text-xs text-white underline"},{default:Z(()=>[je(b(i.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}const oa=Ve(et,[["render",Bt],["__scopeId","data-v-666aebc0"]]);export{oa as default};
