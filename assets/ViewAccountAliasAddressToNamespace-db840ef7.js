import{d as oe,u as ie,r as g,c as t,w as i,n as T,H as B,B as p,S as de,a as x,l as ue,z as b,i as W,o as O,b as Z,m as c,v as j,e as r,t as A,f as ce,j as H,x as ve,W as me}from"./index-6982070c.js";import{_ as ge}from"./PasswordInput.vue_vue_type_script_setup_true_lang-5b6252b9.js";import{a as L}from"./accountUtils-8fd64752.js";import{A as pe,_ as fe}from"./AccountTabs.vue_vue_type_script_setup_true_lang-fdee24d4.js";import{M as q}from"./multisigUtils-db2c53f4.js";import{_ as be}from"./AddressInputClean.vue_vue_type_style_index_0_lang-ca2bb6d5.js";import{_ as ke}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-e868ef53.js";import{_ as he}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-cc847591.js";import"./jdenticon-module-6c808149.js";import"./functions-0a4df64c.js";import"./TextInput-d29f3cc5.js";import"./TextInputClean-64285474.js";import"./icon-key-5b3f7dda.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";import"./proximax-logo-ecfc3767.js";const ye={class:"w-10/12 mx-auto mt-5"},we={class:"border-2 border-t-0 filter shadow-lg xl:grid xl:grid-cols-3"},Ae={class:"lg:col-span-2 py-6 px-6"},Le={key:0,class:"text-tsm flex gap-2 items-center"},Ce={class:"font-semibold mt-3"},Ie={class:"flex flex-col"},Ne={class:"flex mt-3 gap-1"},Te={class:"bg-navy-primary p-6 lg:col-span-1"},xe={class:"font-semibold text-xs text-white mb-1.5"},$e=r("div",{class:"mt-3"},null,-1),Se=["disabled"],Pe={class:"text-center"},We="^[^ ]{8,}$",Fe="^[0-9A-Za-z]{40}$",Me="^[0-9A-Za-z-]{46}$",Qe=oe({__name:"ViewAccountAliasAddressToNamespace",props:{address:{}},setup(v){const{t:f}=ie(),F=g({name:"",value:""}),G=[{value:"Link",label:f("general.link")},{value:"Unlink",label:f("general.unlink")}],n=g({value:"Link",label:f("general.link")}),d=g(null),k=e=>{let s=i.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length,multisigInfo:a.multisigInfo})),l=i.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0,multisigInfo:a.multisigInfo}));return s.concat(l).find(a=>a.publicKey==e)},h=t(()=>{var e;return((e=i.currentLoggedInWallet)==null?void 0:e.accounts.find(s=>s.address==v.address))||i.currentLoggedInWallet.others.find(s=>s.address==v.address)}),D=g(""),y=g(""),m=g(""),C=g(!0),M=g(""),V=t(()=>T.currentNetworkProfileConfig?B.convertToExact(T.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility):0),U=t(()=>T.currentNetworkProfile?B.convertToExact(de.getLockFundFee(),p.nativeToken.divisibility):0),R=i.currentLoggedInWallet?i.currentLoggedInWallet.name:"",w=g(0),K=t(()=>{let e=p.nativeToken.divisibility;return o.value.hasCosigner?e==0?Math.trunc(w.value+V.value+U.value):Math.round((w.value+V.value+U.value)*Math.pow(10,p.nativeToken.divisibility))/Math.pow(10,p.nativeToken.divisibility):w.value}),E=t(()=>h.value?h.value.balance:0),J=t(()=>p.nativeToken.divisibility),Q=t(()=>i.currentLoggedInWallet?B.toCurrencyFormat(E.value,J.value):"0"),_=t(()=>{var e=!1;return o.value.hasCosigner?k(I.value)&&(k(I.value).balance<K.value?e=!0:e=!1):E.value<K.value&&(e=!0),e}),X=t(()=>!(_.value==!1&&y.value.match(We)&&m.value!=""&&d.value.value!=null&&C.value==!1)),Y=t(()=>L.namespaceOption(v.address,n.value.value)),ee=t(()=>{var s,l;return(((s=i.currentLoggedInWallet)==null?void 0:s.accounts.find(a=>a.address==v.address))||((l=i.currentLoggedInWallet)==null?void 0:l.others.find(a=>a.address==v.address))).namespaces.filter(a=>a.active==!0)}),o=t(()=>{if(T.currentNetworkProfileConfig){const s=q.getCosignerInWallet(h.value.publicKey?h.value.publicKey:"").cosignerList.map(a=>({publicKey:a,name:k(a).name,balance:k(a).balance,address:k(a).address}));let l=!1;return s.length>0&&(l=!0),{hasCosigner:l,cosignerList:s}}else return{hasCosigner:!1,cosignerList:[]}}),ae=t(()=>o.value.cosignerList.map(e=>({name:e.name,value:e.publicKey}))),I=g(o.value.cosignerList[0]?o.value.cosignerList[0].publicKey:"");x(o,e=>{e.cosignerList.length&&(I.value=e.cosignerList[0]?e.cosignerList[0].publicKey:"")},{deep:!0});const z=t(()=>h.value?q.getCosignerInWallet(h.value.publicKey).cosignerList.length>0:!1),$=t(()=>!!(!z.value&&o.value.hasCosigner||!ee.value.length));x(n,()=>{m.value="",d.value=null},{immediate:!0}),x(d,e=>{var a;const l=L.getNamespaceListByAddress(v.address).find(N=>{var P;return N.name===((P=d.value)==null?void 0:P.value)});if(n.value.value=="Unlink"&&e!=null)m.value=b.Address.createFromRawAddress(l.linkedId).pretty();else if(n.value.value=="Link"&&m.value!=""&&e.value!=null){let N=b.Address.createFromRawAddress(m.value).plain();w.value=L.getLinkNamespaceToAddressTransactionFee(o.value.hasCosigner,N,(a=d.value)==null?void 0:a.value,n.value.value)/Math.pow(10,p.nativeToken.divisibility)}}),x(m,e=>{var s;if(e.length==46&&e.match(Me)||e.length==40&&e.match(Fe))if(L.verifyAddress(v.address,m.value).isPassed==!1)M.value="Invalid Address",C.value=!0;else{let a=b.Address.createFromRawAddress(e).plain();w.value=L.getLinkNamespaceToAddressTransactionFee(o.value.hasCosigner,a,(s=d.value)==null?void 0:s.value,n.value.value)/Math.pow(10,p.nativeToken.divisibility),M.value="",C.value=!1}else C.value=!0});const se=ue(),le=async()=>{var e;if(!me.verifyWalletPassword(R,T.chainNetworkName,y.value))D.value=f("general.walletPasswordInvalid",{name:R}),y.value="";else{let s=i.currentLoggedInWallet.accounts.find(a=>a.address==v.address)?i.currentLoggedInWallet.accounts.find(a=>a.address==v.address):i.currentLoggedInWallet.others.find(a=>a.address==v.address);D.value="";const l=await p.chainAPI.nodeAPI.getNodeTime();L.linkNamespaceToAddress(I.value,o.value.hasCosigner,s,y.value,(e=d.value)==null?void 0:e.value,n.value.value,m.value,new b.UInt64(l.sendTimeStamp)),se.push({name:"ViewAccountPendingTransactions",params:{address:v.address}})}},te=t(()=>{let e=k(I.value);return e?e.balance:0});x(o,e=>{e.cosignerList.length&&(F.value={name:e.cosignerList[0].name,value:e.cosignerList[0].publicKey})},{immediate:!0});const S=g(!1),ne=e=>{S.value=!1,m.value=e.data},re=t(()=>{const e=i.currentLoggedInWallet;if(!e)return[];const s=[...e.accounts,...e.others];return e.contacts.length?[{key:"0",label:f("general.ownerAcc"),selectable:!1,children:s.map((l,a)=>({key:"0-"+a.toString(),label:l.name,data:b.Address.createFromRawAddress(l.address).pretty(),selectable:!0}))},{key:"1",label:f("general.contact"),selectable:!1,children:e.contacts.map((l,a)=>({key:"1-"+a.toString(),label:l.name,data:b.Address.createFromRawAddress(l.address).pretty(),selectable:!0}))}]:[{key:"0",label:f("general.ownerAcc"),selectable:!1,children:s.map((l,a)=>({key:"0-"+a.toString(),label:l.name,data:b.Address.createFromRawAddress(l.address).pretty(),selectable:!0}))}]});return(e,s)=>{const l=W("Sidebar"),a=W("Dropdown"),N=W("font-awesome-icon"),P=W("router-link");return O(),Z("div",null,[c(l,{visible:S.value,"onUpdate:visible":s[0]||(s[0]=u=>S.value=u),baseZIndex:1e4,position:"full"},{default:j(()=>[c(he,{contacts:re.value,onNodeSelect:ne},null,8,["contacts"])]),_:1},8,["visible"]),r("div",ye,[c(pe,{address:e.address,class:"mb-6"},null,8,["address"]),c(fe,{address:e.address,selected:"details"},null,8,["address"]),r("div",we,[r("div",Ae,[o.value.cosignerList.length?(O(),Z("div",Le,[r("div",null,A(e.$t("general.initiateBy"))+":",1),c(a,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=u=>F.value=u),options:ae.value,class:"text-tsm","option-label":"name"},null,8,["modelValue","options"])])):ce("",!0),r("div",Ce,A(n.value.value=="Link"?e.$t("general.linkToNamespace"):e.$t("namespace.manageNamespace")),1),r("div",Ie,[c(a,{class:"my-3",placeholder:e.$t("namespace.selectAction"),modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=u=>n.value=u),options:G,"option-label":"label",disabled:$.value},null,8,["placeholder","modelValue","disabled"]),c(a,{placeholder:e.$t("namespace.selectNamespace"),modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=u=>d.value=u),"option-label":"label",options:Y.value,"option-disabled":"disabled",disabled:$.value},null,8,["placeholder","modelValue","options","disabled"])]),r("div",Ne,[c(be,{placeholder:e.$t("general.addAccAddress"),modelValue:m.value,"onUpdate:modelValue":s[4]||(s[4]=u=>m.value=u),errorMessage:M.value,showError:C.value,disabled:$.value||n.value.value=="Unlink"||d.value==null},null,8,["placeholder","modelValue","errorMessage","showError","disabled"]),r("div",{class:"border rounded-md cursor-pointer flex flex-col justify-around p-2",onClick:s[5]||(s[5]=u=>S.value=!0)},[c(N,{icon:"id-card-alt",class:H([d.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","ml-auto mr-auto"])},null,8,["class"]),r("div",{class:H([d.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","text-xxs font-semibold uppercase"])},A(e.$t("general.select")),3)])])]),r("div",Te,[c(ke,{"transaction-fee":String(w.value),"total-fee-formatted":String(K.value),"get-multi-sig-cosigner":o.value,"check-cosign-balance":String(te.value),"lock-fund-currency":String(V.value),"lock-fund-tx-fee":String(U.value),balance:Q.value,"selected-acc-add":e.address,"is-cosigner":z.value,"fund-status":_.value},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add","is-cosigner","fund-status"]),r("div",xe,A(e.$t("general.enterPasswordContinue")),1),c(ge,{placeholder:e.$t("general.enterPassword"),errorMessage:e.$t("general.passwordRequired"),modelValue:y.value,"onUpdate:modelValue":s[6]||(s[6]=u=>y.value=u),icon:"lock",disabled:$.value},null,8,["placeholder","errorMessage","modelValue","disabled"]),$e,r("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:le,disabled:X.value},A(n.value.value=="Unlink"?e.$t("namespace.unlinkNamespace"):e.$t("general.linkToNamespace")),9,Se),r("div",Pe,[c(P,{to:{name:"ViewAccountDetails",params:{address:e.address}},class:"content-center text-xs text-white underline"},{default:j(()=>[ve(A(e.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}}});export{Qe as default};
