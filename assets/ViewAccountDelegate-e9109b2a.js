import{_ as be,u as pe,r as d,w as g,H as _,E as h,c as s,at as v,a as H,n as A,P as ye,q as _e,D as he,g as we,au as ke,K as Ae,k as I,o as f,b as m,e as l,s as P,t as r,f as F,A as ee,S as Pe,af as Ce,F as xe,i as Ie,z as Ke,B,W as te}from"./index-f81de996.js";import{P as Le}from"./PasswordInput-0dd59ef4.js";import{T as Fe}from"./TransactionFeeDisplay-b8f2fa3e.js";import{c as Te}from"./functions-ee8fa276.js";import{a as R}from"./accountUtils-becb344d.js";import{A as De,a as Ve}from"./AccountTabs-9e5c8eeb.js";import{M as W}from"./multisigUtils-558cd5cc.js";import"./proximax-logo-ecfc3767.js";import"./icon-new-page-link-270844f6.js";import"./jdenticon-module-7161194d.js";import"./TextInput-3c8a9d79.js";import"./TextInputClean-1671b736.js";import"./icon-key-5b3f7dda.js";const Se="/web-wallet-vuejs/assets/icon-blue-tick-41ef93f6.svg";const Be={name:"ViewAccountDelegate",components:{AccountComponent:De,PasswordInput:Le,AccountTabs:Ve,TransactionFeeDisplay:Fe},props:{address:String},setup(n){const{t:i}=pe(),K="^(0x|0X)?[a-fA-F0-9].{63,65}$";let e=d(""),T=d(!0);const p=d(""),M=d(!1),C=d(!1),w=g.currentLoggedInWallet?g.currentLoggedInWallet.selectDefaultAccount():null,L=d(w?w.address:""),N=d(_.toCurrencyFormat(w?w.balance:0,h.nativeToken.divisibility)),o=s(()=>{if(!g.currentLoggedInWallet)return null;let t=g.currentLoggedInWallet.accounts.find(c=>c.address==n.address)||g.currentLoggedInWallet.others.find(c=>c.address==n.address);return t||null}),u=()=>o.value?W.getCosignerInWallet(o.value.publicKey).cosignerList:[],x=s(()=>{let t=u(),c=[];return t.forEach(a=>{c.push({publicKey:a,name:v(a).name,balance:v(a).balance})}),c}),z=s(()=>o.value?W.getCosignerInWallet(o.value.publicKey).cosignerList.length>0:!1),b=d(x.value[0]?x.value[0].publicKey:"");H(x,t=>{t.length&&(b.value=t[0]?t[0].publicKey:"")},{deep:!0});let D=d(!1);(()=>{o.value&&W.onPartial(B.PublicAccount.createFromPublicKey(o.value.publicKey,h.networkType)).then(t=>D.value=t).catch(t=>{D.value=!1})})();const G=s(()=>A.currentNetworkProfileConfig?_.convertToExact(A.currentNetworkProfileConfig.lockedFundsPerAggregate,h.nativeToken.divisibility):0),O=s(()=>A.currentNetworkProfile?_.convertToExact(ye.getLockFundFee(),h.nativeToken.divisibility):0),y=s(()=>o.value?!!o.value.getDirectParentMultisig().length:!1);let E=s(()=>R.getDelegateFee(y.value));const V=s(()=>y.value?E.value+G.value+O.value:E.value),X=s(()=>o.value?o.value.balance:0),ae=s(()=>h.nativeToken.label),J=s(()=>h.nativeToken.divisibility),le=s(()=>g.currentLoggedInWallet?y.value?v(b.value)?_.toCurrencyFormat(v(b.value).balance,J.value):"0":_.toCurrencyFormat(X.value,J.value):"0"),Q=s(()=>{var t=!1;return y.value?v(b.value)&&(v(b.value).balance<V.value?t=!0:t=!1):X.value<V.value&&(t=!0),t}),ne=s(()=>{let t=le.value.split(".");return t[1]!=null?{left:t[0],right:t[1]}:{left:t[0],right:null}});H(e,t=>{t.match(K)?T.value=!1:T.value=!0});const k=d(""),S=d(""),se=d(""),oe=_e(),re=he();d(n.address);const Y="^[^ ]{8,}$",ie=we(),ce=new ke(Ae.buildAPIEndpoint(A.selectedAPIEndpoint,A.currentNetworkProfile.httpPort));ie.appContext.config.globalProperties.emitter;const j=g.currentLoggedInWallet?g.currentLoggedInWallet.name:"",ue=s(()=>D.value||Q.value||!z.value&&y.value?!0:q.value?q.value?!p.value.match(Y):!0:!p.value.match(Y)),de=t=>{let c=document.getElementById(t).getAttribute("copyValue"),a=document.getElementById(t).getAttribute("copySubject");Te(c),re.add({severity:"info",detail:a+" "+i("general.copied"),group:"br-custom",life:3e3})},U=async()=>{if(o.value&&o.value){const t=_.createPublicAccount(o.value.publicKey,h.networkType),c=await ce.accountAPI.getAccountInfo(t.address);k.value=c.linkedAccountKey}};U(),H(()=>o,t=>{U()},{deep:!0});const q=s(()=>{let t=!1;return k.value!=""&&(k.value==="0".repeat(64)?t=!1:k.value!=="0".repeat(64)&&(t=!0)),t}),Z=async()=>{e.value=B.Account.generateNewAccount().privateKey};Z();const ge=async()=>{const t=te.createAccountFromPrivateKey(e.value,h.networkType);t&&(S.value=t.publicKey),te.verifyWalletPassword(j,A.chainNetworkName,p.value)?(k.value!=="0".repeat(64)?(R.createDelegateTransaction(b.value,y.value,o.value,p.value,k.value,B.LinkAction.Unlink),p.value="",C.value=""):S.value!=""&&(R.createDelegateTransaction(b.value,y.value,o.value,p.value,S.value,B.LinkAction.Link),p.value="",C.value=""),oe.push({name:"ViewAccountPendingTransactions",params:{address:n.address}})):C.value=i("general.walletPasswordInvalid",{name:j})},$=s(()=>{if(!g.currentLoggedInWallet)return[];let t=g.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),c=g.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return t.concat(c)}),ve=s(()=>_.amountFormatterSimple(V.value,0)),fe=s(()=>{if(A.currentNetworkProfileConfig){let t=W.getCosignerInWallet($.value.find(a=>a.address==L.value)?$.value.find(a=>a.address==L.value).publicKey:""),c=[];return t.cosignerList.forEach(a=>{c.push({publicKey:a,name:v(a).name,balance:v(a).balance,address:v(a).address})}),t.cosignerList=c,t}else return{hasCosigner:!1,cosignerList:[]}}),me=s(()=>{let t=v(b.value)?v(b.value).balance:0;return _.toCurrencyFormat(t,3)});return{showPrivateKeyError:T,findAcc:v,privateKey:e,currentNativeTokenName:ae,splitBalance:ne,isMultisig:y,acc:o,walletPassword:p,showPasswdError:M,walletState:g,createDelegate:ge,verifyDelegateAcc:U,delegateAcc:k,AccPublicKey:S,AccPrivateKey:se,disableLinkBtn:ue,copy:de,err:C,walletName:j,delegateValue:q,isCosigner:z,lockFund:G,transactionFee:E,totalFee:V,lockFundTxFee:O,onPartial:D,walletCosignerList:x,selectedCosignPublicKey:b,fundStatus:Q,generatePrivateKey:Z,totalFeeFormatted:ve,selectedAccAdd:L,accBalance:N,getMultiSigCosigner:fe,checkCosignBalance:me}}},We={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},Me={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-3"},Ne={class:"lg:col-span-2 py-6 pr-6"},Ee={class:"pl-6"},je={key:0,class:"error error_box mb-5"},Ue={key:0,class:"text-left mt-2 mb-5 ml-6"},qe={key:0},He={class:"text-tsm"},Re={key:0,class:"font-bold"},ze={key:1,class:"font-bold"},Ge=["value"],Oe={key:1},Xe={class:"text-xs font-semibold pl-6"},Je={class:"text-xxs pl-6 mt-2"},Qe=l("div",{class:"mt-4"},null,-1),Ye=l("div",{class:"ml-6 my-7 gray-line"},null,-1),Ze={class:"pl-6"},$e={class:"text-xs text-blue-primary mt-0.5 font-semibold uppercase"},et={class:"flex"},tt=["copyValue","copySubject"],at={class:"text-txs mt-1 text-red-400 border px-1.5 py-2 border-red-400 rounded-md"},lt={key:2},nt={class:"text-xs font-semibold pl-6"},st={class:"ml-6 px-3 py-2 mt-3 bg-green-100"},ot=l("img",{src:Se,class:"h-3 w-3 inline-block mr-2"},null,-1),rt={class:"text-xs mt-2 inline-block"},it={class:"border border-blue-300 rounded-md ml-6 p-3 mt-3 bg-blue-50 overflow-x-auto"},ct={class:"text-xs inline-block"},ut=["copyValue","copySubject"],dt={class:"bg-navy-primary p-6 lg:col-span-1"},gt=l("div",{class:"mt-5"},null,-1),vt={class:"font-semibold text-xs text-white mb-1.5"},ft={class:"mt-3"},mt=["disabled"],bt=["disabled"],pt={class:"text-center"};function yt(n,i,K,e,T,p){const M=I("AccountComponent"),C=I("AccountTabs"),w=I("font-awesome-icon"),L=I("TransactionFeeDisplay"),N=I("PasswordInput"),o=I("router-link");return f(),m("div",null,[l("div",We,[P(M,{address:K.address,class:"mb-6"},null,8,["address"]),P(C,{address:K.address,selected:"details"},null,8,["address"]),l("div",Me,[l("div",Ne,[l("div",Ee,[e.err!=""?(f(),m("div",je,r(e.err),1)):F("v-if",!0)]),e.isMultisig?(f(),m("div",Ue,[e.walletCosignerList.length>0?(f(),m("div",qe,[l("div",He,[ee(r(n.$t("general.initiateBy"))+": ",1),e.walletCosignerList.length==1?(f(),m("span",Re,r(e.walletCosignerList[0].name),1)):(f(),m("span",ze,[Pe(l("select",{class:"","onUpdate:modelValue":i[0]||(i[0]=u=>e.selectedCosignPublicKey=u)},[(f(!0),m(xe,null,Ie(e.walletCosignerList,(u,x)=>(f(),m("option",{value:e.findAcc(u.publicKey).publicKey,key:x},r(u.name),9,Ge))),128))],512),[[Ce,e.selectedCosignPublicKey]])]))])])):F("v-if",!0)])):F("v-if",!0),e.delegateValue?(f(),m("div",lt,[l("div",nt,r(n.$t("delegate.accDelegated")),1),l("div",st,[ot,l("div",rt,r(n.$t("delegate.linked")),1)]),l("div",it,[l("div",ct,r(n.$t("delegate.publicKeyOfDelegate")),1),P(w,{icon:"copy",onClick:i[2]||(i[2]=u=>e.copy("delegatePublicKey")),title:n.$t("general.copy"),class:"inline-block float-right mt-1 w-5 h-5 text-blue-link cursor-pointer"},null,8,["title"]),l("div",{class:"text-xs mt-0.5 font-semibold",id:"delegatePublicKey",copyValue:e.delegateAcc,copySubject:n.$t("delegate.delegatePublicKey")},r(e.delegateAcc),9,ut)])])):(f(),m("div",Oe,[l("div",Xe,r(n.$t("general.delegate")),1),l("div",Je,r(n.$t("delegate.notLinked")),1),Qe,Ye,l("div",Ze,[l("div",$e,r(n.$t("general.privateKey")),1),l("div",et,[l("div",{id:"private",class:"truncate text-xs mt-1 font-semibold",type:"text",copyValue:e.privateKey,copySubject:n.$t("general.privateKey")},r(e.privateKey),9,tt),P(w,{title:n.$t("general.copy"),icon:"copy",onClick:i[1]||(i[1]=u=>e.copy("private")),class:"ml-2 pb-1 w-5 h-5 text-blue-link mt-0.5 cursor-pointer"},null,8,["title"])]),l("div",at,r(n.$t("general.pkWarning")),1)])]))]),l("div",dt,[P(L,{"fund-status":e.fundStatus,"is-multisig":e.isMultisig,"is-cosigner":e.isCosigner,"on-partial":e.onPartial,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFund,"lock-fund-tx-fee":e.lockFundTxFee,balance:e.accBalance,"selected-acc-add":e.selectedAccAdd},null,8,["fund-status","is-multisig","is-cosigner","on-partial","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),gt,l("div",vt,r(n.$t("general.enterPasswordContinue")),1),P(N,{placeholder:n.$t("general.enterPassword"),errorMessage:n.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":i[3]||(i[3]=u=>e.walletPassword=u)},null,8,["placeholder","errorMessage","showError","modelValue"]),l("div",ft,[e.delegateValue?(f(),m("button",{key:0,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[4]||(i[4]=(...u)=>e.createDelegate&&e.createDelegate(...u)),disabled:e.disableLinkBtn},r(n.$t("delegate.unlinkAcc")),9,mt)):F("v-if",!0),e.delegateValue?F("v-if",!0):(f(),m("button",{key:1,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[5]||(i[5]=(...u)=>e.createDelegate&&e.createDelegate(...u)),disabled:e.disableLinkBtn},r(n.$t("delegate.delegateAcc")),9,bt))]),l("div",pt,[P(o,{to:{name:"ViewAccountDetails",params:{address:K.address}},class:"content-center text-xs text-white underline"},{default:Ke(()=>[ee(r(n.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Vt=be(Be,[["render",yt],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/account/submodule/delegate/views/ViewAccountDelegate.vue"]]);export{Vt as default};
