import{_ as xe,u as Ce,q as De,D as Ne,r as s,c as l,n as r,b7 as Fe,b8 as Pe,E as f,K as Te,at as Le,H as i,R as Se,am as G,w as x,I as Ie,a as A,as as W,b9 as oe,k as M,o as v,b as g,e as n,t as o,s as N,f as F,B as J,Q as Ae,ae as Me,F as Be,h as Ee,z as Ve,W as We}from"./index-9f44b159.js";import{P as Ue}from"./PasswordInput-0577d8e3.js";import{D as He}from"./DurationInputClean-cc0d4204.js";import{T as Re}from"./TransactionFeeDisplay-065cff3a.js";import{N as P}from"./namespaceUtils-01ffe63b.js";import{t as je}from"./jdenticon-module-342376c0.js";import{M as qe}from"./multisigUtils-f7b74538.js";import{_ as ze}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const Oe={name:"ViewServicesNamespaceExtend",components:{PasswordInput:Ue,DurationInputClean:He,TransactionFeeDisplay:Re},props:{namespaceId:String,address:String},setup(t){const{t:b}=Ce(),K=De();Ne();const e=s(null),U=s(!1),u=s("1"),k=s(""),B=s(""),p=s(!1),T=s(!1),H="^[^ ]{8,}$",c=s(!1),w=s(""),le=s(!1),re=s(!1),C=s(""),E=s(0),R=s(0),V=s(0),j=s(!1),L=l(()=>r.currentNetworkProfileConfig?Math.floor(Fe.configReturn(r.currentNetworkProfileConfig.maxNamespaceDuration,Pe.DAY)):0),ie=l(()=>f.readBlockHeight),ce=l(()=>f.nativeToken.label);(async()=>{const a=Te.buildAPIEndpoint(r.selectedAPIEndpoint,r.currentNetworkProfile?r.currentNetworkProfile.httpPort:3e3),d=new Le(a);E.value=await d.chainAPI.getBlockchainHeight()})();const de=l(()=>{let a=[];const d=P.listRootNamespaces(y.value);return a.push.apply(a,d),a}),ue=l(()=>f.nativeToken.label),D=l(()=>r.currentNetworkProfileConfig?u.value>0?i.convertToExact(r.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*P.calculateDuration(u.value),f.nativeToken.divisibility):i.convertToExact(r.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,f.nativeToken.divisibility):0),ve=l(()=>i.toCurrencyFormat(D.value,6)),ge=l(()=>r.currentNetworkProfileConfig?i.convertToExact(r.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),me=l(()=>r.currentNetworkProfileConfig?i.amountFormatterSimple(r.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),q=l(()=>r.currentNetworkProfile?i.convertToExact(Se.getLockFundFee(),f.nativeToken.divisibility):0),S=l(()=>(m.value?m.value.cosignerList.length:0)==0&&G(y.value)),fe=s(q.value.toString()),z=l(()=>ge.value+q.value),be=l(()=>!(k.value.match(H)&&!U.value&&!ne.value&&!S.value)),X=s(""),y=s(""),O=s(""),Q=s(""),Z=l(()=>x.currentLoggedInWallet?x.currentLoggedInWallet.selectDefaultAccount():null),he=s(Z.value?G(Z.value.address):!1),$=i.createAddress(t.address).plain();let h=l(()=>x.currentLoggedInWallet?x.currentLoggedInWallet.accounts.find(a=>a.address==$)||x.currentLoggedInWallet.others.find(a=>a.address==$):null);h.value&&(X.value=h.value.name,y.value=h.value.address,O.value=i.toCurrencyFormat(h.value.balance,f.nativeToken.divisibility),Q.value=h.value.balance);let ee=new Ie("ThemeStyleConfig");ee.init();const we=s(je(t.address,40,ee.jdenticonConfig));if(h.value){let a=h.value.namespaces.find(d=>d.idHex===t.namespaceId);if(a!=null){R.value=a.endHeight;const d=a.name.split(".");d.length>1?w.value=d[0]:w.value=a.name}}const ae=s("0"),I=s(0);try{ae.value=i.convertToCurrency(P.getRootNamespaceTransactionFee(w.value,u.value),f.nativeToken.divisibility),I.value=i.convertToExact(P.getRootNamespaceTransactionFee(w.value,u.value),f.nativeToken.divisibility)}catch{}let Y=!1;A(u,a=>{if(a>L.value)u.value=L.value;else{let d=R.value-E.value,_=0;V.value=Math.ceil(d/(24*60*4)),parseInt(a)+V.value>L.value?(_=L.value-V.value,u.value=_.toString(),j.value=!0,Y=!0):(Y||(j.value=!1),Y=!1)}});const ke=()=>{u.value="1"},te=l(()=>G(i.createAddress(t.address).plain())?parseFloat(z.value)+D.value+I.value:D.value+I.value),pe=l(()=>i.amountFormatterSimple(te.value,0));A(te,a=>{O.value<a&&!S.value?p.value=!0:p.value=!1}),A(ie,a=>{E.value=a});const ye=()=>{if(!We.verifyWalletPassword(x.currentLoggedInWallet.name,r.chainNetworkName,k.value)){B.value=b("general.walletPasswordInvalid",{name:x.currentLoggedInWallet.name});return}se.value?P.extendNamespaceMultisig(se.value,k.value,w.value,u.value,y.value):P.extendNamespace(y.value,k.value,w.value,u.value),K.push({name:"ViewAccountPendingTransactions",params:{address:y.value}})},m=l(()=>{if(h.value)if(r.currentNetworkProfileConfig){let a=qe.getCosignerInWallet(h.value?h.value.publicKey:""),d=[];return a.cosignerList.forEach(_=>{d.push({publicKey:_,name:W(_).name,balance:W(_).balance,address:W(_).address})}),a.cosignerList=d,{hasCosigner:a.hasCosigner,cosignerList:a.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});C.value=m.value&&m.value.cosignerList.length>0?m.value.cosignerList[0].address:"",A(m,a=>{a&&a.cosignerList.length>0&&(C.value=a.cosignerList.length>0?m.value.cosignerList[0].address:"")});const ne=l(()=>S.value?Q.value<D.value+I.value:Q.value<D.value+I.value+z.value);A(S,a=>{a?(p.value=!0,T.value=!0):(p.value=!1,T.value=!1)});const se=l(()=>m.value.cosignerList.length>0?m.value.cosignerList.length>1?C.value:W(m.value.cosignerList[0].publicKey).address:""),_e=l(()=>{let a=oe(C.value)?oe(C.value).balance:0;return i.toCurrencyFormat(a)});return{namespaceSelect:e,selectedAccName:X,selectedAccAdd:y,balance:O,showNoBalance:ne,err:B,walletPassword:k,disableCreate:be,showPasswdError:c,disabledPassword:p,showDuration:le,disabledDuration:T,duration:u,showDurationErr:U,isMultiSigBool:he,rentalFee:D,rentalFeeCurrency:ve,lockFundTxFee:q,lockFundCurrency:me,currencyName:ue,lockFundTxFeeCurrency:fe,lockFundTotalFee:z,totalFeeFormatted:pe,selectNamespace:w,namespaceOption:de,extendNamespace:ye,transactionFee:ae,getMultiSigCosigner:m,cosignerBalanceInsufficient:re,cosignerAddress:C,isNotCosigner:S,block:E,endBlock:R,numDaysleft:V,showMaxDaysLabel:j,svgString:we,Helper:i,currentNativeTokenName:ce,maxDurationInDays:L,setDefaultDuration:ke,checkCosignBalance:_e}}},Qe={class:"w-10/12 ml-auto mr-auto"},Ye={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Ge={class:"xl:col-span-2 p-6 lg:p-12"},Je={class:"lg:flex lg:justify-between lg:items-center"},Ke={class:"font-semibold mb-4 inline-block mt-1"},Xe={class:"flex items-center"},Ze=["innerHTML"],$e={class:"ml-2"},ea={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},aa={class:"font-bold text-black text-sm"},ta={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},na={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},sa={class:"inline-block text-xs"},oa={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},la={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},ra={class:"inline-block text-xs"},ia={key:2,class:"error error_box"},ca={class:"text-right w-full"},da={key:0,class:"inline-block"},ua={class:"text-tsm text-left mt-3"},va={key:0,class:"font-bold"},ga={key:0,class:"error"},ma={key:1,class:"font-bold"},fa=["value"],ba={key:2,class:"error"},ha={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},wa=n("img",{src:ze},null,-1),ka={class:"ml-1"},pa={class:"uppercase text-blue-primary font-semibold text-xxs"},ya={class:"text-black text-sm font-bold"},_a={key:3,class:"text-xs inline-block text-gray-400"},xa={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Ca={class:"text-xs text-white my-5"},Da=["disabled"],Na={class:"text-center"};function Fa(t,b,K,e,U,u){const k=M("font-awesome-icon"),B=M("DurationInputClean"),p=M("TransactionFeeDisplay"),T=M("PasswordInput"),H=M("router-link");return v(),g("div",null,[n("div",Qe,[n("div",Ye,[n("div",Ge,[n("div",Je,[n("div",Ke,o(t.$t("general.extendDuration")),1),n("div",Xe,[n("div",{innerHTML:e.svgString,class:"inline-block"},null,8,Ze),n("div",$e,[n("div",ea,o(t.$t("namespace.namespaceCreatedBy")),1),n("div",aa,o(e.selectedAccName),1)])])]),e.showNoBalance?(v(),g("div",ta,[n("div",na,[N(k,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),n("div",sa,o(t.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(v(),g("div",oa,[n("div",la,[N(k,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),n("div",ra,o(t.$t("general.noCosigner")),1)])):F("v-if",!0),e.err!=""?(v(),g("div",ia,o(e.err),1)):F("v-if",!0),n("div",ca,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(v(),g("div",da,[n("div",ua,[J(o(t.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(v(),g("span",va,[J(o(e.getMultiSigCosigner.cosignerList[0].name)+" ("+o(t.$t("general.balance"))+": "+o(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+o(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(v(),g("span",ga,"- "+o(t.$t("general.insufficientBalance")),1)):F("v-if",!0)])):(v(),g("span",ma,[Ae(n("select",{"onUpdate:modelValue":b[0]||(b[0]=c=>e.cosignerAddress=c)},[(v(!0),g(Be,null,Ee(e.getMultiSigCosigner.cosignerList,(c,w)=>(v(),g("option",{value:c.address,key:w},o(c.name)+" ("+o(t.$t("general.balance"))+": "+o(c.balance)+" "+o(e.currentNativeTokenName)+")",9,fa))),128))],512),[[Me,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(v(),g("div",ba,"- "+o(t.$t("general.insufficientBalance")),1)):F("v-if",!0)])])):F("v-if",!0)]),n("div",ha,[wa,n("div",ka,[n("div",pa,o(t.$t("general.namespace")),1),n("div",ya,o(e.selectNamespace),1)])]),N(B,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":b[1]||(b[1]=c=>e.duration=c),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:t.$t("namespace.duration"),showError:e.showDurationErr,toolTip:t.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+t.$t("general.year"):""} (${e.maxDurationInDays}`+t.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(v(),g("div",_a,o(t.$t("namespace.durationMsg2"))+" "+o(e.maxDurationInDays-e.numDaysleft)+" "+o(t.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):F("v-if",!0)]),n("div",xa,[N(p,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),n("div",Ca,o(t.$t("general.enterPasswordContinue")),1),N(T,{placeholder:t.$t("general.password"),errorMessage:t.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":b[2]||(b[2]=c=>e.walletPassword=c),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),n("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:b[3]||(b[3]=(...c)=>e.extendNamespace&&e.extendNamespace(...c))},o(t.$t("general.extendDuration")),9,Da),n("div",Na,[N(H,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Ve(()=>[J(o(t.$t("general.cancel")),1)]),_:1})])])])])])}const Wa=xe(Oe,[["render",Fa],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/services/submodule/namespaces/views/ViewServicesNamespaceExtend.vue"]]);export{Wa as default};
