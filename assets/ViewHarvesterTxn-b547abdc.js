import{d as z,o as m,b as f,e as t,t as _,_ as Q,f as E,E as ne,q as re,r as n,u as ie,c,W as I,w as V,G as l,H as u,n as S,X as W,a as q,k as G,Q as ce,s as v,R as de,z as ue,B as ve,i as me,p as fe,j as _e,A as O}from"./index-50355987.js";import{_ as pe}from"./icon-red-x-a5511f99.js";import{_ as be}from"./icon-green-tick-1b766454.js";import{_ as he,a as xe,b as ge,c as ye}from"./TxnSummary.vue_vue_type_script_setup_true_lang-142f5f1c.js";import{_ as we}from"./PasswordInput.vue_vue_type_script_setup_true_lang-03ddb185.js";import{T as R}from"./transactionState-d6e64c2d.js";import"./jdenticon-module-4ad48b04.js";import"./proximax-logo-ecfc3767.js";const ke={class:"border border-gray-200 px-2 py-2 rounded-md w-full"},Te={class:"flex gap-2"},Pe={class:"flex flex-col w-full"},$e={class:"uppercase text-gray-500 font-light text-xxs text-left"},Ae=["value"],Ie={key:0,class:"flex flex-col ml-auto justify-center mt-1"},Ve=t("img",{src:pe,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Se={class:"text-xxs text-red-400 font-bold uppercase"},Ee={key:1,class:"flex flex-col ml-auto justify-center mt-1"},Fe=t("img",{src:be,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Ce={class:"text-xxs text-green-400 font-bold uppercase"},He=z({__name:"PublicKeyInputClean",props:{placeholder:String,showError:Boolean,modelValue:String},emits:["update:modelValue"],setup(r){return(i,o)=>(m(),f("div",ke,[t("div",Te,[t("div",Pe,[t("div",$e,_(r.placeholder),1),t("input",{autocomplete:"off",type:"text",value:r.modelValue,onInput:o[0]||(o[0]=F=>i.$emit("update:modelValue",F.target.value)),class:"w-full font-semibold text-tsm outline-none mt-1"},null,40,Ae)]),r.showError?(m(),f("div",Ie,[Ve,t("div",Se,_(i.$t("general.invalid")),1)])):(m(),f("div",Ee,[Fe,t("div",Ce,_(i.$t("general.valid")),1)]))])]))}});const Be={props:{placeholder:String,errorMessage:String,showError:Boolean,modelValue:String,title:String,disabled:Boolean},emits:["update:modelValue"],name:"SelectLinkType",data(){return{inputText:"",borderColor:"border border-gray-300",textErr:!1}},watch:{showError:function(r){r?(this.borderColor="border-2 border-red-primary",this.textErr=!0):(this.borderColor="border-2 border-gray-300",this.textErr=!1)}}},Ne={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},Ke={class:"uppercase text-gray-500 text-txs text-left mb-2"},Me={class:"flex items-center"},Le=["value","disabled","checked"],We=t("label",{for:"add",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Add",-1),Re=["value","disabled","checked"],Ue=t("label",{for:"remove",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Remove",-1),je={class:"h-3 mb-2"},De={key:0,class:"error error-text text-left"};function qe(r,i,o,F,y,h){return m(),f("div",null,[t("div",Ne,[t("div",Ke,_(o.title),1),t("div",Me,[t("input",{id:"add",type:"radio",name:"linkType",value:o.modelValue,disabled:o.disabled,class:"h-5 w-5",onChange:i[0]||(i[0]=C=>r.$emit("update:modelValue","add")),checked:o.modelValue=="link"},null,40,Le),We,t("input",{id:"remove",type:"radio",name:"linkType",value:o.modelValue,disabled:o.disabled,class:"h-5 w-5",onChange:i[1]||(i[1]=C=>r.$emit("update:modelValue","remove")),checked:o.modelValue=="unlink"},null,40,Re),Ue])]),t("div",je,[y.textErr||o.showError?(m(),f("div",De,_(o.errorMessage),1)):E("",!0)])])}const Ge=Q(Be,[["render",qe]]),Oe=r=>(fe("data-v-841d3dc9"),r=r(),_e(),r),ze={class:"w-10/12 ml-auto mr-auto"},Qe={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Xe={class:"xl:col-span-2 p-12"},Je=Oe(()=>t("div",{class:"font-semibold mb-4"},"Harvester Transaction",-1)),Ye={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},Ze={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},et={class:"inline-block text-xs"},tt={key:1,class:"error error_box"},at={class:"mt-4"},lt={class:"flex gap-1 mt-3"},st={key:0,class:"mt-3"},ot={class:"mt-3"},nt={class:""},rt={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},it={class:"text-xs text-white my-5"},ct=["disabled"],dt={class:"text-center"},ut="^[^ ]{8,}$",vt=z({__name:"ViewHarvesterTxn",setup(r){const i=ne(),o=re(),y=me().appContext.config.globalProperties.emitter,h=n(""),{t:C}=ie(),H=n(""),X=c(()=>L.value||Y.value),J=n(!1),Y=n(!1),B=n(""),w=n(""),A=n(!0),Z=()=>{try{w.value=O.PublicAccount.createFromPublicKey(w.value,l.networkType).publicKey,A.value=!1}catch{A.value=!0}},N=n(),k=n();try{N.value=I.createPublicAccount(V.currentLoggedInWallet?V.currentLoggedInWallet.selectDefaultAccount().publicKey:"",l.networkType)}catch(e){console.log(e)}const ee=c(()=>{if(l.isReady){let e=l.buildTxn.addHarvester(u.samplePubAcc());if(s.value){let a=l.buildTxn.aggregateBonded([e.toAggregateV1(u.samplePubAcc())]);return u.amountFormatterSimple(a.maxFee.compact(),l.nativeToken.divisibility)}else return u.amountFormatterSimple(e.maxFee.compact(),l.nativeToken.divisibility)}else return"0"}),$=c(()=>u.convertNumberMinimumFormat(Number(ee.value),l.nativeToken.divisibility)),U=c(()=>S.currentNetworkProfileConfig?u.convertToExact(S.currentNetworkProfileConfig.lockedFundsPerAggregate,l.nativeToken.divisibility):0),j=c(()=>S.currentNetworkProfile?u.convertToExact(W.getLockFundFee(),l.nativeToken.divisibility):0),D=c(()=>U.value+j.value),te=c(()=>!h.value.match(ut)||w.value==""||A.value||L.value),s=n(null),T=n(null),p=n(null),x=n(0),K=n(0),M=async e=>{if(l.chainAPI&&e)try{const a=await l.chainAPI.accountAPI.getAccountInfo(O.Address.createFromRawAddress(e)),d=a.mosaics.findIndex(g=>g.id.toHex()==l.nativeToken.assetId);return d!=-1?a.mosaics[d].amount.compact()/Math.pow(10,l.nativeToken.divisibility):0}catch{return 0}},L=c(()=>{if(p.value)return s.value?x.value<$.value+D.value:x.value<$.value});q(p,async(e,a)=>{e==null?(x.value=0,T.value=null,s.value=null,k.value=null):e!=a&&(T.value=null,s.value=null,k.value=null,x.value=await M(e))}),q(s,async(e,a)=>{e==null?(K.value=0,T.value=null,s.value=null,k.value=null,x.value=await M(p.value)):e!=a&&(K.value=await M(e))});const ae=c(()=>s.value?D.value+$.value:$.value),le=c(()=>u.amountFormatterSimple(ae.value,0)),se=async()=>{if(!I.verifyWalletPassword(V.currentLoggedInWallet.name,S.chainNetworkName,h.value)){H.value=C("general.walletPasswordInvalid",{name:V.currentLoggedInWallet.name});return}let a,d;const g=B.value==="add";g?d=l.buildTxn.addHarvesterBuilder():d=l.buildTxn.removeHarvesterBuilder();try{const b=await l.chainAPI.harvesterAPI.getAccountHarvestingHarvesterInfo(u.createPublicAccount(w.value,l.networkType));if(g&&b.length){i.add({severity:"error",detail:"Harvester key found, it is already added",group:"br-custom",life:1e4});return}else if(!g&&b.length===0){i.add({severity:"error",detail:"Harvester key not found, does not need to be removed",group:"br-custom",life:1e4});return}}catch{return}if(s.value){const oe=[d.harvesterKey(k.value).build().toAggregateV1(k.value)];a=W.signTxnWithPassword(p.value,s.value,h.value,null,oe)}else{const b=d.harvesterKey(N.value).build();a=W.signTxnWithPassword(p.value,s.value,h.value,b)}R.lockHashPayload=a.hashLockTxnPayload,R.transactionPayload=a.txnPayload,R.selectedAddress=p.value,o.push({name:"ViewConfirmTransaction"})};return y.on("select-account",e=>{p.value=e}),y.on("select-account-public-key",e=>{N.value=I.createPublicAccount(e,l.networkType)}),y.on("select-multisig-account",e=>{T.value=e.label,s.value=e.value,k.value=I.createPublicAccount(e.publicKey,l.networkType)}),y.on("CLOSE_MULTISIG",()=>{T.value=null,s.value=null}),(e,a)=>{const d=G("font-awesome-icon"),g=G("router-link"),b=ce("debounce");return m(),f("div",null,[t("div",ze,[t("div",Qe,[t("div",Xe,[Je,L.value?(m(),f("div",Ye,[t("div",Ze,[v(d,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),t("div",et,_(e.$t("general.insufficientBalance")),1)])):E("",!0),H.value!=""?(m(),f("div",tt,_(H.value),1)):E("",!0),t("div",at,[t("div",lt,[v(he,{type:"dynamic",label:"Add Harvester"}),v(xe,{"selected-address":p.value},null,8,["selected-address"])]),s.value?(m(),f("div",st,[v(ge,{"select-default-address":s.value,"select-default-name":T.value,label:"Multisig account selected",type:"dynamic"},null,8,["select-default-address","select-default-name"])])):E("",!0)]),t("div",ot,[v(Ge,{title:"Type",modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=P=>B.value=P),disabled:!1},null,8,["modelValue"])]),t("div",nt,[de(v(He,{placeholder:"Harvester Key",modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=P=>w.value=P),showError:A.value},null,8,["modelValue","showError"]),[[b,Z,"1000"]])])]),t("div",rt,[v(ye,{"signer-native-token-balance":x.value,"native-token-balance":s.value?K.value:x.value,"lock-fund":U.value,"lock-fund-tx-fee":j.value,"selected-multisig-address":s.value,"txn-fee":$.value,"total-fee":Number(le.value)},null,8,["signer-native-token-balance","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),t("div",it,_(e.$t("general.enterPasswordContinue")),1),v(we,{placeholder:e.$t("general.password"),errorMessage:e.$t("general.passwordRequired"),showError:J.value,modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=P=>h.value=P),disabled:X.value},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),t("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:te.value,onClick:se},"Create harvester transaction",8,ct),t("div",dt,[v(g,{to:{name:"ViewServices"},class:"content-center text-xs text-white border-b-2 border-white"},{default:ue(()=>[ve(_(e.$t("general.cancel")),1)]),_:1})])])])])])}}});const yt=Q(vt,[["__scopeId","data-v-841d3dc9"]]);export{yt as default};
