import{_ as be,j as pe,g,w as u,H as p,A as b,c as s,au as v,D as j,n as w,B as ke,k as _e,y as Ae,b4 as he,G as we,r as T,o as f,f as m,l as C,b as z,e as a,t as c,i as P,s as Z,O as Ce,ak as Le,F as $,K as xe,x as S,E as Te,W as Pe}from"./index-ec24e299.js";import{T as Ke}from"./TransactionLayout-0c31618b.js";import{_ as Ie}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-38214e82.js";import{c as Fe}from"./functions-b5bd9b3c.js";import{a as De}from"./accountUtils-42a457d2.js";import{M as V}from"./multisigUtils-ce075a8a.js";import{T as W}from"./transactionState-bd4bb225.js";import{_ as Be}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-9934b402.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-67ac7cc6.js";import"./proximax-logo-ecfc3767.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-4d3f24f1.js";import"./jdenticon-module-708539e7.js";import"./TextInput-cf4d1586.js";import"./TextInputClean-e1542c5e.js";import"./icon-key-5b3f7dda.js";const Se="/web-wallet-vuejs/assets/icon-blue-tick-41ef93f6.svg";const Ve={name:"ViewAccountDelegate",components:{TransactionFeeDisplay:Ie,AccTabLayout:Be,TransactionLayout:Ke},props:{address:String},setup(i){const{t:l}=pe(),K="^(0x|0X)?[a-fA-F0-9].{63,65}$";let t=g(""),I=g(!0);const G=g(!1),L=g(!1),k=u.currentLoggedInWallet?u.currentLoggedInWallet.selectDefaultAccount():null,x=g(k?k.address:""),M=g(p.toCurrencyFormat(k?k.balance:0,b.nativeToken.divisibility)),o=s(()=>{if(!u.currentLoggedInWallet)return null;let e=u.currentLoggedInWallet.accounts.find(r=>r.address==i.address)||u.currentLoggedInWallet.others.find(r=>r.address==i.address);return e||null}),d=()=>o.value?V.getCosignerInWallet(o.value.publicKey).cosignerList:[],h=s(()=>{let e=d(),r=[];return e.forEach(n=>{r.push({publicKey:n,name:v(n).name,balance:v(n).balance})}),r}),H=s(()=>o.value?V.getCosignerInWallet(o.value.publicKey).cosignerList.length>0:!1),y=g(h.value[0]?h.value[0].publicKey:"");j(h,e=>{e.length&&(y.value=e[0]?e[0].publicKey:"")},{deep:!0});let F=g(!1);(()=>{o.value&&V.onPartial(S.PublicAccount.createFromPublicKey(o.value.publicKey,b.networkType)).then(e=>F.value=e).catch(e=>{F.value=!1})})();const O=s(()=>w.currentNetworkProfileConfig?p.convertToExact(w.currentNetworkProfileConfig.lockedFundsPerAggregate,b.nativeToken.divisibility):0),R=s(()=>w.currentNetworkProfile?p.convertToExact(ke.getLockFundFee(),b.nativeToken.divisibility):0),_=s(()=>o.value?!!o.value.getDirectParentMultisig().length:!1);let N=s(()=>De.getDelegateFee(_.value));const D=s(()=>_.value?N.value+O.value+R.value:N.value),X=s(()=>o.value?o.value.balance:0),ee=s(()=>b.nativeToken.label),q=s(()=>b.nativeToken.divisibility),te=s(()=>u.currentLoggedInWallet?_.value?v(y.value)?p.toCurrencyFormat(v(y.value).balance,q.value):"0":p.toCurrencyFormat(X.value,q.value):"0"),J=s(()=>{var e=!1;return _.value?v(y.value)&&(v(y.value).balance<D.value?e=!0:e=!1):X.value<D.value&&(e=!0),e}),ne=s(()=>{let e=te.value.split(".");return e[1]!=null?{left:e[0],right:e[1]}:{left:e[0],right:null}});j(t,e=>{e.match(K)?I.value=!1:I.value=!0});const A=g(""),B=g(""),ae=g(""),le=_e(),se=Ae();g(i.address);const ie=Te(),oe=new he(we.buildAPIEndpoint(w.selectedAPIEndpoint,w.currentNetworkProfile.httpPort));ie.appContext.config.globalProperties.emitter;const re=u.currentLoggedInWallet?u.currentLoggedInWallet.name:"",ce=s(()=>!!(F.value||J.value||!H.value&&_.value)),ue=e=>{let r=document.getElementById(e).getAttribute("copyValue"),n=document.getElementById(e).getAttribute("copySubject");Fe(r),se.add({severity:"info",detail:n+" "+l("general.copied"),group:"br-custom",life:3e3})},E=async()=>{if(o.value&&o.value){const e=p.createPublicAccount(o.value.publicKey,b.networkType),r=await oe.accountAPI.getAccountInfo(e.address);A.value=r.linkedAccountKey}};E(),j(()=>o,e=>{E()},{deep:!0});const de=s(()=>{let e=!1;return A.value!=""&&(A.value==="0".repeat(64)?e=!1:A.value!=="0".repeat(64)&&(e=!0)),e}),Q=async()=>{t.value=S.Account.generateNewAccount().privateKey};Q();const ge=async()=>{const e=Pe.createAccountFromPrivateKey(t.value,b.networkType);e&&(B.value=e.publicKey);let r="";const n=b.buildTxn;if(A.value!=="0".repeat(64)?(r=n.accountLinkBuilder().remoteAccountKey(A.value).linkAction(S.LinkAction.Unlink).build().serialize(),L.value=""):B.value!=""&&(r=n.accountLinkBuilder().remoteAccountKey(B.value).linkAction(S.LinkAction.Link).build().serialize(),L.value=""),_.value){let U=u.currentLoggedInWallet.accounts.find(ye=>ye.publicKey==y.value).address;W.selectedAddress=U,W.selectedMultisigAddress=o.value.address}else W.selectedAddress=o.value.address;W.unsignedTransactionPayload=r,le.push({name:"ViewConfirmTransaction"})},Y=s(()=>{if(!u.currentLoggedInWallet)return[];let e=u.currentLoggedInWallet.accounts.map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!!n.getDirectParentMultisig().length})),r=u.currentLoggedInWallet.others.filter(n=>n.type==="MULTISIG").map(n=>({name:n.name,balance:n.balance,address:n.address,publicKey:n.publicKey,isMultisig:!0}));return e.concat(r)}),ve=s(()=>p.amountFormatterSimple(D.value,0)),fe=s(()=>{if(w.currentNetworkProfileConfig){let e=V.getCosignerInWallet(Y.value.find(n=>n.address==x.value)?Y.value.find(n=>n.address==x.value).publicKey:""),r=[];return e.cosignerList.forEach(n=>{r.push({publicKey:n,name:v(n).name,balance:v(n).balance,address:v(n).address})}),e.cosignerList=r,e}else return{hasCosigner:!1,cosignerList:[]}}),me=s(()=>{let e=v(y.value)?v(y.value).balance:0;return p.toCurrencyFormat(e,3)});return{showPrivateKeyError:I,findAcc:v,privateKey:t,currentNativeTokenName:ee,splitBalance:ne,isMultisig:_,acc:o,showPasswdError:G,walletState:u,createDelegate:ge,verifyDelegateAcc:E,delegateAcc:A,AccPublicKey:B,AccPrivateKey:ae,disableLinkBtn:ce,copy:ue,err:L,walletName:re,delegateValue:de,isCosigner:H,lockFund:O,transactionFee:N,totalFee:D,lockFundTxFee:R,onPartial:F,walletCosignerList:h,selectedCosignPublicKey:y,fundStatus:J,generatePrivateKey:Q,totalFeeFormatted:ve,selectedAccAdd:x,accBalance:M,getMultiSigCosigner:fe,checkCosignBalance:me}}},We={class:"pl-6"},Me={key:0,class:"error error_box mb-5"},Ne={key:0,class:"text-left mt-2 mb-5"},Ee={key:0},Ue={class:"text-tsm"},je={key:0,class:"font-bold"},ze={key:1,class:"font-bold"},Ge=["value"],He={key:1},Oe={class:"text-xs font-semibold"},Re={class:"text-xxs mt-2"},Xe={class:"text-xs text-blue-primary mt-0.5 font-semibold uppercase"},qe={class:"flex"},Je=["copyValue","copySubject"],Qe={class:"text-txs mt-1 text-red-400 border px-1.5 py-2 border-red-400 rounded-md"},Ye={key:2},Ze={class:"text-xs font-semibold"},$e={class:"px-3 py-2 mt-3 bg-green-100"},et={class:"text-xs mt-2 inline-block"},tt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50 overflow-x-auto"},nt={class:"text-xs inline-block"},at=["copyValue","copySubject"],lt={class:"mt-3"},st=["disabled"],it=["disabled"],ot={class:"text-center"};function rt(i,l,K,t,I,G){const L=T("AccTabLayout"),k=T("font-awesome-icon"),x=T("TransactionFeeDisplay"),M=T("router-link"),o=T("TransactionLayout");return f(),m($,null,[C(L,{address:K.address,selected:"details"},null,8,["address"]),C(o,null,{white:z(()=>[a("div",We,[t.err!=""?(f(),m("div",Me,c(t.err),1)):P("",!0)]),t.isMultisig?(f(),m("div",Ne,[t.walletCosignerList.length>0?(f(),m("div",Ee,[a("div",Ue,[Z(c(i.$t("general.initiateBy"))+": ",1),t.walletCosignerList.length==1?(f(),m("span",je,c(t.walletCosignerList[0].name),1)):(f(),m("span",ze,[Ce(a("select",{class:"","onUpdate:modelValue":l[0]||(l[0]=d=>t.selectedCosignPublicKey=d)},[(f(!0),m($,null,xe(t.walletCosignerList,(d,h)=>(f(),m("option",{value:t.findAcc(d.publicKey).publicKey,key:h},c(d.name),9,Ge))),128))],512),[[Le,t.selectedCosignPublicKey]])]))])])):P("",!0)])):P("",!0),t.delegateValue?(f(),m("div",Ye,[a("div",Ze,c(i.$t("delegate.accDelegated")),1),a("div",$e,[l[7]||(l[7]=a("img",{src:Se,class:"h-3 w-3 inline-block mr-2"},null,-1)),a("div",et,c(i.$t("delegate.linked")),1)]),a("div",tt,[a("div",nt,c(i.$t("delegate.publicKeyOfDelegate")),1),C(k,{icon:"copy",onClick:l[2]||(l[2]=d=>t.copy("delegatePublicKey")),title:i.$t("general.copy"),class:"inline-block float-right mt-1 w-5 h-5 text-blue-link cursor-pointer"},null,8,["title"]),a("div",{class:"text-xs mt-0.5 font-semibold",id:"delegatePublicKey",copyValue:t.delegateAcc,copySubject:i.$t("delegate.delegatePublicKey")},c(t.delegateAcc),9,at)])])):(f(),m("div",He,[a("div",Oe,c(i.$t("general.delegate")),1),a("div",Re,c(i.$t("delegate.notLinked")),1),l[5]||(l[5]=a("div",{class:"mt-4"},null,-1)),l[6]||(l[6]=a("div",{class:"my-7 gray-line"},null,-1)),a("div",null,[a("div",Xe,c(i.$t("general.privateKey")),1),a("div",qe,[a("div",{id:"private",class:"truncate text-xs mt-1 font-semibold",type:"text",copyValue:t.privateKey,copySubject:i.$t("general.privateKey")},c(t.privateKey),9,Je),C(k,{title:i.$t("general.copy"),icon:"copy",onClick:l[1]||(l[1]=d=>t.copy("private")),class:"ml-2 pb-1 w-5 h-5 text-blue-link mt-0.5 cursor-pointer"},null,8,["title"])]),a("div",Qe,c(i.$t("general.pkWarning")),1)])]))]),navy:z(()=>[C(x,{"fund-status":t.fundStatus,"is-multisig":t.isMultisig,"is-cosigner":t.isCosigner,"on-partial":t.onPartial,"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":t.lockFund,"lock-fund-tx-fee":t.lockFundTxFee,balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig","is-cosigner","on-partial","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l[8]||(l[8]=a("div",{class:"mt-5"},null,-1)),a("div",lt,[t.delegateValue?(f(),m("button",{key:0,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:l[3]||(l[3]=(...d)=>t.createDelegate&&t.createDelegate(...d)),disabled:t.disableLinkBtn},c(i.$t("delegate.unlinkAcc")),9,st)):P("",!0),t.delegateValue?P("",!0):(f(),m("button",{key:1,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:l[4]||(l[4]=(...d)=>t.createDelegate&&t.createDelegate(...d)),disabled:t.disableLinkBtn},c(i.$t("delegate.delegateAcc")),9,it))]),a("div",ot,[C(M,{to:{name:"ViewAccountDetails",params:{address:K.address}},class:"content-center text-xs text-white underline"},{default:z(()=>[Z(c(i.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}const Lt=be(Ve,[["render",rt]]);export{Lt as default};
