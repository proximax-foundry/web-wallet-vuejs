import{d as le,L as pe,r as T,a as Y,i as oe,o as f,b as x,m as L,v as J,e,t as o,f as I,z as i,B as n,h as ie,l as ve,A as ge,c as D,H as ae,n as z,S as K,w as F,M as fe,O as xe,y as B,x as _e,W as ne,be as he}from"./index-8a270fd9.js";import{_ as re}from"./proximax-logo-ecfc3767.js";import{_ as ye,a as be,I as q}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-ce22c5e0.js";import{_ as we}from"./InputId.vue_vue_type_style_index_0_lang-ef5b1bba.js";import{_ as Ie}from"./PasswordInput.vue_vue_type_script_setup_true_lang-133d9fe7.js";import"./jdenticon-module-e8bbf2b2.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";const Ae={key:0},Te={class:"flex justify-between"},ke={class:"flex flex-col ml-2 text-left"},Me=e("div",{class:"text-blue-primary font-semibold text-xxs uppercase",style:{"line-height":"9px"}}," Selected Asset",-1),Fe={class:"mt-1 text-tsm font-bold"},Le={class:"mt-1 text-tsm font-bold"},Ee={class:"account-item"},Pe={class:"flex justify-between"},Ve={class:"mt-1 text-tsm font-bold"},$e={class:"mt-1 text-tsm font-bold"},Se=le({__name:"SelectInputAsset",props:{selectedAddress:{type:String,required:!1},selectedMultisigAddress:{type:String,required:!1}},emits:["select-asset","update:modelValue"],setup(Q){const X=Q,G=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],H=c=>{const r=G.find(u=>u.namespace==c);return r?r.name:c},{selectedAddress:j,selectedMultisigAddress:A}=pe(X),N=T([]),E=T(!1),k=async c=>{if(!n.chainAPI||!c)return;y(null),N.value=[];const r=await n.chainAPI.accountAPI.getAccountInfo(i.Address.createFromRawAddress(c));for(let u=0;u<r.mosaics.length;u++){const s=r.mosaics[u];N.value.push({id:s.id.toHex(),amount:s.amount.compact(),divisibility:0,namespace:"",hasUpdated:!1})}},_=T(null);Y([j,A],([c,r])=>{_.value=null,c!=null&&r==null?k(c):c!=null&&r!=null&&k(r)});const d=async c=>{if(E.value)return;E.value=!0;const{first:r,last:u}=c,s=[];for(let w=r;w<u;w++)N.value[w].hasUpdated||s.push(new i.MosaicId(N.value[w].id));if(!s.length){E.value=!1;return}const b=await n.chainAPI.assetAPI.getMosaicsNames(s),V=await n.chainAPI.assetAPI.getMosaics(s);let $=0,U=0;const S=new Map;b.forEach((w,M)=>{S.set(w.mosaicId.toHex(),M)}),V.sort((w,M)=>{const O=S.get(w.mosaicId.toHex()),R=S.get(M.mosaicId.toHex());return O-R});for(let w=r;w<u;w++){if(!b[$])continue;const M=N.value.find(O=>O.id==b[$].mosaicId.toHex());M&&(M.namespace=b[$].names.length?b[$].names[0].name:"",M.amount=M.amount/Math.pow(10,V[U].divisibility),M.divisibility=V[U].divisibility,M.hasUpdated=!0,$++,U++)}E.value=!1},h=ie().appContext.config.globalProperties.emitter,y=c=>{h.emit("select-asset",c),_.value=c};return(c,r)=>{const u=oe("Dropdown");return f(),x("div",null,[L(u,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=s=>_.value=s),style:{width:"100%"},options:N.value,filter:!0,filterFields:["id","namespace"],emptyFilterMessage:" ",virtualScrollerOptions:{lazy:!0,onLazyLoad:d,showLoader:!0,loading:E.value,delay:0,itemSize:38},onChange:r[1]||(r[1]=s=>{y(s.value),c.$emit("update:modelValue",s.value.value),c.$emit("select-asset",s.value.value)})},{value:J(s=>[s.value?(f(),x("div",Ae,[e("div",Te,[e("div",ke,[Me,e("div",Fe,o(H(s.value.namespace==""?s.value.id:s.value.namespace)),1)]),e("div",Le,"Balance: "+o(s.value.amount),1)])])):I("",!0)]),option:J(s=>[e("div",Ee,[e("div",Pe,[e("div",Ve,o(H(s.option.namespace==""?s.option.id:s.option.namespace)),1),e("div",$e,"Balance: "+o(s.option.amount),1)])])]),_:1},8,["modelValue","options","virtualScrollerOptions"])])}}}),He={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},Ne={class:"border-2 xl:grid xl:grid-cols-3"},Ce={class:"xl:col-span-2 p-12"},Ue=e("div",null,"Create SDA-SDA Exchange",-1),Be={key:0,class:"text-xs mt-3 text-blue-primary"},Oe=e("div",{class:"text-blue-primary text-xs mt-3"},"Asset to Give",-1),Re={key:1,class:"text-red-500 text-xs"},De=e("div",{class:"text-blue-primary text-xs mt-3"},"Asset to Receive",-1),We={key:2,class:"text-red-500 text-xs"},Ke={key:3,class:"text-xs"},Xe={key:4,class:"text-red-500 text-xs"},Ge={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},je={key:0},ze={class:"font-bold text-xs text-blue-primary uppercase"},qe={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},Ye={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Je=["innerHTML"],Qe={class:"flex"},Ze={class:"ml-1 text-blue-400 font-bold"},et=e("img",{src:re,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),tt={key:0,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},st=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),at={class:"ml-auto lg:col-span-2 col-span-3"},nt={class:"ml-1 text-blue-400 text-xs"},lt={key:1,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},ot=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Receive",-1),it={class:"ml-auto lg:col-span-2 col-span-3"},rt={class:"ml-1 text-blue-400 text-xs"},ct=e("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),dt={class:"font-bold text-xs text-blue-primary uppercase"},ut={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},mt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},pt=["innerHTML"],vt={class:"flex"},gt={class:"ml-1 text-blue-400 font-bold"},ft=e("img",{src:re,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),xt=e("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),_t={key:1},ht={key:0,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},yt=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),bt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},wt={class:"ml-1 text-blue-400 text-xs"},It={key:1,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},At=e("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Receive",-1),Tt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},kt={class:"ml-1 text-blue-400 text-xs"},Mt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Ft={class:"font-semibold lg:col-span-2 col-span-3"},Lt=["innerHTML"],Et={class:"ml-1 text-blue-400"},Pt={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Vt={class:"font-semibold lg:col-span-2 col-span-3"},$t=["innerHTML"],St={class:"ml-1 text-blue-400"},Ht={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Nt={class:"font-semibold lg:col-span-2 col-span-3"},Ct=["innerHTML"],Ut={class:"ml-1 text-blue-400"},Bt=e("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Ot={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Rt=e("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"},"Total",-1),Dt=["innerHTML"],Wt={class:"ml-1 text-blue-400"},Kt={class:"font-semibold text-xs text-white mb-1.5"},Xt={class:"text-center"},es=le({__name:"ViewExchangeCreate",setup(Q){const X=t=>{const a=Math.floor(t/86400),l=Math.floor(t%(24*3600)/3600),m=Math.floor(t%3600/60),p=t%60;let v="";return a>0&&(v+=`${a} day${a>1?"s":""} `),l>0&&(v+=`${l} hour${l>1?"s":""} `),m>0&&(v+=`${m} min${m>1?"s":""} `),p>0&&(v+=`${p} second${p>1?"s":""}`),v.trim()},G=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],H=t=>{const a=G.find(l=>l.namespace==t);return a?a.name:t.length==16?t.substring(0,4)+"..."+t.substring(t.length-4,t.length+1):t},j=ve(),A=ge(),E=ie().appContext.config.globalProperties.emitter,k=T(null),_=T(null),d=T(null),P=T(!1),h=T("0"),y=T("0"),c=T(""),r=T(""),u=T("57600"),s=T(null),b=D(()=>_.value!=null),V=t=>{let a=t.toString().split(".");return a[1]!=null?'<span class="font-semibold text-sm">'+a[0]+'</span>.<span class="font-semibold text-xs">'+a[1]+"</span>":'<span class="font-semibold text-sm">'+a[0]+"</span>"},$=D(()=>ae.convertToExact(z.currentNetworkProfileConfig.lockedFundsPerAggregate,n.nativeToken.divisibility)),U=D(()=>ae.convertToExact(K.getLockFundFee(),n.nativeToken.divisibility)),S=D(()=>{var m,p,v;if(!n.isReady)return 0;const t=i.PlaceSdaExchangeOfferTransaction.create(i.Deadline.create(),[new i.SdaExchangeOffer(new i.MosaicId(n.nativeToken.assetId),i.UInt64.fromUint(parseFloat(h.value)*Math.pow(10,((m=d.value)==null?void 0:m.divisibility)??0)),new i.MosaicId(n.nativeToken.assetId),i.UInt64.fromUint(parseFloat(y.value)*Math.pow(10,((p=s.value)==null?void 0:p.divisibility)??0)),i.UInt64.fromUint(parseInt(u.value)))],n.networkType);if(!b.value)return((v=t.maxFee)==null?void 0:v.compact())/Math.pow(10,n.nativeToken.divisibility);const a=[...F.currentLoggedInWallet.accounts,...F.currentLoggedInWallet.others].find(g=>g.address==_.value),l=[t.toAggregateV1(i.PublicAccount.createFromPublicKey(a.publicKey,n.networkType))];return n.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,n.nativeToken.divisibility)}),w=t=>{const a=F.currentLoggedInWallet.accounts.find(l=>l.address==t)||F.currentLoggedInWallet.others.find(l=>l.address==t);return a?V(a.balance):0},M=t=>{const a=F.currentLoggedInWallet.accounts.find(l=>l.address==t)||F.currentLoggedInWallet.others.find(l=>l.address==t);return a?a.balance:0};E.on("select-account",t=>{k.value=t}),E.on("select-multisig-account",t=>{_.value=t}),E.on("select-asset",t=>{d.value=t});const O=async()=>{var t,a;try{new i.NamespaceId(r.value).fullName;const l=await n.chainAPI.namespaceAPI.getLinkedMosaicId(new i.NamespaceId(r.value));r.value=l.toHex();const m=await n.chainAPI.assetAPI.getMosaic(l),p=await n.chainAPI.assetAPI.getMosaicsNames([l]);s.value={supply:m.supply.compact(),divisibility:m.divisibility,namespace:p.length?p[0].names[0].name:l.toHex()},P.value=!0;return}catch{P.value=!1,s.value=null}try{const l=new i.MosaicId(r.value.toUpperCase()),m=await n.chainAPI.assetAPI.getMosaic(l),p=await n.chainAPI.assetAPI.getMosaicsNames([l]);s.value={supply:m.supply.compact(),divisibility:m.divisibility,namespace:((a=(t=p[0])==null?void 0:t.names[0])==null?void 0:a.name)??l.toHex()},P.value=!0}catch{P.value=!1,s.value=null}};Y(h,t=>{isNaN(parseFloat(t))&&(h.value="0")}),Y(y,t=>{isNaN(parseFloat(t))&&(y.value="0")});const R=D(()=>b.value?Math.round(($.value+U.value+S.value)*Math.pow(10,n.nativeToken.divisibility))/Math.pow(10,n.nativeToken.divisibility):d.value&&d.value.id.toLowerCase()==n.nativeToken.assetId.toLowerCase()?parseFloat(h.value)+S.value:S.value),ce=async()=>{var Z,ee;if(k.value==null){A.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(!d.value||!P.value){A.add({severity:"error",summary:"Error",detail:"Asset is not selected",group:"br-custom",life:1e3});return}if(parseFloat(y.value)<=0||parseFloat(h.value)<=0){A.add({severity:"error",summary:"Error",detail:"Asset amount cannot be 0",group:"br-custom",life:1e3});return}if(parseFloat(h.value)>((Z=d.value)==null?void 0:Z.amount)){A.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(parseFloat(y.value)>((ee=s.value)==null?void 0:ee.supply)){A.add({severity:"error",summary:"Error",detail:"Exceeded maximum supply",group:"br-custom",life:1e3});return}if(parseInt(u.value)>57600||parseInt(u.value)<=0){A.add({severity:"error",summary:"Error",detail:"Invalid duration",group:"br-custom",life:1e3});return}const t=M(k.value);if(b.value&&t<R.value){A.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(d.value.id.toLowerCase()==n.nativeToken.assetId.toLowerCase()&&!b.value&&t<R.value){A.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(c.value.length<8){A.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!ne.verifyWalletPassword(F.currentLoggedInWallet.name,z.chainNetworkName,c.value)){A.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const a=new i.ExchangeSdaHttp(n.nodeFullURL);try{if((await he(a.getAccountSdaExchangeOffers(i.Address.createFromRawAddress(_.value??k.value)))).sdaOfferBalances.find(W=>W.mosaicIdGive.toHex().toLowerCase()==d.value.id.toLowerCase()&&W.mosaicIdGet.toHex().toLowerCase()==r.value.toLowerCase())){A.add({severity:"error",summary:"Error",detail:"You cannot create an existing pair from this account",group:"br-custom",life:1e3});return}}catch{}const l=F.currentLoggedInWallet.accounts.find(C=>C.address==k.value),m=i.PlaceSdaExchangeOfferTransaction.create(i.Deadline.create(),[new i.SdaExchangeOffer(new i.MosaicId(d.value.id),i.UInt64.fromUint(parseFloat(h.value)*Math.pow(10,d.value.divisibility)),new i.MosaicId(r.value),i.UInt64.fromUint(parseFloat(y.value)*Math.pow(10,s.value.divisibility)),i.UInt64.fromUint(parseInt(u.value)))],n.networkType),p=ne.decryptPrivateKey(new i.Password(c.value),l.encrypted,l.iv);c.value="";const v=i.Account.createFromPrivateKeyV1(p,n.networkType),g=z.currentNetworkProfile.generationHash;if(b.value){const C=[...F.currentLoggedInWallet.accounts,...F.currentLoggedInWallet.others].find(me=>me.address==_.value),te=[m.toAggregateV1(i.PublicAccount.createFromPublicKey(C.publicKey,n.networkType))],W=n.buildTxn.aggregateBonded(te),se=v.preV2Sign(W,g),de=K.lockFundTx(se),ue=v.preV2Sign(de,g);K.announceLF_AND_addAutoAnnounceABT(ue,se)}else{const C=v.preV2Sign(m,g);await K.announceTransaction(C)}j.push({name:"ViewAccountPendingTransactions",params:{address:v.address.plain()}})};return(t,a)=>{var p,v;const l=oe("router-link"),m=fe("debounce");return f(),x("div",null,[e("div",He,[e("div",Ne,[e("div",Ce,[Ue,k.value?I("",!0):(f(),x("div",Be,"Select Account to Create / Initiate Transaction")),L(ye),L(be,{class:"md:mt-3","selected-address":k.value},null,8,["selected-address"]),Oe,L(Se,{"selected-address":k.value,"selected-multisig-address":_.value},null,8,["selected-address","selected-multisig-address"]),L(q,{class:"mt-3",placeholder:"Asset Amount",modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=g=>h.value=g),decimal:d.value?d.value.divisibility:0},null,8,["modelValue","decimal"]),parseFloat(h.value)>((p=d.value)==null?void 0:p.amount)?(f(),x("div",Re,"Insufficient Balance")):I("",!0),De,xe(L(we,{class:"mt-3",modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=g=>r.value=g),"show-error":!P.value},null,8,["modelValue","show-error"]),[[m,O,"1000"]]),L(q,{class:"mt-3",placeholder:"Asset Amount",modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=g=>y.value=g),decimal:s.value?s.value.divisibility:0},null,8,["modelValue","decimal"]),parseFloat(y.value)>((v=s.value)==null?void 0:v.supply)?(f(),x("div",We," Exceeded Maximum Supply")):I("",!0),L(q,{class:"mt-3",placeholder:"Duration (Block)",modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=g=>u.value=g),decimal:0},null,8,["modelValue"]),parseInt(u.value)<=57600?(f(),x("div",Ke,"Approximately "+o(X(parseInt(u.value)*15)),1)):I("",!0),parseInt(u.value)>57600?(f(),x("div",Xe,"Exceeded maximum duration")):I("",!0)]),e("div",Ge,[_.value?(f(),x("div",je,[e("div",ze,o(t.$t("general.multisigAcc")),1),e("div",qe,[e("div",Ye,o(t.$t("general.currentBalance")),1),e("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:w(_.value)},null,8,Je),e("div",Qe,[e("div",Ze,o(B(n).nativeToken.label),1),et])]),d.value?(f(),x("div",tt,[st,e("span",at,o(h.value),1),e("span",nt,o(H(d.value.namespace.length?d.value.namespace:d.value.id)),1)])):I("",!0),P.value?(f(),x("div",lt,[ot,e("span",it,o(y.value),1),e("span",rt,o(H(s.value.namespace)),1)])):I("",!0),ct])):I("",!0),e("div",dt,o(t.$t("general.signerAcc")),1),e("div",ut,[e("div",mt,o(t.$t("general.currentBalance")),1),e("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:w(k.value)},null,8,pt),e("div",vt,[e("div",gt,o(B(n).nativeToken.label),1),ft])]),xt,_.value?I("",!0):(f(),x("div",_t,[d.value?(f(),x("div",ht,[yt,e("span",bt,o(h.value),1),e("span",wt,o(H(d.value.namespace.length?d.value.namespace:d.value.id)),1)])):I("",!0),P.value?(f(),x("div",It,[At,e("span",Tt,o(y.value),1),e("span",kt,o(H(s.value.namespace)),1)])):I("",!0)])),e("div",Mt,[e("div",Ft,o(b.value?t.$t("general.aggregateFee"):t.$t("general.transactionFee")),1),e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:V(S.value)},null,8,Lt),e("div",Et,o(B(n).nativeToken.label),1)]),b.value?(f(),x("div",Pt,[e("div",Vt,o(t.$t("general.lockFund")),1),e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:V($.value??0)},null,8,$t),e("div",St,o(B(n).nativeToken.label),1)])):I("",!0),b.value?(f(),x("div",Ht,[e("div",Nt,o(t.$t("general.lockFundTxFee")),1),e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:V(U.value??0)},null,8,Ct),e("div",Ut,o(B(n).nativeToken.label),1)])):I("",!0),Bt,e("div",Ot,[Rt,e("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:V(R.value)},null,8,Dt),e("div",Wt,o(B(n).nativeToken.label),1)]),e("div",Kt,o(t.$t("general.enterPasswordContinue")),1),L(Ie,{placeholder:t.$t("general.enterPassword"),modelValue:c.value,"onUpdate:modelValue":a[4]||(a[4]=g=>c.value=g),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),e("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:a[5]||(a[5]=g=>ce())}," Sell "),e("div",Xt,[L(l,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white underline"},{default:J(()=>[_e(o(t.$t("general.cancel")),1)]),_:1})])])])])])}}});export{es as default};
