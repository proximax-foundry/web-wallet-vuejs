import{d as O,o as v,f as _,e as t,t as b,_ as Q,i as $,y as ae,k as le,j as se,g as o,c,W as N,w as W,A as a,H as d,n as K,B as ne,D as z,r as G,S as oe,a as re,b as M,l as f,Q as ie,s as ce,E as ue,I as de,J as ve,x as J}from"./index-ac085045.js";import{_ as me}from"./icon-red-x-a5511f99.js";import{_ as fe}from"./icon-green-tick-1b766454.js";import{_ as _e,a as be,b as pe,c as xe}from"./TxnSummary.vue_vue_type_script_setup_true_lang-ff48953a.js";import{T as he}from"./TransactionLayout-5136d917.js";import{T as L}from"./transactionState-90b266b3.js";import"./jdenticon-module-2a95d186.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-4c592bc8.js";import"./proximax-logo-ecfc3767.js";const ye={class:"border border-gray-200 px-2 py-2 rounded-md w-full"},ge={class:"flex gap-2"},ke={class:"flex flex-col w-full"},we={class:"uppercase text-gray-500 font-light text-xxs text-left"},Te=["value"],Ae={key:0,class:"flex flex-col ml-auto justify-center mt-1"},Ie=t("img",{src:me,class:"h-5 w-5 mr-auto ml-auto"},null,-1),$e={class:"text-xxs text-red-400 font-bold uppercase"},Pe={key:1,class:"flex flex-col ml-auto justify-center mt-1"},Ve=t("img",{src:fe,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Se={class:"text-xxs text-green-400 font-bold uppercase"},Fe=O({__name:"PublicKeyInputClean",props:{placeholder:String,showError:Boolean,modelValue:String},emits:["update:modelValue"],setup(r){return(i,n)=>(v(),_("div",ye,[t("div",ge,[t("div",ke,[t("div",we,b(r.placeholder),1),t("input",{autocomplete:"off",type:"text",value:r.modelValue,onInput:n[0]||(n[0]=P=>i.$emit("update:modelValue",P.target.value)),class:"w-full font-semibold text-tsm outline-none mt-1"},null,40,Te)]),r.showError?(v(),_("div",Ae,[Ie,t("div",$e,b(i.$t("general.invalid")),1)])):(v(),_("div",Pe,[Ve,t("div",Se,b(i.$t("general.valid")),1)]))])]))}});const Ce={props:{placeholder:String,errorMessage:String,showError:Boolean,modelValue:String,title:String,disabled:Boolean},emits:["update:modelValue"],name:"SelectLinkType",data(){return{inputText:"",borderColor:"border border-gray-300",textErr:!1}},watch:{showError:function(r){r?(this.borderColor="border-2 border-red-primary",this.textErr=!0):(this.borderColor="border-2 border-gray-300",this.textErr=!1)}}},Ee={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},He={class:"uppercase text-gray-500 text-txs text-left mb-2"},Be={class:"flex items-center"},Ne=["value","disabled","checked"],Ke=t("label",{for:"add",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Add",-1),Me=["value","disabled","checked"],Le=t("label",{for:"remove",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Remove",-1),De={class:"h-3 mb-2"},Ue={key:0,class:"error error-text text-left"};function je(r,i,n,P,h,V){return v(),_("div",null,[t("div",Ee,[t("div",He,b(n.title),1),t("div",Be,[t("input",{id:"add",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[0]||(i[0]=S=>r.$emit("update:modelValue","add")),checked:n.modelValue=="link"},null,40,Ne),Ke,t("input",{id:"remove",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[1]||(i[1]=S=>r.$emit("update:modelValue","remove")),checked:n.modelValue=="unlink"},null,40,Me),Le])]),t("div",De,[h.textErr||n.showError?(v(),_("div",Ue,b(n.errorMessage),1)):$("",!0)])])}const Re=Q(Ce,[["render",je]]),We=r=>(de("data-v-50d7fb02"),r=r(),ve(),r),ze=We(()=>t("div",{class:"font-semibold mb-4"},"Harvester Transaction",-1)),Ge={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},Je={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},Oe={class:"inline-block text-xs"},Qe={key:1,class:"error error_box"},qe={class:"mt-4"},Xe={class:"flex gap-1 mt-3"},Ye={key:0,class:"mt-3"},Ze={class:"mt-3"},et={class:""},tt=["disabled"],at={class:"text-center"},lt=O({__name:"ViewHarvesterTxn",setup(r){const i=ae(),n=le(),h=ue().appContext.config.globalProperties.emitter;se();const V=o("");o(!1);const S=o(!1),T=o(""),g=o(""),A=o(!0),F=o(),k=o(),C=o();c(()=>B.value||S.value);const q=()=>{try{C.value=J.PublicAccount.createFromPublicKey(g.value,a.networkType),A.value=!1}catch{A.value=!0}};try{F.value=N.createPublicAccount(W.currentLoggedInWallet?W.currentLoggedInWallet.selectDefaultAccount().publicKey:"",a.networkType)}catch(e){console.log(e)}const X=c(()=>{if(a.isReady){let e=a.buildTxn.addHarvester(d.samplePubAcc());if(s.value){let l=a.buildTxn.aggregateBonded([e.toAggregateV1(d.samplePubAcc())]);return d.amountFormatterSimple(l.maxFee.compact(),a.nativeToken.divisibility)}else return d.amountFormatterSimple(e.maxFee.compact(),a.nativeToken.divisibility)}else return"0"}),w=c(()=>d.convertNumberMinimumFormat(Number(X.value),a.nativeToken.divisibility)),D=c(()=>K.currentNetworkProfileConfig?d.convertToExact(K.currentNetworkProfileConfig.lockedFundsPerAggregate,a.nativeToken.divisibility):0),U=c(()=>K.currentNetworkProfile?d.convertToExact(ne.getLockFundFee(),a.nativeToken.divisibility):0),j=c(()=>D.value+U.value),Y=c(()=>g.value==""||A.value||B.value||!p.value||!F.value||!T.value),s=o(null),y=o(null),p=o(null),x=o(0),E=o(0),H=async e=>{if(a.chainAPI&&e)try{const l=await a.chainAPI.accountAPI.getAccountInfo(J.Address.createFromRawAddress(e)),m=l.mosaics.findIndex(u=>u.id.toHex()==a.nativeToken.assetId);return m!=-1?l.mosaics[m].amount.compact()/Math.pow(10,a.nativeToken.divisibility):0}catch{return 0}},B=c(()=>{if(p.value)return s.value?x.value<w.value+j.value:x.value<w.value});z(p,async(e,l)=>{e==null?(x.value=0,y.value=null,s.value=null,k.value=null):e!=l&&(y.value=null,s.value=null,k.value=null,x.value=await H(e))}),z(s,async(e,l)=>{e==null?(E.value=0,y.value=null,s.value=null,k.value=null,x.value=await H(p.value)):e!=l&&(E.value=await H(e))});const Z=c(()=>s.value?j.value+w.value:w.value),ee=c(()=>d.amountFormatterSimple(Z.value,0)),te=async()=>{let e,l;const m=T.value==="add";m?l=a.buildTxn.addHarvesterBuilder():l=a.buildTxn.removeHarvesterBuilder();try{const u=await a.chainAPI.harvesterAPI.getAccountHarvestingHarvesterInfo(d.createPublicAccount(g.value,a.networkType));if(m&&u.length){i.add({severity:"error",detail:"Harvester key found, it is already added",group:"br-custom",life:1e4});return}else if(!m&&u.length===0){i.add({severity:"error",detail:"Harvester key not found, does not need to be removed",group:"br-custom",life:1e4});return}}catch{return}s.value?e=[l.harvesterKey(C.value).build().toAggregateV1(k.value).serialize()]:e=l.harvesterKey(C.value).build().serialize(),L.unsignedTransactionPayload=e,L.selectedAddress=p.value,L.selectedMultisigAddress=s.value,n.push({name:"ViewConfirmTransaction"})};return h.on("select-account",e=>{p.value=e}),h.on("select-account-public-key",e=>{F.value=N.createPublicAccount(e,a.networkType)}),h.on("select-multisig-account",e=>{y.value=e.label,s.value=e.value,k.value=N.createPublicAccount(e.publicKey,a.networkType)}),h.on("CLOSE_MULTISIG",()=>{y.value=null,s.value=null}),(e,l)=>{const m=G("font-awesome-icon"),u=G("router-link"),R=oe("debounce");return v(),re(he,{class:"mt-8"},{white:M(()=>[ze,B.value?(v(),_("div",Ge,[t("div",Je,[f(m,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),t("div",Oe,b(e.$t("general.insufficientBalance")),1)])):$("",!0),V.value!=""?(v(),_("div",Qe,b(V.value),1)):$("",!0),t("div",qe,[t("div",Xe,[f(_e,{type:"dynamic",label:"Add Harvester"}),f(be,{"selected-address":p.value},null,8,["selected-address"])]),s.value?(v(),_("div",Ye,[f(pe,{"select-default-address":s.value,"select-default-name":y.value,label:"Multisig account selected",type:"dynamic"},null,8,["select-default-address","select-default-name"])])):$("",!0)]),t("div",Ze,[f(Re,{title:"Type",modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=I=>T.value=I),disabled:!1},null,8,["modelValue"])]),t("div",et,[ie(f(Fe,{placeholder:"Harvester Key",modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=I=>g.value=I),showError:A.value},null,8,["modelValue","showError"]),[[R,q,"1000"]])])]),navy:M(()=>[f(xe,{"signer-native-token-balance":x.value,"native-token-balance":s.value?E.value:x.value,"lock-fund":D.value,"lock-fund-tx-fee":U.value,"selected-multisig-address":s.value,"txn-fee":w.value,"total-fee":Number(ee.value)},null,8,["signer-native-token-balance","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),t("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:Y.value,onClick:te}," Create harvester transaction ",8,tt),t("div",at,[f(u,{to:{name:"ViewServices"},class:"content-center text-xs text-white border-b-2 border-white"},{default:M(()=>[ce(b(e.$t("general.cancel")),1)]),_:1})])]),_:1})}}});const mt=Q(lt,[["__scopeId","data-v-50d7fb02"]]);export{mt as default};
