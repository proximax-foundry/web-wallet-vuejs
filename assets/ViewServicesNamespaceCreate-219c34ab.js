import{_ as ee,ad as $e,P as ne,o as u,b as c,e as s,B as ie,t as r,Q as ue,f as C,l as q,d as ce,r as l,u as de,c as y,A as Z,g as Te,F as Ce,h as Pe,i as ve,q as Ie,n as h,ba as Se,bb as Ee,H as f,E as d,V as J,a as L,k as oe,s as w,z as Fe,W as Ve,w as re,K as Re}from"./index-a63143aa.js";import{_ as De}from"./PasswordInput.vue_vue_type_script_setup_true_lang-71b5a6a2.js";import{_ as Ae}from"./icon-info-8b4f1351.js";import{N as R}from"./namespaceUtils-8a7c04cc.js";import{D as Me}from"./DurationInputClean-4d8a0402.js";import{_ as Le,a as Ue,b as Be,c as We}from"./TxnSummary.vue_vue_type_script_setup_true_lang-4465343d.js";import{T as X}from"./transactionState-5a314dd5.js";import"./jdenticon-module-b1f729db.js";import"./proximax-logo-ecfc3767.js";const ze={directives:{tooltip:$e},props:{placeholder:String,errorMessage:String,showError:Boolean,disabled:Boolean,modelValue:String,toolTip:String},emits:["update:modelValue"],name:"TextInputTooltip",data(){return{textErr:!1}}},He={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},Oe={class:"uppercase text-gray-500 text-txs text-left mb-2"},qe={key:0,src:Ae,class:"inline-block ml-1 relative cursor-pointer",style:{top:"-1px"}},Qe=["disabled","value"],je={class:"h-3 mb-2"},Ge={key:0,class:"error error-text text-left"};function Ke(t,_,n,D,U,x){const i=ne("tooltip");return u(),c("div",{class:q(n.disabled?"opacity-50":"")},[s("div",He,[s("div",Oe,[ie(r(n.placeholder)+" ",1),n.toolTip?ue((u(),c("img",qe,null,512)),[[i,{value:"<tiptext>"+n.toolTip+"</tiptext>",escape:!0},void 0,{bottom:!0}]]):C("",!0)]),s("input",{disabled:n.disabled,value:n.modelValue,onInput:_[0]||(_[0]=g=>t.$emit("update:modelValue",g.target.value)),type:"text",class:"text_input"},null,40,Qe)]),s("div",je,[U.textErr||n.showError?(u(),c("div",Ge,r(n.errorMessage),1)):C("",!0)])],2)}const Ye=ee(ze,[["render",Ke]]),Je=ce({emits:["select-namespace","update:modelValue","clear-namespace"],name:"SelectInputParentNamespace",props:["modelValue","action","address","disabled"],setup(t,{emit:_}){const n=l(!1);ve().appContext.config.globalProperties.emitter;const{t:U}=de(),x=l(""),i=l(""),g=v=>{x.value=v.value,i.value=v.label,n.value=!n.value},o=()=>{x.value="",i.value=""},W=y(()=>{let v=[];v.push({value:"1",label:U("namespace.newRootNamespace"),level:0,disabled:!1});const A=R.listNamespaces(Z.Address.createFromRawAddress(t.address).plain());return A.length>0&&v.push.apply(v,A),v});return{selectNamespace:g,namespaces:W,toggleSelection:n,selectedNamespace:x,selectedNamespaceLabel:i,selectNs:v=>{v.disabled||(g(v),_("update:modelValue",x.value),_("select-namespace",x.value))},clearLabel:o}}}),Xe={class:"flex"},Ze={class:"flex flex-col ml-2 text-left"},ea={class:"text-blue-primary font-semibold text-xxs mb-1 uppercase",style:{"line-height":"9px"}},aa={key:0,class:"mt-1 text-tsm font-bold"},ta={key:1,class:"text-tsm font-bold"},sa={key:0,class:"text-xxs ml-auto cursor-pointer text-blue-primary font-semibold mt-auto mb-auto"},la={key:1,class:"text-xxs ml-auto cursor-pointer text-blue-primary font-semibold mt-auto mb-auto"},oa={class:"relative"},ra={key:0,class:"absolute border border-t-0 w-full z-50 bg-white max-h-40 overflow-auto px-3 filter drop-shodow-xl"},na={key:0,class:"uppercase pl-2 pt-4 text-xxs text-gray-400"},ia={key:1,class:"text-xxs pt-2 pl-2 pb-2"},ua=["onClick"],ca={key:0,class:"cursor-pointer text-blue-primary text-xxs mt-0.5 ml-auto font-semibold uppercase"},da={key:1,class:"text-gray-300 text-xxs mt-0.5 ml-auto uppercase"},va={key:2,class:"text-gray-500 text-xxs mt-0.5 ml-auto uppercase"};function ma(t,_,n,D,U,x){return u(),c("div",{class:q(["relative",t.disabled?"opacity-50":"cursor-pointer"])},[s("div",{onClick:_[1]||(_[1]=i=>t.disabled?"":t.toggleSelection=!t.toggleSelection),class:"border ml-auto mr-auto py-3 px-2 rounded-md w-full h-14"},[s("div",Xe,[s("div",Ze,[s("div",ea,r(t.$t("general.namespace")),1),t.selectedNamespace!=""?(u(),c("div",aa,r(t.selectedNamespaceLabel),1)):(u(),c("div",ta,r(t.$t("namespace.selectNamespace")),1))]),!t.toggleSelection&&t.selectedNamespace==""?(u(),c("div",sa,r(t.$t("general.select")),1)):C("",!0),!t.toggleSelection&&t.selectedNamespace!=""?(u(),c("div",la,r(t.$t("general.change")),1)):C("",!0),t.toggleSelection?(u(),c("img",{key:2,onClick:_[0]||(_[0]=i=>{t.selectedNamespace="",t.$emit("clear-namespace")}),src:Te,class:"h-5 w-5 ml-auto cursor-pointer text-blue-primary font-semibold mt-auto mb-auto"})):C("",!0)])]),s("div",oa,[t.toggleSelection?(u(),c("div",ra,[t.namespaces.length>0?(u(),c("div",na,r(t.$t("namespace.selectNamespace")),1)):(u(),c("div",ia,r(t.$t("general.listEmpty")),1)),(u(!0),c(Ce,null,Pe(t.namespaces,(i,g)=>(u(),c("div",{key:g,class:q(["px-2 py-3 flex items-center",[g!=t.namespaces.length-1?"border-b border-gray-200":"",i.disabled?"cursor-text":"cursor-pointer"]]),onClick:o=>t.selectNs(i)},[s("div",{class:q(["text-xs truncate",i.disabled?"text-gray-300":"text-black font-semibold"])},r(i.label),3),i.label!=t.selectedNamespace&&!i.disabled?(u(),c("div",ca,r(t.$t("general.select")),1)):i.disabled?(u(),c("div",da,r(t.$t("general.disabled")),1)):(u(),c("div",va,r(t.$t("general.current")),1))],10,ua))),128))])):C("",!0)])],2)}const pa=ee(Je,[["render",ma]]),fa={class:"w-10/12 ml-auto mr-auto"},ba={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},ga={class:"xl:col-span-2 p-12"},ha={class:"font-semibold mb-4"},_a={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},ya={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},xa={class:"inline-block text-xs"},Na={key:1,class:"error error_box"},ka={class:"mt-4"},wa={class:"flex gap-1 mt-3"},$a={key:0,class:"mt-3"},Ta={class:"lg:grid lg:grid-cols-2 mt-5"},Ca={class:"mb-5 lg:mb-0 lg:mr-2"},Pa={class:"mb-5 lg:mb-0 lg:ml-2"},Ia={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},Sa={class:"text-xs text-white my-5"},Ea=["disabled"],Fa={class:"text-center"},Va={class:"sm:grid sm:grid-cols-2 mt-10 lg:mt-16"},Ra={class:"mb-8 sm:pr-1"},Da={href:"https://bcdocs.xpxsirius.io/docs/built-in-features/namespace/",target:"_new",class:"sm:h-9 lg:h-5 text-blue-primary font-bold text-tsm items-start flex"},Aa={class:"text-gray-400 text-tsm my-3 sm:pr-2"},Ma={class:"mb-8"},La={href:"https://t.me/proximaxhelpdesk",target:"_new",class:"sm:h-9 lg:h-5 text-blue-primary font-bold text-tsm items-start flex"},Ua={class:"text-gray-400 text-tsm my-3"},Ba="^[^ ]{8,}$",Wa=ce({__name:"ViewServicesNamespaceCreate",setup(t){const _=Ie(),{t:n}=de(),D=l(null),x=ve().appContext.config.globalProperties.emitter,i=l(!1),g=l(!1),o=l(""),W=l(!1),N=l("1"),v=l(""),A=l(""),P=l(n("namespace.validName"));l("");const I=l(!1),S=l(!1),ae=l(!1),me=l(!1),te=`^[0-9a-z]{2,${y(()=>h.currentNetworkProfileConfig?h.currentNetworkProfileConfig.maxNameSize:0).value}}$`,b=l(!1),M=y(()=>h.currentNetworkProfileConfig?Math.floor(Se.configReturn(h.currentNetworkProfileConfig.maxNamespaceDuration,Ee.DAY)):0),m=l(""),B=y(()=>m.value?m.value=="1"?Number(N.value)>0?f.convertToExact(h.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*R.calculateDuration(Number(N.value)),d.nativeToken.divisibility):f.convertToExact(h.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,d.nativeToken.divisibility):f.convertToExact(h.currentNetworkProfileConfig.childNamespaceRentalFee,d.nativeToken.divisibility):0),pe=y(()=>f.toCurrencyFormat(B.value,d.nativeToken.divisibility)),Q=y(()=>h.currentNetworkProfileConfig?f.convertToExact(h.currentNetworkProfileConfig.lockedFundsPerAggregate,d.nativeToken.divisibility):0),j=y(()=>h.currentNetworkProfile?f.convertToExact(J.getLockFundFee(),d.nativeToken.divisibility):0),fe=y(()=>Q.value+j.value),be=y(()=>!(v.value.match(Ba)&&o.value.match(te)&&!W.value&&!se.value&&!b.value&&m.value)),p=l(null),z=l(null),k=l(null),$=l(0),H=l(0),G=async e=>{if(d.chainAPI&&e)try{const a=await d.chainAPI.accountAPI.getAccountInfo(Z.Address.createFromRawAddress(e)),E=a.mosaics.findIndex(F=>F.id.toHex()==d.nativeToken.assetId);return E!=-1?a.mosaics[E].amount.compact()/Math.pow(10,d.nativeToken.divisibility):0}catch{return 0}},se=y(()=>{if(k.value)return p.value?H.value<B.value?!0:$.value<T.value+fe.value:$.value<B.value+T.value});$.value<B.value?(I.value=!0,ae.value=!0,S.value=!0,i.value=!0,g.value=!0):(I.value=!1,ae.value=!1,S.value=!1,i.value=!1,g.value=!1);const O=l(0),T=l(0),ge=()=>{m.value=""},he=e=>{let a=0;e=="1"?(N.value="1",S.value=!1,o.value.trim().length>0&&!b.value&&(a=R.getRootNamespaceTransactionFee(o.value),O.value=Number(f.convertToCurrency(a,d.nativeToken.divisibility)),T.value=f.convertToExact(a,d.nativeToken.divisibility))):(N.value="0",S.value=!0,o.value.trim().length>0&&!b.value&&(a=R.getSubNamespaceTransactionFee(e,o.value),O.value=Number(f.convertToCurrency(a,d.nativeToken.divisibility)),T.value=f.convertToExact(a,d.nativeToken.divisibility)))};L(m,e=>{e?(i.value=!1,S.value=!1,I.value=!1):(i.value=!0,S.value=!0,I.value=!0)},{immediate:!0});const _e=()=>{if(!Ve.verifyWalletPassword(re.currentLoggedInWallet.name,h.chainNetworkName,v.value)){A.value=n("general.walletPasswordInvalid",{name:re.currentLoggedInWallet.name});return}let a,E=d.buildTxn;if(m.value==="1"){let F=E.registerRootNamespace(o.value,Z.UInt64.fromUint(R.calculateDuration(Number(N.value))));a=J.signTxnWithPassword(k.value,p.value,v.value,F)}else{let F=E.registersubNamespace(m.value,o.value);a=J.signTxnWithPassword(k.value,p.value,v.value,F)}X.lockHashPayload=a.hashLockTxnPayload,X.transactionPayload=a.txnPayload,X.selectedAddress=k.value,_.push({name:"ViewConfirmTransaction"})};L(N,e=>{parseInt(e)>M.value&&(N.value=`${M.value}`)});const K=()=>{N.value="1"},le=y(()=>{if(p.value){let e=[Q.value,j.value,T.value];return f.safeSum(e)}else return B.value+T.value});L(le,e=>{$.value<e?(I.value=!0,g.value=!0):(I.value=!1,g.value=!1)});const ye=y(()=>h.currentNetworkProfileConfig?h.currentNetworkProfileConfig.reservedRootNamespaceNames.split(",").map(e=>e.trim()):[]),xe=()=>m.value==="1"&&ye.value.includes(o.value.trim())?(b.value=!0,P.value=n("namespace.reservedName"),!0):!1,Ne=async()=>{if(m.value==="1"&&o.value.trim())try{let e=await Re.getNamespaceInfo(f.createNamespaceId(o.value));if(p.value){if(e.owner.address.plain()!==p.value)return b.value=!0,P.value=n("namespace.nameRegistered"),!0}else if(e.owner.address.plain()!==k.value)return b.value=!0,P.value=n("namespace.nameRegistered"),!0}catch{return!1}return!1},ke=async()=>{if(o.value.trim()){if(xe())return;if(b.value=!o.value.match(te),b.value)P.value=n("namespace.validName");else{if(await Ne())return;let a=0;m.value=="1"?o.value.trim().length>0&&!b.value&&(a=R.getRootNamespaceTransactionFee(o.value),O.value=Number(f.convertToCurrency(a,d.nativeToken.divisibility)),T.value=f.convertToExact(a,d.nativeToken.divisibility)):o.value.trim().length>0&&!b.value&&(a=R.getSubNamespaceTransactionFee(o.value,m.value),O.value=Number(f.convertToCurrency(a,d.nativeToken.divisibility)),T.value=f.convertToExact(a,d.nativeToken.divisibility))}}},Y=()=>{o.value="",m.value="",D.value.clearLabel(),b.value=!1,K(),z.value=null,p.value=null};return L(k,async(e,a)=>{e==null?($.value=0,Y()):e!=a&&(Y(),$.value=await G(e))}),L(p,async(e,a)=>{e==null?(H.value=0,Y(),$.value=await G(k.value)):e!=a&&(m.value="",o.value="",D.value.clearLabel(),b.value=!1,K(),H.value=await G(e))}),L(o,e=>{m.value===""?(b.value=!1,P.value=""):e.length==0&&(b.value=!0,P.value=n("namespace.validName"))}),x.on("select-account",e=>{k.value=e}),x.on("select-multisig-account",e=>{z.value=e.label,p.value=e.value}),x.on("CLOSE_MULTISIG",()=>{z.value=null,p.value=null}),(e,a)=>{const E=oe("font-awesome-icon"),F=oe("router-link"),we=ne("debounce");return u(),c("div",null,[s("div",fa,[s("div",ba,[s("div",ga,[s("div",ha,r(e.$t("general.createNamespace")),1),se.value?(u(),c("div",_a,[s("div",ya,[w(E,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),s("div",xa,r(e.$t("general.insufficientBalance")),1)])):C("",!0),A.value!=""?(u(),c("div",Na,r(A.value),1)):C("",!0),s("div",ka,[s("div",wa,[w(Le,{type:"namespace"}),w(Ue,{"selected-address":k.value},null,8,["selected-address"])]),p.value?(u(),c("div",$a,[w(Be,{"select-default-address":p.value,"select-default-name":z.value,type:"namespace"},null,8,["select-default-address","select-default-name"])])):C("",!0),w(pa,{onSelectNamespace:he,onClearNamespace:ge,ref_key:"nsRef",ref:D,modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=V=>m.value=V),address:p.value?p.value:k.value,class:"mt-5",disabled:g.value},null,8,["modelValue","address","disabled"]),s("div",Ta,[s("div",Ca,[ue(w(Ye,{disabled:i.value,placeholder:e.$t("general.name"),errorMessage:P.value,modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=V=>o.value=V),icon:"id-card-alt",showError:b.value,class:"w-full inline-block",toolTip:e.$t("namespace.namespaceNameMsg1")+"<br><br>"+e.$t("namespace.namespaceNameMsg2")+"<br><br>"+e.$t("namespace.namespaceNameMsg3"),tabindex:"0"},null,8,["disabled","placeholder","errorMessage","modelValue","showError","toolTip"]),[[we,ke,"1000"]])]),s("div",Pa,[w(Me,{disabled:S.value,modelValue:N.value,"onUpdate:modelValue":a[2]||(a[2]=V=>N.value=V),max:M.value,placeholder:e.$t("namespace.duration"),onSetDefaultDuration:K,showError:W.value,toolTip:e.$t("namespace.durationMsg")+`<br>${M.value===365?"1 "+e.$t("general.year"):""} (${M.value}`+e.$t("general.day",M.value)+")."},null,8,["disabled","modelValue","max","placeholder","showError","toolTip"])])])])]),s("div",Ia,[w(We,{"signer-native-token-balance":$.value,"namespace-rental-fee-currency":pe.value,"native-token-balance":p.value?H.value:$.value,"lock-fund":Q.value,"lock-fund-tx-fee":j.value,"selected-multisig-address":p.value,"txn-fee":T.value,"total-fee":le.value},null,8,["signer-native-token-balance","namespace-rental-fee-currency","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),s("div",Sa,r(e.$t("general.enterPasswordContinue")),1),w(De,{placeholder:e.$t("general.password"),errorMessage:e.$t("general.passwordRequired"),showError:me.value,modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=V=>v.value=V),disabled:I.value},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),s("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:be.value,onClick:_e},r(e.$t("namespace.registerNamespace")),9,Ea),s("div",Fa,[w(F,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Fe(()=>[ie(r(e.$t("general.cancel")),1)]),_:1})])])]),s("div",Va,[s("div",Ra,[s("a",Da,r(e.$t("general.namespaceQues")),1),s("div",Aa,r(e.$t("namespace.namespaceAns")),1)]),s("div",Ma,[s("a",La,r(e.$t("general.feedback")),1),s("div",Ua,r(e.$t("general.feedbackDescription")),1)])])])])}}});const Xa=ee(Wa,[["__scopeId","data-v-7be4e4b9"]]);export{Xa as default};
