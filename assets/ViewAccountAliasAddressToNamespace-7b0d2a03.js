import{d as oe,u as de,r as m,c as t,w as r,n as M,H as K,B as f,R as ue,a as I,l as ce,z as g,i as W,o as z,b as O,m as c,v as Z,e as d,t as N,f as ve,j,x as me}from"./index-afd1020c.js";import{a as x}from"./accountUtils-4298dcf8.js";import{A as ge,_ as pe}from"./AccountTabs.vue_vue_type_script_setup_true_lang-57c705a8.js";import{M as H}from"./multisigUtils-20f56368.js";import{_ as fe}from"./AddressInputClean.vue_vue_type_style_index_0_lang-7fd63744.js";import{_ as be}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-7d243f5c.js";import{_ as ke}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-5def6846.js";import{T as U}from"./transactionState-7849e3b3.js";import"./jdenticon-module-971263f4.js";import"./functions-372bba67.js";import"./TextInput-25b49b99.js";import"./TextInputClean-a4fdbca6.js";import"./icon-key-5b3f7dda.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";import"./proximax-logo-ecfc3767.js";const ye={class:"w-10/12 mx-auto mt-5"},he={class:"border-2 border-t-0 filter shadow-lg xl:grid xl:grid-cols-3"},Ae={class:"lg:col-span-2 py-6 px-6"},Le={key:0,class:"text-tsm flex gap-2 items-center"},we={class:"font-semibold mt-3"},Te={class:"flex flex-col"},Ce={class:"flex mt-3 gap-1"},Ie=["disabled"],Ne={class:"bg-navy-primary p-6 lg:col-span-1"},xe=d("div",{class:"mt-3"},null,-1),Se=["disabled"],Fe={class:"text-center"},$e="^[0-9A-Za-z]{40}$",Me="^[0-9A-Za-z-]{46}$",qe=oe({__name:"ViewAccountAliasAddressToNamespace",props:{address:{}},setup(v){const{t:h}=de(),S=m({name:"",value:""}),G=[{value:"Link",label:h("general.link")},{value:"Unlink",label:h("general.unlink")}],n=m({value:"Link",label:h("general.link")}),i=m(null),A=e=>{let s=r.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length,multisigInfo:a.multisigInfo})),l=r.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0,multisigInfo:a.multisigInfo}));return s.concat(l).find(a=>a.publicKey==e)},L=t(()=>{var e;return((e=r.currentLoggedInWallet)==null?void 0:e.accounts.find(s=>s.address==v.address))||r.currentLoggedInWallet.others.find(s=>s.address==v.address)}),q=m(""),u=m(""),C=m(!0),V=m(""),B=t(()=>M.currentNetworkProfileConfig?K.convertToExact(M.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),P=t(()=>M.currentNetworkProfile?K.convertToExact(ue.getLockFundFee(),f.nativeToken.divisibility):0);r.currentLoggedInWallet&&r.currentLoggedInWallet.name;const w=m(0),_=t(()=>{let e=f.nativeToken.divisibility;return p.value.hasCosigner?e==0?Math.trunc(w.value+B.value+P.value):Math.round((w.value+B.value+P.value)*Math.pow(10,f.nativeToken.divisibility))/Math.pow(10,f.nativeToken.divisibility):w.value}),R=t(()=>L.value?L.value.balance:0),J=t(()=>f.nativeToken.divisibility),Q=t(()=>r.currentLoggedInWallet?K.toCurrencyFormat(R.value,J.value):"0"),D=t(()=>{var e=!1;return p.value.hasCosigner?A(b.value)&&(A(b.value).balance<_.value?e=!0:e=!1):R.value<_.value&&(e=!0),e}),X=t(()=>!(D.value==!1&&u.value!=""&&i.value.value!=null&&C.value==!1)),Y=t(()=>x.namespaceOption(v.address,n.value.value)),ee=t(()=>{var s,l;return(((s=r.currentLoggedInWallet)==null?void 0:s.accounts.find(a=>a.address==v.address))||((l=r.currentLoggedInWallet)==null?void 0:l.others.find(a=>a.address==v.address))).namespaces.filter(a=>a.active==!0)}),p=t(()=>{if(M.currentNetworkProfileConfig){const s=H.getCosignerInWallet(L.value.publicKey?L.value.publicKey:"").cosignerList.map(a=>({publicKey:a,name:A(a).name,balance:A(a).balance,address:A(a).address}));let l=!1;return s.length>0&&(l=!0),{hasCosigner:l,cosignerList:s}}else return{hasCosigner:!1,cosignerList:[]}}),ae=t(()=>p.value.cosignerList.map(e=>({name:e.name,value:e.publicKey}))),b=m("");I(S,e=>{e.value!=""?b.value=e.value:b.value=""},{deep:!0});const E=t(()=>L.value?H.getCosignerInWallet(L.value.publicKey).cosignerList.length>0:!1),F=t(()=>!!(!E.value&&p.value.hasCosigner||!ee.value.length));I(n,()=>{u.value="",i.value=null},{immediate:!0}),I(i,e=>{var a;const l=x.getNamespaceListByAddress(v.address).find(k=>{var T;return k.name===((T=i.value)==null?void 0:T.value)});if(n.value.value=="Unlink"&&e!=null)u.value=g.Address.createFromRawAddress(l.linkedId).pretty();else if(n.value.value=="Link"&&u.value!=""&&e.value!=null){let k=g.Address.createFromRawAddress(u.value).plain();w.value=x.getLinkNamespaceToAddressTransactionFee(p.value.hasCosigner,k,(a=i.value)==null?void 0:a.value,n.value.value)/Math.pow(10,f.nativeToken.divisibility)}}),I(u,e=>{var s;if(e.length==46&&e.match(Me)||e.length==40&&e.match($e))if(x.verifyAddress(v.address,u.value).isPassed==!1)V.value="Invalid Address",C.value=!0;else{let a=g.Address.createFromRawAddress(e).plain();w.value=x.getLinkNamespaceToAddressTransactionFee(p.value.hasCosigner,a,(s=i.value)==null?void 0:s.value,n.value.value)/Math.pow(10,f.nativeToken.divisibility),V.value="",C.value=!1}else C.value=!0});const se=ce(),le=()=>{var o;let e=r.currentLoggedInWallet.accounts.find(y=>y.address==v.address)?r.currentLoggedInWallet.accounts.find(y=>y.address==v.address):r.currentLoggedInWallet.others.find(y=>y.address==v.address);q.value="";const s=f.buildTxn,l=n.value.value=="Link"?g.AliasActionType.Link:g.AliasActionType.Unlink,a=new g.NamespaceId((o=i.value)==null?void 0:o.value),k=g.Address.createFromRawAddress(u.value),T=s.addressAliasBuilder().actionType(l).namespaceId(a).address(k).build();if(b.value){let y=r.currentLoggedInWallet.accounts.find(ie=>ie.publicKey==b.value).address;U.selectedAddress=y,U.selectedMultisigAddress=e.address}else U.selectedAddress=e.address;U.unsignedTransactionPayload=T.serialize(),se.push({name:"ViewConfirmTransaction"})},te=t(()=>{let e=A(b.value);return e?e.balance:0});I(p,e=>{e.cosignerList.length&&(S.value={name:e.cosignerList[0].name,value:e.cosignerList[0].publicKey})},{immediate:!0});const $=m(!1),ne=e=>{$.value=!1,u.value=e.data},re=t(()=>{const e=r.currentLoggedInWallet;if(!e)return[];const s=[...e.accounts,...e.others];return e.contacts.length?[{key:"0",label:h("general.ownerAcc"),selectable:!1,children:s.map((l,a)=>({key:"0-"+a.toString(),label:l.name,data:g.Address.createFromRawAddress(l.address).pretty(),selectable:!0}))},{key:"1",label:h("general.contact"),selectable:!1,children:e.contacts.map((l,a)=>({key:"1-"+a.toString(),label:l.name,data:g.Address.createFromRawAddress(l.address).pretty(),selectable:!0}))}]:[{key:"0",label:h("general.ownerAcc"),selectable:!1,children:s.map((l,a)=>({key:"0-"+a.toString(),label:l.name,data:g.Address.createFromRawAddress(l.address).pretty(),selectable:!0}))}]});return(e,s)=>{const l=W("Sidebar"),a=W("Dropdown"),k=W("font-awesome-icon"),T=W("router-link");return z(),O("div",null,[c(l,{visible:$.value,"onUpdate:visible":s[0]||(s[0]=o=>$.value=o),baseZIndex:1e4,position:"full"},{default:Z(()=>[c(ke,{contacts:re.value,onNodeSelect:ne},null,8,["contacts"])]),_:1},8,["visible"]),d("div",ye,[c(ge,{address:e.address,class:"mb-6"},null,8,["address"]),c(pe,{address:e.address,selected:"details"},null,8,["address"]),d("div",he,[d("div",Ae,[p.value.cosignerList.length?(z(),O("div",Le,[d("div",null,N(e.$t("general.initiateBy"))+":",1),c(a,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=o=>S.value=o),options:ae.value,class:"text-tsm","option-label":"name"},null,8,["modelValue","options"])])):ve("",!0),d("div",we,N(n.value.value=="Link"?e.$t("general.linkToNamespace"):e.$t("namespace.manageNamespace")),1),d("div",Te,[c(a,{class:"my-3",placeholder:e.$t("namespace.selectAction"),modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=o=>n.value=o),options:G,"option-label":"label",disabled:F.value},null,8,["placeholder","modelValue","disabled"]),c(a,{placeholder:e.$t("namespace.selectNamespace"),modelValue:i.value,"onUpdate:modelValue":s[3]||(s[3]=o=>i.value=o),"option-label":"label",options:Y.value,"option-disabled":"disabled",disabled:F.value},null,8,["placeholder","modelValue","options","disabled"])]),d("div",Ce,[c(fe,{placeholder:e.$t("general.addAccAddress"),modelValue:u.value,"onUpdate:modelValue":s[4]||(s[4]=o=>u.value=o),errorMessage:V.value,showError:C.value,disabled:F.value||n.value.value=="Unlink"||i.value==null},null,8,["placeholder","modelValue","errorMessage","showError","disabled"]),d("button",{class:"border rounded-md cursor-pointer flex flex-col justify-around p-2",onClick:s[5]||(s[5]=o=>$.value=!0),disabled:F.value||n.value.value=="Unlink"||i.value==null},[c(k,{icon:"id-card-alt",class:j([i.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","ml-auto mr-auto"])},null,8,["class"]),d("div",{class:j([i.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","text-xxs font-semibold uppercase"])},N(e.$t("general.select")),3)],8,Ie)])]),d("div",Ne,[c(be,{"transaction-fee":String(w.value),"total-fee-formatted":String(_.value),"get-multi-sig-cosigner":p.value,"check-cosign-balance":String(te.value),"lock-fund-currency":String(B.value),"lock-fund-tx-fee":String(P.value),balance:Q.value,"selected-acc-add":e.address,"is-cosigner":E.value,"fund-status":D.value},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add","is-cosigner","fund-status"]),xe,d("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:le,disabled:X.value},N(n.value.value=="Unlink"?e.$t("namespace.unlinkNamespace"):e.$t("general.linkToNamespace")),9,Se),d("div",Fe,[c(T,{to:{name:"ViewAccountDetails",params:{address:e.address}},class:"content-center text-xs text-white underline"},{default:Z(()=>[me(N(e.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}}});export{qe as default};
