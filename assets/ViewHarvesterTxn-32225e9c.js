import{d as J,o as f,b as _,e as t,t as p,_ as Q,f as C,A as re,l as ie,r as o,u as ce,c,W as V,w as S,B as l,H as v,n as F,S as U,a as q,i as z,M as ue,m,O as de,v as ve,x as me,h as fe,I as _e,J as pe,z as G}from"./index-bd0ab822.js";import{_ as be}from"./icon-red-x-a5511f99.js";import{_ as he}from"./icon-green-tick-1b766454.js";import{_ as xe,a as ge,b as ye,c as we}from"./TxnSummary.vue_vue_type_script_setup_true_lang-c29e63c9.js";import{_ as ke}from"./PasswordInput.vue_vue_type_script_setup_true_lang-8961f750.js";import{T as R}from"./transactionState-73249cdc.js";import"./jdenticon-module-75786862.js";import"./proximax-logo-ecfc3767.js";const Te={class:"border border-gray-200 px-2 py-2 rounded-md w-full"},Pe={class:"flex gap-2"},Ae={class:"flex flex-col w-full"},$e={class:"uppercase text-gray-500 font-light text-xxs text-left"},Ie=["value"],Ve={key:0,class:"flex flex-col ml-auto justify-center mt-1"},Se=t("img",{src:be,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Fe={class:"text-xxs text-red-400 font-bold uppercase"},Ce={key:1,class:"flex flex-col ml-auto justify-center mt-1"},Ee=t("img",{src:he,class:"h-5 w-5 mr-auto ml-auto"},null,-1),He={class:"text-xxs text-green-400 font-bold uppercase"},Be=J({__name:"PublicKeyInputClean",props:{placeholder:String,showError:Boolean,modelValue:String},emits:["update:modelValue"],setup(r){return(i,n)=>(f(),_("div",Te,[t("div",Pe,[t("div",Ae,[t("div",$e,p(r.placeholder),1),t("input",{autocomplete:"off",type:"text",value:r.modelValue,onInput:n[0]||(n[0]=E=>i.$emit("update:modelValue",E.target.value)),class:"w-full font-semibold text-tsm outline-none mt-1"},null,40,Ie)]),r.showError?(f(),_("div",Ve,[Se,t("div",Fe,p(i.$t("general.invalid")),1)])):(f(),_("div",Ce,[Ee,t("div",He,p(i.$t("general.valid")),1)]))])]))}});const Ne={props:{placeholder:String,errorMessage:String,showError:Boolean,modelValue:String,title:String,disabled:Boolean},emits:["update:modelValue"],name:"SelectLinkType",data(){return{inputText:"",borderColor:"border border-gray-300",textErr:!1}},watch:{showError:function(r){r?(this.borderColor="border-2 border-red-primary",this.textErr=!0):(this.borderColor="border-2 border-gray-300",this.textErr=!1)}}},Me={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},Ke={class:"uppercase text-gray-500 text-txs text-left mb-2"},Le={class:"flex items-center"},We=["value","disabled","checked"],Ue=t("label",{for:"add",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Add",-1),Re=["value","disabled","checked"],je=t("label",{for:"remove",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Remove",-1),De={class:"h-3 mb-2"},Oe={key:0,class:"error error-text text-left"};function qe(r,i,n,E,y,h){return f(),_("div",null,[t("div",Me,[t("div",Ke,p(n.title),1),t("div",Le,[t("input",{id:"add",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[0]||(i[0]=H=>r.$emit("update:modelValue","add")),checked:n.modelValue=="link"},null,40,We),Ue,t("input",{id:"remove",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[1]||(i[1]=H=>r.$emit("update:modelValue","remove")),checked:n.modelValue=="unlink"},null,40,Re),je])]),t("div",De,[y.textErr||n.showError?(f(),_("div",Oe,p(n.errorMessage),1)):C("",!0)])])}const ze=Q(Ne,[["render",qe]]),Ge=r=>(_e("data-v-f27eb9e1"),r=r(),pe(),r),Je={class:"w-10/12 ml-auto mr-auto"},Qe={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Xe={class:"xl:col-span-2 p-12"},Ye=Ge(()=>t("div",{class:"font-semibold mb-4"},"Harvester Transaction",-1)),Ze={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},et={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},tt={class:"inline-block text-xs"},at={key:1,class:"error error_box"},lt={class:"mt-4"},st={class:"flex gap-1 mt-3"},ot={key:0,class:"mt-3"},nt={class:"mt-3"},rt={class:""},it={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},ct={class:"text-xs text-white my-5"},ut=["disabled"],dt={class:"text-center"},vt="^[^ ]{8,}$",mt=J({__name:"ViewHarvesterTxn",setup(r){const i=re(),n=ie(),y=fe().appContext.config.globalProperties.emitter,h=o(""),{t:H}=ce(),B=o(""),X=o(!1),Y=o(!1),$=o(""),T=o(""),I=o(!0),N=o(),P=o(),M=o(),Z=c(()=>W.value||Y.value),ee=()=>{try{M.value=G.PublicAccount.createFromPublicKey(T.value,l.networkType),I.value=!1}catch{I.value=!0}};try{N.value=V.createPublicAccount(S.currentLoggedInWallet?S.currentLoggedInWallet.selectDefaultAccount().publicKey:"",l.networkType)}catch(e){console.log(e)}const te=c(()=>{if(l.isReady){let e=l.buildTxn.addHarvester(v.samplePubAcc());if(s.value){let a=l.buildTxn.aggregateBonded([e.toAggregateV1(v.samplePubAcc())]);return v.amountFormatterSimple(a.maxFee.compact(),l.nativeToken.divisibility)}else return v.amountFormatterSimple(e.maxFee.compact(),l.nativeToken.divisibility)}else return"0"}),A=c(()=>v.convertNumberMinimumFormat(Number(te.value),l.nativeToken.divisibility)),j=c(()=>F.currentNetworkProfileConfig?v.convertToExact(F.currentNetworkProfileConfig.lockedFundsPerAggregate,l.nativeToken.divisibility):0),D=c(()=>F.currentNetworkProfile?v.convertToExact(U.getLockFundFee(),l.nativeToken.divisibility):0),O=c(()=>j.value+D.value),ae=c(()=>!h.value.match(vt)||T.value==""||I.value||W.value||!u.value||!N.value||!$.value),s=o(null),w=o(null),u=o(null),x=o(0),K=o(0),L=async e=>{if(l.chainAPI&&e)try{const a=await l.chainAPI.accountAPI.getAccountInfo(G.Address.createFromRawAddress(e)),d=a.mosaics.findIndex(g=>g.id.toHex()==l.nativeToken.assetId);return d!=-1?a.mosaics[d].amount.compact()/Math.pow(10,l.nativeToken.divisibility):0}catch{return 0}},W=c(()=>{if(u.value)return s.value?x.value<A.value+O.value:x.value<A.value});q(u,async(e,a)=>{e==null?(x.value=0,w.value=null,s.value=null,P.value=null):e!=a&&(w.value=null,s.value=null,P.value=null,x.value=await L(e))}),q(s,async(e,a)=>{e==null?(K.value=0,w.value=null,s.value=null,P.value=null,x.value=await L(u.value)):e!=a&&(K.value=await L(e))});const le=c(()=>s.value?O.value+A.value:A.value),se=c(()=>v.amountFormatterSimple(le.value,0)),oe=async()=>{if(!V.verifyWalletPassword(S.currentLoggedInWallet.name,F.chainNetworkName,h.value)){B.value=H("general.walletPasswordInvalid",{name:S.currentLoggedInWallet.name});return}let a,d;const g=$.value==="add";g?d=l.buildTxn.addHarvesterBuilder():d=l.buildTxn.removeHarvesterBuilder();try{const b=await l.chainAPI.harvesterAPI.getAccountHarvestingHarvesterInfo(v.createPublicAccount(T.value,l.networkType));if(g&&b.length){i.add({severity:"error",detail:"Harvester key found, it is already added",group:"br-custom",life:1e4});return}else if(!g&&b.length===0){i.add({severity:"error",detail:"Harvester key not found, does not need to be removed",group:"br-custom",life:1e4});return}}catch{return}if(s.value){const ne=[d.harvesterKey(M.value).build().toAggregateV1(P.value)];a=U.signTxnWithPassword(u.value,s.value,h.value,null,ne)}else{const b=d.harvesterKey(M.value).build();a=U.signTxnWithPassword(u.value,s.value,h.value,b)}R.lockHashPayload=a.hashLockTxnPayload,R.transactionPayload=a.txnPayload,R.selectedAddress=u.value,n.push({name:"ViewConfirmTransaction"})};return y.on("select-account",e=>{u.value=e}),y.on("select-account-public-key",e=>{N.value=V.createPublicAccount(e,l.networkType)}),y.on("select-multisig-account",e=>{w.value=e.label,s.value=e.value,P.value=V.createPublicAccount(e.publicKey,l.networkType)}),y.on("CLOSE_MULTISIG",()=>{w.value=null,s.value=null}),(e,a)=>{const d=z("font-awesome-icon"),g=z("router-link"),b=ue("debounce");return f(),_("div",null,[t("div",Je,[t("div",Qe,[t("div",Xe,[Ye,W.value?(f(),_("div",Ze,[t("div",et,[m(d,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),t("div",tt,p(e.$t("general.insufficientBalance")),1)])):C("",!0),B.value!=""?(f(),_("div",at,p(B.value),1)):C("",!0),t("div",lt,[t("div",st,[m(xe,{type:"dynamic",label:"Add Harvester"}),m(ge,{"selected-address":u.value},null,8,["selected-address"])]),s.value?(f(),_("div",ot,[m(ye,{"select-default-address":s.value,"select-default-name":w.value,label:"Multisig account selected",type:"dynamic"},null,8,["select-default-address","select-default-name"])])):C("",!0)]),t("div",nt,[m(ze,{title:"Type",modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=k=>$.value=k),disabled:!1},null,8,["modelValue"])]),t("div",rt,[de(m(Be,{placeholder:"Harvester Key",modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=k=>T.value=k),showError:I.value},null,8,["modelValue","showError"]),[[b,ee,"1000"]])])]),t("div",it,[m(we,{"signer-native-token-balance":x.value,"native-token-balance":s.value?K.value:x.value,"lock-fund":j.value,"lock-fund-tx-fee":D.value,"selected-multisig-address":s.value,"txn-fee":A.value,"total-fee":Number(se.value)},null,8,["signer-native-token-balance","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),t("div",ct,p(e.$t("general.enterPasswordContinue")),1),m(ke,{placeholder:e.$t("general.password"),errorMessage:e.$t("general.passwordRequired"),showError:X.value,modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=k=>h.value=k),disabled:Z.value},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),t("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:ae.value,onClick:oe}," Create harvester transaction ",8,ut),t("div",dt,[m(g,{to:{name:"ViewServices"},class:"content-center text-xs text-white border-b-2 border-white"},{default:ve(()=>[me(p(e.$t("general.cancel")),1)]),_:1})])])])])])}}});const wt=Q(mt,[["__scopeId","data-v-f27eb9e1"]]);export{wt as default};
