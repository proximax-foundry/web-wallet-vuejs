import{_ as ae,u as ne,D as le,c as q,w as i,r as F,E as y,B as n,q as ie,k as C,o as m,b as p,e as l,s as I,t as g,z,A as G,f as b,F as ce,i as de,a0 as J,n as L,aU as ue,W as K,p as me,j as pe}from"./index-47d422d4.js";import{c as ge}from"./functions-4879562c.js";import{M as fe}from"./multisigUtils-bc8d203b.js";import{A as Ae,a as ve}from"./AccountTabs-0ac62344.js";import"./jdenticon-module-4c899338.js";import"./TextInput-585f2c09.js";import"./TextInputClean-5836e25c.js";import"./icon-key-5b3f7dda.js";const ye="/web-wallet-vuejs/assets/chevron_right-3f95020a.svg";const be={name:"ViewMultisigHome",props:{address:String},components:{AccountComponent:Ae,AccountTabs:ve},setup(o){const{t:c}=ne(),w=le(),s=q(()=>{if(!i.currentLoggedInWallet)return null;let e=i.currentLoggedInWallet.accounts.find(r=>r.address==o.address)||i.currentLoggedInWallet.others.find(r=>r.address==o.address);return e||null}),_=e=>n.Address.createFromRawAddress(e).plain(),A=e=>{let r=_(e);return(i.currentLoggedInWallet.accounts.find(u=>u.address==r)||i.currentLoggedInWallet.others.find(u=>u.address==r))!=null},P=e=>{let r=n.Address.createFromRawAddress(e).plain();return!!i.currentLoggedInWallet.others.find(a=>a.address==r)},R=F(!1),x=y.networkType,k=e=>n.Address.createFromPublicKey(e,x),V=e=>i.currentLoggedInWallet.accounts.find(r=>r.address==k(e).plain())?i.currentLoggedInWallet.accounts.find(r=>r.address==k(e).plain()):i.currentLoggedInWallet.others.find(r=>r.address==k(e).plain()),d=e=>{const r=n.PublicAccount.createFromPublicKey(e,x).address.plain(),a=i.currentLoggedInWallet.contacts.find(u=>u.address==r);return a?a.name:V(e)?V(e).name:`Cosigner-${k(e).plain().substr(-4)}`};let T=q(()=>{if(!s.value)return[];let e=[];return s.value.multisigInfo.filter(a=>a.level==1).forEach(a=>e.push({name:d(a.publicKey),address:n.PublicAccount.createFromPublicKey(a.publicKey,x).address.pretty()})),e},{deep:!0}),M=fe.checkIsMultiSig(s.value?s.value.address:"");R.value=M;const Q=e=>{let r=document.getElementById(e).getAttribute("copyValue"),a=document.getElementById(e).getAttribute("copySubject");ge(r),w.add({severity:"info",detail:a+" "+c("general.copied"),group:"br-custom",life:3e3})},E=F(!1),W=ie(),H=e=>{i.currentLoggedInWallet.accounts.find(r=>r.name==e)&&i.currentLoggedInWallet.setDefaultAccountByName(e)},v=e=>{let r=i.currentLoggedInWallet.accounts.find(a=>a.address==e)||i.currentLoggedInWallet.others.find(a=>a.address==e);return r?r.name:""},X=e=>{if(A(e)&&!E.value&&!P(e)?(H(v(n.Address.createFromRawAddress(e).plain())),J(n.Address.createFromRawAddress(e).plain()),W.push({name:"ViewAccountDetails",params:{address:_(e)}})):A(e)&&W.push({name:"ViewAccountDetails",params:{address:_(e)}}),!L.currentNetworkProfile)return"";A(e)||window.open(L.currentNetworkProfile.chainExplorer.url+"/"+L.currentNetworkProfile.chainExplorer.addressRoute+"/"+e)},j=F([]),O=F(0),U=async e=>{if(!y.isReady){setTimeout(U,1e3);return}if(!y.chainAPI)return;let r=n.Address.createFromRawAddress(e),a=await y.chainAPI.accountAPI.getMultisigAccountGraphInfo(r),u=[];a.multisigAccounts.forEach((t,se)=>{const re=se;for(let B=0;B<t.length;++B){let S=t[B],oe=new ue(S.account.publicKey,re,S.cosignatories.map(D=>D.publicKey),S.multisigAccounts.map(D=>D.publicKey),S.minApproval,S.minRemoval);u.push(oe)}});var h=[],f=0;h.push({key:"0",label:"Level 1",selectable:!1,children:[]}),h.push({key:"1",label:"Level 2",selectable:!1,children:[]}),h.push({key:"2",label:"Level 3",selectable:!1,children:[]});const te=u.filter(t=>t.level<0).map(t=>K.createAddressFromPublicKey(t.publicKey,y.networkType).plain());u.filter(t=>t.level==-1).map(t=>K.createAddressFromPublicKey(t.publicKey,y.networkType).pretty()).forEach(t=>{h[0].children.push({key:"0-"+f.toString(),label:v(n.Address.createFromRawAddress(t).plain())?v(n.Address.createFromRawAddress(t).plain()):t,data:t,selectable:!0}),f++}),f=0,u.filter(t=>t.level==-2).map(t=>K.createAddressFromPublicKey(t.publicKey,y.networkType).pretty()).forEach(t=>{h[1].children.push({key:"1-"+f.toString(),label:v(n.Address.createFromRawAddress(t).plain())?v(n.Address.createFromRawAddress(t).plain()):t,data:t,selectable:!0}),f++}),f=0,u.filter(t=>t.level==-3).map(t=>K.createAddressFromPublicKey(t.publicKey,y.networkType).pretty()).forEach(t=>{h[2].children.push({key:"2-"+f.toString(),label:v(n.Address.createFromRawAddress(t).plain())?v(n.Address.createFromRawAddress(t).plain()):t,data:t,selectable:!0}),f++}),f=0,j.value=h,O.value=te.length,Z()};U(o.address);const Y=e=>{if(A(e.data)&&!E.value&&!P(e.data)?(H(v(n.Address.createFromRawAddress(e.data).plain())),J(n.Address.createFromRawAddress(e.data).plain()),W.push({name:"ViewAccountDetails",params:{address:_(e.data)}})):A(e.data)&&W.push({name:"ViewAccountDetails",params:{address:_(e.data)}}),!L.currentNetworkProfile)return"";A(e.data)||window.open(L.currentNetworkProfile.chainExplorer.url+"/"+L.currentNetworkProfile.chainExplorer.addressRoute+"/"+e.data)},N=F({}),Z=()=>{for(let e of j.value)ee(e);N.value={...N.value}},$=()=>{N.value={}},ee=e=>{e.children&&e.children.length&&(N.value[e.key]=!0)};return{findAccountWithAddress:A,isHover:E,navigate:X,copy:Q,isMultisig:R,acc:s,cosignerAccountsList:T,multisigAddress:j,multisigLength:O,onNodeSelect:Y,expandedKeys:N,expandTree:Z,collapseTree:$}}},he=o=>(me("data-v-228a0286"),o=o(),pe(),o),we={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},_e={class:"p-6 border-2 border-t-0"},xe={key:0,class:"flex cursor-pointer"},ke={class:"border-2 border-blue-primary p-1 mb-3 w-16 text-white bg-blue-primary text-xs text-center font-semibold"},Ie={class:"text-xs font-semibold"},Le={class:"border p-4 my-3"},Te={class:"flex flex-col gap-2"},Me=["onClick"],Ne={class:"text-txs font-semibold text-blue-primary"},Se={class:"flex"},Fe=["id","copyValue","copySubject","title"],Ce={key:0,class:"w-5 h-5 ml-auto",src:ye},Pe={key:0,class:"text-blue-primary text-xs text-center font-semibold"},Re={class:"flex text-txs w-9/12 ml-auto mr-auto text-gray-400 mt-1 text-center justify-center"},Ve={key:0},We=he(()=>l("div",{class:"gray-line my-8"},null,-1)),Ke={class:"text-xs font-semibold"},Ee={class:"border p-4 mt-3"},je={key:0,class:"w-full"},Be={key:1,class:"text-blue-primary text-xs text-center font-semibold"},De={key:2,class:"flex text-txs w-9/12 ml-auto mr-auto text-gray-400 mt-1 justify-center text-center"},He={key:0};function Oe(o,c,w,s,_,A){const P=C("AccountComponent"),R=C("AccountTabs"),x=C("router-link"),k=C("font-awesome-icon"),V=C("Tree");return m(),p("div",null,[l("div",we,[I(P,{address:w.address,class:"mb-6"},null,8,["address"]),I(R,{address:w.address,selected:"multisig"},null,8,["address"]),l("div",_e,[s.isMultisig?(m(),p("div",xe,[l("div",ke,g(o.$t("general.multisig")),1),I(x,{to:{name:"ViewMultisigScheme",params:{address:w.address}},class:"border-2 border-blue-primary p-1 mb-3 w-16 text-blue-primary text-xs text-center font-semibold"},{default:z(()=>[G(g(o.$t("general.scheme")),1)]),_:1},8,["to"])])):b("v-if",!0),l("div",Ie,g(o.$t("multisig.accountCosignatories")),1),l("div",Le,[l("div",Te,[(m(!0),p(ce,null,de(s.cosignerAccountsList,(d,T)=>(m(),p("div",{key:T},[l("div",{class:"border w-full cursor-pointer rounded-md p-3",onClick:M=>s.navigate(d.address)},[l("div",Ne,g(d.name),1),l("div",Se,[l("div",{id:`cosignerAddress${T}`,copyValue:d.address,copySubject:o.$t("general.address"),title:d.address,class:"truncate md:text-clip md:w-auto text-txs font-bold mt-1"},g(d.address),9,Fe),I(k,{icon:"copy",onMouseover:c[0]||(c[0]=M=>s.isHover=!0),onMouseout:c[1]||(c[1]=M=>s.isHover=!1),title:o.$t("general.copy"),onClick:M=>s.copy(`cosignerAddress${T}`),class:"ml-2 w-5 h-5 text-blue-link cursor-pointer"},null,8,["title","onClick"]),s.findAccountWithAddress(d.address)?(m(),p("img",Ce)):b("v-if",!0)])],8,Me)]))),128))]),s.isMultisig?b("v-if",!0):(m(),p("div",Pe,g(o.$t("general.ntgToShow")),1)),l("div",Re,[s.isMultisig?b("v-if",!0):(m(),p("span",Ve,g(o.$t("multisig.noCosigner",{name:s.acc?s.acc.name:""})),1))])]),I(x,{to:{name:s.isMultisig?"ViewMultisigEditAccount":"ViewMultisigConvertAccount",params:{address:w.address}},class:"blue-btn py-2 px-2"},{default:z(()=>[G(g(o.$t("multisig.manageCosignatories")),1)]),_:1},8,["to"]),We,l("div",Ke,g(o.$t("multisig.cosignatoryOf")),1),l("div",Ee,[s.multisigLength?(m(),p("div",je,[l("button",{class:"mr-5 w-32 blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:c[2]||(c[2]=d=>s.expandTree())}," Expand All "),l("button",{class:"w-32 blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:c[3]||(c[3]=d=>s.collapseTree())}," Collapse All "),I(V,{expandedKeys:s.expandedKeys,"onUpdate:expandedKeys":c[4]||(c[4]=d=>s.expandedKeys=d),value:s.multisigAddress,filter:!0,filterMode:"strict",onNodeSelect:s.onNodeSelect,selectionMode:"single",class:"pt-1.5"},null,8,["expandedKeys","value","onNodeSelect"])])):b("v-if",!0),s.multisigLength?b("v-if",!0):(m(),p("div",Be,g(o.$t("general.ntgToShow")),1)),s.multisigLength?b("v-if",!0):(m(),p("div",De,[s.multisigLength?b("v-if",!0):(m(),p("span",He,g(o.$t("multisig.noMultisig",{name:s.acc?s.acc.name:""})),1))]))])])])])}const tt=ae(be,[["render",Oe],["__scopeId","data-v-228a0286"],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/account/submodule/multisig/views/ViewMultisigHome.vue"]]);export{tt as default};
