import{_ as he,u as ke,r as g,w as u,H as h,B as p,c as r,am as v,a as q,n as P,S as F,l as we,A as Pe,aX as Ae,G as Ce,i as L,o as f,b as m,e as l,m as A,t as i,f as W,x as ne,O as xe,aa as Le,F as Te,g as Ie,v as Ke,z as M,h as Fe,W as se}from"./index-c59831c6.js";import{_ as We}from"./PasswordInput.vue_vue_type_script_setup_true_lang-24a75142.js";import{_ as De}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-047b257d.js";import{c as Be}from"./functions-3adf3897.js";import{a as Ve}from"./accountUtils-c160d22f.js";import{A as Se,_ as Me}from"./AccountTabs.vue_vue_type_script_setup_true_lang-51b42284.js";import{M as N}from"./multisigUtils-6df93a8a.js";import{T as z}from"./transactionState-8afc3d95.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-fd1c13a7.js";import"./TextInput-4142d0f6.js";import"./TextInputClean-1fa2c718.js";import"./icon-key-5b3f7dda.js";const Ne="/web-wallet-vuejs/assets/icon-blue-tick-41ef93f6.svg";const Ee={name:"ViewAccountDelegate",components:{AccountComponent:Se,PasswordInput:We,AccountTabs:Me,TransactionFeeDisplay:De},props:{address:String},setup(n){const{t:c}=ke(),T="^(0x|0X)?[a-fA-F0-9].{63,65}$";let e=g(""),D=g(!0);const b=g(""),E=g(!1),C=g(!1),k=u.currentLoggedInWallet?u.currentLoggedInWallet.selectDefaultAccount():null,I=g(k?k.address:""),U=g(h.toCurrencyFormat(k?k.balance:0,p.nativeToken.divisibility)),s=r(()=>{if(!u.currentLoggedInWallet)return null;let t=u.currentLoggedInWallet.accounts.find(o=>o.address==n.address)||u.currentLoggedInWallet.others.find(o=>o.address==n.address);return t||null}),d=()=>s.value?N.getCosignerInWallet(s.value.publicKey).cosignerList:[],x=r(()=>{let t=d(),o=[];return t.forEach(a=>{o.push({publicKey:a,name:v(a).name,balance:v(a).balance})}),o}),J=r(()=>s.value?N.getCosignerInWallet(s.value.publicKey).cosignerList.length>0:!1),y=g(x.value[0]?x.value[0].publicKey:"");q(x,t=>{t.length&&(y.value=t[0]?t[0].publicKey:"")},{deep:!0});let B=g(!1);(()=>{s.value&&N.onPartial(M.PublicAccount.createFromPublicKey(s.value.publicKey,p.networkType)).then(t=>B.value=t).catch(t=>{B.value=!1})})();const Q=r(()=>P.currentNetworkProfileConfig?h.convertToExact(P.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility):0),Y=r(()=>P.currentNetworkProfile?h.convertToExact(F.getLockFundFee(),p.nativeToken.divisibility):0),_=r(()=>s.value?!!s.value.getDirectParentMultisig().length:!1);let j=r(()=>Ve.getDelegateFee(_.value));const V=r(()=>_.value?j.value+Q.value+Y.value:j.value),Z=r(()=>s.value?s.value.balance:0),oe=r(()=>p.nativeToken.label),$=r(()=>p.nativeToken.divisibility),re=r(()=>u.currentLoggedInWallet?_.value?v(y.value)?h.toCurrencyFormat(v(y.value).balance,$.value):"0":h.toCurrencyFormat(Z.value,$.value):"0"),ee=r(()=>{var t=!1;return _.value?v(y.value)&&(v(y.value).balance<V.value?t=!0:t=!1):Z.value<V.value&&(t=!0),t}),ie=r(()=>{let t=re.value.split(".");return t[1]!=null?{left:t[0],right:t[1]}:{left:t[0],right:null}});q(e,t=>{t.match(T)?D.value=!1:D.value=!0});const w=g(""),S=g(""),ce=g(""),de=we(),ue=Pe();g(n.address);const te="^[^ ]{8,}$",ge=Fe(),ve=new Ae(Ce.buildAPIEndpoint(P.selectedAPIEndpoint,P.currentNetworkProfile.httpPort));ge.appContext.config.globalProperties.emitter;const H=u.currentLoggedInWallet?u.currentLoggedInWallet.name:"",fe=r(()=>B.value||ee.value||!J.value&&_.value?!0:O.value?O.value?!b.value.match(te):!0:!b.value.match(te)),me=t=>{let o=document.getElementById(t).getAttribute("copyValue"),a=document.getElementById(t).getAttribute("copySubject");Be(o),ue.add({severity:"info",detail:a+" "+c("general.copied"),group:"br-custom",life:3e3})},G=async()=>{if(s.value&&s.value){const t=h.createPublicAccount(s.value.publicKey,p.networkType),o=await ve.accountAPI.getAccountInfo(t.address);w.value=o.linkedAccountKey}};G(),q(()=>s,t=>{G()},{deep:!0});const O=r(()=>{let t=!1;return w.value!=""&&(w.value==="0".repeat(64)?t=!1:w.value!=="0".repeat(64)&&(t=!0)),t}),ae=async()=>{e.value=M.Account.generateNewAccount().privateKey};ae();const be=async()=>{const t=se.createAccountFromPrivateKey(e.value,p.networkType);t&&(S.value=t.publicKey);let o={};const a=p.buildTxn;if(se.verifyWalletPassword(H,P.chainNetworkName,b.value)){if(w.value!=="0".repeat(64)){const K=a.accountLinkBuilder().remoteAccountKey(w.value).linkAction(M.LinkAction.Unlink).build();if(_.value){let R=u.currentLoggedInWallet.accounts.find(X=>X.publicKey==y.value).address;o=F.signTxnWithPassword(R,s.value.address,b.value,K)}else o=F.signTxnWithPassword(s.value.address,null,b.value,K);b.value="",C.value=""}else if(S.value!=""){const K=a.accountLinkBuilder().remoteAccountKey(S.value).linkAction(M.LinkAction.Link).build();if(console.log(s.value.address),_.value){let R=u.currentLoggedInWallet.accounts.find(X=>X.publicKey==y.value).address;o=F.signTxnWithPassword(R,s.value.address,b.value,K)}else o=F.signTxnWithPassword(s.value.address,null,b.value,K);b.value="",C.value=""}z.lockHashPayload=o.hashLockTxnPayload,z.transactionPayload=o.txnPayload,z.selectedAddress=n.address,de.push({name:"ViewConfirmTransaction"})}else C.value=c("general.walletPasswordInvalid",{name:H})},le=r(()=>{if(!u.currentLoggedInWallet)return[];let t=u.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),o=u.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return t.concat(o)}),ye=r(()=>h.amountFormatterSimple(V.value,0)),pe=r(()=>{if(P.currentNetworkProfileConfig){let t=N.getCosignerInWallet(le.value.find(a=>a.address==I.value)?le.value.find(a=>a.address==I.value).publicKey:""),o=[];return t.cosignerList.forEach(a=>{o.push({publicKey:a,name:v(a).name,balance:v(a).balance,address:v(a).address})}),t.cosignerList=o,t}else return{hasCosigner:!1,cosignerList:[]}}),_e=r(()=>{let t=v(y.value)?v(y.value).balance:0;return h.toCurrencyFormat(t,3)});return{showPrivateKeyError:D,findAcc:v,privateKey:e,currentNativeTokenName:oe,splitBalance:ie,isMultisig:_,acc:s,walletPassword:b,showPasswdError:E,walletState:u,createDelegate:be,verifyDelegateAcc:G,delegateAcc:w,AccPublicKey:S,AccPrivateKey:ce,disableLinkBtn:fe,copy:me,err:C,walletName:H,delegateValue:O,isCosigner:J,lockFund:Q,transactionFee:j,totalFee:V,lockFundTxFee:Y,onPartial:B,walletCosignerList:x,selectedCosignPublicKey:y,fundStatus:ee,generatePrivateKey:ae,totalFeeFormatted:ye,selectedAccAdd:I,accBalance:U,getMultiSigCosigner:pe,checkCosignBalance:_e}}},Ue={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},je={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-3"},He={class:"lg:col-span-2 py-6 pr-6"},Ge={class:"pl-6"},Oe={key:0,class:"error error_box mb-5"},Re={key:0,class:"text-left mt-2 mb-5 ml-6"},Xe={key:0},qe={class:"text-tsm"},ze={key:0,class:"font-bold"},Je={key:1,class:"font-bold"},Qe=["value"],Ye={key:1},Ze={class:"text-xs font-semibold pl-6"},$e={class:"text-xxs pl-6 mt-2"},et=l("div",{class:"mt-4"},null,-1),tt=l("div",{class:"ml-6 my-7 gray-line"},null,-1),at={class:"pl-6"},lt={class:"text-xs text-blue-primary mt-0.5 font-semibold uppercase"},nt={class:"flex"},st=["copyValue","copySubject"],ot={class:"text-txs mt-1 text-red-400 border px-1.5 py-2 border-red-400 rounded-md"},rt={key:2},it={class:"text-xs font-semibold pl-6"},ct={class:"ml-6 px-3 py-2 mt-3 bg-green-100"},dt=l("img",{src:Ne,class:"h-3 w-3 inline-block mr-2"},null,-1),ut={class:"text-xs mt-2 inline-block"},gt={class:"border border-blue-300 rounded-md ml-6 p-3 mt-3 bg-blue-50 overflow-x-auto"},vt={class:"text-xs inline-block"},ft=["copyValue","copySubject"],mt={class:"bg-navy-primary p-6 lg:col-span-1"},bt=l("div",{class:"mt-5"},null,-1),yt={class:"font-semibold text-xs text-white mb-1.5"},pt={class:"mt-3"},_t=["disabled"],ht=["disabled"],kt={class:"text-center"};function wt(n,c,T,e,D,b){const E=L("AccountComponent"),C=L("AccountTabs"),k=L("font-awesome-icon"),I=L("TransactionFeeDisplay"),U=L("PasswordInput"),s=L("router-link");return f(),m("div",null,[l("div",Ue,[A(E,{address:T.address,class:"mb-6"},null,8,["address"]),A(C,{address:T.address,selected:"details"},null,8,["address"]),l("div",je,[l("div",He,[l("div",Ge,[e.err!=""?(f(),m("div",Oe,i(e.err),1)):W("",!0)]),e.isMultisig?(f(),m("div",Re,[e.walletCosignerList.length>0?(f(),m("div",Xe,[l("div",qe,[ne(i(n.$t("general.initiateBy"))+": ",1),e.walletCosignerList.length==1?(f(),m("span",ze,i(e.walletCosignerList[0].name),1)):(f(),m("span",Je,[xe(l("select",{class:"","onUpdate:modelValue":c[0]||(c[0]=d=>e.selectedCosignPublicKey=d)},[(f(!0),m(Te,null,Ie(e.walletCosignerList,(d,x)=>(f(),m("option",{value:e.findAcc(d.publicKey).publicKey,key:x},i(d.name),9,Qe))),128))],512),[[Le,e.selectedCosignPublicKey]])]))])])):W("",!0)])):W("",!0),e.delegateValue?(f(),m("div",rt,[l("div",it,i(n.$t("delegate.accDelegated")),1),l("div",ct,[dt,l("div",ut,i(n.$t("delegate.linked")),1)]),l("div",gt,[l("div",vt,i(n.$t("delegate.publicKeyOfDelegate")),1),A(k,{icon:"copy",onClick:c[2]||(c[2]=d=>e.copy("delegatePublicKey")),title:n.$t("general.copy"),class:"inline-block float-right mt-1 w-5 h-5 text-blue-link cursor-pointer"},null,8,["title"]),l("div",{class:"text-xs mt-0.5 font-semibold",id:"delegatePublicKey",copyValue:e.delegateAcc,copySubject:n.$t("delegate.delegatePublicKey")},i(e.delegateAcc),9,ft)])])):(f(),m("div",Ye,[l("div",Ze,i(n.$t("general.delegate")),1),l("div",$e,i(n.$t("delegate.notLinked")),1),et,tt,l("div",at,[l("div",lt,i(n.$t("general.privateKey")),1),l("div",nt,[l("div",{id:"private",class:"truncate text-xs mt-1 font-semibold",type:"text",copyValue:e.privateKey,copySubject:n.$t("general.privateKey")},i(e.privateKey),9,st),A(k,{title:n.$t("general.copy"),icon:"copy",onClick:c[1]||(c[1]=d=>e.copy("private")),class:"ml-2 pb-1 w-5 h-5 text-blue-link mt-0.5 cursor-pointer"},null,8,["title"])]),l("div",ot,i(n.$t("general.pkWarning")),1)])]))]),l("div",mt,[A(I,{"fund-status":e.fundStatus,"is-multisig":e.isMultisig,"is-cosigner":e.isCosigner,"on-partial":e.onPartial,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFund,"lock-fund-tx-fee":e.lockFundTxFee,balance:e.accBalance,"selected-acc-add":e.selectedAccAdd},null,8,["fund-status","is-multisig","is-cosigner","on-partial","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),bt,l("div",yt,i(n.$t("general.enterPasswordContinue")),1),A(U,{placeholder:n.$t("general.enterPassword"),errorMessage:n.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":c[3]||(c[3]=d=>e.walletPassword=d)},null,8,["placeholder","errorMessage","showError","modelValue"]),l("div",pt,[e.delegateValue?(f(),m("button",{key:0,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:c[4]||(c[4]=(...d)=>e.createDelegate&&e.createDelegate(...d)),disabled:e.disableLinkBtn},i(n.$t("delegate.unlinkAcc")),9,_t)):W("",!0),e.delegateValue?W("",!0):(f(),m("button",{key:1,type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:c[5]||(c[5]=(...d)=>e.createDelegate&&e.createDelegate(...d)),disabled:e.disableLinkBtn},i(n.$t("delegate.delegateAcc")),9,ht))]),l("div",kt,[A(s,{to:{name:"ViewAccountDetails",params:{address:T.address}},class:"content-center text-xs text-white underline"},{default:Ke(()=>[ne(i(n.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Mt=he(Ee,[["render",wt]]);export{Mt as default};
