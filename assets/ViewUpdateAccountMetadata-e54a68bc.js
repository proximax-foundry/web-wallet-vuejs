import{g as y,I as Ue,c as v,w as c,H as L,A as m,D as C,j as We,n as F,B as De,x as i,au as I,k as Ne,_ as Be,f as u,e as o,l as w,b as E,F as ee,r as W,Q as Ee,o as g,s as te,t as p,i as T,O as R,ak as Re,K as ce,av as ue}from"./index-49f5eac9.js";import{_ as Oe}from"./AccTabLayout.vue_vue_type_script_setup_true_lang-606f53f3.js";import{T as Qe}from"./TransactionLayout-62c14ae0.js";import{M as ae}from"./multisigUtils-0fb8134c.js";import{M as je}from"./MetadataInput-026fd14b.js";import{_ as Ze}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-95a39e42.js";import{t as ze}from"./jdenticon-module-80457c6f.js";import{U as Xe}from"./UTF8-18787633.js";import{T as O}from"./transactionState-6ed4f3b4.js";import{_ as Ge}from"./chevron_left-0423cb29.js";import"./AccountTabs.vue_vue_type_script_setup_true_lang-c57c1e13.js";import"./functions-fa076abc.js";import"./TextInput-2430a15b.js";import"./TextInputClean-ae76feb7.js";import"./icon-key-5b3f7dda.js";import"./icon-info-8b4f1351.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-914defbd.js";import"./proximax-logo-ecfc3767.js";const qe={name:"ViewUpdateAccountMetadata",props:{targetPublicKey:String,scopedMetadataKey:String},components:{MetadataInput:je,TransactionFeeDisplay:Ze,AccTabLayout:Oe,TransactionLayout:Qe},setup(r){const n=Ne();let Q=y(!1),t=y(!0),k=y(1),b=y(null),K=y(!1),_=y(""),d=y(""),f=y(null),x,D,s,h;const M=y(""),P=y(""),le=new Ue("ThemeStyleConfig");le.init();const ge=v(()=>ze(f.value?f.value.address:"",40,le.jdenticonConfig)),ve=v(()=>f.value?c.currentLoggedInWallet.convertAddressToName(f.value.address,!0):""),ne=y([]),N=c.currentLoggedInWallet?c.currentLoggedInWallet.selectDefaultAccount():null,j=y(N?N.address:""),ye=y(L.toCurrencyFormat(N?N.balance:0,m.nativeToken.divisibility)),oe=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=oe(e)),e),Z=e=>{e=oe(e);let l=i.Convert.hexToUint8(e);return Xe.isNotUTF8(l)||(e=i.Convert.decodeHexToUtf8(e)),e},me=()=>{let e=new i.MetadataQueryParams;e.metadataType=i.MetadataType.ACCOUNT,e.targetKey=b.value,m.chainAPI.metadataAPI.searchMetadatas(e).then(l=>{l.metadataEntries.forEach(a=>{ne.value.push({value:a.scopedMetadataKey.toHex()==Z(a.scopedMetadataKey.toHex())?a.scopedMetadataKey.toHex():Z(a.scopedMetadataKey.toHex()),type:a.scopedMetadataKey.toHex()==Z(a.scopedMetadataKey.toHex())?2:1})})})},fe=v(()=>f.value?f.value.address:"0".repeat(40)),pe=()=>{r.targetPublicKey.length===64&&i.Convert.isHexString(r.targetPublicKey)&&(b.value=i.PublicAccount.createFromPublicKey(r.targetPublicKey,m.networkType),x.targetPublicKey(b.value)),c.currentLoggedInWallet&&(f.value=c.currentLoggedInWallet.accounts.find(e=>e.publicKey===r.targetPublicKey)||c.currentLoggedInWallet.others.find(e=>e.publicKey===r.targetPublicKey),f.value&&(K.value=!!f.value.getDirectParentMultisig().length))},be=v(()=>c.currentLoggedInWallet&&b.value?c.currentLoggedInWallet.others.find(e=>e.publicKey===r.targetPublicKey):null);C(be,async e=>{if(e){if(!c.currentLoggedInWallet)return;f.value=c.currentLoggedInWallet.accounts.find(l=>l.publicKey===r.targetPublicKey)||c.currentLoggedInWallet.others.find(l=>l.publicKey===r.targetPublicKey),f.value&&(K.value=!!f.value.getDirectParentMultisig().length)}},{deep:!0});const xe=()=>{if(r.scopedMetadataKey)if(t.value=!1,d.value=r.scopedMetadataKey,r.scopedMetadataKey.length===16&&i.Convert.isHexString(r.scopedMetadataKey))k.value=2,_.value=r.scopedMetadataKey,x.scopedMetadataKey(i.UInt64.fromHex(_.value));else{let e=i.Convert.utf8ToHex(r.scopedMetadataKey);const l=e.length/2;e.length&&l<=8&&(k.value=1,e.length/2<8&&(e=e+"00".repeat(8-l)),_.value=e,x.scopedMetadataKey(i.UInt64.fromHex(_.value)))}},he=async()=>{x=m.buildTxn.accountMetadataBuilder();const e=await m.chainAPI.nodeAPI.getNodeTime();D=m.buildTxn.aggregateBondedBuilder(new i.UInt64(e.sendTimeStamp))},Me=async()=>{if(b.value&&_.value){let e=new i.MetadataQueryParams;e.metadataType=i.MetadataType.ACCOUNT,e.targetKey=b.value,e.scopedMetadataKey=i.UInt64.fromHex(_.value);let l=await m.chainAPI.metadataAPI.searchMetadatas(e);l.metadataEntries.length&&(M.value=l.metadataEntries[0].value)}x.oldValue(M.value)},Te=()=>{x.value(P.value)},z=()=>{s=x.calculateDifferences().build()},X=()=>{s&&(h=D.innerTransactions([s.toAggregateV1(b.value)]).build())},G=()=>{h&&(S.value=h.maxFee.compact()/Math.pow(10,m.nativeToken.divisibility))},Ke=v(()=>m.nativeToken.label);We();const _e=y(""),ke=c.currentLoggedInWallet?c.currentLoggedInWallet.name:"",q=v(()=>F.currentNetworkProfileConfig?L.convertToExact(F.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility):0),Ae=v(()=>F.currentNetworkProfileConfig?L.convertToCurrency(F.currentNetworkProfileConfig.lockedFundsPerAggregate,m.nativeToken.divisibility):0),J=v(()=>F.currentNetworkProfile?L.convertToExact(De.getLockFundFee(),m.nativeToken.divisibility):0),we=y(!1),Y=v(()=>k.value==1?i.Convert.utf8ToHex(d.value).length/2>8:d.value.length>16?!0:d.value.length%2===1),se=v(()=>Pe.value<$.value),Ce=v(()=>Y.value==!0||d.value==""||P.value==""||se.value==!0),H=v(()=>{if(!c.currentLoggedInWallet)return[];let e=c.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),l=c.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return e.concat(l)});C(k,e=>{re(),e==2&&(i.Convert.isHexString(d.value)||(d.value=""))});const re=async()=>{if(Y.value||d.value.length==0)return;let e="";if(k.value==1){let B=i.Convert.utf8ToHex(d.value);e=B+"00".repeat((16-B.length)/2)}else e="00".repeat((16-d.value.length)/2)+d.value;let l=new i.MetadataQueryParams;l.targetKey=b.value,l.metadataType=i.MetadataType.ACCOUNT,l.scopedMetadataKey=i.UInt64.fromHex(e);let a=await m.chainAPI.metadataAPI.searchMetadatas(l);a.metadataEntries.length?M.value=a.metadataEntries[0].value:M.value=""},Ie=async()=>{if(!c.currentLoggedInWallet)return;let e="",l;if(k.value==1){let V=i.Convert.utf8ToHex(d.value);e=V+"00".repeat((16-V.length)/2)}else e="00".repeat((16-d.value.length)/2)+d.value;let a=x.targetPublicKey(b.value).scopedMetadataKey(i.UInt64.fromHex(e)).value(P.value).oldValue(M.value).calculateDifferences().build(),B=m.buildTxn.aggregateCompleteBuilder().innerTransactions([a.toAggregateV1(b.value)]).build().serialize(),de=c.currentLoggedInWallet.accounts.find(V=>V.publicKey==b.value.publicKey).address;if(K.value){let V=c.currentLoggedInWallet.accounts.find(He=>He.publicKey==A.value).address;l=a.toAggregateV1(b.value).serialize(),O.selectedAddress=V,O.selectedMultisigAddress=de}else l=B,O.selectedAddress=de;d.value="",M.value="",P.value="",O.unsignedTransactionPayload=l,n.push({name:"ViewConfirmTransaction"})},S=y(0),$=v(()=>{let e=m.nativeToken.divisibility;return K.value?e==0?Math.trunc(q.value+J.value+S.value):Math.round((q.value+J.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),U=v(()=>!c.currentLoggedInWallet||!b.value?[]:ae.getCosignerInWallet(r.targetPublicKey).cosignerList.length?H.value?ae.getCosignerInWallet(r.targetPublicKey).cosignerList.map(e=>{let l=H.value.find(a=>a.publicKey==e);return{name:l.name,publicKey:e,balance:l.balance}}):[]:[]),A=y("");U.value.length>0&&(A.value=U.value[0].publicKey),C(()=>U,e=>{e.value.length&&(A.value=U.value[0].publicKey)},{deep:!0});const Pe=v(()=>c.currentLoggedInWallet?K.value?A.value?I(A.value).balance:0:f.value?f.value.balance:0:0),Se=v(()=>S.value.toString()),Ve=v(()=>L.amountFormatterSimple($.value,0)),Le=v(()=>{if(F.currentNetworkProfileConfig){let e=ae.getCosignerInWallet(H.value.find(a=>a.address==j.value)?H.value.find(a=>a.address==j.value).publicKey:""),l=[];return e.cosignerList.forEach(a=>{l.push({publicKey:a,name:I(a).name,balance:I(a).balance,address:I(a).address})}),e.cosignerList=l,e}else return{hasCosigner:!1,cosignerList:[]}}),Fe=v(()=>{let e=I(A.value)?I(A.value).balance:0;return L.toCurrencyFormat(e,3)});C(M,e=>{x.oldValue(e),z(),X(),G()}),C(P,e=>{x.value(e),z(),X(),G()}),C(d,e=>{e==""&&(M.value="")});const ie=async()=>{await he(),pe(),await xe(),await Me(),await Te(),z(),X(),G(),me()};if(m.isReady)ie();else{let e=C(m,l=>{l.isReady&&(ie(),e())})}return{findAcc:I,totalFee:$,err:_e,showPasswdError:we,accounts:H,updateMetadata:Ie,targetAccIsMultisig:K,lockFundCurrency:Ae,lockFund:q,aggregateFee:S,lockFundTxFee:J,walletName:ke,currentNativeTokenName:Ke,oldValue:M,newValue:P,cosigners:U,scopedMetadataKeyType:k,svgString:ge,accountName:ve,accountAddress:fe,disableAddBtn:Ce,showBalanceErr:se,showScopedKeyErr:Y,inputScopedMetadataKey:d,checkOldValue:re,selectedCosigner:A,showKeys:Q,existingScopedMetadataKeys:ne,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:_,transactionFee:Se,totalFeeFormatted:Ve,selectedAccAdd:j,accBalance:ye,getMultiSigCosigner:Le,checkCosignBalance:Fe}}},Je={class:"flex cursor-pointer"},Ye={class:"pl-6"},$e={key:0,class:"error error_box mb-5"},et={key:0,class:"text-left mt-2 mb-5"},tt={key:0},at={class:"text-tsm"},lt={key:0,class:"font-bold"},nt={key:1,class:"font-bold"},ot=["value"],st={key:1,class:"error"},rt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},it={class:"flex items-center gap-2"},dt=["innerHTML"],ct={class:"flex flex-col gap-0.5"},ut={class:"font-semibold"},gt={key:1,class:"mt-2"},vt=["onClick"],yt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},mt={key:1,class:"text-xs py-2 pl-2 w-full"},ft={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},pt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},bt={key:2},xt={class:"flex gap-3"},ht={class:"flex gap-2"},Mt={class:"flex gap-2"},Tt={key:3,class:"my-3"},Kt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},_t={class:"flex flex-col gap-0.5"},kt={class:"flex"},At={class:"font-semibold"},wt={class:"ml-3 text-gray-400 font-semibold"},Ct={class:"flex"},It={key:0,class:"font-semibold"},Pt={key:1,class:"ml-3 text-gray-400 font-semibold"},St={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Vt={class:"font-semibold"},Lt=["disabled"],Ft={class:"text-center"};function Ht(r,n,Q,t,k,b){const K=W("router-link"),_=W("AccTabLayout"),d=W("MetadataInput"),f=W("TransactionFeeDisplay"),x=W("TransactionLayout"),D=Ee("debounce");return g(),u(ee,null,[o("div",Je,[n[8]||(n[8]=o("img",{src:Ge},null,-1)),w(K,{to:{name:"ViewDashboard"},class:"text-blue-primary text-xs mt-0.5"},{default:E(()=>[te(p(r.$t("general.back")),1)]),_:1})]),w(_,{address:t.accountAddress,selected:"metadata"},null,8,["address"]),w(x,null,{white:E(()=>[o("div",Ye,[t.err!=""?(g(),u("div",$e,p(t.err),1)):T("",!0)]),t.targetAccIsMultisig?(g(),u("div",et,[t.cosigners.length>0?(g(),u("div",tt,[o("div",at,[te(p(r.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(g(),u("span",lt,p(t.cosigners[0].name),1)):(g(),u("span",nt,[R(o("select",{class:"","onUpdate:modelValue":n[0]||(n[0]=s=>t.selectedCosigner=s)},[(g(!0),u(ee,null,ce(t.cosigners,(s,h)=>(g(),u("option",{value:t.findAcc(s.publicKey).publicKey,key:h},p(s.name),9,ot))),128))],512),[[Re,t.selectedCosigner]])]))])])):(g(),u("div",st,p(r.$t("general.noCosigner")),1))])):T("",!0),n[14]||(n[14]=o("div",{class:"font-semibold mb-4"},"Update Account Metadata",-1)),o("div",rt,[o("div",it,[o("div",{innerHTML:t.svgString},null,8,dt),o("div",ct,[n[9]||(n[9]=o("div",{class:"uppercase text-xxs text-blue-primary"}," Selected Account ",-1)),o("div",ut,p(t.accountName),1)])])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(g(),u("div",gt,[o("div",{onClick:n[1]||(n[1]=s=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"}," Select Existing Scoped Metadata Key "),(g(!0),u(ee,null,ce(t.existingScopedMetadataKeys,(s,h)=>(g(),u("div",{key:h},[t.showKeys?(g(),u("div",{key:0,class:"flex justify-center cursor-pointer",onClick:M=>(t.scopedMetadataKeyType=s.type,t.inputScopedMetadataKey=s.value,t.checkOldValue(),t.showKeys=!1)},[h%2==0?(g(),u("div",yt,p(s.value),1)):T("",!0),h%2==1?(g(),u("div",mt,p(s.value),1)):T("",!0),h%2==0?(g(),u("div",ft,p(r.$t("general.select")),1)):T("",!0),h%2==1?(g(),u("div",pt,p(r.$t("general.select")),1)):T("",!0)],8,vt)):T("",!0)]))),128))])):T("",!0),t.scopedMetadataKeySelectable?(g(),u("div",bt,[R(w(d,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":n[2]||(n[2]=s=>t.inputScopedMetadataKey=s),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[D,t.checkOldValue,"1000"]]),o("div",xt,[o("div",ht,[R(o("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":n[3]||(n[3]=s=>t.scopedMetadataKeyType=s)},null,512),[[ue,t.scopedMetadataKeyType]]),n[10]||(n[10]=o("label",{for:"regular"},"UTF-8",-1))]),o("div",Mt,[R(o("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":n[4]||(n[4]=s=>t.scopedMetadataKeyType=s)},null,512),[[ue,t.scopedMetadataKeyType]]),n[11]||(n[11]=o("label",{for:"hexa"},"Hexadecimal",-1))])]),w(d,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":n[5]||(n[5]=s=>t.oldValue=s),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(g(),u("div",Tt,[o("div",Kt,[o("div",_t,[n[12]||(n[12]=o("div",{class:"uppercase text-xxs text-blue-primary"}," Selected Scoped Metadata Key ",-1)),o("div",kt,[o("div",At,p(Q.scopedMetadataKey),1),o("div",wt,p(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),o("div",Ct,[t.scopedMetadataKeyType==1?(g(),u("div",It,p(t.scopedMetadataKeyHex),1)):T("",!0),t.scopedMetadataKeyType==1?(g(),u("div",Pt," HEX ")):T("",!0)])])]),o("div",St,[n[13]||(n[13]=o("div",{class:"uppercase text-xxs text-blue-primary"},"CURRENT VALUE",-1)),o("div",Vt,p(t.oldValue),1)])])),w(d,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":n[6]||(n[6]=s=>t.newValue=s),placeholder:"New Value"},null,8,["modelValue"])]),navy:E(()=>[w(f,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),o("button",{type:"submit",class:"w-full blue-btn px-3 py-3 mt-3 disabled:opacity-50 disabled:cursor-auto",onClick:n[7]||(n[7]=s=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Account Metadata ",8,Lt),o("div",Ft,[w(K,{to:{name:"ViewAccountMetadata",params:{address:t.accountAddress}},class:"content-center text-xs text-white underline"},{default:E(()=>[te(p(r.$t("general.cancel")),1)]),_:1},8,["to"])])]),_:1})],64)}const ea=Be(qe,[["render",Ht]]);export{ea as default};
