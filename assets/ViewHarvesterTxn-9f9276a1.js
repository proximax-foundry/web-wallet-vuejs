import{d as G,o as v,b as m,e as t,t as b,_ as J,f as $,A as te,l as le,u as ae,r as o,c,W as M,w as W,B as l,H as d,n as N,S as se,a as j,i as z,M as ne,m as _,O as oe,v as re,x as ie,h as ce,I as ue,J as de,z as O}from"./index-5c640343.js";import{_ as ve}from"./icon-red-x-a5511f99.js";import{_ as me}from"./icon-green-tick-1b766454.js";import{_ as fe,a as _e,b as be,c as pe}from"./TxnSummary.vue_vue_type_script_setup_true_lang-93305cc6.js";import{T as K}from"./transactionState-d904b215.js";import"./jdenticon-module-fec6c6e8.js";import"./proximax-logo-ecfc3767.js";const xe={class:"border border-gray-200 px-2 py-2 rounded-md w-full"},he={class:"flex gap-2"},ye={class:"flex flex-col w-full"},ge={class:"uppercase text-gray-500 font-light text-xxs text-left"},ke=["value"],we={key:0,class:"flex flex-col ml-auto justify-center mt-1"},Te=t("img",{src:ve,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Ae={class:"text-xxs text-red-400 font-bold uppercase"},Ie={key:1,class:"flex flex-col ml-auto justify-center mt-1"},$e=t("img",{src:me,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Pe={class:"text-xxs text-green-400 font-bold uppercase"},Ve=G({__name:"PublicKeyInputClean",props:{placeholder:String,showError:Boolean,modelValue:String},emits:["update:modelValue"],setup(r){return(i,n)=>(v(),m("div",xe,[t("div",he,[t("div",ye,[t("div",ge,b(r.placeholder),1),t("input",{autocomplete:"off",type:"text",value:r.modelValue,onInput:n[0]||(n[0]=P=>i.$emit("update:modelValue",P.target.value)),class:"w-full font-semibold text-tsm outline-none mt-1"},null,40,ke)]),r.showError?(v(),m("div",we,[Te,t("div",Ae,b(i.$t("general.invalid")),1)])):(v(),m("div",Ie,[$e,t("div",Pe,b(i.$t("general.valid")),1)]))])]))}});const Se={props:{placeholder:String,errorMessage:String,showError:Boolean,modelValue:String,title:String,disabled:Boolean},emits:["update:modelValue"],name:"SelectLinkType",data(){return{inputText:"",borderColor:"border border-gray-300",textErr:!1}},watch:{showError:function(r){r?(this.borderColor="border-2 border-red-primary",this.textErr=!0):(this.borderColor="border-2 border-gray-300",this.textErr=!1)}}},Fe={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},Ce={class:"uppercase text-gray-500 text-txs text-left mb-2"},He={class:"flex items-center"},Ee=["value","disabled","checked"],Be=t("label",{for:"add",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Add",-1),Me=["value","disabled","checked"],Ne=t("label",{for:"remove",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Remove",-1),Ke={class:"h-3 mb-2"},Le={key:0,class:"error error-text text-left"};function Ue(r,i,n,P,h,V){return v(),m("div",null,[t("div",Fe,[t("div",Ce,b(n.title),1),t("div",He,[t("input",{id:"add",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[0]||(i[0]=S=>r.$emit("update:modelValue","add")),checked:n.modelValue=="link"},null,40,Ee),Be,t("input",{id:"remove",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[1]||(i[1]=S=>r.$emit("update:modelValue","remove")),checked:n.modelValue=="unlink"},null,40,Me),Ne])]),t("div",Ke,[h.textErr||n.showError?(v(),m("div",Le,b(n.errorMessage),1)):$("",!0)])])}const De=J(Se,[["render",Ue]]),Re=r=>(ue("data-v-5a0ab19c"),r=r(),de(),r),We={class:"w-10/12 ml-auto mr-auto"},je={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},ze={class:"xl:col-span-2 p-12"},Oe=Re(()=>t("div",{class:"font-semibold mb-4"},"Harvester Transaction",-1)),Ge={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},Je={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},qe={class:"inline-block text-xs"},Qe={key:1,class:"error error_box"},Xe={class:"mt-4"},Ye={class:"flex gap-1 mt-3"},Ze={key:0,class:"mt-3"},et={class:"mt-3"},tt={class:""},lt={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},at=["disabled"],st={class:"text-center"},nt=G({__name:"ViewHarvesterTxn",setup(r){const i=te(),n=le(),h=ce().appContext.config.globalProperties.emitter;ae();const V=o("");o(!1);const S=o(!1),T=o(""),g=o(""),A=o(!0),F=o(),k=o(),C=o();c(()=>B.value||S.value);const q=()=>{try{C.value=O.PublicAccount.createFromPublicKey(g.value,l.networkType),A.value=!1}catch{A.value=!0}};try{F.value=M.createPublicAccount(W.currentLoggedInWallet?W.currentLoggedInWallet.selectDefaultAccount().publicKey:"",l.networkType)}catch(e){console.log(e)}const Q=c(()=>{if(l.isReady){let e=l.buildTxn.addHarvester(d.samplePubAcc());if(s.value){let a=l.buildTxn.aggregateBonded([e.toAggregateV1(d.samplePubAcc())]);return d.amountFormatterSimple(a.maxFee.compact(),l.nativeToken.divisibility)}else return d.amountFormatterSimple(e.maxFee.compact(),l.nativeToken.divisibility)}else return"0"}),w=c(()=>d.convertNumberMinimumFormat(Number(Q.value),l.nativeToken.divisibility)),L=c(()=>N.currentNetworkProfileConfig?d.convertToExact(N.currentNetworkProfileConfig.lockedFundsPerAggregate,l.nativeToken.divisibility):0),U=c(()=>N.currentNetworkProfile?d.convertToExact(se.getLockFundFee(),l.nativeToken.divisibility):0),D=c(()=>L.value+U.value),X=c(()=>g.value==""||A.value||B.value||!p.value||!F.value||!T.value),s=o(null),y=o(null),p=o(null),x=o(0),H=o(0),E=async e=>{if(l.chainAPI&&e)try{const a=await l.chainAPI.accountAPI.getAccountInfo(O.Address.createFromRawAddress(e)),f=a.mosaics.findIndex(u=>u.id.toHex()==l.nativeToken.assetId);return f!=-1?a.mosaics[f].amount.compact()/Math.pow(10,l.nativeToken.divisibility):0}catch{return 0}},B=c(()=>{if(p.value)return s.value?x.value<w.value+D.value:x.value<w.value});j(p,async(e,a)=>{e==null?(x.value=0,y.value=null,s.value=null,k.value=null):e!=a&&(y.value=null,s.value=null,k.value=null,x.value=await E(e))}),j(s,async(e,a)=>{e==null?(H.value=0,y.value=null,s.value=null,k.value=null,x.value=await E(p.value)):e!=a&&(H.value=await E(e))});const Y=c(()=>s.value?D.value+w.value:w.value),Z=c(()=>d.amountFormatterSimple(Y.value,0)),ee=async()=>{let e,a;const f=T.value==="add";f?a=l.buildTxn.addHarvesterBuilder():a=l.buildTxn.removeHarvesterBuilder();try{const u=await l.chainAPI.harvesterAPI.getAccountHarvestingHarvesterInfo(d.createPublicAccount(g.value,l.networkType));if(f&&u.length){i.add({severity:"error",detail:"Harvester key found, it is already added",group:"br-custom",life:1e4});return}else if(!f&&u.length===0){i.add({severity:"error",detail:"Harvester key not found, does not need to be removed",group:"br-custom",life:1e4});return}}catch{return}s.value?e=[a.harvesterKey(C.value).build().toAggregateV1(k.value).serialize()]:e=a.harvesterKey(C.value).build().serialize(),K.unsignedTransactionPayload=e,K.selectedAddress=p.value,K.selectedMultisigAddress=s.value,n.push({name:"ViewConfirmTransaction"})};return h.on("select-account",e=>{p.value=e}),h.on("select-account-public-key",e=>{F.value=M.createPublicAccount(e,l.networkType)}),h.on("select-multisig-account",e=>{y.value=e.label,s.value=e.value,k.value=M.createPublicAccount(e.publicKey,l.networkType)}),h.on("CLOSE_MULTISIG",()=>{y.value=null,s.value=null}),(e,a)=>{const f=z("font-awesome-icon"),u=z("router-link"),R=ne("debounce");return v(),m("div",null,[t("div",We,[t("div",je,[t("div",ze,[Oe,B.value?(v(),m("div",Ge,[t("div",Je,[_(f,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),t("div",qe,b(e.$t("general.insufficientBalance")),1)])):$("",!0),V.value!=""?(v(),m("div",Qe,b(V.value),1)):$("",!0),t("div",Xe,[t("div",Ye,[_(fe,{type:"dynamic",label:"Add Harvester"}),_(_e,{"selected-address":p.value},null,8,["selected-address"])]),s.value?(v(),m("div",Ze,[_(be,{"select-default-address":s.value,"select-default-name":y.value,label:"Multisig account selected",type:"dynamic"},null,8,["select-default-address","select-default-name"])])):$("",!0)]),t("div",et,[_(De,{title:"Type",modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=I=>T.value=I),disabled:!1},null,8,["modelValue"])]),t("div",tt,[oe(_(Ve,{placeholder:"Harvester Key",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=I=>g.value=I),showError:A.value},null,8,["modelValue","showError"]),[[R,q,"1000"]])])]),t("div",lt,[_(pe,{"signer-native-token-balance":x.value,"native-token-balance":s.value?H.value:x.value,"lock-fund":L.value,"lock-fund-tx-fee":U.value,"selected-multisig-address":s.value,"txn-fee":w.value,"total-fee":Number(Z.value)},null,8,["signer-native-token-balance","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),t("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:X.value,onClick:ee}," Create harvester transaction ",8,at),t("div",st,[_(u,{to:{name:"ViewServices"},class:"content-center text-xs text-white border-b-2 border-white"},{default:re(()=>[ie(b(e.$t("general.cancel")),1)]),_:1})])])])])])}}});const mt=J(nt,[["__scopeId","data-v-5a0ab19c"]]);export{mt as default};
