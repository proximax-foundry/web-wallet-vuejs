import{_ as Ve,u as Ke,l as Be,r as i,w as D,H as O,B as p,c as y,n as Q,R as Le,a as K,z as P,i as C,o as _,b as h,e as l,m as T,t as b,f as B,F as re,g as ce,v as me,as as We,P as pe,Q as fe,x as je,h as Oe,W as ge,I as Re,J as qe}from"./index-7898c72d.js";import{_ as He}from"./PasswordInput.vue_vue_type_script_setup_true_lang-3437d248.js";import{T as ze}from"./TextInput-50d495d8.js";import{_ as Je,a as Qe}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-3d0e17fb.js";import{T as Ze}from"./TextInputClean-1ac4e59d.js";import{M as Z}from"./multisigUtils-568ce271.js";import{_ as Ge}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-aee22452.js";import{A as Xe,_ as Ye}from"./AccountTabs.vue_vue_type_script_setup_true_lang-871551e8.js";import{T as ie}from"./transactionState-7684a256.js";import{_ as $e}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-76e359f0.js";import"./functions-82304a4c.js";import"./icon-key-5b3f7dda.js";const et={name:"ViewConvertAccountMultisig",components:{PasswordInput:He,TextInput:ze,TextInputClean:Ze,SelectAccountAndContact:Ge,AccountComponent:Xe,AccountTabs:Ye,TransactionFeeDisplay:Je},props:{address:String},setup(c){const{t:s}=Ke(),L=Be();Oe().appContext.config.globalProperties.emitter;const A=i(""),I=i([]),W=i(""),U=i(!1),E=i(""),X=i(!1),R="^[^ ]{8,}$",f=i(1),g=i(1),v=i(0),m=i(0),Y="^[0-9A-Fa-f]{64}$",a=i([]),r=i([]),u=i([]),$=i([]),w=i([]),ee=i([]),j=i(!1),be=i(!1),q=D.currentLoggedInWallet?D.currentLoggedInWallet.selectDefaultAccount():null,ye=i(q?q.address:""),_e=i(O.toCurrencyFormat(q?q.balance:0,p.nativeToken.divisibility)),te=y(()=>O.convertToCurrency(Q.currentNetworkProfileConfig.lockedFundsPerAggregate,p.nativeToken.divisibility)),ae=y(()=>Q.currentNetworkProfile?O.convertToExact(Le.getLockFundFee(),p.nativeToken.divisibility):0),H=i(0),d=y(()=>D.currentLoggedInWallet?D.currentLoggedInWallet.accounts.find(t=>t.address===c.address):null);let le=y(()=>{if(d.value)return Z.checkIsMultiSig(d.value.address)}),z=()=>{d.value&&(H.value=Z.getAggregateFee(d.value.publicKey,a.value,f.value,g.value))};z();const V=y(()=>{let t=p.nativeToken.divisibility;return t==0?Math.trunc(parseFloat(H.value)+parseFloat(te.value)+ae.value):Math.round((parseFloat(H.value)+parseFloat(te.value)+ae.value)*Math.pow(10,t))/Math.pow(10,t)}),he=y(()=>p.nativeToken.label),Ae=y(()=>p.nativeToken.divisibility);y(()=>D.currentLoggedInWallet?O.toCurrencyFormat(d.value.balance,Ae.value):"0");const ue=y(()=>{if(!d.value)return!1;const t=D.currentLoggedInWallet;let o=t.accounts.map(x=>({name:x.name,publicKey:x.publicKey})),n=t.contacts;var k=[],F=0;return k.push({key:"0",label:s("general.ownerAcc"),selectable:!1,children:[]}),o.forEach(x=>{k[0].children.push({key:"0-"+F.toString(),label:x.name,data:x.publicKey}),F++}),F=0,k.push({key:"1",label:s("general.contact"),selectable:!1,children:[]}),n!=null&&n.forEach(x=>{k[1].children.push({key:"1-"+F.toString(),label:x.name,data:x.address}),F++}),k});function we(t,o){de(o),u.value[o]=t.label,t.key[0]=="1"?ke(t.data,o):a.value[o]=t.data,a.value[o]=t.data,ee.value[o]=!1,r.value[o][t.key]=!0,t.selectable=!1}function ke(t,o){try{Z.verifyContactPublicKey(t).then(n=>{n.status==!0?a.value[o]=n.publicKey:A.value=s("multisig.noPublicKey")})}catch{A.value=s("multisig.noPublicKey")}}const de=t=>{if(Object.keys(r.value[t]).length!==0){let o=Object.keys(r.value[t])[0].split("-");ue.value[o[0]].children[o[1]].selectable=!0,r.value[t]={}}},xe=y(()=>le.value||j.value||!E.value.match(R)||a.value.length==0||A.value||w.value.every(t=>t==!1)==!1||g.value==0||f.value==0||d.value.balance<V.value),Ce=y(()=>{if(!d.value)return!1;var t=!1;if(d.value.balance>=V.value&&!j.value){for(var o=0;o<a.value.length;o++)if(w.value[o]!=""){t=!0;break}else if(a.value[o].length<40){t=!0;break}}else t=!0;return t}),ve=()=>{a.value=[],$.value=[],w.value=[],E.value="",f.value=1,v.value=0,g.value=1,m.value=0,I.value=[]},Te=async()=>{const t=D.currentLoggedInWallet;if(!ge.verifyWalletPassword(t.name,Q.chainNetworkName,E.value))W.value=s("general.walletPasswordInvalid",{name:D.currentLoggedInWallet.name});else{const n=[],k=t.accounts.find(M=>M.name===d.value.name);if(!k)throw new Error("Account not found");const F=ge.decryptPrivateKey(new P.Password(E.value),k.encrypted,k.iv),x=P.Account.createFromPrivateKey(F,p.networkType,1);if(!p.chainAPI)throw new Error("Service unavailable");let J=null;for(const M of a.value){if(M.length==64)J=P.PublicAccount.createFromPublicKey(M,p.networkType);else if(M.length==40||M.length==46){const Ue=P.Address.createFromRawAddress(M);try{const ne=await p.chainAPI.accountAPI.getAccountInfo(Ue);J=P.PublicAccount.createFromPublicKey(ne.publicKey,p.networkType)}catch(ne){console.log(ne)}}J&&n.push(new P.MultisigCosignatoryModification(P.MultisigCosignatoryModificationType.Add,J))}if(!p.buildTxn)throw new Error("Service unavailable");const Me=p.buildTxn.modifyMultisigAccountBuilder().minApprovalDelta(f.value).minRemovalDelta(g.value).modifications(n).build();W.value="",ve(),ie.unsignedTransactionPayload=Me.serialize(),ie.selectedAddress=d.value.address,ie.selectedMultisigAddress=x.address.plain(),L.push({name:"ViewConfirmTransaction"})}};K(()=>[...a.value],async t=>{let o=!1;if(a.value.length>0)for(var n=0;n<a.value.length;n++)a.value[n].length==64?a.value[n]==d.value.publicKey&&o==!1?(o=!0,w.value[n]=!0,A.value=s("multisig.selectedAccErr")):!a.value[n].match(Y)&&a.value[n].length==64?w.value[n]=!0:(w.value[n]=!1,Array.from(new Set(t)).length!=t.length?A.value=s("multisig.duplicatedCosigner"):o==!1&&(A.value="",await Ee(a.value[n])||I.value.includes(a.value[n])||I.value.push(a.value[n]))):w.value[n]=!0;else A.value=""},{deep:!0}),K(()=>[...w.value],t=>{t.every(o=>o==!1)&&z()},{deep:!0});const Se=()=>{a.value.push(""),r.value.push({}),w.value.push(!1),v.value+=1,m.value+=1},Pe=(t,o)=>{v.value>0&&(v.value-=1),m.value>0&&(m.value-=1),g.value>m.value&&(g.value=m.value),f.value>v.value&&(f.value=v.value),de(o),a.value.splice(o,1),r.value.splice(o,1),u.value.splice(o,1),ee.value.splice(o,1),$.value.splice(o,1),w.value.splice(o,1);for(let n=0;n<I.value.length;n++)t===I.value[n]&&I.value.splice(n,1)},Ie=t=>{f.value*10*~~(v.value/10)+t.charCode-48>v.value&&t.preventDefault()};let oe=s("multisig.deletionExceedMax"),se=s("multisig.approvalExceedMax"),S="";K(f,t=>{z(),v.value==0&&t>1||t>v.value&&t!=1&&v.value!=0?S=se:v.value>0&&t<=0?S=s("multisig.approvalAtLeastOne"):g.value>m.value&&g.value!=1&&m.value!=0?S=oe:S=""});const Ne=t=>{g.value*10*~~(m.value/10)+t.charCode-48>m.value&&t.preventDefault()};let N="";K(g,t=>{z(),m.value==0&&t>1||t>m.value&&t!=1&&m.value!=0?N=oe:m.value>0&&t<=0?N=s("multisig.deletionAtLeastOne"):f.value>v.value&&f.value!=1&&v.value!=0?N=se:N=""}),K([f,g],()=>{S!=""&&N!=""?A.value=S+`
`+N:S!=""?A.value=S:A.value=N});const Fe=y(()=>j.value||le.value);d.value&&Z.onPartial(P.PublicAccount.createFromPublicKey(d.value.publicKey,p.networkType)).then(t=>j.value=t),d.value&&d.value.balance<V.value&&(U.value=!0),K(d,t=>{t&&(t.balance<V.value?U.value=!0:U.value=!1)});const De=y(()=>O.amountFormatterSimple(V.value,0)),Ee=async t=>{const o=P.PublicAccount.createFromPublicKey(t,p.networkType);try{return!!await p.chainAPI.accountAPI.getAccountInfo(o.address)}catch{return!1}};return{networkState:Q,toggleContact:ee,contact:ue,space:be,currentNativeTokenName:he,contactName:u,err:A,disableSend:xe,numApproveTransaction:f,numDeleteUser:g,maxNumApproveTransaction:v,maxNumDeleteUser:m,fundStatus:U,acc:d,passwd:E,showPasswdError:X,showAddressError:w,addCoSig:Se,coSign:a,addCoSigButton:Ce,selectedNode:r,deleteCoSigAddressInput:Pe,onNodeSelect:we,selectedAddresses:$,clear:ve,convertAccount:Te,disabledPassword:Fe,onPartial:j,isMultisig:le,passwdPattern:R,validateApproval:Ie,validateDelete:Ne,lockFundCurrency:te,lockFundTxFee:ae,aggregateFee:H,totalFee:V,totalFeeFormatted:De,selectedAccAdd:ye,accBalance:_e,passwordErr:W,pkNotExistArray:I}}},G=c=>(Re("data-v-7ce77f2f"),c=c(),qe(),c),tt={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},at={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},lt={class:"lg:col-span-2 py-6 pr-6"},ot={class:"text-xs font-semibold pl-6"},st={class:"pl-6"},nt={key:0,class:"error error_box mb-5 whitespace-pre"},rt={key:1},ct={key:0,class:"flex gap-2 bg-yellow-50 py-2 rounded-md px-2 my-3"},it=G(()=>l("img",{src:Qe,class:"w-5 h-5"},null,-1)),ut={class:"text-xs font-bold pt-1"},dt={key:2,class:"error error_box mb-5"},vt=G(()=>l("div",{class:"mt-4"},null,-1)),mt={class:"flex flex-col gap-2"},pt={class:"flex"},ft=["onClick"],gt={key:0,class:"mt-16"},bt=["onClick"],yt={class:"text-xxs text-blue-primary font-semibold uppercase"},_t={key:0},ht=["disabled"],At=G(()=>l("div",{class:"ml-6 my-7 gray-line"},null,-1)),wt={class:"pl-6 text-xs font-semibold mb-3"},kt={class:"flex gap-2 pl-6"},xt={class:"border w-6/12"},Ct={class:"border-b-2 text-xxs text-center py-1 uppercase"},Tt={class:"flex justify-around"},St=["disabled"],Pt=["max"],It=["disabled"],Nt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Ft={class:"border w-6/12"},Dt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Et={class:"flex justify-around"},Mt=["disabled"],Ut=["max"],Vt=["disabled"],Kt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Bt={class:"pl-6"},Lt={class:"text-xs font-semibold my-3"},Wt={class:"bg-navy-primary p-6 lg:col-span-1"},jt=G(()=>l("div",{class:"mt-5"},null,-1)),Ot={class:"mt-3"},Rt=["disabled"],qt={class:"text-center"};function Ht(c,s,L,e,A,I){const W=C("AccountComponent"),U=C("AccountTabs"),E=C("TextInput"),X=C("TextInputClean"),R=C("font-awesome-icon"),f=C("SelectAccountAndContact"),g=C("Sidebar"),v=C("PasswordInput"),m=C("TransactionFeeDisplay"),Y=C("router-link");return _(),h("div",null,[l("div",tt,[T(W,{address:L.address,class:"mb-6"},null,8,["address"]),T(U,{address:L.address,selected:"multisig"},null,8,["address"]),l("div",at,[l("div",lt,[l("div",ot,b(c.$t("multisig.manageCosignatories")),1),l("div",st,[e.err!=""?(_(),h("div",nt,b(e.err),1)):B("",!0),e.pkNotExistArray.length>0?(_(),h("div",rt,[(_(!0),h(re,null,ce(e.pkNotExistArray,a=>(_(),h("div",null,[(_(!0),h(re,null,ce(e.coSign,(r,u)=>(_(),h("div",{key:u},[a===r?(_(),h("div",ct,[it,l("div",ut,b(e.contactName[u]?e.contactName[u]:c.$t("multisig.cosignatory")+`${u+1}`)+"'s public key does not exist",1)])):B("",!0)]))),128))]))),256))])):B("",!0),e.passwordErr!=""?(_(),h("div",dt,b(e.passwordErr),1)):B("",!0)]),vt,l("div",mt,[(_(!0),h(re,null,ce(e.coSign,(a,r)=>(_(),h("div",{key:r},[l("div",pt,[l("img",{src:$e,onClick:u=>e.deleteCoSigAddressInput(a,r),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,ft),T(E,{class:"w-5/12 mr-2",placeholder:c.$t("multisig.cosignatory")+`${r+1}`,modelValue:e.contactName[r],"onUpdate:modelValue":u=>e.contactName[r]=u,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),T(X,{class:"w-7/12 mr-2",placeholder:c.$t("general.publicKey"),errorMessage:c.$t("general.invalidInput"),showError:e.showAddressError[r],modelValue:e.coSign[r],"onUpdate:modelValue":u=>e.coSign[r]=u},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),e.showAddressError[r]==!0?(_(),h("div",gt)):B("",!0),l("div",{onClick:u=>e.toggleContact[r]=!e.toggleContact[r],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[T(R,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),l("div",yt,b(c.$t("general.select")),1)],8,bt)]),e.toggleContact[r]?(_(),h("div",_t,[T(g,{visible:e.toggleContact[r],"onUpdate:visible":u=>e.toggleContact[r]=u,baseZIndex:1e4,position:"full"},{default:me(()=>[T(f,We(r,{contacts:e.contact,index:r,selectedNode:e.selectedNode[r],onNodeSelect:u=>e.onNodeSelect(u,r)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):B("",!0)]))),128))]),l("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:s[0]||(s[0]=(...a)=>e.addCoSig&&e.addCoSig(...a)),disabled:e.addCoSigButton},"+"+b(c.$t("multisig.addNewCosignatory")),9,ht),At,l("div",wt,b(c.$t("general.scheme")),1),l("div",kt,[l("div",xt,[l("div",Ct,b(c.$t("multisig.transactionsApproval")),1),l("div",Tt,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:s[1]||(s[1]=a=>e.numApproveTransaction--),disabled:e.numApproveTransaction<=0},"-",8,St),pe(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:s[2]||(s[2]=(...a)=>e.validateApproval&&e.validateApproval(...a)),max:e.maxNumApproveTransaction,"onUpdate:modelValue":s[3]||(s[3]=a=>e.numApproveTransaction=a)},null,40,Pt),[[fe,e.numApproveTransaction]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:e.numApproveTransaction>=e.maxNumApproveTransaction,onClick:s[4]||(s[4]=a=>e.numApproveTransaction++)},"+",8,It)]),l("div",Nt,b(c.$t("multisig.ofCosignatories",{value:e.maxNumApproveTransaction})),1)]),l("div",Ft,[l("div",Dt,b(c.$t("multisig.accountDeletionApproval")),1),l("div",Et,[l("button",{class:"text-blue-primary disabled:opacity-50",onClick:s[5]||(s[5]=a=>e.numDeleteUser--),disabled:e.numDeleteUser<=0},"-",8,Mt),pe(l("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:s[6]||(s[6]=(...a)=>e.validateDelete&&e.validateDelete(...a)),max:e.maxNumDeleteUser,"onUpdate:modelValue":s[7]||(s[7]=a=>e.numDeleteUser=a)},null,40,Ut),[[fe,e.numDeleteUser]]),l("button",{class:"text-blue-primary disabled:opacity-50",disabled:e.numDeleteUser>=e.maxNumDeleteUser,onClick:s[8]||(s[8]=a=>e.numDeleteUser++)},"+",8,Vt)]),l("div",Kt,b(c.$t("multisig.ofCosignatories",{value:e.maxNumDeleteUser})),1)])]),l("div",Bt,[l("div",Lt,b(c.$t("general.enterPasswordContinue")),1),T(v,{placeholder:c.$t("general.enterPassword"),errorMessage:c.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.passwd,"onUpdate:modelValue":s[9]||(s[9]=a=>e.passwd=a),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"])])]),l("div",Wt,[T(m,{"fund-status":e.fundStatus,"is-multisig-already":e.isMultisig,"on-partial":e.onPartial,"transaction-fee":String(e.aggregateFee),"total-fee-formatted":e.totalFeeFormatted,"lock-fund-currency-convert":e.lockFundCurrency,"lock-fund-tx-fee-convert":String(e.lockFundTxFee),balance:e.accBalance,"selected-acc-add":e.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),jt,l("div",Ot,[l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:s[10]||(s[10]=a=>e.convertAccount()),disabled:e.disableSend},b(c.$t("multisig.updateCosignatories")),9,Rt)]),l("div",qt,[T(Y,{to:{name:"ViewMultisigHome",params:{address:L.address}},class:"content-center text-xs text-white underline"},{default:me(()=>[je(b(c.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const ra=Ve(et,[["render",Ht],["__scopeId","data-v-7ce77f2f"]]);export{ra as default};
