import{r as o,u as te,D as ae,q as oe,w as d,H as U,c as k,ac as se,a as N,i as re,A as E,E as P,W as le,_ as ne,k as S,o as _,b as I,e as b,s as g,z as W,B as V,t as m,f as F}from"./index-d6467577.js";import{T as de}from"./TextInputClean-62b2769f.js";import{A as ce}from"./addressBookUtils-0d3294bf.js";import{S as ie}from"./SelectInputPluginClean-3bdb78b0.js";import{A as ue,_ as me}from"./icon-save-c6c7d248.js";import"./multiselect-f031cdf1.js";const ve={name:"ViewServicesAddressBookEditContact",components:{TextInputClean:de,SelectInputPluginClean:ie,AddCustomGroupModal:ue},props:{contactAddress:String,contactPublicKey:String},setup(a){const K=re().appContext.config.globalProperties.emitter,t=o(null),{t:s}=te(),D=ae(),v=o(""),p=o(!0),C=o(""),M=oe(),c=o("");var w=null;d.currentLoggedInWallet&&(w=d.currentLoggedInWallet.contacts.find(e=>U.createAddress(e.address).pretty()==a.contactAddress));const f=o(w?w.name:""),r=o(a.contactAddress),l=o(""),A=o("");l.value=r.value;const T=o(!1),L=o(!1);a.contactPublicKey=="true"&&(T.value=!0);const q=k(()=>r.value.length==64),O=o([]);d.currentLoggedInWallet&&d.currentLoggedInWallet.contacts.forEach(e=>{O.value.push(e.group)}),se(()=>{t.value.select(w?w.group:[])});function H(e,n,y){return y.indexOf(e)===n}var B=[s("addressBook.work"),s("addressBook.friend"),s("addressBook.family"),s("addressBook.employee"),s("addressBook.director")].concat(O.value).filter(H);B=B.filter(e=>e!="-none-"),B.sort();const h=o([]);h.value.push({value:"-none-",label:" - "}),B.forEach(e=>{h.value.push({value:e,label:e})}),h.value.push({value:"Custom",label:s("addressBook.custom")});const z=k(()=>h.value),j=k(()=>!(p.value&&f.value!="")),J=k(()=>!p.value&&l.value!=""),Q=k(()=>l.value!=""&&f.value==""||r.value!=""&&f.value==""),X=k(()=>{let e=s("general.invalidInput");return C.value?C.value:e});N(r,()=>{if(d.currentLoggedInWallet)if(r.value.length<=63||r.value.length>=65){l.value=r.value;const e=d.currentLoggedInWallet.accounts.find(y=>y.default==!0),n=ce.verifyNetworkAddress(e.address,l.value);p.value=n.isPassed,C.value=n.errMessage,R()}else r.value.length==64&&(p.value=!0,l.value=le.createAddressFromPublicKey(r.value,P.networkType).plain())});const x=o(!1);N(c,e=>{e=="Custom"&&(x.value=!0)});const G=async e=>{try{let n=await P.chainAPI.accountAPI.getAccountInfo(E.Address.createFromRawAddress(e));n.publicKey=="0000000000000000000000000000000000000000000000000000000000000000"?(A.value=null,L.value=!0):(A.value=n.publicKey,L.value=!0)}catch{A.value=null,L.value=!0}},Y=async()=>{const e=d.currentLoggedInWallet;if(!e)return;r.value.length==64?A.value=r.value:await G(l.value);const n=d.currentLoggedInWallet.contacts.findIndex(u=>U.createAddress(u.address).pretty()==a.contactAddress);let y=e.contacts.filter(u=>u.name.toLowerCase()!=w.name.toLowerCase().trim()),Z=y.find(u=>u.name.toLowerCase()==f.value.toLowerCase().trim()),$=e.accounts.find(u=>u.name.toLowerCase()==f.value.toLowerCase().trim()),ee=y.find(u=>E.Address.createFromRawAddress(u.address).plain()==E.Address.createFromRawAddress(l.value).plain());Z!=null||$!=null?v.value=s("addressBook.nameExist"):ee!=null?v.value=s("addressBook.addressExist"):(d.currentLoggedInWallet.updateAddressBook(n,{name:f.value.trim(),address:E.Address.createFromRawAddress(l.value).plain(),group:c.value,publicKey:A.value}),d.wallets.saveMyWalletOnlytoLocalStorage(d.currentLoggedInWallet),D.add({severity:"info",summary:s("general.addressBook"),detail:s("addressBook.contactUpdated"),group:"br-custom",life:5e3}),M.push({name:"ViewServicesAddressBook"}))};K.on("CLOSE_ADDCUSTOMGROUP_PANEL",()=>{x.value=!1}),K.on("ADD_CUSTOM_GROUP",e=>{h.value.push({value:e,label:e}),t.value&&t.value.select(e),x.value=!1});const R=()=>{if(P.isReady)G(l.value);else{let e=N(P,n=>{n.isReady&&(G(l.value),e())})}};return R(),{err:v,addErr:X,contactName:f,address:l,addressOrPk:r,disableSave:j,showAddErr:J,showNameErr:Q,SaveContact:Y,selectContactGroups:c,contactGroups:z,isDisplayAddCustomPanel:x,selectGroupDropdown:t,existingPublicKey:T,publicKey:A,isLoaded:L,newPublicKey:q}}},pe={class:"w-9/12 ml-auto mr-auto mt-5"},fe={class:"flex text-xs font-semibold border-b-2 menu_title_div"},ge={class:"border border-gray-100 p-5 filter drop-shadow-xl mt-10 bg-white"},be={class:"text-md mb-5 font-semibold"},we={key:0,class:"error error_box mb-5"},Ae={class:"mt-2 py-3 text-center px-0 flex"},ye=["disabled"],ke=b("img",{src:me,class:"inline-block mr-2"},null,-1),Ce={key:1},he={key:0,class:"px-3 py-2 mt-1 bg-red-300"},_e={key:1,class:"px-3 py-2 mt-1 bg-green-100"};function Ie(a,i,K,t,s,D){const v=S("router-link"),p=S("TextInputClean"),C=S("SelectInputPluginClean"),M=S("AddCustomGroupModal");return _(),I("div",null,[b("div",pe,[b("div",fe,[g(v,{to:{name:"ViewServicesAddressBook"},class:"w-18 text-center border-b pb-3"},{default:W(()=>[V(m(a.$t("general.list")),1)]),_:1}),g(v,{to:{name:"ViewServicesAddressBookImport"},class:"w-18 text-center border-b pb-3"},{default:W(()=>[V(m(a.$t("general.import")),1)]),_:1}),g(v,{to:{name:"ViewServicesAddressBookExport"},class:"w-18 text-center border-b pb-3"},{default:W(()=>[V(m(a.$t("general.export")),1)]),_:1})]),b("div",ge,[b("div",be,m(a.$t("addressBook.editContact")),1),t.err!=""?(_(),I("div",we,m(t.err),1)):F("",!0),b("div",Ae,[g(p,{placeholder:a.$t("general.name"),errorMessage:a.$t("general.nameRequired"),modelValue:t.contactName,"onUpdate:modelValue":i[0]||(i[0]=c=>t.contactName=c),icon:"id-card-alt",showError:t.showNameErr,class:"w-52 inline-block mr-2"},null,8,["placeholder","errorMessage","modelValue","showError"]),g(p,{placeholder:a.$t("general.address"),errorMessage:t.addErr,modelValue:t.addressOrPk,"onUpdate:modelValue":i[1]||(i[1]=c=>t.addressOrPk=c),icon:"wallet",showError:t.showAddErr,class:"w-96 inline-block mr-2"},null,8,["placeholder","errorMessage","modelValue","showError"]),g(C,{modelValue:t.selectContactGroups,"onUpdate:modelValue":i[2]||(i[2]=c=>t.selectContactGroups=c),placeholder:"Group",options:t.contactGroups,selectDefault:"-none-",ref:"selectGroupDropdown",class:"w-60 inline-block mr-2"},null,8,["modelValue","options"]),b("button",{type:"submit",class:"default-btn py-1 disabled:opacity-50 h-12 flex items-center",disabled:t.disableSave,onClick:i[3]||(i[3]=c=>t.SaveContact())},[ke,V(m(a.$t("addressBook.saveAddress")),1)],8,ye)]),!t.existingPublicKey&&!t.showAddErr&&!t.newPublicKey?(_(),I("div",Ce,[!t.publicKey&&t.isLoaded?(_(),I("div",he,m(a.$t("general.publicKeyNotAvailable")),1)):(_(),I("div",_e,m(a.$t("general.publicKeyAvailable")),1))])):F("",!0)])]),g(M,{toggleModal:t.isDisplayAddCustomPanel,groups:t.contactGroups},null,8,["toggleModal","groups"])])}const Me=ne(ve,[["render",Ie]]);export{Me as default};
