import{g as te,r as s,u as ae,D as se,q as oe,w as d,H as U,c as k,aa as re,a as N,W as le,E as S,B as x,_ as ne,k as P,o as _,b as I,e as b,s as g,z as W,A as V,t as v,f as F}from"./index-fe79a787.js";import{T as de}from"./TextInputClean-5508fd13.js";import{A as ce}from"./addressBookUtils-0d3294bf.js";import{S as ie}from"./SelectInputPluginClean-a1954b40.js";import{A as ue,_ as ve}from"./icon-save-cec0ea8f.js";import"./multiselect-8e9b7eac.js";const me={name:"ViewServicesAddressBookEditContact",components:{TextInputClean:de,SelectInputPluginClean:ie,AddCustomGroupModal:ue},props:{contactAddress:String,contactPublicKey:String},setup(a){const K=te().appContext.config.globalProperties.emitter,t=s(null),{t:o}=ae(),D=se(),m=s(""),p=s(!0),C=s(""),M=oe(),c=s("");var w=null;d.currentLoggedInWallet&&(w=d.currentLoggedInWallet.contacts.find(e=>U.createAddress(e.address).pretty()==a.contactAddress));const f=s(w?w.name:""),r=s(a.contactAddress),l=s(""),A=s("");l.value=r.value;const T=s(!1),L=s(!1);a.contactPublicKey=="true"&&(T.value=!0);const q=k(()=>r.value.length==64),O=s([]);d.currentLoggedInWallet&&d.currentLoggedInWallet.contacts.forEach(e=>{O.value.push(e.group)}),re(()=>{t.value.select(w?w.group:[])});function j(e,n,y){return y.indexOf(e)===n}var B=[o("addressBook.work"),o("addressBook.friend"),o("addressBook.family"),o("addressBook.employee"),o("addressBook.director")].concat(O.value).filter(j);B=B.filter(e=>e!="-none-"),B.sort();const h=s([]);h.value.push({value:"-none-",label:" - "}),B.forEach(e=>{h.value.push({value:e,label:e})}),h.value.push({value:"Custom",label:o("addressBook.custom")});const H=k(()=>h.value),z=k(()=>!(p.value&&f.value!="")),J=k(()=>!p.value&&l.value!=""),Q=k(()=>l.value!=""&&f.value==""||r.value!=""&&f.value==""),X=k(()=>{let e=o("general.invalidInput");return C.value?C.value:e});N(r,()=>{if(d.currentLoggedInWallet)if(r.value.length<=63||r.value.length>=65){l.value=r.value;const e=d.currentLoggedInWallet.accounts.find(y=>y.default==!0),n=ce.verifyNetworkAddress(e.address,l.value);p.value=n.isPassed,C.value=n.errMessage,R()}else r.value.length==64&&(p.value=!0,l.value=le.createAddressFromPublicKey(r.value,S.networkType).plain())});const E=s(!1);N(c,e=>{e=="Custom"&&(E.value=!0)});const G=async e=>{try{let n=await S.chainAPI.accountAPI.getAccountInfo(x.Address.createFromRawAddress(e));n.publicKey=="0000000000000000000000000000000000000000000000000000000000000000"?(A.value=null,L.value=!0):(A.value=n.publicKey,L.value=!0)}catch{A.value=null,L.value=!0}},Y=async()=>{const e=d.currentLoggedInWallet;if(!e)return;r.value.length==64?A.value=r.value:await G(l.value);const n=d.currentLoggedInWallet.contacts.findIndex(u=>U.createAddress(u.address).pretty()==a.contactAddress);let y=e.contacts.filter(u=>u.name.toLowerCase()!=w.name.toLowerCase().trim()),Z=y.find(u=>u.name.toLowerCase()==f.value.toLowerCase().trim()),$=e.accounts.find(u=>u.name.toLowerCase()==f.value.toLowerCase().trim()),ee=y.find(u=>x.Address.createFromRawAddress(u.address).plain()==x.Address.createFromRawAddress(l.value).plain());Z!=null||$!=null?m.value=o("addressBook.nameExist"):ee!=null?m.value=o("addressBook.addressExist"):(d.currentLoggedInWallet.updateAddressBook(n,{name:f.value.trim(),address:x.Address.createFromRawAddress(l.value).plain(),group:c.value,publicKey:A.value}),d.wallets.saveMyWalletOnlytoLocalStorage(d.currentLoggedInWallet),D.add({severity:"info",summary:o("general.addressBook"),detail:o("addressBook.contactUpdated"),group:"br-custom",life:5e3}),M.push({name:"ViewServicesAddressBook"}))};K.on("CLOSE_ADDCUSTOMGROUP_PANEL",()=>{E.value=!1}),K.on("ADD_CUSTOM_GROUP",e=>{h.value.push({value:e,label:e}),t.value&&t.value.select(e),E.value=!1});const R=()=>{if(S.isReady)G(l.value);else{let e=N(S,n=>{n.isReady&&(G(l.value),e())})}};return R(),{err:m,addErr:X,contactName:f,address:l,addressOrPk:r,disableSave:z,showAddErr:J,showNameErr:Q,SaveContact:Y,selectContactGroups:c,contactGroups:H,isDisplayAddCustomPanel:E,selectGroupDropdown:t,existingPublicKey:T,publicKey:A,isLoaded:L,newPublicKey:q}}},pe={class:"w-9/12 ml-auto mr-auto mt-5"},fe={class:"flex text-xs font-semibold border-b-2 menu_title_div"},ge={class:"border border-gray-100 p-5 filter drop-shadow-xl mt-10 bg-white"},be={class:"text-md mb-5 font-semibold"},we={key:0,class:"error error_box mb-5"},Ae={class:"mt-2 py-3 text-center px-0 flex"},ye=["disabled"],ke=b("img",{src:ve,class:"inline-block mr-2"},null,-1),Ce={key:1},he={key:0,class:"px-3 py-2 mt-1 bg-red-300"},_e={key:1,class:"px-3 py-2 mt-1 bg-green-100"};function Ie(a,i,K,t,o,D){const m=P("router-link"),p=P("TextInputClean"),C=P("SelectInputPluginClean"),M=P("AddCustomGroupModal");return _(),I("div",null,[b("div",pe,[b("div",fe,[g(m,{to:{name:"ViewServicesAddressBook"},class:"w-18 text-center border-b pb-3"},{default:W(()=>[V(v(a.$t("general.list")),1)]),_:1}),g(m,{to:{name:"ViewServicesAddressBookImport"},class:"w-18 text-center border-b pb-3"},{default:W(()=>[V(v(a.$t("general.import")),1)]),_:1}),g(m,{to:{name:"ViewServicesAddressBookExport"},class:"w-18 text-center border-b pb-3"},{default:W(()=>[V(v(a.$t("general.export")),1)]),_:1})]),b("div",ge,[b("div",be,v(a.$t("addressBook.editContact")),1),t.err!=""?(_(),I("div",we,v(t.err),1)):F("v-if",!0),b("div",Ae,[g(p,{placeholder:a.$t("general.name"),errorMessage:a.$t("general.nameRequired"),modelValue:t.contactName,"onUpdate:modelValue":i[0]||(i[0]=c=>t.contactName=c),icon:"id-card-alt",showError:t.showNameErr,class:"w-52 inline-block mr-2"},null,8,["placeholder","errorMessage","modelValue","showError"]),g(p,{placeholder:a.$t("general.address"),errorMessage:t.addErr,modelValue:t.addressOrPk,"onUpdate:modelValue":i[1]||(i[1]=c=>t.addressOrPk=c),icon:"wallet",showError:t.showAddErr,class:"w-96 inline-block mr-2"},null,8,["placeholder","errorMessage","modelValue","showError"]),g(C,{modelValue:t.selectContactGroups,"onUpdate:modelValue":i[2]||(i[2]=c=>t.selectContactGroups=c),placeholder:"Group",options:t.contactGroups,selectDefault:"-none-",ref:"selectGroupDropdown",class:"w-60 inline-block mr-2"},null,8,["modelValue","options"]),b("button",{type:"submit",class:"default-btn py-1 disabled:opacity-50 h-12 flex items-center",disabled:t.disableSave,onClick:i[3]||(i[3]=c=>t.SaveContact())},[ke,V(v(a.$t("addressBook.saveAddress")),1)],8,ye)]),!t.existingPublicKey&&!t.showAddErr&&!t.newPublicKey?(_(),I("div",Ce,[!t.publicKey&&t.isLoaded?(_(),I("div",he,v(a.$t("general.publicKeyNotAvailable")),1)):(_(),I("div",_e,v(a.$t("general.publicKeyAvailable")),1))])):F("v-if",!0)])]),g(M,{toggleModal:t.isDisplayAddCustomPanel,groups:t.contactGroups},null,8,["toggleModal","groups"])])}const Me=ne(me,[["render",Ie],["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/services/submodule/addressbook/views/ViewServicesAddressBookEditContact.vue"]]);export{Me as default};
