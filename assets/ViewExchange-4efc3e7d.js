import{d as Ce,c as I,r as F,H as p,n as j,B as o,S as W,z as n,w as x,A as Be,a as O,l as Ve,i as Ue,o as g,b as y,e as a,f as w,m as S,t as s,y as u,v as $e,x as We,h as Oe,W as ke,be as Ke}from"./index-98b53c7e.js";import{_ as Fe}from"./proximax-logo-ecfc3767.js";import{_ as Re,a as je,I as Xe}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-d8225268.js";import{_ as ze}from"./PasswordInput.vue_vue_type_script_setup_true_lang-ff9861f6.js";import"./jdenticon-module-d16cd5bb.js";const qe={class:"border-2 xl:grid xl:grid-cols-3"},Je={class:"xl:col-span-2 p-12"},Qe=a("div",null,"SDA-SDA Exchange ",-1),Ye={key:0,class:"text-xs mt-3 text-blue-primary"},Ze=a("div",{class:"text-blue-primary mt-3"},"Available Amount",-1),et=a("div",{class:"text-blue-primary mt-3"},"Minimum Offer ",-1),tt={class:"text-blue-primary mt-3"},at={key:1,class:"text-red-500 text-xs"},it={key:2,class:"text-red-500 text-xs"},st={class:"mt-2 text-xs text-gray-600"},ot={class:"flex mt-2"},lt={class:"text-gray-600 text-xs"},nt={key:0,class:"text-red-500 text-xs ml-2"},ct={key:3,class:"text-gray-600 text-xs mt-2"},rt=a("div",{class:"text-blue-primary mt-3"},"Actual offer",-1),ut={key:4},dt={key:5},vt={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},mt={key:0},pt={class:"font-bold text-xs text-blue-primary uppercase"},gt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},yt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},ft=["innerHTML"],ht={class:"flex"},bt={class:"ml-1 text-blue-400 font-bold"},xt=a("img",{src:Fe,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),_t={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},wt=a("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Gt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Tt={class:"ml-1 text-blue-400 text-xs"},At=a("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),Mt={class:"font-bold text-xs text-blue-primary uppercase"},It={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},kt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Ft=["innerHTML"],Dt={class:"flex"},Lt={class:"ml-1 text-blue-400 font-bold"},Nt=a("img",{src:Fe,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),Et=a("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Ht={key:1},St={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},Pt=a("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Ct={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Bt={class:"ml-1 text-blue-400 text-xs"},Vt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Ut={class:"font-semibold lg:col-span-2 col-span-3"},$t=["innerHTML"],Wt={class:"ml-1 text-blue-400"},Ot={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Kt={class:"font-semibold lg:col-span-2 col-span-3"},Rt=["innerHTML"],jt={class:"ml-1 text-blue-400"},Xt={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},zt={class:"font-semibold lg:col-span-2 col-span-3"},qt=["innerHTML"],Jt={class:"ml-1 text-blue-400"},Qt=a("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Yt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Zt=a("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"},"Total",-1),ea=["innerHTML"],ta={class:"ml-1 text-blue-400"},aa={class:"font-semibold text-xs text-white mb-1.5"},ia={class:"text-center"},ua=Ce({__name:"ViewExchange",props:{type:String,owner:String,pair:String},setup(De){const X=(t,i)=>{const l=(m,b)=>b===0?m:l(b,m%b),v=l(t,i),r=t/v,f=i/v;return[r,f]},_=I(()=>{var t,i,l;return parseFloat(c.value)<A.value[0]/Math.pow(10,(t=e.value)==null?void 0:t.mosaicGetDivisibility)?0:parseFloat(c.value)*Math.pow(10,(i=e.value)==null?void 0:i.mosaicGetDivisibility)%A.value[0]/Math.pow(10,(l=e.value)==null?void 0:l.mosaicGetDivisibility)}),Le=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],c=F("0"),D=I(()=>parseFloat(c.value)*R.value-_.value*R.value),z=Oe().appContext.config.globalProperties.emitter,L=F(""),G=F(null),T=F(null),q=I(()=>p.convertToExact(j.currentNetworkProfileConfig.lockedFundsPerAggregate,o.nativeToken.divisibility)),J=I(()=>p.convertToExact(W.getLockFundFee(),o.nativeToken.divisibility)),P=I(()=>{var v,r,f,m;if(!o.isReady)return 0;const t=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(parseFloat(c.value)*Math.pow(10,((v=e.value)==null?void 0:v.mosaicGetDivisibility)??0)),new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(D.value*Math.pow(10,((r=e.value)==null?void 0:r.mosaicGiveDivisibility)??0)),(f=e.value)==null?void 0:f.deadline)],o.networkType);if(!M.value)return((m=t.maxFee)==null?void 0:m.compact())/Math.pow(10,o.nativeToken.divisibility);const i=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(b=>b.address==T.value),l=[t.toAggregateV1(n.PublicAccount.createFromPublicKey(i.publicKey,o.networkType))];return o.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,o.nativeToken.divisibility)});z.on("select-account",t=>{G.value=t}),z.on("select-multisig-account",t=>{T.value=t});const d=t=>{const i=Le.find(l=>l.namespace==t);return i?i.name:t},K=I(()=>M.value?Math.round((q.value+J.value+P.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()?Math.round((parseFloat(c.value)-_.value+P.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):P.value),N=De,e=F(null),R=F(0),h=Be(),Q=N.pair.split("/")[N.type=="Sell"?0:1],Y=N.pair.split("/")[N.type=="Sell"?1:0],k=F(0),Z=t=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==t)||x.currentLoggedInWallet.others.find(l=>l.address==t);return i?E(i.balance):0},E=t=>{let i=t.toString().split(".");return i[1]!=null?'<span class="font-semibold text-sm">'+i[0]+'</span>.<span class="font-semibold text-xs">'+i[1]+"</span>":'<span class="font-semibold text-sm">'+i[0]+"</span>"},A=I(()=>{if(!e.value)return X(0,0);const t=e.value.initialMosaicGiveAmount.compact(),i=e.value.initialMosaicGetAmount.compact();return X(i,t)});O(e,t=>{t.mosaicGetDivisibility&&(c.value=(A.value[0]/Math.pow(10,t.mosaicGetDivisibility)).toString())},{deep:!0});const M=I(()=>T.value!=null),Ne=async()=>{if(!Q||!Y){h.add({severity:"error",summary:"Error",detail:"Invalid",group:"br-custom",life:1e3});return}const t=new n.ExchangeSdaHttp(o.nodeFullURL),i=await Ke(t.getAccountSdaExchangeOffers(n.Address.createFromRawAddress(N.owner)));if(e.value=i.sdaOfferBalances.find(r=>r.mosaicIdGive.toHex()==Q&&r.mosaicIdGet.toHex()==Y),!e.value){h.add({severity:"error",summary:"Error",detail:"Offer not found",group:"br-custom",life:1e3});return}const l=await o.chainAPI.assetAPI.getMosaicsNames([e.value.mosaicIdGet,e.value.mosaicIdGive]),v=await o.chainAPI.assetAPI.getMosaics([e.value.mosaicIdGet,e.value.mosaicIdGive]);e.value.mosaicGetName=l[0].names.length?l[0].names[0].name:e.value.mosaicIdGet.toHex(),e.value.mosaicGiveName=l[1].names.length?l[1].names[0].name:e.value.mosaicIdGive.toHex(),e.value.mosaicGetDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGet.toHex()).divisibility,e.value.mosaicGiveDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGive.toHex()).divisibility,R.value=e.value.initialMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)/(e.value.initialMosaicGetAmount.compact()/Math.pow(10,e.value.mosaicGetDivisibility))},ee=async t=>{try{const l=(await o.chainAPI.accountAPI.getAccountInfo(n.Address.createFromRawAddress(t))).mosaics.find(v=>v.id.toHex()==e.value.mosaicIdGet.toHex());if(!l){k.value=0;return}k.value=l.amount.compact()/Math.pow(10,e.value.mosaicGetDivisibility)}catch{k.value=0}};O(c,t=>{isNaN(parseFloat(t))&&(c.value="0")}),O([G,T],([t,i])=>{k.value=0,t!=null&&i==null?ee(t):t!=null&&i!=null&&ee(i)});const Ee=O(o,async(t,i)=>{t.isReady&&(await Ne(),Ee())},{immediate:!0}),He=t=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==t)||x.currentLoggedInWallet.others.find(l=>l.address==t);return i?i.balance:0},Se=Ve(),Pe=async()=>{if(G.value==null){h.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(parseFloat(c.value)<A.value[0]/Math.pow(10,e.value.mosaicGetDivisibility)){h.add({severity:"error",summary:"Error",detail:"Less than minimum offer amount",group:"br-custom",life:1e3});return}if(parseFloat(c.value)-_.value>k.value){h.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))/Math.pow(10,e.value.mosaicGiveDivisibility)>e.value.currentMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)){h.add({severity:"error",summary:"Error",detail:"Exceed available amount of "+d(e.value.mosaicGiveName),group:"br-custom",life:1e3});return}const t=He(G.value);if(M.value&&t<K.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()&&!M.value&&t<K.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(L.value.length<8){h.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!ke.verifyWalletPassword(x.currentLoggedInWallet.name,j.chainNetworkName,L.value)){h.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const i=x.currentLoggedInWallet.accounts.find(m=>m.address==G.value),l=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(e.value.mosaicIdGet,n.UInt64.fromUint(Math.trunc((parseFloat(c.value)-_.value)*Math.pow(10,e.value.mosaicGetDivisibility))),e.value.mosaicIdGive,n.UInt64.fromUint(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))),n.UInt64.fromUint(57600))],o.networkType),v=ke.decryptPrivateKey(new n.Password(L.value),i.encrypted,i.iv);L.value="";const r=n.Account.createFromPrivateKeyV1(v,o.networkType),f=j.currentNetworkProfile.generationHash;if(M.value){const m=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(U=>U.address==T.value),b=[l.toAggregateV1(n.PublicAccount.createFromPublicKey(m.publicKey,o.networkType))],C=o.buildTxn.aggregateBonded(b),H=r.preV2Sign(C,f),B=W.lockFundTx(H),V=r.preV2Sign(B,f);W.announceLF_AND_addAutoAnnounceABT(V,H)}else{const m=r.preV2Sign(l,f);await W.announceTransaction(m)}Se.push({name:"ViewAccountPendingTransactions",params:{address:r.address.plain()}})};return(t,i)=>{var v,r,f,m,b,C,H,B,V,U,te,ae,ie,se,oe,le,ne,ce,re,ue,de,ve,me,pe,ge,ye,fe,he,be,xe,_e,we,Ge,Te,Ae,Me,Ie;const l=Ue("router-link");return g(),y("div",null,[a("div",qe,[a("div",Je,[Qe,G.value?w("",!0):(g(),y("div",Ye,"Select Account to Create / Initiate Transaction")),S(Re),S(je,{class:"md:mt-3","selected-address":G.value},null,8,["selected-address"]),Ze,a("div",null,s(u(p).toCurrencyFormat(((v=e.value)==null?void 0:v.currentMosaicGiveAmount.compact())/Math.pow(10,(r=e.value)==null?void 0:r.mosaicGiveDivisibility),(f=e.value)==null?void 0:f.mosaicGiveDivisibility))+" "+s(d((m=e.value)==null?void 0:m.mosaicGiveName)),1),et,a("div",null,s(u(p).toCurrencyFormat(A.value[0]/Math.pow(10,(b=e.value)==null?void 0:b.mosaicGetDivisibility),(C=e.value)==null?void 0:C.mosaicGetDivisibility))+" "+s(d((H=e.value)==null?void 0:H.mosaicGetName))+" : "+s(u(p).toCurrencyFormat(A.value[1]/Math.pow(10,(B=e.value)==null?void 0:B.mosaicGiveDivisibility),(V=e.value)==null?void 0:V.mosaicGiveDivisibility))+" "+s(d((U=e.value)==null?void 0:U.mosaicGiveName)),1),a("div",tt,"Amount to give ("+s(d((te=e.value)==null?void 0:te.mosaicGetName))+") ",1),S(Xe,{placeholder:"Asset Amount",modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=$=>c.value=$),decimal:((ae=e.value)==null?void 0:ae.mosaicGetDivisibility)??0},null,8,["modelValue","decimal"]),parseFloat(c.value)>k.value?(g(),y("div",at,"Insufficient Balance")):w("",!0),parseFloat(c.value)<A.value[0]/Math.pow(10,(ie=e.value)==null?void 0:ie.mosaicGetDivisibility)?(g(),y("div",it,"Less than minimum offer amount ")):w("",!0),a("div",st,"Available to give: "+s(u(p).toCurrencyFormat(k.value,(se=e.value)==null?void 0:se.mosaicGetDivisibility))+" "+s(d((oe=e.value)==null?void 0:oe.mosaicGetName)),1),a("div",ot,[a("div",lt," I will receive "+s(u(p).toCurrencyFormat(D.value,(le=e.value)==null?void 0:le.mosaicGiveDivisibility))+" "+s(d((ne=e.value)==null?void 0:ne.mosaicGiveName)),1),Math.trunc(D.value*Math.pow(10,(ce=e.value)==null?void 0:ce.mosaicGiveDivisibility))/Math.pow(10,(re=e.value)==null?void 0:re.mosaicGiveDivisibility)>((ue=e.value)==null?void 0:ue.currentMosaicGiveAmount.compact())/Math.pow(10,(de=e.value)==null?void 0:de.mosaicGiveDivisibility)?(g(),y("div",nt," (Exceed Available Amount of "+s(d((ve=e.value)==null?void 0:ve.mosaicGiveName))+")",1)):w("",!0)]),Math.trunc(_.value*Math.pow(10,(me=e.value)==null?void 0:me.mosaicGetDivisibility))/Math.pow(10,(pe=e.value)==null?void 0:pe.mosaicGetDivisibility)>0?(g(),y("div",ct,s(u(p).toCurrencyFormat(_.value,(ge=e.value)==null?void 0:ge.mosaicGetDivisibility))+" "+s(d((ye=e.value)==null?void 0:ye.mosaicGetName))+" will be ignored ",1)):w("",!0),rt,parseFloat(c.value)>=A.value[0]/Math.pow(10,(fe=e.value)==null?void 0:fe.mosaicGetDivisibility)?(g(),y("div",ut,s(u(p).toCurrencyFormat(parseFloat(c.value)-_.value,(he=e.value)==null?void 0:he.mosaicGetDivisibility))+" "+s(d((be=e.value)==null?void 0:be.mosaicGetName))+" : "+s(u(p).toCurrencyFormat(D.value,(xe=e.value)==null?void 0:xe.mosaicGiveDivisibility))+" "+s(d((_e=e.value)==null?void 0:_e.mosaicGiveName)),1)):(g(),y("div",dt," 0 "+s(d((we=e.value)==null?void 0:we.mosaicGetName))+" : 0 "+s(d((Ge=e.value)==null?void 0:Ge.mosaicGiveName)),1))]),a("div",vt,[T.value?(g(),y("div",mt,[a("div",pt,s(t.$t("general.multisigAcc")),1),a("div",gt,[a("div",yt,s(t.$t("general.currentBalance")),1),a("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:Z(T.value)},null,8,ft),a("div",ht,[a("div",bt,s(u(o).nativeToken.label),1),xt])]),a("div",_t,[wt,a("span",Gt,s(u(p).toCurrencyFormat(parseFloat(c.value)-_.value,(Te=e.value)==null?void 0:Te.mosaicGetDivisibility)),1),a("span",Tt,s(d((Ae=e.value)==null?void 0:Ae.mosaicGetName)),1)]),At])):w("",!0),a("div",Mt,s(t.$t("general.signerAcc")),1),a("div",It,[a("div",kt,s(t.$t("general.currentBalance")),1),a("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:Z(G.value)},null,8,Ft),a("div",Dt,[a("div",Lt,s(u(o).nativeToken.label),1),Nt])]),Et,T.value?w("",!0):(g(),y("div",Ht,[a("div",St,[Pt,a("span",Ct,s(u(p).toCurrencyFormat(parseFloat(c.value)-_.value,(Me=e.value)==null?void 0:Me.mosaicGetDivisibility)),1),a("span",Bt,s(d((Ie=e.value)==null?void 0:Ie.mosaicGetName)),1)])])),a("div",Vt,[a("div",Ut,s(M.value?t.$t("general.aggregateFee"):t.$t("general.transactionFee")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(P.value)},null,8,$t),a("div",Wt,s(u(o).nativeToken.label),1)]),M.value?(g(),y("div",Ot,[a("div",Kt,s(t.$t("general.lockFund")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(q.value??0)},null,8,Rt),a("div",jt,s(u(o).nativeToken.label),1)])):w("",!0),M.value?(g(),y("div",Xt,[a("div",zt,s(t.$t("general.lockFundTxFee")),1),a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(J.value??0)},null,8,qt),a("div",Jt,s(u(o).nativeToken.label),1)])):w("",!0),Qt,a("div",Yt,[Zt,a("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(K.value)},null,8,ea),a("div",ta,s(u(o).nativeToken.label),1)]),a("div",aa,s(t.$t("general.enterPasswordContinue")),1),S(ze,{placeholder:t.$t("general.enterPassword"),modelValue:L.value,"onUpdate:modelValue":i[1]||(i[1]=$=>L.value=$),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),a("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[2]||(i[2]=$=>Pe())}," Sell "),a("div",ia,[S(l,{to:{name:"ViewExchangeListing"},class:"content-center text-xs text-white underline"},{default:$e(()=>[We(s(t.$t("general.cancel")),1)]),_:1})])])])])}}});export{ua as default};
