import{_ as Ae,u as Ce,q as ke,r as i,w as k,H as E,E as x,c as _,n as Y,V as xe,a as M,A as Te,k as w,o as T,b as S,e as a,s as A,t as y,f as q,F as Se,h as Fe,z as le,aC as Ne,Q as se,U as oe,B as Ie,i as Pe,p as De,j as Ue}from"./index-42fb6041.js";import{_ as Ve}from"./PasswordInput.vue_vue_type_script_setup_true_lang-039a64c1.js";import{T as Ee}from"./TextInput-2a10c657.js";import{_ as Me}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-c5d9a3e2.js";import{T as Ke}from"./TextInputClean-8a67b611.js";import{M as K}from"./multisigUtils-44967108.js";import{_ as Le}from"./SelectAccountAndContact.vue_vue_type_script_setup_true_lang-a1160fc0.js";import{A as Be,_ as We}from"./AccountTabs.vue_vue_type_script_setup_true_lang-c323f8d6.js";import{_ as je}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-2412ea1e.js";import"./functions-6429d95a.js";import"./icon-key-5b3f7dda.js";const Oe={name:"ViewConvertAccountMultisig",components:{PasswordInput:Ve,TextInput:Ee,TextInputClean:Ke,SelectAccountAndContact:Le,AccountComponent:Be,AccountTabs:We,TransactionFeeDisplay:Me},props:{address:String},setup(n){const{t:l}=Ce(),P=ke();Pe().appContext.config.globalProperties.emitter;const u=i(""),L=i(""),F=i(!1),N=i(""),H=i(!1),B="^[^ ]{8,}$",g=i(1),f=i(1),d=i(0),v=i(0),R="^[0-9A-Fa-f]{64}$",c=i([]),s=i([]),r=i([]),b=i([]),h=i([]),z=i([]),D=i(!1),ne=i(!1),W=k.currentLoggedInWallet?k.currentLoggedInWallet.selectDefaultAccount():null,re=i(W?W.address:""),ce=i(E.toCurrencyFormat(W?W.balance:0,x.nativeToken.divisibility)),Q=_(()=>E.convertToCurrency(Y.currentNetworkProfileConfig.lockedFundsPerAggregate,x.nativeToken.divisibility)),Z=_(()=>Y.currentNetworkProfile?E.convertToExact(xe.getLockFundFee(),x.nativeToken.divisibility):0),j=i(0),p=_(()=>k.currentLoggedInWallet?k.currentLoggedInWallet.accounts.find(e=>e.address===n.address):null);let G=_(()=>{if(p.value)return K.checkIsMultiSig(p.value.address)}),O=()=>{p.value&&(j.value=K.getAggregateFee(p.value.publicKey,c.value,g.value,f.value))};O();const U=_(()=>{let e=x.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(j.value)+parseFloat(Q.value)+Z.value):Math.round((parseFloat(j.value)+parseFloat(Q.value)+Z.value)*Math.pow(10,e))/Math.pow(10,e)}),ie=_(()=>x.nativeToken.label),ue=_(()=>x.nativeToken.divisibility);_(()=>k.currentLoggedInWallet?E.toCurrencyFormat(p.value.balance,ue.value):"0");const ee=_(()=>{if(!p.value)return!1;const e=k.currentLoggedInWallet;let o=e.accounts.map(C=>({name:C.name,publicKey:C.publicKey})),m=e.contacts;var I=[],V=0;return I.push({key:"0",label:l("general.ownerAcc"),selectable:!1,children:[]}),o.forEach(C=>{I[0].children.push({key:"0-"+V.toString(),label:C.name,data:C.publicKey}),V++}),V=0,I.push({key:"1",label:l("general.contact"),selectable:!1,children:[]}),m!=null&&m.forEach(C=>{I[1].children.push({key:"1-"+V.toString(),label:C.name,data:C.address}),V++}),I});function de(e,o){te(o),r.value[o]=e.label,e.key[0]=="1"?ve(e.data,o):c.value[o]=e.data,c.value[o]=e.data,z.value[o]=!1,s.value[o][e.key]=!0,e.selectable=!1}function ve(e,o){try{K.verifyContactPublicKey(e).then(m=>{m.status==!0?c.value[o]=m.publicKey:u.value=l("multisig.noPublicKey")})}catch{u.value=l("multisig.noPublicKey")}}const te=e=>{if(Object.keys(s.value[e]).length!==0){let o=Object.keys(s.value[e])[0].split("-");ee.value[o[0]].children[o[1]].selectable=!0,s.value[e]={}}},me=_(()=>G.value||D.value||!N.value.match(B)||c.value.length==0||u.value||h.value.every(e=>e==!1)==!1||f.value==0||g.value==0),pe=_(()=>{if(!p.value)return!1;var e=!1;if(p.value.balance>=U.value&&!D.value){for(var o=0;o<c.value.length;o++)if(h.value[o]!=""){e=!0;break}else if(c.value[o].length<40){e=!0;break}}else e=!0;return e}),ae=()=>{c.value=[],b.value=[],h.value=[],N.value="",g.value=1,d.value=0,f.value=1,v.value=0},ge=async()=>{await K.convertAccount(c.value,g.value,f.value,p.value.name,N.value)?(L.value="",ae(),P.push({name:"ViewAccountPendingTransactions",params:{address:n.address}})):L.value=l("general.walletPasswordInvalid",{name:k.currentLoggedInWallet.name})};M(()=>[...c.value],e=>{let o=!1;if(c.value.length>0)for(var m=0;m<c.value.length;m++)c.value[m].length==64?c.value[m]==p.value.publicKey&&o==!1?(o=!0,h.value[m]=!0,u.value=l("multisig.selectedAccErr")):!c.value[m].match(R)&&c.value[m].length==64?h.value[m]=!0:(h.value[m]=!1,Array.from(new Set(e)).length!=e.length?u.value=l("multisig.duplicatedCosigner"):o==!1&&(u.value="")):h.value[m]=!0;else u.value=""},{deep:!0}),M(()=>[...h.value],e=>{e.every(o=>o==!1)&&O()},{deep:!0});const fe=()=>{c.value.push(""),s.value.push({}),h.value.push(!1),d.value+=1,v.value+=1},be=e=>{d.value>0&&(d.value-=1),v.value>0&&(v.value-=1),f.value>v.value&&(f.value=v.value),g.value>d.value&&(g.value=d.value),te(e),c.value.splice(e,1),s.value.splice(e,1),r.value.splice(e,1),z.value.splice(e,1),b.value.splice(e,1),h.value.splice(e,1)},_e=e=>{g.value*10*~~(d.value/10)+e.charCode-48>d.value&&e.preventDefault()};let J=l("multisig.deletionExceedMax"),X=l("multisig.approvalExceedMax");M(g,e=>{O(),d.value==0&&e>1||e>d.value&&e!=1&&d.value!=0?u.value=X:d.value>0&&e<=0?u.value=l("multisig.approvalAtLeastOne"):f.value>v.value&&f.value!=1&&v.value!=0?u.value=J:u.value=""});const ye=e=>{f.value*10*~~(v.value/10)+e.charCode-48>v.value&&e.preventDefault()};M(f,e=>{O(),v.value==0&&e>1||e>v.value&&e!=1&&v.value!=0?u.value=J:v.value>0&&e<=0?u.value=l("multisig.deletionAtLeastOne"):g.value>d.value&&g.value!=1&&d.value!=0?u.value=X:u.value=""});const he=_(()=>D.value||G.value);p.value&&K.onPartial(Te.PublicAccount.createFromPublicKey(p.value.publicKey,x.networkType)).then(e=>D.value=e),p.value&&p.value.balance<U.value&&(F.value=!0),M(p,e=>{e&&(e.balance<U.value?F.value=!0:F.value=!1)});const we=_(()=>E.amountFormatterSimple(U.value,0));return{networkState:Y,toggleContact:z,contact:ee,space:ne,currentNativeTokenName:ie,contactName:r,err:u,disableSend:me,numApproveTransaction:g,numDeleteUser:f,maxNumApproveTransaction:d,maxNumDeleteUser:v,fundStatus:F,acc:p,passwd:N,showPasswdError:H,showAddressError:h,addCoSig:fe,coSign:c,addCoSigButton:pe,selectedNode:s,deleteCoSigAddressInput:be,onNodeSelect:de,selectedAddresses:b,clear:ae,convertAccount:ge,disabledPassword:he,onPartial:D,isMultisig:G,passwdPattern:B,validateApproval:_e,validateDelete:ye,lockFundCurrency:Q,lockFundTxFee:Z,aggregateFee:j,totalFee:U,totalFeeFormatted:we,selectedAccAdd:re,accBalance:ce,passwordErr:L}}},$=n=>(De("data-v-47914c6a"),n=n(),Ue(),n),qe={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},He={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},Re={class:"lg:col-span-2 py-6 pr-6"},ze={class:"text-xs font-semibold pl-6"},Qe={class:"pl-6"},Ze={key:0,class:"error error_box mb-5"},Ge={key:1,class:"error error_box mb-5"},Je=$(()=>a("div",{class:"mt-4"},null,-1)),Xe={class:"flex flex-col gap-2"},Ye={class:"flex"},$e=["onClick"],et={key:0,class:"mt-16"},tt=["onClick"],at={class:"text-xxs text-blue-primary font-semibold uppercase"},lt={key:0},st=["disabled"],ot=$(()=>a("div",{class:"ml-6 my-7 gray-line"},null,-1)),nt={class:"pl-6 text-xs font-semibold mb-3"},rt={class:"flex gap-2 pl-6"},ct={class:"border w-6/12"},it={class:"border-b-2 text-xxs text-center py-1 uppercase"},ut={class:"flex justify-around"},dt=["disabled"],vt=["max"],mt=["disabled"],pt={class:"text-xxs border-t-2 text-center py-1 uppercase"},gt={class:"border w-6/12"},ft={class:"border-b-2 text-xxs text-center py-1 uppercase"},bt={class:"flex justify-around"},_t=["disabled"],yt=["max"],ht=["disabled"],wt={class:"text-xxs border-t-2 text-center py-1 uppercase"},At={class:"bg-navy-primary p-6 lg:col-span-1"},Ct=$(()=>a("div",{class:"mt-5"},null,-1)),kt={class:"font-semibold text-xs text-white mb-1.5"},xt={class:"mt-3"},Tt=["disabled"],St={class:"text-center"};function Ft(n,l,P,t,u,L){const F=w("AccountComponent"),N=w("AccountTabs"),H=w("TextInput"),B=w("TextInputClean"),g=w("font-awesome-icon"),f=w("SelectAccountAndContact"),d=w("Sidebar"),v=w("TransactionFeeDisplay"),R=w("PasswordInput"),c=w("router-link");return T(),S("div",null,[a("div",qe,[A(F,{address:P.address,class:"mb-6"},null,8,["address"]),A(N,{address:P.address,selected:"multisig"},null,8,["address"]),a("div",He,[a("div",Re,[a("div",ze,y(n.$t("multisig.manageCosignatories")),1),a("div",Qe,[t.err!=""?(T(),S("div",Ze,y(t.err),1)):q("",!0),t.passwordErr!=""?(T(),S("div",Ge,y(t.passwordErr),1)):q("",!0)]),Je,a("div",Xe,[(T(!0),S(Se,null,Fe(t.coSign,(s,r)=>(T(),S("div",{key:r},[a("div",Ye,[a("img",{src:je,onClick:b=>t.deleteCoSigAddressInput(r),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,$e),A(H,{class:"w-5/12 mr-2",placeholder:n.$t("multisig.cosignatory")+`${r+1}`,modelValue:t.contactName[r],"onUpdate:modelValue":b=>t.contactName[r]=b,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),A(B,{class:"w-7/12 mr-2",placeholder:n.$t("general.publicKey"),errorMessage:n.$t("general.invalidInput"),showError:t.showAddressError[r],modelValue:t.coSign[r],"onUpdate:modelValue":b=>t.coSign[r]=b},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),t.showAddressError[r]==!0?(T(),S("div",et)):q("",!0),a("div",{onClick:b=>t.toggleContact[r]=!t.toggleContact[r],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[A(g,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),a("div",at,y(n.$t("general.select")),1)],8,tt)]),t.toggleContact[r]?(T(),S("div",lt,[A(d,{visible:t.toggleContact[r],"onUpdate:visible":b=>t.toggleContact[r]=b,baseZIndex:1e4,position:"full"},{default:le(()=>[A(f,Ne(r,{contacts:t.contact,index:r,selectedNode:t.selectedNode[r],onNodeSelect:b=>t.onNodeSelect(b,r)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):q("",!0)]))),128))]),a("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:l[0]||(l[0]=(...s)=>t.addCoSig&&t.addCoSig(...s)),disabled:t.addCoSigButton},"+"+y(n.$t("multisig.addNewCosignatory")),9,st),ot,a("div",nt,y(n.$t("general.scheme")),1),a("div",rt,[a("div",ct,[a("div",it,y(n.$t("multisig.transactionsApproval")),1),a("div",ut,[a("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[1]||(l[1]=s=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,dt),se(a("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[2]||(l[2]=(...s)=>t.validateApproval&&t.validateApproval(...s)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":l[3]||(l[3]=s=>t.numApproveTransaction=s)},null,40,vt),[[oe,t.numApproveTransaction]]),a("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:l[4]||(l[4]=s=>t.numApproveTransaction++)},"+",8,mt)]),a("div",pt,y(n.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),a("div",gt,[a("div",ft,y(n.$t("multisig.accountDeletionApproval")),1),a("div",bt,[a("button",{class:"text-blue-primary disabled:opacity-50",onClick:l[5]||(l[5]=s=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,_t),se(a("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:l[6]||(l[6]=(...s)=>t.validateDelete&&t.validateDelete(...s)),max:t.maxNumDeleteUser,"onUpdate:modelValue":l[7]||(l[7]=s=>t.numDeleteUser=s)},null,40,yt),[[oe,t.numDeleteUser]]),a("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:l[8]||(l[8]=s=>t.numDeleteUser++)},"+",8,ht)]),a("div",wt,y(n.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),a("div",At,[A(v,{"fund-status":t.fundStatus,"is-multisig-already":t.isMultisig,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"lock-fund-currency-convert":t.lockFundCurrency,"lock-fund-tx-fee-convert":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig-already","on-partial","transaction-fee","total-fee-formatted","lock-fund-currency-convert","lock-fund-tx-fee-convert","balance","selected-acc-add"]),Ct,a("div",kt,y(n.$t("general.enterPasswordContinue")),1),A(R,{placeholder:n.$t("general.enterPassword"),errorMessage:n.$t("general.passwordRequired"),showError:t.showPasswdError,modelValue:t.passwd,"onUpdate:modelValue":l[9]||(l[9]=s=>t.passwd=s),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),a("div",xt,[a("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:l[10]||(l[10]=s=>t.convertAccount()),disabled:t.disableSend},y(n.$t("multisig.updateCosignatories")),9,Tt)]),a("div",St,[A(c,{to:{name:"ViewMultisigHome",params:{address:P.address}},class:"content-center text-xs text-white underline"},{default:le(()=>[Ie(y(n.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Ot=Ae(Oe,[["render",Ft],["__scopeId","data-v-47914c6a"]]);export{Ot as default};
