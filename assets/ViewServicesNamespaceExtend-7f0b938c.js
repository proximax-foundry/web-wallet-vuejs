import{_ as Ne,u as Te,l as Pe,A as Fe,r as s,c as l,n as i,b3 as Le,b4 as Se,B as u,G as Ie,aX as Ae,H as c,S as X,ai as Y,w as C,D as Me,a as L,am as W,b5 as ce,i as S,o as g,b as m,e as n,t as o,m as D,f as N,x as J,O as Be,aa as Ee,F as Ve,g as We,v as Ue,W as He,z as Re}from"./index-a022c3bf.js";import{_ as je}from"./PasswordInput.vue_vue_type_script_setup_true_lang-8cf80800.js";import{D as Oe}from"./DurationInputClean-97939cb1.js";import{_ as qe}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-21716866.js";import{N as I}from"./namespaceUtils-537ce4ad.js";import{t as ze}from"./jdenticon-module-5a7d6ef0.js";import{M as Ge}from"./multisigUtils-02d7ca23.js";import{T as Q}from"./transactionState-056a7852.js";import{_ as Xe}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const Ye={name:"ViewServicesNamespaceExtend",components:{PasswordInput:je,DurationInputClean:Oe,TransactionFeeDisplay:qe},props:{namespaceId:String,address:String},setup(t){const{t:h}=Te(),Z=Pe();Fe();const e=s(null),U=s(!1),v=s("1"),y=s(""),A=s(""),p=s(!1),T=s(!1),H="^[^ ]{8,}$",d=s(!1),w=s(""),de=s(!1),ue=s(!1),_=s(""),M=s(0),R=s(0),B=s(0),j=s(!1),P=l(()=>i.currentNetworkProfileConfig?Math.floor(Le.configReturn(i.currentNetworkProfileConfig.maxNamespaceDuration,Se.DAY)):0),ge=l(()=>u.readBlockHeight),me=l(()=>u.nativeToken.label);(async()=>{const a=Ie.buildAPIEndpoint(i.selectedAPIEndpoint,i.currentNetworkProfile?i.currentNetworkProfile.httpPort:3e3),r=new Ae(a);M.value=await r.chainAPI.getBlockchainHeight()})();const ve=l(()=>{let a=[];const r=I.listRootNamespaces(x.value);return a.push.apply(a,r),a}),fe=l(()=>u.nativeToken.label),E=l(()=>i.currentNetworkProfileConfig?v.value>0?c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*I.calculateDuration(v.value),u.nativeToken.divisibility):c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,u.nativeToken.divisibility):0),he=l(()=>c.toCurrencyFormat(E.value,6)),be=l(()=>i.currentNetworkProfileConfig?c.convertToExact(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),ye=l(()=>i.currentNetworkProfileConfig?c.amountFormatterSimple(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),O=l(()=>i.currentNetworkProfile?c.convertToExact(X.getLockFundFee(),u.nativeToken.divisibility):0),V=l(()=>(f.value?f.value.cosignerList.length:0)==0&&Y(x.value)),we=s(O.value.toString()),q=l(()=>be.value+O.value),ke=l(()=>!(y.value.match(H)&&!U.value&&!le.value&&!V.value)),K=s(""),x=s(""),z=s(""),$=s(""),ee=l(()=>C.currentLoggedInWallet?C.currentLoggedInWallet.selectDefaultAccount():null),pe=s(ee.value?Y(ee.value.address):!1),ae=c.createAddress(t.address).plain();let b=l(()=>C.currentLoggedInWallet?C.currentLoggedInWallet.accounts.find(a=>a.address==ae)||C.currentLoggedInWallet.others.find(a=>a.address==ae):null);b.value&&(K.value=b.value.name,x.value=b.value.address,z.value=c.toCurrencyFormat(b.value.balance,u.nativeToken.divisibility),$.value=b.value.balance);let te=new Me("ThemeStyleConfig");te.init();const _e=s(ze(t.address,40,te.jdenticonConfig));if(b.value){let a=b.value.namespaces.find(r=>r.idHex===t.namespaceId);if(a!=null){R.value=a.endHeight;const r=a.name.split(".");r.length>1?w.value=r[0]:w.value=a.name}}const ne=s("0"),F=s(0);try{ne.value=c.convertToCurrency(I.getRootNamespaceTransactionFee(w.value,v.value),u.nativeToken.divisibility),F.value=c.convertToExact(I.getRootNamespaceTransactionFee(w.value,v.value),u.nativeToken.divisibility)}catch{}let G=!1;L(v,a=>{if(a>P.value)v.value=P.value;else{let r=R.value-M.value,k=0;B.value=Math.ceil(r/(24*60*4)),parseInt(a)+B.value>P.value?(k=P.value-B.value,v.value=k.toString(),j.value=!0,G=!0):(G||(j.value=!1),G=!1)}});const xe=()=>{v.value="1"},se=l(()=>Y(c.createAddress(t.address).plain())?parseFloat(q.value)+E.value+F.value:E.value+F.value),Ce=l(()=>c.amountFormatterSimple(se.value,0));L(se,a=>{z.value<a&&!V.value?p.value=!0:p.value=!1}),L(ge,a=>{M.value=a});const De=()=>{if(!He.verifyWalletPassword(C.currentLoggedInWallet.name,i.chainNetworkName,y.value)){A.value=h("general.walletPasswordInvalid",{name:C.currentLoggedInWallet.name});return}let r={};const ie=u.buildTxn.registerRootNamespace(w.value,Re.UInt64.fromUint(I.calculateDuration(Number(v.value))));re.value?r=X.signTxnWithPassword(re.value,x.value,y.value,ie):r=X.signTxnWithPassword(x.value,null,y.value,ie),Q.lockHashPayload=r.hashLockTxnPayload,Q.transactionPayload=r.txnPayload,Q.selectedAddress=x.value,Z.push({name:"ViewConfirmTransaction"})},f=l(()=>{if(b.value)if(i.currentNetworkProfileConfig){let a=Ge.getCosignerInWallet(b.value?b.value.publicKey:""),r=[];return a.cosignerList.forEach(k=>{r.push({publicKey:k,name:W(k).name,balance:W(k).balance,address:W(k).address})}),a.cosignerList=r,{hasCosigner:a.hasCosigner,cosignerList:a.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});_.value=f.value&&f.value.cosignerList.length>0?f.value.cosignerList[0].address:"",L(f,a=>{a&&a.cosignerList.length>0&&(_.value=a.cosignerList.length>0?f.value.cosignerList[0].address:"")});const oe=l(()=>{let a=ce(_.value)?ce(_.value).balance:0;return c.toCurrencyFormat(a)}),le=l(()=>_.value.length<=0?$.value<F.value:Number(oe.value)<F.value+q.value);L(V,a=>{a?(p.value=!0,T.value=!0):(p.value=!1,T.value=!1)});const re=l(()=>f.value.cosignerList.length>0?f.value.cosignerList.length>1?_.value:W(f.value.cosignerList[0].publicKey).address:"");return{namespaceSelect:e,selectedAccName:K,selectedAccAdd:x,balance:z,showNoBalance:le,err:A,walletPassword:y,disableCreate:ke,showPasswdError:d,disabledPassword:p,showDuration:de,disabledDuration:T,duration:v,showDurationErr:U,isMultiSigBool:pe,rentalFee:E,rentalFeeCurrency:he,lockFundTxFee:O,lockFundCurrency:ye,currencyName:fe,lockFundTxFeeCurrency:we,lockFundTotalFee:q,totalFeeFormatted:Ce,selectNamespace:w,namespaceOption:ve,extendNamespace:De,transactionFee:ne,getMultiSigCosigner:f,cosignerBalanceInsufficient:ue,cosignerAddress:_,isNotCosigner:V,block:M,endBlock:R,numDaysleft:B,showMaxDaysLabel:j,svgString:_e,Helper:c,currentNativeTokenName:me,maxDurationInDays:P,setDefaultDuration:xe,checkCosignBalance:oe}}},Je={class:"w-10/12 ml-auto mr-auto"},Qe={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Ze={class:"xl:col-span-2 p-6 lg:p-12"},Ke={class:"lg:flex lg:justify-between lg:items-center"},$e={class:"font-semibold mb-4 inline-block mt-1"},ea={class:"flex items-center"},aa=["innerHTML"],ta={class:"ml-2"},na={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},sa={class:"font-bold text-black text-sm"},oa={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},la={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},ra={class:"inline-block text-xs"},ia={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},ca={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},da={class:"inline-block text-xs"},ua={key:2,class:"error error_box"},ga={class:"text-right w-full"},ma={key:0,class:"inline-block"},va={class:"text-tsm text-left mt-3"},fa={key:0,class:"font-bold"},ha={key:0,class:"error"},ba={key:1,class:"font-bold"},ya=["value"],wa={key:2,class:"error"},ka={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},pa=n("img",{src:Xe},null,-1),_a={class:"ml-1"},xa={class:"uppercase text-blue-primary font-semibold text-xxs"},Ca={class:"text-black text-sm font-bold"},Da={key:3,class:"text-xs inline-block text-gray-400"},Na={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Ta={class:"text-xs text-white my-5"},Pa=["disabled"],Fa={class:"text-center"};function La(t,h,Z,e,U,v){const y=S("font-awesome-icon"),A=S("DurationInputClean"),p=S("TransactionFeeDisplay"),T=S("PasswordInput"),H=S("router-link");return g(),m("div",null,[n("div",Je,[n("div",Qe,[n("div",Ze,[n("div",Ke,[n("div",$e,o(t.$t("general.extendDuration")),1),n("div",ea,[n("div",{innerHTML:e.svgString,class:"inline-block"},null,8,aa),n("div",ta,[n("div",na,o(t.$t("namespace.namespaceCreatedBy")),1),n("div",sa,o(e.selectedAccName),1)])])]),e.showNoBalance?(g(),m("div",oa,[n("div",la,[D(y,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),n("div",ra,o(t.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(g(),m("div",ia,[n("div",ca,[D(y,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),n("div",da,o(t.$t("general.noCosigner")),1)])):N("",!0),e.err!=""?(g(),m("div",ua,o(e.err),1)):N("",!0),n("div",ga,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(g(),m("div",ma,[n("div",va,[J(o(t.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(g(),m("span",fa,[J(o(e.getMultiSigCosigner.cosignerList[0].name)+" ("+o(t.$t("general.balance"))+": "+o(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+o(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(g(),m("span",ha,"- "+o(t.$t("general.insufficientBalance")),1)):N("",!0)])):(g(),m("span",ba,[Be(n("select",{"onUpdate:modelValue":h[0]||(h[0]=d=>e.cosignerAddress=d)},[(g(!0),m(Ve,null,We(e.getMultiSigCosigner.cosignerList,(d,w)=>(g(),m("option",{value:d.address,key:w},o(d.name)+" ("+o(t.$t("general.balance"))+": "+o(d.balance)+" "+o(e.currentNativeTokenName)+")",9,ya))),128))],512),[[Ee,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(g(),m("div",wa,"- "+o(t.$t("general.insufficientBalance")),1)):N("",!0)])])):N("",!0)]),n("div",ka,[pa,n("div",_a,[n("div",xa,o(t.$t("general.namespace")),1),n("div",Ca,o(e.selectNamespace),1)])]),D(A,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":h[1]||(h[1]=d=>e.duration=d),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:t.$t("namespace.duration"),showError:e.showDurationErr,toolTip:t.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+t.$t("general.year"):""} (${e.maxDurationInDays}`+t.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(g(),m("div",Da,o(t.$t("namespace.durationMsg2"))+" "+o(e.maxDurationInDays-e.numDaysleft)+" "+o(t.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):N("",!0)]),n("div",Na,[D(p,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),n("div",Ta,o(t.$t("general.enterPasswordContinue")),1),D(T,{placeholder:t.$t("general.password"),errorMessage:t.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":h[2]||(h[2]=d=>e.walletPassword=d),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),n("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:h[3]||(h[3]=(...d)=>e.extendNamespace&&e.extendNamespace(...d))},o(t.$t("general.extendDuration")),9,Pa),n("div",Fa,[D(H,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Ue(()=>[J(o(t.$t("general.cancel")),1)]),_:1})])])])])])}const ja=Ne(Ye,[["render",La]]);export{ja as default};
