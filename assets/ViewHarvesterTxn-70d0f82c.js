import{d as Q,o as v,f as b,e as t,t as p,_ as q,i as V,y as ne,k as oe,j as re,g as r,c as i,W as E,w as U,A as a,H as d,n as B,B as ie,D as W,r as z,Q as ue,a as ce,b as M,l as f,O as de,s as ve,E as me,x as O}from"./index-5ab99b99.js";import{_ as fe}from"./icon-red-x-a5511f99.js";import{_ as be}from"./icon-green-tick-1b766454.js";import{_ as pe}from"./SelectInputAccount.vue_vue_type_script_setup_true_lang-3fad3d1f.js";import{_ as _e}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-5a92369c.js";import{_ as xe}from"./MultisigInput.vue_vue_type_script_setup_true_lang-d33db91b.js";import{_ as ye}from"./TxnSummary.vue_vue_type_script_setup_true_lang-e3826c5f.js";import{T as ge}from"./TransactionLayout-bd837a1b.js";import{T as K}from"./transactionState-cfbbb012.js";import"./jdenticon-module-3d0ed466.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-42d5384c.js";import"./proximax-logo-ecfc3767.js";const he={class:"border border-gray-200 px-2 py-2 rounded-md w-full"},ke={class:"flex gap-2"},we={class:"flex flex-col w-full"},Te={class:"uppercase text-gray-500 font-light text-xxs text-left"},Ae=["value"],Pe={key:0,class:"flex flex-col ml-auto justify-center mt-1"},Ve={class:"text-xxs text-red-400 font-bold uppercase"},$e={key:1,class:"flex flex-col ml-auto justify-center mt-1"},Ie={class:"text-xxs text-green-400 font-bold uppercase"},Fe=Q({__name:"PublicKeyInputClean",props:{placeholder:String,showError:Boolean,modelValue:String},emits:["update:modelValue"],setup(u){return(n,s)=>(v(),b("div",he,[t("div",ke,[t("div",we,[t("div",Te,p(u.placeholder),1),t("input",{autocomplete:"off",type:"text",value:u.modelValue,onInput:s[0]||(s[0]=$=>n.$emit("update:modelValue",$.target.value)),class:"w-full font-semibold text-tsm outline-none mt-1"},null,40,Ae)]),u.showError?(v(),b("div",Pe,[s[1]||(s[1]=t("img",{src:fe,class:"h-5 w-5 mr-auto ml-auto"},null,-1)),t("div",Ve,p(n.$t("general.invalid")),1)])):(v(),b("div",$e,[s[2]||(s[2]=t("img",{src:be,class:"h-5 w-5 mr-auto ml-auto"},null,-1)),t("div",Ie,p(n.$t("general.valid")),1)]))])]))}});const Se={props:{placeholder:String,errorMessage:String,showError:Boolean,modelValue:String,title:String,disabled:Boolean},emits:["update:modelValue"],name:"SelectLinkType",data(){return{inputText:"",borderColor:"border border-gray-300",textErr:!1}},watch:{showError:function(u){u?(this.borderColor="border-2 border-red-primary",this.textErr=!0):(this.borderColor="border-2 border-gray-300",this.textErr=!1)}}},Ce={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},He={class:"uppercase text-gray-500 text-txs text-left mb-2"},Ee={class:"flex items-center"},Be=["value","disabled","checked"],Me=["value","disabled","checked"],Ke={class:"h-3 mb-2"},Ne={key:0,class:"error error-text text-left"};function De(u,n,s,$,T,N){return v(),b("div",null,[t("div",Ce,[t("div",He,p(s.title),1),t("div",Ee,[t("input",{id:"add",type:"radio",name:"linkType",value:s.modelValue,disabled:s.disabled,class:"h-5 w-5",onChange:n[0]||(n[0]=y=>u.$emit("update:modelValue","add")),checked:s.modelValue=="link"},null,40,Be),n[2]||(n[2]=t("label",{for:"add",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Add",-1)),t("input",{id:"remove",type:"radio",name:"linkType",value:s.modelValue,disabled:s.disabled,class:"h-5 w-5",onChange:n[1]||(n[1]=y=>u.$emit("update:modelValue","remove")),checked:s.modelValue=="unlink"},null,40,Me),n[3]||(n[3]=t("label",{for:"remove",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Remove",-1))])]),t("div",Ke,[T.textErr||s.showError?(v(),b("div",Ne,p(s.errorMessage),1)):V("",!0)])])}const Le=q(Se,[["render",De]]),je={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},Re={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},Ue={class:"inline-block text-xs"},We={key:1,class:"error error_box"},ze={class:"mt-4"},Oe={class:"flex gap-1 mt-3"},Qe={key:0,class:"mt-3"},qe={class:"mt-3"},Ge={class:""},Je=["disabled"],Xe={class:"text-center"},Ye=Q({__name:"ViewHarvesterTxn",setup(u){const n=ne(),s=oe();me().appContext.config.globalProperties.emitter,re();const T=r("");r(!1);const N=r(!1),y=r(""),h=r(""),A=r(!0),I=r(),k=r(),F=r();i(()=>H.value||N.value);const G=()=>{try{F.value=O.PublicAccount.createFromPublicKey(h.value,a.networkType),A.value=!1}catch{A.value=!0}};try{I.value=E.createPublicAccount(U.currentLoggedInWallet?U.currentLoggedInWallet.selectDefaultAccount().publicKey:"",a.networkType)}catch(e){console.log(e)}const J=i(()=>{if(a.isReady){let e=a.buildTxn.addHarvester(d.samplePubAcc());if(o.value){let l=a.buildTxn.aggregateBonded([e.toAggregateV1(d.samplePubAcc())]);return d.amountFormatterSimple(l.maxFee.compact(),a.nativeToken.divisibility)}else return d.amountFormatterSimple(e.maxFee.compact(),a.nativeToken.divisibility)}else return"0"}),w=i(()=>d.convertNumberMinimumFormat(Number(J.value),a.nativeToken.divisibility)),D=i(()=>B.currentNetworkProfileConfig?d.convertToExact(B.currentNetworkProfileConfig.lockedFundsPerAggregate,a.nativeToken.divisibility):0),L=i(()=>B.currentNetworkProfile?d.convertToExact(ie.getLockFundFee(),a.nativeToken.divisibility):0),j=i(()=>D.value+L.value),X=i(()=>h.value==""||A.value||H.value||!_.value||!I.value||!y.value),o=r(null),g=r(null),_=r(null),x=r(0),S=r(0),C=async e=>{if(a.chainAPI&&e)try{const l=await a.chainAPI.accountAPI.getAccountInfo(O.Address.createFromRawAddress(e)),m=l.mosaics.findIndex(c=>c.id.toHex()==a.nativeToken.assetId);return m!=-1?l.mosaics[m].amount.compact()/Math.pow(10,a.nativeToken.divisibility):0}catch{return 0}},H=i(()=>{if(_.value)return o.value?x.value<w.value+j.value:x.value<w.value});W(_,async(e,l)=>{e==null?(x.value=0,g.value=null,o.value=null,k.value=null):e!=l&&(g.value=null,o.value=null,k.value=null,x.value=await C(e))}),W(o,async(e,l)=>{e==null?(S.value=0,g.value=null,o.value=null,k.value=null,x.value=await C(_.value)):e!=l&&(S.value=await C(e))});const Y=i(()=>o.value?j.value+w.value:w.value),Z=i(()=>d.amountFormatterSimple(Y.value,0)),ee=async()=>{let e,l;const m=y.value==="add";m?l=a.buildTxn.addHarvesterBuilder():l=a.buildTxn.removeHarvesterBuilder();try{const c=await a.chainAPI.harvesterAPI.getAccountHarvestingHarvesterInfo(d.createPublicAccount(h.value,a.networkType));if(m&&c.length){n.add({severity:"error",detail:"Harvester key found, it is already added",group:"br-custom",life:1e4});return}else if(!m&&c.length===0){n.add({severity:"error",detail:"Harvester key not found, does not need to be removed",group:"br-custom",life:1e4});return}}catch{return}o.value?e=[l.harvesterKey(F.value).build().toAggregateV1(k.value).serialize()]:e=l.harvesterKey(F.value).build().serialize(),K.unsignedTransactionPayload=e,K.selectedAddress=_.value,K.selectedMultisigAddress=o.value,s.push({name:"ViewConfirmTransaction"})},te=e=>{_.value=e},le=e=>{I.value=E.createPublicAccount(e,a.networkType)},ae=e=>{g.value=e.label,o.value=e.value,k.value=E.createPublicAccount(e.publicKey,a.networkType)},se=()=>{g.value=null,o.value=null};return(e,l)=>{const m=z("font-awesome-icon"),c=z("router-link"),R=ue("debounce");return v(),ce(ge,{class:"mt-8"},{white:M(()=>[l[2]||(l[2]=t("div",{class:"font-semibold mb-4"},"Harvester Transaction",-1)),H.value?(v(),b("div",je,[t("div",Re,[f(m,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),t("div",Ue,p(e.$t("general.insufficientBalance")),1)])):V("",!0),T.value!=""?(v(),b("div",We,p(T.value),1)):V("",!0),t("div",ze,[t("div",Oe,[f(pe,{type:"dynamic",label:"Add Harvester",onSelectAccount:te,onSelectAccountPublicKey:le}),f(_e,{"selected-address":_.value,onSelectMultisigAccount:ae},null,8,["selected-address"])]),o.value?(v(),b("div",Qe,[f(xe,{"select-default-address":o.value,"select-default-name":g.value,label:"Multisig account selected",type:"dynamic",onCloseMultisig:se},null,8,["select-default-address","select-default-name"])])):V("",!0)]),t("div",qe,[f(Le,{title:"Type",modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=P=>y.value=P),disabled:!1},null,8,["modelValue"])]),t("div",Ge,[de(f(Fe,{placeholder:"Harvester Key",modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=P=>h.value=P),showError:A.value},null,8,["modelValue","showError"]),[[R,G,"1000"]])])]),navy:M(()=>[f(ye,{"signer-native-token-balance":x.value,"native-token-balance":o.value?S.value:x.value,"lock-fund":D.value,"lock-fund-tx-fee":L.value,"selected-multisig-address":o.value,"txn-fee":w.value,"total-fee":Number(Z.value)},null,8,["signer-native-token-balance","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),t("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:X.value,onClick:ee}," Create harvester transaction ",8,Je),t("div",Xe,[f(c,{to:{name:"ViewServices"},class:"content-center text-xs text-white border-b-2 border-white"},{default:M(()=>[ve(p(e.$t("general.cancel")),1)]),_:1})])]),_:1})}}});const dt=q(Ye,[["__scopeId","data-v-4a3d3bc5"]]);export{dt as default};
