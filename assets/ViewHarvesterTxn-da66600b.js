import{d as J,o as f,b as _,e as t,t as p,_ as Q,f as C,A as ie,l as ce,r as o,u as ue,c,W as V,w as S,B as l,H as v,n as F,S as U,a as z,i as G,M as de,m,O as ve,v as me,x as fe,h as _e,z as R,I as pe,J as be}from"./index-101c1a50.js";import{_ as he}from"./icon-red-x-a5511f99.js";import{_ as xe}from"./icon-green-tick-1b766454.js";import{_ as ge,a as ye,b as we,c as ke}from"./TxnSummary.vue_vue_type_script_setup_true_lang-c0bc9a89.js";import{_ as Te}from"./PasswordInput.vue_vue_type_script_setup_true_lang-33ecb86a.js";import{T as j}from"./transactionState-730de40e.js";import"./jdenticon-module-0d5e08d8.js";import"./proximax-logo-ecfc3767.js";const Pe={class:"border border-gray-200 px-2 py-2 rounded-md w-full"},Ae={class:"flex gap-2"},Ie={class:"flex flex-col w-full"},$e={class:"uppercase text-gray-500 font-light text-xxs text-left"},Ve=["value"],Se={key:0,class:"flex flex-col ml-auto justify-center mt-1"},Fe=t("img",{src:he,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Ce={class:"text-xxs text-red-400 font-bold uppercase"},Ee={key:1,class:"flex flex-col ml-auto justify-center mt-1"},He=t("img",{src:xe,class:"h-5 w-5 mr-auto ml-auto"},null,-1),Be={class:"text-xxs text-green-400 font-bold uppercase"},Ne=J({__name:"PublicKeyInputClean",props:{placeholder:String,showError:Boolean,modelValue:String},emits:["update:modelValue"],setup(r){return(i,n)=>(f(),_("div",Pe,[t("div",Ae,[t("div",Ie,[t("div",$e,p(r.placeholder),1),t("input",{autocomplete:"off",type:"text",value:r.modelValue,onInput:n[0]||(n[0]=E=>i.$emit("update:modelValue",E.target.value)),class:"w-full font-semibold text-tsm outline-none mt-1"},null,40,Ve)]),r.showError?(f(),_("div",Se,[Fe,t("div",Ce,p(i.$t("general.invalid")),1)])):(f(),_("div",Ee,[He,t("div",Be,p(i.$t("general.valid")),1)]))])]))}});const Me={props:{placeholder:String,errorMessage:String,showError:Boolean,modelValue:String,title:String,disabled:Boolean},emits:["update:modelValue"],name:"SelectLinkType",data(){return{inputText:"",borderColor:"border border-gray-300",textErr:!1}},watch:{showError:function(r){r?(this.borderColor="border-2 border-red-primary",this.textErr=!0):(this.borderColor="border-2 border-gray-300",this.textErr=!1)}}},Ke={class:"border border-gray-200 px-2 py-1 h-14 rounded-md"},Le={class:"uppercase text-gray-500 text-txs text-left mb-2"},We={class:"flex items-center"},Ue=["value","disabled","checked"],Re=t("label",{for:"add",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Add",-1),je=["value","disabled","checked"],De=t("label",{for:"remove",class:"cursor-pointer font-bold ml-4 mr-5 text-tsm"},"Remove",-1),Oe={class:"h-3 mb-2"},qe={key:0,class:"error error-text text-left"};function ze(r,i,n,E,y,h){return f(),_("div",null,[t("div",Ke,[t("div",Le,p(n.title),1),t("div",We,[t("input",{id:"add",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[0]||(i[0]=H=>r.$emit("update:modelValue","add")),checked:n.modelValue=="link"},null,40,Ue),Re,t("input",{id:"remove",type:"radio",name:"linkType",value:n.modelValue,disabled:n.disabled,class:"h-5 w-5",onChange:i[1]||(i[1]=H=>r.$emit("update:modelValue","remove")),checked:n.modelValue=="unlink"},null,40,je),De])]),t("div",Oe,[y.textErr||n.showError?(f(),_("div",qe,p(n.errorMessage),1)):C("",!0)])])}const Ge=Q(Me,[["render",ze]]),Je=r=>(pe("data-v-7080d55e"),r=r(),be(),r),Qe={class:"w-10/12 ml-auto mr-auto"},Xe={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Ye={class:"xl:col-span-2 p-12"},Ze=Je(()=>t("div",{class:"font-semibold mb-4"},"Harvester Transaction",-1)),et={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},tt={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},at={class:"inline-block text-xs"},lt={key:1,class:"error error_box"},st={class:"mt-4"},ot={class:"flex gap-1 mt-3"},nt={key:0,class:"mt-3"},rt={class:"mt-3"},it={class:""},ct={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},ut={class:"text-xs text-white my-5"},dt=["disabled"],vt={class:"text-center"},mt="^[^ ]{8,}$",ft=J({__name:"ViewHarvesterTxn",setup(r){const i=ie(),n=ce(),y=_e().appContext.config.globalProperties.emitter,h=o(""),{t:H}=ue(),B=o(""),X=o(!1),Y=o(!1),I=o(""),T=o(""),$=o(!0),N=o(),P=o(),M=o(),Z=c(()=>W.value||Y.value),ee=()=>{try{M.value=R.PublicAccount.createFromPublicKey(T.value,l.networkType),$.value=!1}catch{$.value=!0}};try{N.value=V.createPublicAccount(S.currentLoggedInWallet?S.currentLoggedInWallet.selectDefaultAccount().publicKey:"",l.networkType)}catch(e){console.log(e)}const te=c(()=>{if(l.isReady){let e=l.buildTxn.addHarvester(v.samplePubAcc());if(s.value){let a=l.buildTxn.aggregateBonded([e.toAggregateV1(v.samplePubAcc())]);return v.amountFormatterSimple(a.maxFee.compact(),l.nativeToken.divisibility)}else return v.amountFormatterSimple(e.maxFee.compact(),l.nativeToken.divisibility)}else return"0"}),A=c(()=>v.convertNumberMinimumFormat(Number(te.value),l.nativeToken.divisibility)),D=c(()=>F.currentNetworkProfileConfig?v.convertToExact(F.currentNetworkProfileConfig.lockedFundsPerAggregate,l.nativeToken.divisibility):0),O=c(()=>F.currentNetworkProfile?v.convertToExact(U.getLockFundFee(),l.nativeToken.divisibility):0),q=c(()=>D.value+O.value),ae=c(()=>!h.value.match(mt)||T.value==""||$.value||W.value||!u.value||!N.value||!I.value),s=o(null),w=o(null),u=o(null),x=o(0),K=o(0),L=async e=>{if(l.chainAPI&&e)try{const a=await l.chainAPI.accountAPI.getAccountInfo(R.Address.createFromRawAddress(e)),d=a.mosaics.findIndex(g=>g.id.toHex()==l.nativeToken.assetId);return d!=-1?a.mosaics[d].amount.compact()/Math.pow(10,l.nativeToken.divisibility):0}catch{return 0}},W=c(()=>{if(u.value)return s.value?x.value<A.value+q.value:x.value<A.value});z(u,async(e,a)=>{e==null?(x.value=0,w.value=null,s.value=null,P.value=null):e!=a&&(w.value=null,s.value=null,P.value=null,x.value=await L(e))}),z(s,async(e,a)=>{e==null?(K.value=0,w.value=null,s.value=null,P.value=null,x.value=await L(u.value)):e!=a&&(K.value=await L(e))});const le=c(()=>s.value?q.value+A.value:A.value),se=c(()=>v.amountFormatterSimple(le.value,0)),oe=async()=>{if(!V.verifyWalletPassword(S.currentLoggedInWallet.name,F.chainNetworkName,h.value)){B.value=H("general.walletPasswordInvalid",{name:S.currentLoggedInWallet.name});return}let a,d;const g=I.value==="add";g?d=l.buildTxn.addHarvesterBuilder():d=l.buildTxn.removeHarvesterBuilder();try{const b=await l.chainAPI.harvesterAPI.getAccountHarvestingHarvesterInfo(v.createPublicAccount(T.value,l.networkType));if(g&&b.length){i.add({severity:"error",detail:"Harvester key found, it is already added",group:"br-custom",life:1e4});return}else if(!g&&b.length===0){i.add({severity:"error",detail:"Harvester key not found, does not need to be removed",group:"br-custom",life:1e4});return}}catch{return}if(s.value){const ne=[d.harvesterKey(M.value).build().toAggregateV1(P.value)],re=await l.chainAPI.nodeAPI.getNodeTime();a=U.signTxnWithPassword(u.value,s.value,h.value,null,ne,new R.UInt64(re.sendTimeStamp))}else{const b=d.harvesterKey(M.value).build();a=U.signTxnWithPassword(u.value,null,h.value,b)}j.lockHashPayload=a.hashLockTxnPayload,j.transactionPayload=a.txnPayload,j.selectedAddress=u.value,n.push({name:"ViewConfirmTransaction"})};return y.on("select-account",e=>{u.value=e}),y.on("select-account-public-key",e=>{N.value=V.createPublicAccount(e,l.networkType)}),y.on("select-multisig-account",e=>{w.value=e.label,s.value=e.value,P.value=V.createPublicAccount(e.publicKey,l.networkType)}),y.on("CLOSE_MULTISIG",()=>{w.value=null,s.value=null}),(e,a)=>{const d=G("font-awesome-icon"),g=G("router-link"),b=de("debounce");return f(),_("div",null,[t("div",Qe,[t("div",Xe,[t("div",Ye,[Ze,W.value?(f(),_("div",et,[t("div",tt,[m(d,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),t("div",at,p(e.$t("general.insufficientBalance")),1)])):C("",!0),B.value!=""?(f(),_("div",lt,p(B.value),1)):C("",!0),t("div",st,[t("div",ot,[m(ge,{type:"dynamic",label:"Add Harvester"}),m(ye,{"selected-address":u.value},null,8,["selected-address"])]),s.value?(f(),_("div",nt,[m(we,{"select-default-address":s.value,"select-default-name":w.value,label:"Multisig account selected",type:"dynamic"},null,8,["select-default-address","select-default-name"])])):C("",!0)]),t("div",rt,[m(Ge,{title:"Type",modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=k=>I.value=k),disabled:!1},null,8,["modelValue"])]),t("div",it,[ve(m(Ne,{placeholder:"Harvester Key",modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=k=>T.value=k),showError:$.value},null,8,["modelValue","showError"]),[[b,ee,"1000"]])])]),t("div",ct,[m(ke,{"signer-native-token-balance":x.value,"native-token-balance":s.value?K.value:x.value,"lock-fund":D.value,"lock-fund-tx-fee":O.value,"selected-multisig-address":s.value,"txn-fee":A.value,"total-fee":Number(se.value)},null,8,["signer-native-token-balance","native-token-balance","lock-fund","lock-fund-tx-fee","selected-multisig-address","txn-fee","total-fee"]),t("div",ut,p(e.$t("general.enterPasswordContinue")),1),m(Te,{placeholder:e.$t("general.password"),errorMessage:e.$t("general.passwordRequired"),showError:X.value,modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=k=>h.value=k),disabled:Z.value},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),t("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:ae.value,onClick:oe}," Create harvester transaction ",8,dt),t("div",vt,[m(g,{to:{name:"ViewServices"},class:"content-center text-xs text-white border-b-2 border-white"},{default:me(()=>[fe(p(e.$t("general.cancel")),1)]),_:1})])])])])])}}});const kt=Q(ft,[["__scopeId","data-v-7080d55e"]]);export{kt as default};
