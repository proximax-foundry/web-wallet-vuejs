import{_ as Pe,u as Fe,l as Ie,A as Se,r as s,c as l,n as i,b3 as Le,b4 as Ae,B as u,G as Me,aX as Be,H as c,S as X,ai as Y,w as C,D as Ee,a as I,am as W,b5 as ce,i as S,o as m,b as g,e as n,t as o,m as N,f as D,x as J,O as Ve,aa as We,F as Ue,g as He,v as Re,W as je,z as de}from"./index-6982070c.js";import{_ as Oe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-5b6252b9.js";import{D as qe}from"./DurationInputClean-7dacc290.js";import{_ as ze}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-e868ef53.js";import{N as L}from"./namespaceUtils-23b6a66d.js";import{t as Ge}from"./jdenticon-module-6c808149.js";import{M as Xe}from"./multisigUtils-db2c53f4.js";import{T as Q}from"./transactionState-577ae0ba.js";import{_ as Ye}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const Je={name:"ViewServicesNamespaceExtend",components:{PasswordInput:Oe,DurationInputClean:qe,TransactionFeeDisplay:ze},props:{namespaceId:String,address:String},setup(t){const{t:h}=Fe(),Z=Ie();Se();const e=s(null),U=s(!1),v=s("1"),w=s(""),A=s(""),p=s(!1),T=s(!1),H="^[^ ]{8,}$",d=s(!1),y=s(""),ue=s(!1),me=s(!1),_=s(""),M=s(0),R=s(0),B=s(0),j=s(!1),P=l(()=>i.currentNetworkProfileConfig?Math.floor(Le.configReturn(i.currentNetworkProfileConfig.maxNamespaceDuration,Ae.DAY)):0),ge=l(()=>u.readBlockHeight),ve=l(()=>u.nativeToken.label);(async()=>{const a=Me.buildAPIEndpoint(i.selectedAPIEndpoint,i.currentNetworkProfile?i.currentNetworkProfile.httpPort:3e3),r=new Be(a);M.value=await r.chainAPI.getBlockchainHeight()})();const fe=l(()=>{let a=[];const r=L.listRootNamespaces(x.value);return a.push.apply(a,r),a}),he=l(()=>u.nativeToken.label),E=l(()=>i.currentNetworkProfileConfig?v.value>0?c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*L.calculateDuration(v.value),u.nativeToken.divisibility):c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,u.nativeToken.divisibility):0),be=l(()=>c.toCurrencyFormat(E.value,6)),we=l(()=>i.currentNetworkProfileConfig?c.convertToExact(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),ye=l(()=>i.currentNetworkProfileConfig?c.amountFormatterSimple(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),O=l(()=>i.currentNetworkProfile?c.convertToExact(X.getLockFundFee(),u.nativeToken.divisibility):0),V=l(()=>(f.value?f.value.cosignerList.length:0)==0&&Y(x.value)),ke=s(O.value.toString()),q=l(()=>we.value+O.value),pe=l(()=>!(w.value.match(H)&&!U.value&&!le.value&&!V.value)),K=s(""),x=s(""),z=s(""),$=s(""),ee=l(()=>C.currentLoggedInWallet?C.currentLoggedInWallet.selectDefaultAccount():null),_e=s(ee.value?Y(ee.value.address):!1),ae=c.createAddress(t.address).plain();let b=l(()=>C.currentLoggedInWallet?C.currentLoggedInWallet.accounts.find(a=>a.address==ae)||C.currentLoggedInWallet.others.find(a=>a.address==ae):null);b.value&&(K.value=b.value.name,x.value=b.value.address,z.value=c.toCurrencyFormat(b.value.balance,u.nativeToken.divisibility),$.value=b.value.balance);let te=new Ee("ThemeStyleConfig");te.init();const xe=s(Ge(t.address,40,te.jdenticonConfig));if(b.value){let a=b.value.namespaces.find(r=>r.idHex===t.namespaceId);if(a!=null){R.value=a.endHeight;const r=a.name.split(".");r.length>1?y.value=r[0]:y.value=a.name}}const ne=s("0"),F=s(0);try{ne.value=c.convertToCurrency(L.getRootNamespaceTransactionFee(y.value,v.value),u.nativeToken.divisibility),F.value=c.convertToExact(L.getRootNamespaceTransactionFee(y.value,v.value),u.nativeToken.divisibility)}catch{}let G=!1;I(v,a=>{if(a>P.value)v.value=P.value;else{let r=R.value-M.value,k=0;B.value=Math.ceil(r/(24*60*4)),parseInt(a)+B.value>P.value?(k=P.value-B.value,v.value=k.toString(),j.value=!0,G=!0):(G||(j.value=!1),G=!1)}});const Ce=()=>{v.value="1"},se=l(()=>Y(c.createAddress(t.address).plain())?parseFloat(q.value)+E.value+F.value:E.value+F.value),Ne=l(()=>c.amountFormatterSimple(se.value,0));I(se,a=>{z.value<a&&!V.value?p.value=!0:p.value=!1}),I(ge,a=>{M.value=a});const De=async()=>{if(!je.verifyWalletPassword(C.currentLoggedInWallet.name,i.chainNetworkName,w.value)){A.value=h("general.walletPasswordInvalid",{name:C.currentLoggedInWallet.name});return}let r={};const ie=u.buildTxn.registerRootNamespace(y.value,de.UInt64.fromUint(L.calculateDuration(Number(v.value))));if(re.value){const Te=await u.chainAPI.nodeAPI.getNodeTime();r=X.signAbtWithTxnAndPassword(re.value,x.value,w.value,ie,new de.UInt64(Te.sendTimeStamp))}else r=X.signTxnWithPassword(x.value,null,w.value,ie);Q.lockHashPayload=r.hashLockTxnPayload,Q.transactionPayload=r.txnPayload,Q.selectedAddress=x.value,Z.push({name:"ViewConfirmTransaction"})},f=l(()=>{if(b.value)if(i.currentNetworkProfileConfig){let a=Xe.getCosignerInWallet(b.value?b.value.publicKey:""),r=[];return a.cosignerList.forEach(k=>{r.push({publicKey:k,name:W(k).name,balance:W(k).balance,address:W(k).address})}),a.cosignerList=r,{hasCosigner:a.hasCosigner,cosignerList:a.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});_.value=f.value&&f.value.cosignerList.length>0?f.value.cosignerList[0].address:"",I(f,a=>{a&&a.cosignerList.length>0&&(_.value=a.cosignerList.length>0?f.value.cosignerList[0].address:"")});const oe=l(()=>{let a=ce(_.value)?ce(_.value).balance:0;return c.toCurrencyFormat(a)}),le=l(()=>_.value.length<=0?$.value<F.value:Number(oe.value)<F.value+q.value);I(V,a=>{a?(p.value=!0,T.value=!0):(p.value=!1,T.value=!1)});const re=l(()=>f.value.cosignerList.length>0?f.value.cosignerList.length>1?_.value:W(f.value.cosignerList[0].publicKey).address:"");return{namespaceSelect:e,selectedAccName:K,selectedAccAdd:x,balance:z,showNoBalance:le,err:A,walletPassword:w,disableCreate:pe,showPasswdError:d,disabledPassword:p,showDuration:ue,disabledDuration:T,duration:v,showDurationErr:U,isMultiSigBool:_e,rentalFee:E,rentalFeeCurrency:be,lockFundTxFee:O,lockFundCurrency:ye,currencyName:he,lockFundTxFeeCurrency:ke,lockFundTotalFee:q,totalFeeFormatted:Ne,selectNamespace:y,namespaceOption:fe,extendNamespace:De,transactionFee:ne,getMultiSigCosigner:f,cosignerBalanceInsufficient:me,cosignerAddress:_,isNotCosigner:V,block:M,endBlock:R,numDaysleft:B,showMaxDaysLabel:j,svgString:xe,Helper:c,currentNativeTokenName:ve,maxDurationInDays:P,setDefaultDuration:Ce,checkCosignBalance:oe}}},Qe={class:"w-10/12 ml-auto mr-auto"},Ze={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Ke={class:"xl:col-span-2 p-6 lg:p-12"},$e={class:"lg:flex lg:justify-between lg:items-center"},ea={class:"font-semibold mb-4 inline-block mt-1"},aa={class:"flex items-center"},ta=["innerHTML"],na={class:"ml-2"},sa={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},oa={class:"font-bold text-black text-sm"},la={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},ra={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},ia={class:"inline-block text-xs"},ca={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},da={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},ua={class:"inline-block text-xs"},ma={key:2,class:"error error_box"},ga={class:"text-right w-full"},va={key:0,class:"inline-block"},fa={class:"text-tsm text-left mt-3"},ha={key:0,class:"font-bold"},ba={key:0,class:"error"},wa={key:1,class:"font-bold"},ya=["value"],ka={key:2,class:"error"},pa={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},_a=n("img",{src:Ye},null,-1),xa={class:"ml-1"},Ca={class:"uppercase text-blue-primary font-semibold text-xxs"},Na={class:"text-black text-sm font-bold"},Da={key:3,class:"text-xs inline-block text-gray-400"},Ta={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Pa={class:"text-xs text-white my-5"},Fa=["disabled"],Ia={class:"text-center"};function Sa(t,h,Z,e,U,v){const w=S("font-awesome-icon"),A=S("DurationInputClean"),p=S("TransactionFeeDisplay"),T=S("PasswordInput"),H=S("router-link");return m(),g("div",null,[n("div",Qe,[n("div",Ze,[n("div",Ke,[n("div",$e,[n("div",ea,o(t.$t("general.extendDuration")),1),n("div",aa,[n("div",{innerHTML:e.svgString,class:"inline-block"},null,8,ta),n("div",na,[n("div",sa,o(t.$t("namespace.namespaceCreatedBy")),1),n("div",oa,o(e.selectedAccName),1)])])]),e.showNoBalance?(m(),g("div",la,[n("div",ra,[N(w,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),n("div",ia,o(t.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(m(),g("div",ca,[n("div",da,[N(w,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),n("div",ua,o(t.$t("general.noCosigner")),1)])):D("",!0),e.err!=""?(m(),g("div",ma,o(e.err),1)):D("",!0),n("div",ga,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(m(),g("div",va,[n("div",fa,[J(o(t.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(m(),g("span",ha,[J(o(e.getMultiSigCosigner.cosignerList[0].name)+" ("+o(t.$t("general.balance"))+": "+o(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+o(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(m(),g("span",ba,"- "+o(t.$t("general.insufficientBalance")),1)):D("",!0)])):(m(),g("span",wa,[Ve(n("select",{"onUpdate:modelValue":h[0]||(h[0]=d=>e.cosignerAddress=d)},[(m(!0),g(Ue,null,He(e.getMultiSigCosigner.cosignerList,(d,y)=>(m(),g("option",{value:d.address,key:y},o(d.name)+" ("+o(t.$t("general.balance"))+": "+o(d.balance)+" "+o(e.currentNativeTokenName)+")",9,ya))),128))],512),[[We,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(m(),g("div",ka,"- "+o(t.$t("general.insufficientBalance")),1)):D("",!0)])])):D("",!0)]),n("div",pa,[_a,n("div",xa,[n("div",Ca,o(t.$t("general.namespace")),1),n("div",Na,o(e.selectNamespace),1)])]),N(A,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":h[1]||(h[1]=d=>e.duration=d),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:t.$t("namespace.duration"),showError:e.showDurationErr,toolTip:t.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+t.$t("general.year"):""} (${e.maxDurationInDays}`+t.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(m(),g("div",Da,o(t.$t("namespace.durationMsg2"))+" "+o(e.maxDurationInDays-e.numDaysleft)+" "+o(t.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):D("",!0)]),n("div",Ta,[N(p,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),n("div",Pa,o(t.$t("general.enterPasswordContinue")),1),N(T,{placeholder:t.$t("general.password"),errorMessage:t.$t("general.passwordRequired"),showError:e.showPasswdError,modelValue:e.walletPassword,"onUpdate:modelValue":h[2]||(h[2]=d=>e.walletPassword=d),disabled:e.disabledPassword},null,8,["placeholder","errorMessage","showError","modelValue","disabled"]),n("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:h[3]||(h[3]=(...d)=>e.extendNamespace&&e.extendNamespace(...d))},o(t.$t("general.extendDuration")),9,Fa),n("div",Ia,[N(H,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Re(()=>[J(o(t.$t("general.cancel")),1)]),_:1})])])])])])}const Oa=Pe(Je,[["render",Sa]]);export{Oa as default};
