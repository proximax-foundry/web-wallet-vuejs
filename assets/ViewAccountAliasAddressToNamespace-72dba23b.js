import{d as oe,u as de,r as m,c as l,w as r,n as $,H as _,B as f,S as ue,a as I,l as ce,z as g,i as M,o as z,b as O,m as c,v as Z,e as o,t as N,f as ve,j,x as me}from"./index-3c3de18f.js";import{a as x}from"./accountUtils-9660fce0.js";import{A as ge,_ as pe}from"./AccountTabs.vue_vue_type_script_setup_true_lang-36c517dd.js";import{M as H}from"./multisigUtils-9c947a89.js";import{_ as fe}from"./AddressInputClean.vue_vue_type_style_index_0_lang-b200f046.js";import{_ as be}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-6f8f36d5.js";import{_ as ke}from"./SelectAccountAndContact.vue_vue_type_style_index_0_lang-1073d805.js";import{T as W}from"./transactionState-dba65b25.js";import"./jdenticon-module-05002873.js";import"./functions-500208d9.js";import"./TextInput-a4175054.js";import"./TextInputClean-c9691dd5.js";import"./icon-key-5b3f7dda.js";import"./icon-red-x-a5511f99.js";import"./icon-green-tick-1b766454.js";import"./proximax-logo-ecfc3767.js";const ye={class:"w-10/12 mx-auto mt-5"},he={class:"border-2 border-t-0 filter shadow-lg xl:grid xl:grid-cols-3"},Ae={class:"lg:col-span-2 py-6 px-6"},Le={key:0,class:"text-tsm flex gap-2 items-center"},we={class:"font-semibold mt-3"},Te={class:"flex flex-col"},Ce={class:"flex mt-3 gap-1"},Ie={class:"bg-navy-primary p-6 lg:col-span-1"},Ne=o("div",{class:"mt-3"},null,-1),xe=["disabled"],Se={class:"text-center"},Fe="^[0-9A-Za-z]{40}$",$e="^[0-9A-Za-z-]{46}$",Ge=oe({__name:"ViewAccountAliasAddressToNamespace",props:{address:{}},setup(v){const{t:h}=de(),S=m({name:"",value:""}),G=[{value:"Link",label:h("general.link")},{value:"Unlink",label:h("general.unlink")}],n=m({value:"Link",label:h("general.link")}),d=m(null),A=e=>{let s=r.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length,multisigInfo:a.multisigInfo})),t=r.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0,multisigInfo:a.multisigInfo}));return s.concat(t).find(a=>a.publicKey==e)},L=l(()=>{var e;return((e=r.currentLoggedInWallet)==null?void 0:e.accounts.find(s=>s.address==v.address))||r.currentLoggedInWallet.others.find(s=>s.address==v.address)}),q=m(""),u=m(""),C=m(!0),U=m(""),V=l(()=>$.currentNetworkProfileConfig?_.convertToExact($.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),B=l(()=>$.currentNetworkProfile?_.convertToExact(ue.getLockFundFee(),f.nativeToken.divisibility):0);r.currentLoggedInWallet&&r.currentLoggedInWallet.name;const w=m(0),P=l(()=>{let e=f.nativeToken.divisibility;return p.value.hasCosigner?e==0?Math.trunc(w.value+V.value+B.value):Math.round((w.value+V.value+B.value)*Math.pow(10,f.nativeToken.divisibility))/Math.pow(10,f.nativeToken.divisibility):w.value}),D=l(()=>L.value?L.value.balance:0),J=l(()=>f.nativeToken.divisibility),Q=l(()=>r.currentLoggedInWallet?_.toCurrencyFormat(D.value,J.value):"0"),R=l(()=>{var e=!1;return p.value.hasCosigner?A(b.value)&&(A(b.value).balance<P.value?e=!0:e=!1):D.value<P.value&&(e=!0),e}),X=l(()=>!(R.value==!1&&u.value!=""&&d.value.value!=null&&C.value==!1)),Y=l(()=>x.namespaceOption(v.address,n.value.value)),ee=l(()=>{var s,t;return(((s=r.currentLoggedInWallet)==null?void 0:s.accounts.find(a=>a.address==v.address))||((t=r.currentLoggedInWallet)==null?void 0:t.others.find(a=>a.address==v.address))).namespaces.filter(a=>a.active==!0)}),p=l(()=>{if($.currentNetworkProfileConfig){const s=H.getCosignerInWallet(L.value.publicKey?L.value.publicKey:"").cosignerList.map(a=>({publicKey:a,name:A(a).name,balance:A(a).balance,address:A(a).address}));let t=!1;return s.length>0&&(t=!0),{hasCosigner:t,cosignerList:s}}else return{hasCosigner:!1,cosignerList:[]}}),ae=l(()=>p.value.cosignerList.map(e=>({name:e.name,value:e.publicKey}))),b=m("");I(S,e=>{e.value!=""?b.value=e.value:b.value=""},{deep:!0});const E=l(()=>L.value?H.getCosignerInWallet(L.value.publicKey).cosignerList.length>0:!1),K=l(()=>!!(!E.value&&p.value.hasCosigner||!ee.value.length));I(n,()=>{u.value="",d.value=null},{immediate:!0}),I(d,e=>{var a;const t=x.getNamespaceListByAddress(v.address).find(k=>{var T;return k.name===((T=d.value)==null?void 0:T.value)});if(n.value.value=="Unlink"&&e!=null)u.value=g.Address.createFromRawAddress(t.linkedId).pretty();else if(n.value.value=="Link"&&u.value!=""&&e.value!=null){let k=g.Address.createFromRawAddress(u.value).plain();w.value=x.getLinkNamespaceToAddressTransactionFee(p.value.hasCosigner,k,(a=d.value)==null?void 0:a.value,n.value.value)/Math.pow(10,f.nativeToken.divisibility)}}),I(u,e=>{var s;if(e.length==46&&e.match($e)||e.length==40&&e.match(Fe))if(x.verifyAddress(v.address,u.value).isPassed==!1)U.value="Invalid Address",C.value=!0;else{let a=g.Address.createFromRawAddress(e).plain();w.value=x.getLinkNamespaceToAddressTransactionFee(p.value.hasCosigner,a,(s=d.value)==null?void 0:s.value,n.value.value)/Math.pow(10,f.nativeToken.divisibility),U.value="",C.value=!1}else C.value=!0});const se=ce(),te=()=>{var i;let e=r.currentLoggedInWallet.accounts.find(y=>y.address==v.address)?r.currentLoggedInWallet.accounts.find(y=>y.address==v.address):r.currentLoggedInWallet.others.find(y=>y.address==v.address);q.value="";const s=f.buildTxn,t=n.value.value=="Link"?g.AliasActionType.Link:g.AliasActionType.Unlink,a=new g.NamespaceId((i=d.value)==null?void 0:i.value),k=g.Address.createFromRawAddress(u.value),T=s.addressAliasBuilder().actionType(t).namespaceId(a).address(k).build();if(b.value){let y=r.currentLoggedInWallet.accounts.find(ie=>ie.publicKey==b.value).address;W.selectedAddress=y,W.selectedMultisigAddress=e.address}else W.selectedAddress=e.address;W.unsignedTransactionPayload=T.serialize(),se.push({name:"ViewConfirmTransaction"})},le=l(()=>{let e=A(b.value);return e?e.balance:0});I(p,e=>{e.cosignerList.length&&(S.value={name:e.cosignerList[0].name,value:e.cosignerList[0].publicKey})},{immediate:!0});const F=m(!1),ne=e=>{F.value=!1,u.value=e.data},re=l(()=>{const e=r.currentLoggedInWallet;if(!e)return[];const s=[...e.accounts,...e.others];return e.contacts.length?[{key:"0",label:h("general.ownerAcc"),selectable:!1,children:s.map((t,a)=>({key:"0-"+a.toString(),label:t.name,data:g.Address.createFromRawAddress(t.address).pretty(),selectable:!0}))},{key:"1",label:h("general.contact"),selectable:!1,children:e.contacts.map((t,a)=>({key:"1-"+a.toString(),label:t.name,data:g.Address.createFromRawAddress(t.address).pretty(),selectable:!0}))}]:[{key:"0",label:h("general.ownerAcc"),selectable:!1,children:s.map((t,a)=>({key:"0-"+a.toString(),label:t.name,data:g.Address.createFromRawAddress(t.address).pretty(),selectable:!0}))}]});return(e,s)=>{const t=M("Sidebar"),a=M("Dropdown"),k=M("font-awesome-icon"),T=M("router-link");return z(),O("div",null,[c(t,{visible:F.value,"onUpdate:visible":s[0]||(s[0]=i=>F.value=i),baseZIndex:1e4,position:"full"},{default:Z(()=>[c(ke,{contacts:re.value,onNodeSelect:ne},null,8,["contacts"])]),_:1},8,["visible"]),o("div",ye,[c(ge,{address:e.address,class:"mb-6"},null,8,["address"]),c(pe,{address:e.address,selected:"details"},null,8,["address"]),o("div",he,[o("div",Ae,[p.value.cosignerList.length?(z(),O("div",Le,[o("div",null,N(e.$t("general.initiateBy"))+":",1),c(a,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=i=>S.value=i),options:ae.value,class:"text-tsm","option-label":"name"},null,8,["modelValue","options"])])):ve("",!0),o("div",we,N(n.value.value=="Link"?e.$t("general.linkToNamespace"):e.$t("namespace.manageNamespace")),1),o("div",Te,[c(a,{class:"my-3",placeholder:e.$t("namespace.selectAction"),modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=i=>n.value=i),options:G,"option-label":"label",disabled:K.value},null,8,["placeholder","modelValue","disabled"]),c(a,{placeholder:e.$t("namespace.selectNamespace"),modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=i=>d.value=i),"option-label":"label",options:Y.value,"option-disabled":"disabled",disabled:K.value},null,8,["placeholder","modelValue","options","disabled"])]),o("div",Ce,[c(fe,{placeholder:e.$t("general.addAccAddress"),modelValue:u.value,"onUpdate:modelValue":s[4]||(s[4]=i=>u.value=i),errorMessage:U.value,showError:C.value,disabled:K.value||n.value.value=="Unlink"||d.value==null},null,8,["placeholder","modelValue","errorMessage","showError","disabled"]),o("div",{class:"border rounded-md cursor-pointer flex flex-col justify-around p-2",onClick:s[5]||(s[5]=i=>F.value=!0)},[c(k,{icon:"id-card-alt",class:j([d.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","ml-auto mr-auto"])},null,8,["class"]),o("div",{class:j([d.value!=null&&n.value.value=="Link"?"text-blue-primary":"text-gray-400","text-xxs font-semibold uppercase"])},N(e.$t("general.select")),3)])])]),o("div",Ie,[c(be,{"transaction-fee":String(w.value),"total-fee-formatted":String(P.value),"get-multi-sig-cosigner":p.value,"check-cosign-balance":String(le.value),"lock-fund-currency":String(V.value),"lock-fund-tx-fee":String(B.value),balance:Q.value,"selected-acc-add":e.address,"is-cosigner":E.value,"fund-status":R.value},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add","is-cosigner","fund-status"]),Ne,o("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:te,disabled:X.value},N(n.value.value=="Unlink"?e.$t("namespace.unlinkNamespace"):e.$t("general.linkToNamespace")),9,xe),o("div",Se,[c(T,{to:{name:"ViewAccountDetails",params:{address:e.address}},class:"content-center text-xs text-white underline"},{default:Z(()=>[me(N(e.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}}});export{Ge as default};
