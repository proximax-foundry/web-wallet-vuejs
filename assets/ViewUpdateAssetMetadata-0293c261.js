import{l as Le,r as y,D as Ue,c as v,w as d,H as P,B as f,a as w,u as Be,n as F,S as We,z as o,am as A,_ as De,i as N,M as Ee,b as r,e as l,m as H,t as m,f as h,x as ie,O as R,aa as Ne,F as de,g as ce,V as ue,v as Re,o as i}from"./index-c4169c47.js";import{_ as Oe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-922aeae2.js";import{M as ee}from"./multisigUtils-384f1125.js";import{M as Qe}from"./MetadataInput-f477ad7c.js";import{_ as je}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-a8d3d89b.js";import{t as ze}from"./jdenticon-module-92eb974d.js";import{U as Ze}from"./UTF8-f52ef166.js";import{T as O}from"./transactionState-deb70f9f.js";import{_ as Xe}from"./icon-asset-2a9ae6ea.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const Ge={name:"ViewUpdateAssetMetadata",props:{targetId:String,scopedMetadataKey:String,address:String},components:{MetadataInput:Qe,PasswordInput:Oe,TransactionFeeDisplay:je},setup(u){const g=Le();let L=y(!1),t=y(!0),I=y(1),p=y(null),M=null,x=y(!1),T=y(""),c=y(""),b=y(null),n,_,W,Q;const K=y(""),C=y(""),te=new Ue("ThemeStyleConfig");te.init();const ge=v(()=>ze(b.value?b.value.address:"",40,te.jdenticonConfig)),ve=v(()=>b.value?d.currentLoggedInWallet.convertAddressToName(b.value.address,!0):""),ae=y([]),D=d.currentLoggedInWallet?d.currentLoggedInWallet.selectDefaultAccount():null,j=y(D?D.address:""),me=y(P.toCurrencyFormat(D?D.balance:0,f.nativeToken.divisibility)),le=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=le(e)),e),z=e=>{e=le(e);let s=o.Convert.hexToUint8(e);return Ze.isNotUTF8(s)||(e=o.Convert.decodeHexToUtf8(e)),e},ye=()=>{let e=new o.MetadataQueryParams;e.metadataType=o.MetadataType.MOSAIC,e.targetId=M,f.chainAPI.metadataAPI.searchMetadatas(e).then(s=>{s.metadataEntries.forEach(a=>{ae.value.push({value:a.scopedMetadataKey.toHex()==z(a.scopedMetadataKey.toHex())?a.scopedMetadataKey.toHex():z(a.scopedMetadataKey.toHex()),type:a.scopedMetadataKey.toHex()==z(a.scopedMetadataKey.toHex())?2:1})})})},fe=async()=>{if(u.targetId&&u.targetId.length===16&&o.Convert.isHexString(u.targetId)){let e=new o.MosaicId(u.targetId);M=e,n.targetMosaicId(M);let s=await f.chainAPI.assetAPI.getMosaic(e);if(p.value=s.owner,n.targetPublicKey(p.value),!d.currentLoggedInWallet)return;b.value=d.currentLoggedInWallet.accounts.find(a=>a.publicKey===s.owner.publicKey)||d.currentLoggedInWallet.others.find(a=>a.publicKey===s.owner.publicKey),b.value&&(x.value=!!b.value.getDirectParentMultisig().length)}},pe=v(()=>d.currentLoggedInWallet&&p.value?d.currentLoggedInWallet.others.find(e=>e.publicKey===p.value.publicKey):null);w(pe,async e=>{e&&(b.value=d.currentLoggedInWallet.accounts.find(s=>s.publicKey===p.value.publicKey)||d.currentLoggedInWallet.others.find(s=>s.publicKey===p.value.publicKey),b.value&&(x.value=!!b.value.getDirectParentMultisig().length))},{deep:!0});const be=()=>{if(u.scopedMetadataKey)if(t.value=!1,c.value=u.scopedMetadataKey,u.scopedMetadataKey.length===16&&o.Convert.isHexString(u.scopedMetadataKey))I.value=2,T.value=u.scopedMetadataKey,n.scopedMetadataKey(o.UInt64.fromHex(T.value));else{I.value=1;let e=o.Convert.utf8ToHex(u.scopedMetadataKey);const s=e.length/2;e.length&&s<=8&&(e.length/2<8&&(e=e+"00".repeat(8-s)),T.value=e,n.scopedMetadataKey(o.UInt64.fromHex(T.value)))}},he=async()=>{n=f.buildTxn.assetMetadataBuilder();const e=await f.chainAPI.nodeAPI.getNodeTime();_=f.buildTxn.aggregateBondedBuilder(new o.UInt64(e.sendTimeStamp))},xe=async()=>{if(M&&T.value){let e=new o.MetadataQueryParams;e.targetId=M,e.metadataType=o.MetadataType.MOSAIC,e.scopedMetadataKey=o.UInt64.fromHex(T.value);let s=await f.chainAPI.metadataAPI.searchMetadatas(e);s.metadataEntries.length&&(K.value=s.metadataEntries[0].value)}n.oldValue(K.value)},_e=()=>{n.value(C.value)},Z=()=>{W=n.calculateDifferences().build()},X=()=>{W&&(Q=_.innerTransactions([W.toAggregateV1(p.value)]).build())},G=()=>{Q&&(S.value=Q.maxFee.compact()/Math.pow(10,f.nativeToken.divisibility))},se=async()=>{await he(),await fe(),be(),await xe(),_e(),Z(),X(),G(),ye()};if(f.isReady)se();else{let e=w(f,s=>{s.isReady&&(se(),e())})}const Me=v(()=>f.nativeToken.label);Be();const Te=y(""),Ke=d.currentLoggedInWallet?d.currentLoggedInWallet.name:"",q=v(()=>F.currentNetworkProfileConfig?P.convertToExact(F.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),Ie=v(()=>F.currentNetworkProfileConfig?P.convertToCurrency(F.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),J=v(()=>F.currentNetworkProfile?P.convertToExact(We.getLockFundFee(),f.nativeToken.divisibility):0),ke=y(!1),Y=v(()=>I.value==1?o.Convert.utf8ToHex(c.value).length/2>8:c.value.length>16?!0:c.value.length%2===1),ne=v(()=>Ce.value<$.value),we=v(()=>Y.value==!0||c.value==""||C.value==""||ne.value==!0),U=v(()=>{if(!d.currentLoggedInWallet)return[];let e=d.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),s=d.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return e.concat(s)}),S=y(0);w(I,e=>{oe(),e==2&&(o.Convert.isHexString(c.value)||(c.value=""))});const oe=async()=>{if(Y.value||c.value.length==0)return;let e="";if(I.value==1){let E=o.Convert.utf8ToHex(c.value);e=E+"00".repeat((16-E.length)/2)}else e="00".repeat((16-c.value.length)/2)+c.value;let s=new o.MetadataQueryParams;s.targetId=M,s.metadataType=o.MetadataType.MOSAIC,s.scopedMetadataKey=o.UInt64.fromHex(e);let a=await f.chainAPI.metadataAPI.searchMetadatas(s);a.metadataEntries.length?K.value=a.metadataEntries[0].value:K.value=""},Ae=async()=>{if(!d.currentLoggedInWallet)return;let e="",s;if(I.value==1){let V=o.Convert.utf8ToHex(c.value);e=V+"00".repeat((16-V.length)/2)}else e="00".repeat((16-c.value.length)/2)+c.value;let a=n.targetPublicKey(p.value).targetMosaicId(M).scopedMetadataKey(o.UInt64.fromHex(e)).value(C.value).oldValue(K.value).calculateDifferences().build(),E=f.buildTxn.aggregateCompleteBuilder().innerTransactions([a.toAggregateV1(p.value)]).build().serialize(),re=d.currentLoggedInWallet.accounts.find(V=>V.publicKey==p.value.publicKey).address;if(x.value){let V=d.currentLoggedInWallet.accounts.find(He=>He.publicKey==k.value).address;s=a.toAggregateV1(p.value).serialize(),O.selectedAddress=V,O.selectedMultisigAddress=re}else s=E,O.selectedAddress=re;c.value="",K.value="",C.value="",O.unsignedTransactionPayload=s,g.push({name:"ViewConfirmTransaction"})},$=v(()=>{let e=f.nativeToken.divisibility;return x.value?e==0?Math.trunc(q.value+J.value+S.value):Math.round((q.value+J.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),B=v(()=>!d.currentLoggedInWallet||!p.value?[]:ee.getCosignerInWallet(p.value.publicKey).cosignerList.length?U.value?ee.getCosignerInWallet(p.value.publicKey).cosignerList.map(e=>{let s=U.value.find(a=>a.publicKey==e);return{name:s.name,publicKey:e,balance:s.balance}}):[]:[]),k=y("");B.value.length>0&&(k.value=B.value[0].publicKey),w(()=>B,e=>{e.value.length&&(k.value=B.value[0].publicKey)},{deep:!0});const Ce=v(()=>d.currentLoggedInWallet?x.value?k.value?A(k.value).balance:0:b.value?b.value.balance:0:0),Se=v(()=>S.value.toString()),Ve=v(()=>P.amountFormatterSimple($.value,0)),Pe=v(()=>{if(F.currentNetworkProfileConfig){let e=ee.getCosignerInWallet(U.value.find(a=>a.address==j.value)?U.value.find(a=>a.address==j.value).publicKey:""),s=[];return e.cosignerList.forEach(a=>{s.push({publicKey:a,name:A(a).name,balance:A(a).balance,address:A(a).address})}),e.cosignerList=s,e}else return{hasCosigner:!1,cosignerList:[]}}),Fe=v(()=>{let e=A(k.value)?A(k.value).balance:0;return P.toCurrencyFormat(e,3)});return w(K,e=>{n.oldValue(e),Z(),X(),G()}),w(C,e=>{n.value(e),Z(),X(),G()}),w(c,e=>{e==""&&(K.value="")}),{findAcc:A,totalFee:$,err:Te,showPasswdError:ke,accounts:U,updateMetadata:Ae,targetAccIsMultisig:x,lockFundCurrency:Ie,lockFund:q,aggregateFee:S,lockFundTxFee:J,walletName:Ke,currentNativeTokenName:Me,oldValue:K,newValue:C,cosigners:B,scopedMetadataKeyType:I,svgString:ge,accountName:ve,disableAddBtn:we,showBalanceErr:ne,showScopedKeyErr:Y,inputScopedMetadataKey:c,checkOldValue:oe,selectedCosigner:k,existingScopedMetadataKeys:ae,showKeys:L,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:Se,totalFeeFormatted:Ve,selectedAccAdd:j,accBalance:me,getMultiSigCosigner:Pe,checkCosignBalance:Fe}}},qe={class:"w-10/12 ml-auto mr-auto"},Je={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Ye={class:"xl:col-span-2 p-12"},$e=l("div",{class:"font-semibold mb-4"},"Update Asset Metadata",-1),et={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},tt={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},at={class:"inline-block text-xs"},lt={key:1,class:"error error_box mb-5"},st={class:"flex items-center"},nt=["innerHTML"],ot={class:"ml-2"},rt={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},it={class:"font-bold text-black text-sm"},dt={key:2,class:"text-left mt-2 mb-5 ml-4"},ct={key:0},ut={class:"text-tsm"},gt={key:0,class:"font-bold"},vt={key:1,class:"font-bold"},mt=["value"],yt={key:1,class:"error"},ft={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},pt=l("img",{src:Xe},null,-1),bt={class:"ml-1"},ht=l("div",{class:"uppercase text-blue-primary font-semibold text-xxs"},"ASSET ID",-1),xt={class:"text-black text-sm font-bold"},_t={key:3,class:"mt-2"},Mt=["onClick"],Tt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},Kt={key:1,class:"text-xs py-2 pl-2 w-full"},It={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},kt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},wt={key:4},At={class:"flex gap-3"},Ct={class:"flex gap-2"},St=l("label",{for:"regular"},"UTF-8",-1),Vt={class:"flex gap-2"},Pt=l("label",{for:"hexa"},"Hexadecimal",-1),Ft={key:5,class:"my-3"},Ht={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Lt={class:"flex flex-col gap-0.5"},Ut=l("div",{class:"uppercase text-xxs font-semibold text-blue-primary"},"Selected Scoped Metadata Key",-1),Bt={class:"flex"},Wt={class:"font-semibold"},Dt={class:"ml-3 text-gray-400 font-semibold"},Et={class:"flex"},Nt={key:0,class:"font-semibold"},Rt={key:1,class:"ml-3 text-gray-400 font-semibold"},Ot={class:"border border-blue-primary p-4 bg-blue-100 rounded mt-5"},Qt=l("div",{class:"uppercase text-xxs text-blue-primary font-semibold"},"CURRENT VALUE",-1),jt={class:"font-semibold"},zt={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},Zt=["disabled"],Xt={class:"text-center"};function Gt(u,g,L,t,I,p){const M=N("font-awesome-icon"),x=N("MetadataInput"),T=N("TransactionFeeDisplay"),c=N("router-link"),b=Ee("debounce");return i(),r("div",null,[l("div",qe,[l("div",Je,[l("div",Ye,[$e,t.showBalanceErr?(i(),r("div",et,[l("div",tt,[H(M,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),l("div",at,m(u.$t("general.insufficientBalance")),1)])):h("",!0),t.err!=""?(i(),r("div",lt,m(t.err),1)):h("",!0),l("div",st,[l("div",{innerHTML:t.svgString,class:"inline-block"},null,8,nt),l("div",ot,[l("div",rt,m(u.$t("asset.assetCreatedBy")),1),l("div",it,m(t.accountName),1)])]),t.targetAccIsMultisig?(i(),r("div",dt,[t.cosigners.length>0?(i(),r("div",ct,[l("div",ut,[ie(m(u.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(i(),r("span",gt,m(t.cosigners[0].name),1)):(i(),r("span",vt,[R(l("select",{class:"","onUpdate:modelValue":g[0]||(g[0]=n=>t.selectedCosigner=n)},[(i(!0),r(de,null,ce(t.cosigners,(n,_)=>(i(),r("option",{value:t.findAcc(n.publicKey).publicKey,key:_},m(n.name),9,mt))),128))],512),[[Ne,t.selectedCosigner]])]))])])):(i(),r("div",yt,m(u.$t("general.noCosigner")),1))])):h("",!0),l("div",ft,[pt,l("div",bt,[ht,l("div",xt,m(L.targetId),1)])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(i(),r("div",_t,[l("div",{onClick:g[1]||(g[1]=n=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(i(!0),r(de,null,ce(t.existingScopedMetadataKeys,(n,_)=>(i(),r("div",{key:_},[t.showKeys?(i(),r("div",{key:0,class:"flex justify-center cursor-pointer",onClick:W=>(t.scopedMetadataKeyType=n.type,t.inputScopedMetadataKey=n.value,t.checkOldValue(),t.showKeys=!1)},[_%2==0?(i(),r("div",Tt,m(n.value),1)):h("",!0),_%2==1?(i(),r("div",Kt,m(n.value),1)):h("",!0),_%2==0?(i(),r("div",It,m(u.$t("general.select")),1)):h("",!0),_%2==1?(i(),r("div",kt,m(u.$t("general.select")),1)):h("",!0)],8,Mt)):h("",!0)]))),128))])):h("",!0),t.scopedMetadataKeySelectable?(i(),r("div",wt,[R(H(x,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":g[2]||(g[2]=n=>t.inputScopedMetadataKey=n),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[b,t.checkOldValue,"1000"]]),l("div",At,[l("div",Ct,[R(l("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":g[3]||(g[3]=n=>t.scopedMetadataKeyType=n)},null,512),[[ue,t.scopedMetadataKeyType]]),St]),l("div",Vt,[R(l("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":g[4]||(g[4]=n=>t.scopedMetadataKeyType=n)},null,512),[[ue,t.scopedMetadataKeyType]]),Pt])]),H(x,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":g[5]||(g[5]=n=>t.oldValue=n),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(i(),r("div",Ft,[l("div",Ht,[l("div",Lt,[Ut,l("div",Bt,[l("div",Wt,m(L.scopedMetadataKey),1),l("div",Dt,m(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),l("div",Et,[t.scopedMetadataKeyType==1?(i(),r("div",Nt,m(t.scopedMetadataKeyHex),1)):h("",!0),t.scopedMetadataKeyType==1?(i(),r("div",Rt,"HEX")):h("",!0)])])]),l("div",Ot,[Qt,l("div",jt,m(t.oldValue),1)])])),H(x,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":g[6]||(g[6]=n=>t.newValue=n),placeholder:"New Value"},null,8,["modelValue"])]),l("div",zt,[H(T,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 mt-3 disabled:opacity-50 disabled:cursor-auto",onClick:g[7]||(g[7]=n=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Asset Metadata ",8,Zt),l("div",Xt,[H(c,{to:{name:"ViewAccountAssets",params:{address:L.address}},class:"content-center text-xs text-white border-b-2 border-white"},{default:Re(()=>[ie(m(u.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const ra=De(Ge,[["render",Gt]]);export{ra as default};
