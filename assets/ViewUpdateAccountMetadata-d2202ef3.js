import{q as Ee,r as y,I as Re,c as v,w as r,H as F,E as b,a as A,u as Qe,n as C,V as $,A as c,aH as I,W as Oe,_ as Ze,k as L,P as je,b as d,e as a,s as T,z as ge,t as p,f as _,B as ee,Q as R,ag as qe,F as ve,h as me,Y as ye,o as i}from"./index-d7b5897b.js";import{_ as Xe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-b4f305c2.js";import{M as te}from"./multisigUtils-e77b922e.js";import{A as ze,_ as Ge}from"./AccountTabs.vue_vue_type_script_setup_true_lang-f3606106.js";import{M as Ye}from"./MetadataInput-e4fe5b8c.js";import{_ as Je}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-36b5756b.js";import{t as $e}from"./jdenticon-module-3cec977b.js";import{U as et}from"./UTF8-64b56bf3.js";import{T as ae}from"./transactionState-85bdb7df.js";import{_ as tt}from"./chevron_left-0423cb29.js";import"./functions-4b6ff0f7.js";import"./TextInput-5fbb30ca.js";import"./TextInputClean-2f2407e2.js";import"./icon-key-5b3f7dda.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const at={name:"ViewUpdateAccountMetadata",props:{targetPublicKey:String,scopedMetadataKey:String},components:{AccountComponent:ze,MetadataInput:Ye,PasswordInput:Xe,AccountTabs:Ge,TransactionFeeDisplay:Je},setup(o){const u=Ee();let Q=y(!1),t=y(!0),w=y(1),h=y(null),M=y(!1),K=y(""),g=y(""),m=y(null),x,B,U,s;const f=y(""),P=y(""),le=new Re("ThemeStyleConfig");le.init();const fe=v(()=>$e(m.value?m.value.address:"",40,le.jdenticonConfig)),pe=v(()=>m.value?r.currentLoggedInWallet.convertAddressToName(m.value.address,!0):""),ne=y([]),D=r.currentLoggedInWallet?r.currentLoggedInWallet.selectDefaultAccount():null,O=y(D?D.address:""),be=y(F.toCurrencyFormat(D?D.balance:0,b.nativeToken.divisibility)),se=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=se(e)),e),Z=e=>{e=se(e);let n=c.Convert.hexToUint8(e);return et.isNotUTF8(n)||(e=c.Convert.decodeHexToUtf8(e)),e},he=()=>{let e=new c.MetadataQueryParams;e.metadataType=c.MetadataType.ACCOUNT,e.targetKey=h.value,b.chainAPI.metadataAPI.searchMetadatas(e).then(n=>{n.metadataEntries.forEach(l=>{ne.value.push({value:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?l.scopedMetadataKey.toHex():Z(l.scopedMetadataKey.toHex()),type:l.scopedMetadataKey.toHex()==Z(l.scopedMetadataKey.toHex())?2:1})})})},xe=v(()=>m.value?m.value.address:"0".repeat(40)),_e=()=>{o.targetPublicKey.length===64&&c.Convert.isHexString(o.targetPublicKey)&&(h.value=c.PublicAccount.createFromPublicKey(o.targetPublicKey,b.networkType),x.targetPublicKey(h.value)),r.currentLoggedInWallet&&(m.value=r.currentLoggedInWallet.accounts.find(e=>e.publicKey===o.targetPublicKey)||r.currentLoggedInWallet.others.find(e=>e.publicKey===o.targetPublicKey),m.value&&(M.value=!!m.value.getDirectParentMultisig().length))},Me=v(()=>r.currentLoggedInWallet&&h.value?r.currentLoggedInWallet.others.find(e=>e.publicKey===o.targetPublicKey):null);A(Me,async e=>{if(e){if(!r.currentLoggedInWallet)return;m.value=r.currentLoggedInWallet.accounts.find(n=>n.publicKey===o.targetPublicKey)||r.currentLoggedInWallet.others.find(n=>n.publicKey===o.targetPublicKey),m.value&&(M.value=!!m.value.getDirectParentMultisig().length)}},{deep:!0});const Ke=()=>{if(o.scopedMetadataKey)if(t.value=!1,g.value=o.scopedMetadataKey,o.scopedMetadataKey.length===16&&c.Convert.isHexString(o.scopedMetadataKey))w.value=2,K.value=o.scopedMetadataKey,x.scopedMetadataKey(c.UInt64.fromHex(K.value));else{let e=c.Convert.utf8ToHex(o.scopedMetadataKey);const n=e.length/2;e.length&&n<=8&&(w.value=1,e.length/2<8&&(e=e+"00".repeat(8-n)),K.value=e,x.scopedMetadataKey(c.UInt64.fromHex(K.value)))}},Te=()=>{x=b.buildTxn.accountMetadataBuilder(),B=b.buildTxn.aggregateBondedBuilder()},we=async()=>{if(h.value&&K.value){let e=new c.MetadataQueryParams;e.metadataType=c.MetadataType.ACCOUNT,e.targetKey=h.value,e.scopedMetadataKey=c.UInt64.fromHex(K.value);let n=await b.chainAPI.metadataAPI.searchMetadatas(e);n.metadataEntries.length&&(f.value=n.metadataEntries[0].value)}x.oldValue(f.value)},ke=()=>{x.value(P.value)},j=()=>{U=x.calculateDifferences().build()},q=()=>{U&&(s=B.innerTransactions([U.toAggregateV1(h)]).build())},X=()=>{s&&(S.value=s.maxFee.compact()/Math.pow(10,b.nativeToken.divisibility))},Pe=v(()=>b.nativeToken.label),{t:Ae}=Qe(),V=y(""),oe=y(""),re=r.currentLoggedInWallet?r.currentLoggedInWallet.name:"",z=v(()=>C.currentNetworkProfileConfig?F.convertToExact(C.currentNetworkProfileConfig.lockedFundsPerAggregate,b.nativeToken.divisibility):0),Ce=v(()=>C.currentNetworkProfileConfig?F.convertToCurrency(C.currentNetworkProfileConfig.lockedFundsPerAggregate,b.nativeToken.divisibility):0),G=v(()=>C.currentNetworkProfile?F.convertToExact($.getLockFundFee(),b.nativeToken.divisibility):0),Ie="^[^ ]{8,}$",Ve=y(!1),Y=v(()=>w.value==1?c.Convert.utf8ToHex(g.value).length/2>8:g.value.length>16?!0:g.value.length%2===1),ce=v(()=>Fe.value<J.value),Se=v(()=>Y.value==!0||g.value==""||P.value==""||!V.value.match(Ie)||ce.value==!0),W=v(()=>{if(!r.currentLoggedInWallet)return[];let e=r.currentLoggedInWallet.accounts.map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!!l.getDirectParentMultisig().length})),n=r.currentLoggedInWallet.others.filter(l=>l.type==="MULTISIG").map(l=>({name:l.name,balance:l.balance,address:l.address,publicKey:l.publicKey,isMultisig:!0}));return e.concat(n)});A(w,e=>{de(),e==2&&(c.Convert.isHexString(g.value)||(g.value=""))});const de=async()=>{if(Y.value||g.value.length==0)return;let e="";if(w.value==1){let E=c.Convert.utf8ToHex(g.value);e=E+"00".repeat((16-E.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let n=new c.MetadataQueryParams;n.targetKey=h.value,n.metadataType=c.MetadataType.ACCOUNT,n.scopedMetadataKey=c.UInt64.fromHex(e);let l=await b.chainAPI.metadataAPI.searchMetadatas(n);l.metadataEntries.length?f.value=l.metadataEntries[0].value:f.value=""},He=async()=>{if(!r.currentLoggedInWallet)return;if(!Oe.verifyWalletPassword(r.currentLoggedInWallet.name,C.chainNetworkName,V.value)){oe.value=Ae("general.walletPasswordInvalid",{name:re});return}let e="",n;if(w.value==1){let H=c.Convert.utf8ToHex(g.value);e=H+"00".repeat((16-H.length)/2)}else e="00".repeat((16-g.value.length)/2)+g.value;let l=x.targetPublicKey(h.value).scopedMetadataKey(c.UInt64.fromHex(e)).value(P.value).oldValue(f.value).calculateDifferences().build(),E=b.buildTxn.aggregateCompleteBuilder().innerTransactions([l.toAggregateV1(h.value)]).build(),ue=r.currentLoggedInWallet.accounts.find(H=>H.publicKey==h.value.publicKey).address;if(M.value){let H=r.currentLoggedInWallet.accounts.find(De=>De.publicKey==k.value).address,Be=[l.toAggregateV1(h.value)];n=$.signTxnWithPassword(H,ue,V.value,null,Be)}else n=$.signTxnWithPassword(ue,null,V.value,E);g.value="",f.value="",P.value="",V.value="",ae.lockHashPayload=n.hashLockTxnPayload,ae.transactionPayload=n.txnPayload,ae.selectedAddress=h.value.address.plain(),u.push({name:"ViewConfirmTransaction"})},S=y(0),J=v(()=>{let e=b.nativeToken.divisibility;return M.value?e==0?Math.trunc(z.value+G.value+S.value):Math.round((z.value+G.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),N=v(()=>!r.currentLoggedInWallet||!h.value?[]:te.getCosignerInWallet(o.targetPublicKey).cosignerList.length?W.value?te.getCosignerInWallet(o.targetPublicKey).cosignerList.map(e=>{let n=W.value.find(l=>l.publicKey==e);return{name:n.name,publicKey:e,balance:n.balance}}):[]:[]),k=y("");N.value.length>0&&(k.value=N.value[0].publicKey),A(()=>N,e=>{e.value.length&&(k.value=N.value[0].publicKey)},{deep:!0});const Fe=v(()=>r.currentLoggedInWallet?M.value?k.value?I(k.value).balance:0:m.value?m.value.balance:0:0),Le=v(()=>S.value.toString()),Ue=v(()=>F.amountFormatterSimple(J.value,0)),We=v(()=>{if(C.currentNetworkProfileConfig){let e=te.getCosignerInWallet(W.value.find(l=>l.address==O.value)?W.value.find(l=>l.address==O.value).publicKey:""),n=[];return e.cosignerList.forEach(l=>{n.push({publicKey:l,name:I(l).name,balance:I(l).balance,address:I(l).address})}),e.cosignerList=n,e}else return{hasCosigner:!1,cosignerList:[]}}),Ne=v(()=>{let e=I(k.value)?I(k.value).balance:0;return F.toCurrencyFormat(e,3)});A(f,e=>{x.oldValue(e),j(),q(),X()}),A(P,e=>{x.value(e),j(),q(),X()}),A(g,e=>{e==""&&(f.value="")});const ie=async()=>{Te(),_e(),await Ke(),await we(),await ke(),j(),q(),X(),he()};if(b.isReady)ie();else{let e=A(b,n=>{n.isReady&&(ie(),e())})}return{findAcc:I,totalFee:J,err:oe,walletPassword:V,showPasswdError:Ve,accounts:W,updateMetadata:He,targetAccIsMultisig:M,lockFundCurrency:Ce,lockFund:z,aggregateFee:S,lockFundTxFee:G,walletName:re,currentNativeTokenName:Pe,oldValue:f,newValue:P,cosigners:N,scopedMetadataKeyType:w,svgString:fe,accountName:pe,accountAddress:xe,disableAddBtn:Se,showBalanceErr:ce,showScopedKeyErr:Y,inputScopedMetadataKey:g,checkOldValue:de,selectedCosigner:k,showKeys:Q,existingScopedMetadataKeys:ne,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:K,transactionFee:Le,totalFeeFormatted:Ue,selectedAccAdd:O,accBalance:be,getMultiSigCosigner:We,checkCosignBalance:Ne}}},lt={class:"flex cursor-pointer"},nt=a("img",{src:tt},null,-1),st={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},ot={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-5"},rt={class:"lg:col-span-3 py-6 px-6"},ct={class:"pl-6"},dt={key:0,class:"error error_box mb-5"},it={key:0,class:"text-left mt-2 mb-5"},ut={key:0},gt={class:"text-tsm"},vt={key:0,class:"font-bold"},mt={key:1,class:"font-bold"},yt=["value"],ft={key:1,class:"error"},pt=a("div",{class:"font-semibold mb-4"},"Update Account Metadata",-1),bt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},ht={class:"flex items-center gap-2"},xt=["innerHTML"],_t={class:"flex flex-col gap-0.5"},Mt=a("div",{class:"uppercase text-xxs text-blue-primary"},"Selected Account",-1),Kt={class:"font-semibold"},Tt={key:1,class:"mt-2"},wt=["onClick"],kt={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},Pt={key:1,class:"text-xs py-2 pl-2 w-full"},At={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},Ct={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},It={key:2},Vt={class:"flex gap-3"},St={class:"flex gap-2"},Ht=a("label",{for:"regular"},"UTF-8",-1),Ft={class:"flex gap-2"},Lt=a("label",{for:"hexa"},"Hexadecimal",-1),Ut={key:3,class:"my-3"},Wt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Nt={class:"flex flex-col gap-0.5"},Bt=a("div",{class:"uppercase text-xxs text-blue-primary"},"Selected Scoped Metadata Key",-1),Dt={class:"flex"},Et={class:"font-semibold"},Rt={class:"ml-3 text-gray-400 font-semibold"},Qt={class:"flex"},Ot={key:0,class:"font-semibold"},Zt={key:1,class:"ml-3 text-gray-400 font-semibold"},jt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},qt=a("div",{class:"uppercase text-xxs text-blue-primary"},"CURRENT VALUE",-1),Xt={class:"font-semibold"},zt={class:"bg-navy-primary p-6 lg:col-span-2"},Gt={class:"text-xs text-white my-5"},Yt=["disabled"],Jt={class:"text-center"};function $t(o,u,Q,t,w,h){const M=L("router-link"),K=L("AccountComponent"),g=L("AccountTabs"),m=L("MetadataInput"),x=L("TransactionFeeDisplay"),B=L("PasswordInput"),U=je("debounce");return i(),d("div",null,[a("div",lt,[nt,T(M,{to:{name:"ViewDashboard"},class:"text-blue-primary text-xs mt-0.5"},{default:ge(()=>[ee(p(o.$t("general.back")),1)]),_:1})]),a("div",st,[T(K,{address:t.accountAddress,class:"mb-10"},null,8,["address"]),T(g,{address:t.accountAddress,selected:"metadata"},null,8,["address"]),a("div",ot,[a("div",rt,[a("div",ct,[t.err!=""?(i(),d("div",dt,p(t.err),1)):_("",!0)]),t.targetAccIsMultisig?(i(),d("div",it,[t.cosigners.length>0?(i(),d("div",ut,[a("div",gt,[ee(p(o.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(i(),d("span",vt,p(t.cosigners[0].name),1)):(i(),d("span",mt,[R(a("select",{class:"","onUpdate:modelValue":u[0]||(u[0]=s=>t.selectedCosigner=s)},[(i(!0),d(ve,null,me(t.cosigners,(s,f)=>(i(),d("option",{value:t.findAcc(s.publicKey).publicKey,key:f},p(s.name),9,yt))),128))],512),[[qe,t.selectedCosigner]])]))])])):(i(),d("div",ft,p(o.$t("general.noCosigner")),1))])):_("",!0),pt,a("div",bt,[a("div",ht,[a("div",{innerHTML:t.svgString},null,8,xt),a("div",_t,[Mt,a("div",Kt,p(t.accountName),1)])])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(i(),d("div",Tt,[a("div",{onClick:u[1]||(u[1]=s=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(i(!0),d(ve,null,me(t.existingScopedMetadataKeys,(s,f)=>(i(),d("div",{key:f},[t.showKeys?(i(),d("div",{key:0,class:"flex justify-center cursor-pointer",onClick:P=>(t.scopedMetadataKeyType=s.type,t.inputScopedMetadataKey=s.value,t.checkOldValue(),t.showKeys=!1)},[f%2==0?(i(),d("div",kt,p(s.value),1)):_("",!0),f%2==1?(i(),d("div",Pt,p(s.value),1)):_("",!0),f%2==0?(i(),d("div",At,p(o.$t("general.select")),1)):_("",!0),f%2==1?(i(),d("div",Ct,p(o.$t("general.select")),1)):_("",!0)],8,wt)):_("",!0)]))),128))])):_("",!0),t.scopedMetadataKeySelectable?(i(),d("div",It,[R(T(m,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":u[2]||(u[2]=s=>t.inputScopedMetadataKey=s),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[U,t.checkOldValue,"1000"]]),a("div",Vt,[a("div",St,[R(a("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":u[3]||(u[3]=s=>t.scopedMetadataKeyType=s)},null,512),[[ye,t.scopedMetadataKeyType]]),Ht]),a("div",Ft,[R(a("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":u[4]||(u[4]=s=>t.scopedMetadataKeyType=s)},null,512),[[ye,t.scopedMetadataKeyType]]),Lt])]),T(m,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":u[5]||(u[5]=s=>t.oldValue=s),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(i(),d("div",Ut,[a("div",Wt,[a("div",Nt,[Bt,a("div",Dt,[a("div",Et,p(Q.scopedMetadataKey),1),a("div",Rt,p(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),a("div",Qt,[t.scopedMetadataKeyType==1?(i(),d("div",Ot,p(t.scopedMetadataKeyHex),1)):_("",!0),t.scopedMetadataKeyType==1?(i(),d("div",Zt,"HEX")):_("",!0)])])]),a("div",jt,[qt,a("div",Xt,p(t.oldValue),1)])])),T(m,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":u[6]||(u[6]=s=>t.newValue=s),placeholder:"New Value"},null,8,["modelValue"])]),a("div",zt,[T(x,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),a("div",Gt,p(o.$t("general.enterPasswordContinue")),1),T(B,{placeholder:o.$t("general.enterPassword"),errorMessage:o.$t("general.passwordRequired"),modelValue:t.walletPassword,"onUpdate:modelValue":u[7]||(u[7]=s=>t.walletPassword=s),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","errorMessage","modelValue"]),a("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:u[8]||(u[8]=s=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Account Metadata ",8,Yt),a("div",Jt,[T(M,{to:{name:"ViewAccountMetadata",params:{address:t.accountAddress}},class:"content-center text-xs text-white underline"},{default:ge(()=>[ee(p(o.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const fa=Ze(at,[["render",$t]]);export{fa as default};
