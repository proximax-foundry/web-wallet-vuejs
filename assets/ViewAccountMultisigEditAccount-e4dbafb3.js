import{_ as Ze,u as Je,q as Xe,r as v,w as h,H as E,E as L,c as u,n as ue,V as Ye,A as ee,aH as A,a as M,k as P,o as y,b as _,e as s,s as F,B as ye,t as b,Q as de,ag as $e,F as ve,h as ge,f as te,z as _e,aC as et,U as Ce,i as tt,p as lt,j as at}from"./index-002fca0b.js";import{_ as st}from"./PasswordInput.vue_vue_type_script_setup_true_lang-1ea1bd95.js";import{T as ot}from"./TextInput-1aeaf2f2.js";import{_ as nt}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-320947c2.js";import{T as rt}from"./TextInputClean-074716da.js";import{M as K}from"./multisigUtils-108e3b9f.js";import{_ as it}from"./SelectAccountAndContact.vue_vue_type_script_setup_true_lang-663f6659.js";import{A as ct,_ as ut}from"./AccountTabs.vue_vue_type_script_setup_true_lang-dac113bd.js";import{_ as ke}from"./icon-delete-red-ce8ded12.js";import"./proximax-logo-ecfc3767.js";import"./jdenticon-module-8162ac79.js";import"./functions-0b8b4891.js";import"./icon-key-5b3f7dda.js";const dt="/web-wallet-vuejs/assets/icon-delete-gray-e961a25c.svg";const vt={name:"ViewMultisigEditAccount",components:{PasswordInput:st,TextInput:ot,TextInputClean:rt,SelectAccountAndContact:it,AccountComponent:ct,AccountTabs:ut,TransactionFeeDisplay:nt},props:{address:String},setup(c){const{t:o}=Je(),W=Xe();tt().appContext.config.globalProperties.emitter;const m=v(""),H=v(""),V=v(!1),D=v(""),B="^[^ ]{8,}$",le="^[0-9A-Fa-f]{64}$",d=v([]),p=v([]),R=v([]),x=v([]),U=v(!1),j=v([]),r=v(!1),n=v([]),f=v(""),we=v([]),z=v([]),G=h.currentLoggedInWallet?h.currentLoggedInWallet.selectDefaultAccount():null,ae=v(G?G.address:""),Ae=v(E.toCurrencyFormat(G?G.balance:0,L.nativeToken.divisibility)),Q=h.currentLoggedInWallet,i=u(()=>{if(!h.currentLoggedInWallet)return null;let e=h.currentLoggedInWallet.accounts.find(l=>l.address==c.address)||h.currentLoggedInWallet.others.find(l=>l.address==c.address);return e||null}),xe=v(i.value?i.value.name:""),Te=v(i.value?i.value.name:""),se=u(()=>E.convertToCurrency(ue.currentNetworkProfileConfig.lockedFundsPerAggregate,L.nativeToken.divisibility)),oe=u(()=>ue.currentNetworkProfile?E.convertToExact(Ye.getLockFundFee(),L.nativeToken.divisibility):0),Z=v(0);let O=()=>{i.value&&(Z.value=K.getAggregateFee(i.value.publicKey,d.value,C.value,k.value,p.value))};const Ie=e=>ee.Address.createFromPublicKey(e,L.networkType).plain().substr(-4),J=u(()=>{if(!i.value)return[];let e=[];return i.value.multisigInfo.filter(l=>l.level===1).forEach(l=>{e.push(l.publicKey)}),e}),C=v(i.value?i.value.multisigInfo.find(e=>e.level==0).minApproval:0),k=v(i.value?i.value.multisigInfo.find(e=>e.level==0).minRemoval:0),Se=u(()=>{if(!Q)return[];let e=[];return J.value.forEach(l=>{let a=ee.Address.createFromPublicKey(l,L.networkType).plain(),g=h.currentLoggedInWallet.contacts.find(w=>w.address==a);if(g)e.push(g.name);else if(Q.accounts.find(w=>w.publicKey===l))e.push(Q.accounts.find(w=>w.publicKey==l).name);else{let w=ee.Address.createFromPublicKey(l,L.networkType).plain().substr(-4);e.push(o("general.cosigner")+"-"+w)}}),e},{deep:!0});O();const X=()=>i.value?K.getCosignerInWallet(i.value.publicKey):{hasCosigner:!1,cosignerList:[]},Y=u(()=>{if(!h.currentLoggedInWallet)return[];let e=X(),l=[];return e.cosignerList.forEach(a=>{l.push({publicKey:a,name:A(a).name,balance:A(a).balance})}),l}),N=v(Y.value[0]?Y.value[0].publicKey:"");M(Y,e=>{e.length&&(N.value=e[0]?e[0].publicKey:"")},{deep:!0});const ne=u(()=>i.value?K.checkIsMultiSig(i.value.address):!1),Fe=u(()=>!ne.value||U.value||!D.value.match(B)||m.value||x.value.indexOf(!0)!=-1||k.value<0||C.value<0),Ne=u(()=>!(!U.value&&ne.value&&!V.value&&$.value)),$=u(()=>X().hasCosigner),Le=u(()=>{var e=!1;if(Ue.value>=q.value&&$.value){for(var l=0;l<d.value.length;l++)if(x.value[l]!=""){e=!0;break}else if(d.value[l].length<40){e=!0;break}}else e=!0;return e}),q=u(()=>{let e=L.nativeToken.divisibility;return e==0?Math.trunc(parseFloat(Z.value)+parseFloat(se.value)+oe.value):Math.round((parseFloat(Z.value)+parseFloat(se.value)+oe.value)*Math.pow(10,e))/Math.pow(10,e)}),fe=()=>{d.value=[],z.value=[],p.value=[],R.value=[],x.value=[],D.value="",C.value=i.value.multisigInfo.find(e=>e.level===0).minApproval,k.value=i.value.multisigInfo.find(e=>e.level===0).minRemoval,f.value="",we.value=[],m.value=""},Pe=async()=>{let e=[];He.value.cosignerList.forEach(a=>{e.push({address:h.currentLoggedInWallet.accounts.find(g=>g.publicKey==a).address})}),console.log(e);let l=await K.modifyMultisigAccount(N.value,d.value,p.value,C.value,k.value,i.value,D.value);console.log(l),l?(H.value="",fe(),W.push({name:"ViewAccountPendingTransactions",params:{address:c.address}})):H.value=o("general.walletPasswordInvalid",{name:h.currentLoggedInWallet.name})};M(()=>[...d.value],e=>{let l=!1,a=!1;if(d.value.length>0)for(var g=0;g<d.value.length;g++)if(d.value[g].length==64)if(d.value[g]==i.value.publicKey&&a==!1)a=!0,x.value[g]=!0,m.value=o("multisig.selectedAccErr");else if(!d.value[g].match(le)&&d.value[g].length==64)x.value[g]=!0;else if(x.value[g]=!1,Array.from(new Set(e)).length!=e.length)m.value=o("multisig.duplicatedCosigner");else{for(let S=0;S<J.value.length;S++)d.value[g]==J.value[S]&&(l=!0,m.value=o("multisig.duplicatedCosigner"));l==!1&&a==!1&&(m.value="")}else x.value[g]=!0;else m.value=""},{deep:!0}),M(()=>[...x.value],e=>{e.every(l=>l==!1)&&O(i.value.publicKey,d.value,C.value,k.value,p.value)},{deep:!0}),M(()=>[p.value],e=>{O()},{deep:!0});const pe=u(()=>{if(!i.value)return!1;const e=h.currentLoggedInWallet;let l=e.accounts.map(S=>({name:S.name,publicKey:S.publicKey})),a=e.contacts;var g=[],w=0;return g.push({key:"0",label:o("general.ownerAcc"),selectable:!1,children:[]}),l.forEach(S=>{g[0].children.push({key:"0-"+w.toString(),label:S.name,data:S.publicKey}),w++}),w=0,g.push({key:"1",label:o("general.contact"),selectable:!1,children:[]}),a!=null&&a.forEach(S=>{g[1].children.push({key:"1-"+w.toString(),label:S.name,data:S.address}),w++}),g});function Me(e,l){be(l),z.value[l]=e.label,e.key[0]=="1"?Ve(e.data,l):d.value[l]=e.data,j.value[l]=!1,n.value[l][e.key]=!0,e.selectable=!1}function Ve(e,l){try{K.verifyContactPublicKey(e).then(a=>{a.status==!0?d.value[l]=a.publicKey:m.value=o("multisig.noPublicKey")})}catch{m.value=o("multisig.noPublicKey")}}const be=e=>{if(Object.keys(n.value[e]).length!==0){let l=Object.keys(n.value[e])[0].split("-");pe.value[l[0]].children[l[1]].selectable=!0,n.value[e]={}}},Ue=u(()=>i.value?i.value.balance:0),Ke=u(()=>L.nativeToken.label),De=u(()=>L.nativeToken.divisibility);u(()=>h.currentLoggedInWallet&&A(N.value)?E.toCurrencyFormat(A(N.value).balance,De.value):"0");const Ee=()=>{d.value.push(""),n.value.push({}),x.value.push(!1)},We=e=>{be(e),d.value.splice(e,1),j.value.splice(e,1),n.value.splice(e,1),z.value.splice(e,1),x.value.splice(e,1),R.value.splice(e,1)},Be=e=>{!U.value&&!V.value&&$.value&&(p.value=[],p.value.push(e))},Re=e=>{let l=!1;return p.value.length>0&&p.value.forEach(a=>{a==e&&(l=!0)}),l},je=e=>{const l=p.value.indexOf(e);l>-1&&p.value.splice(l,1)},T=u(()=>re()-p.value.length+d.value.length),I=u(()=>re()-p.value.length+d.value.length),re=()=>i.value?i.value.getDirectParentMultisig().length:0;M(T,(e,l)=>{e<l&&(C.value>e&&(C.value=T.value),k.value>e&&(k.value=I.value))}),M(I,(e,l)=>{e<l&&(C.value>e&&(C.value=T.value),k.value>e&&(k.value=I.value))});const Oe=e=>{C.value*10*~~(T.value/10)+e.charCode-48>T.value&&e.preventDefault()};let ie=o("multisig.deletionExceedMax"),ce=o("multisig.approvalExceedMax");M(C,e=>{O(),T.value==0&&e>1||e>T.value&&e!=1&&T.value!=0?m.value=ce:T.value>0&&e<=0?m.value=o("multisig.approvalAtLeastOne"):k.value>I.value&&k.value!=1&&I.value!=0?m.value=ie:m.value=""});const qe=e=>{k.value*10*~~(I.value/10)+e.charCode-48>I.value&&e.preventDefault()};M(k,e=>{O(),I.value==0&&e>1||e>I.value&&e!=1&&I.value!=0?m.value=ie:I.value>0&&e<=0?m.value=o("multisig.deletionAtLeastOne"):C.value>T.value&&C.value!=1&&T.value!=0?m.value=ce:m.value=""});const He=u(()=>X());try{K.onPartial(ee.PublicAccount.createFromPublicKey(i.value.publicKey,L.networkType)).then(e=>U.value=e)}catch{}A(N.value)&&A(N.value).balance<q.value&&(V.value=!0),M(N,e=>{A(e)&&(A(e).balance<q.value?V.value=!0:V.value=!1)});const ze=u(()=>E.amountFormatterSimple(q.value,0)),he=u(()=>{if(!h.currentLoggedInWallet)return[];let e=h.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),l=h.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return e.concat(l)}),Ge=u(()=>{if(ue.currentNetworkProfileConfig){let e=K.getCosignerInWallet(he.value.find(a=>a.address==ae.value)?he.value.find(a=>a.address==ae.value).publicKey:""),l=[];return e.cosignerList.forEach(a=>{l.push({publicKey:a,name:A(a).name,balance:A(a).balance,address:A(a).address})}),e.cosignerList=l,e}else return{hasCosigner:!1,cosignerList:[]}}),Qe=u(()=>{let e=A(N.value)?A(N.value).balance:0;return E.toCurrencyFormat(e,3)});return{cosignerName:Se,contact:pe,toggleContact:j,contactName:z,currentNativeTokenName:Ke,err:m,disableSend:Fe,numApproveTransaction:C,numDeleteUser:k,maxNumApproveTransaction:T,maxNumDeleteUser:I,fundStatus:V,accountNameDisplay:Te,accountName:xe,acc:i,passwd:D,showAddressError:x,addCoSig:Ee,findAcc:A,coSign:d,addCoSigButton:Le,deleteCoSigAddressInput:We,selectedAddresses:R,clear:fe,modifyAccount:Pe,disabledPassword:Ne,onPartial:U,isMultisig:ne,isCoSigner:$,selectedNode:n,showCosigners:r,wallet:Q,removeCosign:p,addToRemovalList:Be,restoreFromRemovalList:je,checkRemoval:Re,getWalletCosigner:X,selectedCosignPublicKey:N,validateApproval:Oe,validateDelete:qe,cosignaturies:J,cosignerAddress:Ie,onNodeSelect:Me,getCosigns:re,lockFundCurrency:se,lockFundTxFee:oe,aggregateFee:Z,totalFee:q,walletCosignerList:Y,totalFeeFormatted:ze,selectedAccAdd:ae,accBalance:Ae,getMultiSigCosigner:Ge,checkCosignBalance:Qe,passwordErr:H}}},me=c=>(lt("data-v-a87ebc7b"),c=c(),at(),c),gt={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},mt={class:"border-2 border-t-0 lg:grid lg:grid-cols-3"},ft={class:"lg:col-span-2 py-6 pr-6"},pt={class:"text-left mt-2 mb-5 ml-6"},bt={key:0},ht={class:"text-tsm"},yt={key:0,class:"font-bold"},_t={key:1,class:"font-bold"},Ct=["value"],kt={class:"text-xs font-semibold pl-6"},wt={class:"pl-6"},At={key:0,class:"error error_box mb-5"},xt={key:1,class:"error error_box mb-5"},Tt=me(()=>s("div",{class:"mt-4"},null,-1)),It={class:"flex flex-col gap-2"},St={class:"flex"},Ft=["onClick"],Nt=["onClick"],Lt={class:"flex flex-col gap-2 mt-2"},Pt={class:"flex"},Mt=["onClick"],Vt=["onClick"],Ut={class:"text-xxs text-blue-primary font-semibold uppercase"},Kt={key:0},Dt=["disabled"],Et=me(()=>s("div",{class:"ml-6 my-7 gray-line"},null,-1)),Wt={class:"pl-6 text-xs font-semibold mb-3"},Bt={class:"flex gap-2 pl-6"},Rt={class:"border w-6/12"},jt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Ot={class:"flex justify-around"},qt=["disabled"],Ht=["max"],zt=["disabled"],Gt={class:"text-xxs border-t-2 text-center py-1 uppercase"},Qt={class:"border w-6/12"},Zt={class:"border-b-2 text-xxs text-center py-1 uppercase"},Jt={class:"flex justify-around"},Xt=["disabled"],Yt=["max"],$t=["disabled"],el={class:"text-xxs border-t-2 text-center py-1 uppercase"},tl={class:"bg-navy-primary p-6 lg:col-span-1"},ll=me(()=>s("div",{class:"mt-5"},null,-1)),al={class:"font-semibold text-xs text-white mb-1.5"},sl={class:"mt-3"},ol=["disabled"],nl={class:"text-center"};function rl(c,o,W,t,m,H){const V=P("AccountComponent"),D=P("AccountTabs"),B=P("TextInput"),le=P("TextInputClean"),d=P("font-awesome-icon"),p=P("SelectAccountAndContact"),R=P("Sidebar"),x=P("TransactionFeeDisplay"),U=P("PasswordInput"),j=P("router-link");return y(),_("div",null,[s("div",gt,[F(V,{address:W.address,class:"mb-6"},null,8,["address"]),F(D,{address:W.address,selected:"multisig"},null,8,["address"]),s("div",mt,[s("div",ft,[s("div",pt,[t.walletCosignerList.length>0?(y(),_("div",bt,[s("div",ht,[ye(b(c.$t("general.initiateBy"))+": ",1),t.walletCosignerList.length==1?(y(),_("span",yt,b(t.walletCosignerList[0].name),1)):(y(),_("span",_t,[de(s("select",{class:"","onUpdate:modelValue":o[0]||(o[0]=r=>t.selectedCosignPublicKey=r)},[(y(!0),_(ve,null,ge(t.walletCosignerList,(r,n)=>(y(),_("option",{value:t.findAcc(r.publicKey)?t.findAcc(r.publicKey).publicKey:"",key:n},b(r.name),9,Ct))),128))],512),[[$e,t.selectedCosignPublicKey]])]))])])):te("",!0)]),s("div",kt,b(c.$t("multisig.manageCosignatories")),1),s("div",wt,[t.err!=""?(y(),_("div",At,b(t.err),1)):te("",!0),t.passwordErr!=""?(y(),_("div",xt,b(t.passwordErr),1)):te("",!0)]),Tt,s("div",It,[(y(!0),_(ve,null,ge(t.cosignaturies,(r,n)=>(y(),_("div",{key:n},[s("div",St,[t.checkRemoval(r)?(y(),_("img",{key:0,onClick:f=>t.restoreFromRemovalList(r),src:ke,class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,Ft)):(y(),_("img",{key:1,onClick:f=>t.addToRemovalList(r),src:dt,class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,Nt)),F(B,{class:"w-5/12 mr-2",modelValue:t.cosignerName[n],"onUpdate:modelValue":f=>t.cosignerName[n]=f,disabled:!0},null,8,["modelValue","onUpdate:modelValue"]),F(B,{class:"w-7/12",modelValue:t.cosignaturies[n],"onUpdate:modelValue":f=>t.cosignaturies[n]=f,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])])]))),128))]),s("div",Lt,[(y(!0),_(ve,null,ge(t.coSign,(r,n)=>(y(),_("div",{key:n},[s("div",Pt,[s("img",{src:ke,onClick:f=>t.deleteCoSigAddressInput(n),class:"w-4 h-4 text-gray-500 cursor-pointer mt-3 mx-1"},null,8,Mt),F(B,{class:"w-5/12 mr-2",placeholder:c.$t("multisig.cosignatory")+`${n+1}`,modelValue:t.contactName[n],"onUpdate:modelValue":f=>t.contactName[n]=f,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"]),F(le,{class:"w-7/12 mr-2",placeholder:c.$t("general.publicKey"),errorMessage:c.$t("general.invalidInput"),showError:t.showAddressError[n],modelValue:t.coSign[n],"onUpdate:modelValue":f=>t.coSign[n]=f},null,8,["placeholder","errorMessage","showError","modelValue","onUpdate:modelValue"]),s("div",{onClick:f=>t.toggleContact[n]=!t.toggleContact[n],class:"border cursor-pointer flex flex-col justify-center p-2",style:{height:"2.66rem"}},[F(d,{icon:"id-card-alt",class:"text-blue-primary ml-auto mr-auto"}),s("div",Ut,b(c.$t("general.select")),1)],8,Vt)]),t.toggleContact[n]?(y(),_("div",Kt,[F(R,{visible:t.toggleContact[n],"onUpdate:visible":f=>t.toggleContact[n]=f,baseZIndex:1e4,position:"full"},{default:_e(()=>[F(p,et(n,{contacts:t.contact,index:n,selectedNode:t.selectedNode[n],onNodeSelect:f=>t.onNodeSelect(f,n)}),null,16,["contacts","index","selectedNode","onNodeSelect"])]),_:2},1032,["visible","onUpdate:visible"])])):te("",!0)]))),128))]),s("button",{class:"pl-6 font-semibold text-xs mt-1 text-blue-primary outline-none focus:outline-none disabled:opacity-50 disabled:cursor-auto",onClick:o[1]||(o[1]=(...r)=>t.addCoSig&&t.addCoSig(...r)),disabled:t.addCoSigButton},"+ "+b(c.$t("multisig.addNewCosignatory")),9,Dt),Et,s("div",Wt,b(c.$t("general.scheme")),1),s("div",Bt,[s("div",Rt,[s("div",jt,b(c.$t("multisig.transactionsApproval")),1),s("div",Ot,[s("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[2]||(o[2]=r=>t.numApproveTransaction--),disabled:t.numApproveTransaction<=0},"-",8,qt),de(s("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[3]||(o[3]=(...r)=>t.validateApproval&&t.validateApproval(...r)),max:t.maxNumApproveTransaction,"onUpdate:modelValue":o[4]||(o[4]=r=>t.numApproveTransaction=r)},null,40,Ht),[[Ce,t.numApproveTransaction]]),s("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numApproveTransaction>=t.maxNumApproveTransaction,onClick:o[5]||(o[5]=r=>t.numApproveTransaction++)},"+",8,zt)]),s("div",Gt,b(c.$t("multisig.ofCosignatories",{value:t.maxNumApproveTransaction})),1)]),s("div",Qt,[s("div",Zt,b(c.$t("multisig.accountDeletionApproval")),1),s("div",Jt,[s("button",{class:"text-blue-primary disabled:opacity-50",onClick:o[6]||(o[6]=r=>t.numDeleteUser--),disabled:t.numDeleteUser<=0},"-",8,Xt),de(s("input",{type:"number",class:"w-4 outline-none text-xs font-bold",min:0,onKeypress:o[7]||(o[7]=(...r)=>t.validateDelete&&t.validateDelete(...r)),max:t.maxNumDeleteUser,"onUpdate:modelValue":o[8]||(o[8]=r=>t.numDeleteUser=r)},null,40,Yt),[[Ce,t.numDeleteUser]]),s("button",{class:"text-blue-primary disabled:opacity-50",disabled:t.numDeleteUser>=t.maxNumDeleteUser,onClick:o[9]||(o[9]=r=>t.numDeleteUser++)},"+",8,$t)]),s("div",el,b(c.$t("multisig.ofCosignatories",{value:t.maxNumDeleteUser})),1)])])]),s("div",tl,[F(x,{"fund-status":t.fundStatus,"is-multisig":t.isMultisig,"is-cosigner":t.isCoSigner,"on-partial":t.onPartial,"transaction-fee":String(t.aggregateFee),"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":t.lockFundCurrency,"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["fund-status","is-multisig","is-cosigner","on-partial","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),ll,s("div",al,b(c.$t("general.enterPasswordContinue")),1),F(U,{placeholder:c.$t("general.enterPassword"),errorMessage:c.$t("general.passwordRequired"),modelValue:t.passwd,"onUpdate:modelValue":o[10]||(o[10]=r=>t.passwd=r),disabled:t.disabledPassword},null,8,["placeholder","errorMessage","modelValue","disabled"]),s("div",sl,[s("button",{type:"submit",class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:o[11]||(o[11]=r=>t.modifyAccount()),disabled:t.disableSend},b(c.$t("multisig.updateCosignatories")),9,ol)]),s("div",nl,[F(j,{to:{name:"ViewMultisigHome",params:{address:W.address}},class:"content-center text-xs text-white underline"},{default:_e(()=>[ye(b(c.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const Cl=Ze(vt,[["render",rl],["__scopeId","data-v-a87ebc7b"]]);export{Cl as default};
