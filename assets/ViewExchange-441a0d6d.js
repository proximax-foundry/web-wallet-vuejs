import{d as We,c as I,r as F,H as p,n as j,E as o,V as O,A as n,w as x,D as $e,a as K,q as Oe,k as Ke,o as g,b as y,e as t,f as w,s as S,t as s,C as d,z as Re,B as je,i as Xe,bl as qe,W as Le,_ as ze}from"./index-401acdd9.js";import{_ as Ee}from"./proximax-logo-ecfc3767.js";import{S as Je,I as Qe,a as Ye}from"./SelectInputMultisigAccount-86454927.js";import{P as Ze}from"./PasswordInput-357714d6.js";import"./jdenticon-module-3e81fcaa.js";const et={class:"border-2 xl:grid xl:grid-cols-3"},tt={class:"xl:col-span-2 p-12"},at=t("div",null,"SDA-SDA Exchange ",-1),it={key:0,class:"text-xs mt-3 text-blue-primary"},st=t("div",{class:"text-blue-primary mt-3"},"Price",-1),ot=t("div",{class:"text-blue-primary mt-3"},"Available Amount",-1),lt=t("div",{class:"text-blue-primary mt-3"},"Minimum Offer ",-1),nt={class:"text-blue-primary mt-3"},ct={key:1,class:"text-red-500 text-xs"},rt={key:2,class:"text-red-500 text-xs"},ut={class:"mt-2 text-xs text-gray-600"},dt={class:"flex mt-2"},vt={class:"text-gray-600 text-xs"},mt={key:0,class:"text-red-500 text-xs ml-2"},pt={key:3,class:"text-gray-600 text-xs mt-2"},gt=t("div",{class:"text-blue-primary mt-3"},"Actual offer",-1),yt={key:4},ft={key:5},ht={class:"bg-navy-primary py-6 px-6 xl:col-span-1"},bt={key:0},xt={class:"font-bold text-xs text-blue-primary uppercase"},_t={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},wt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},Gt=["innerHTML"],Mt={class:"flex"},Tt={class:"ml-1 text-blue-400 font-bold"},At=t("img",{src:Ee,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),It={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},kt=t("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Ft={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Dt={class:"ml-1 text-blue-400 text-xs"},Nt=t("div",{class:"border-b-2 border-gray-600 my-2"},null,-1),Lt={class:"font-bold text-xs text-blue-primary uppercase"},Et={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},Ht={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},St=["innerHTML"],Pt={class:"flex"},Ct={class:"ml-1 text-blue-400 font-bold"},Vt=t("img",{src:Ee,class:"ml-1 h-5 w-5 mt-0.5"},null,-1),Bt=t("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),Ut={key:1},Wt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},$t=t("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give",-1),Ot={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},Kt={class:"ml-1 text-blue-400 text-xs"},Rt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},jt={class:"font-semibold lg:col-span-2 col-span-3"},Xt=["innerHTML"],qt={class:"ml-1 text-blue-400"},zt={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Jt={class:"font-semibold lg:col-span-2 col-span-3"},Qt=["innerHTML"],Yt={class:"ml-1 text-blue-400"},Zt={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},ea={class:"font-semibold lg:col-span-2 col-span-3"},ta=["innerHTML"],aa={class:"ml-1 text-blue-400"},ia=t("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1),sa={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},oa=t("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"},"Total",-1),la=["innerHTML"],na={class:"ml-1 text-blue-400"},ca={class:"font-semibold text-xs text-white mb-1.5"},ra={class:"text-center"},ua=We({__name:"ViewExchange",props:{type:String,owner:String,pair:String},setup(He){const L=He,X=(a,i)=>{const l=(m,b)=>b===0?m:l(b,m%b),v=l(a,i),r=a/v,f=i/v;return[r,f]},_=I(()=>{var a,i;return parseFloat(c.value)<T.value[0]/Math.pow(10,(a=e.value)==null?void 0:a.mosaicGetDivisibility)?0:parseFloat(c.value)*Math.pow(10,(i=e.value)==null?void 0:i.mosaicGetDivisibility)%T.value[0]}),Se=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],c=F("0"),D=I(()=>parseFloat(c.value)*C.value-_.value*C.value),q=Xe().appContext.config.globalProperties.emitter,N=F(""),G=F(null),M=F(null),z=I(()=>p.convertToExact(j.currentNetworkProfileConfig.lockedFundsPerAggregate,o.nativeToken.divisibility)),J=I(()=>p.convertToExact(O.getLockFundFee(),o.nativeToken.divisibility)),P=I(()=>{var v,r,f,m;if(!o.isReady)return 0;const a=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(parseFloat(c.value)*Math.pow(10,((v=e.value)==null?void 0:v.mosaicGiveDivisibility)??0)),new n.MosaicId(o.nativeToken.assetId),n.UInt64.fromUint(D.value*Math.pow(10,((r=e.value)==null?void 0:r.mosaicGetDivisibility)??0)),(f=e.value)==null?void 0:f.deadline)],o.networkType);if(!A.value)return((m=a.maxFee)==null?void 0:m.compact())/Math.pow(10,o.nativeToken.divisibility);const i=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(b=>b.address==M.value),l=[a.toAggregateV1(n.PublicAccount.createFromPublicKey(i.publicKey,o.networkType))];return o.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,o.nativeToken.divisibility)});q.on("select-account",a=>{G.value=a}),q.on("select-multisig-account",a=>{M.value=a});const u=a=>{const i=Se.find(l=>l.namespace==a);return i?i.name:a},R=I(()=>A.value?Math.round((z.value+J.value+P.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()?Math.round((parseFloat(c.value)-_.value+P.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):P.value),e=F(null),C=F(0),h=$e(),Q=L.pair.split("/")[L.type=="Sell"?0:1],Y=L.pair.split("/")[L.type=="Sell"?1:0],k=F(0),Z=a=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==a)||x.currentLoggedInWallet.others.find(l=>l.address==a);return i?E(i.balance):0},E=a=>{let i=a.toString().split(".");return i[1]!=null?'<span class="font-semibold text-sm">'+i[0]+'</span>.<span class="font-semibold text-xs">'+i[1]+"</span>":'<span class="font-semibold text-sm">'+i[0]+"</span>"},T=I(()=>{if(!e.value)return X(0,0);const a=e.value.initialMosaicGiveAmount.compact(),i=e.value.initialMosaicGetAmount.compact();return X(i,a)});K(e,a=>{a.mosaicGetDivisibility&&(c.value=(T.value[0]/Math.pow(10,a.mosaicGetDivisibility)).toString())},{deep:!0});const A=I(()=>M.value!=null),Pe=async()=>{if(!Q||!Y){h.add({severity:"error",summary:"Error",detail:"Invalid",group:"br-custom",life:1e3});return}const a=new n.ExchangeSdaHttp(o.nodeFullURL),i=await qe(a.getAccountSdaExchangeOffers(n.Address.createFromRawAddress(L.owner)));if(e.value=i.sdaOfferBalances.find(r=>r.mosaicIdGive.toHex()==Q&&r.mosaicIdGet.toHex()==Y),!e.value){h.add({severity:"error",summary:"Error",detail:"Offer not found",group:"br-custom",life:1e3});return}const l=await o.chainAPI.assetAPI.getMosaicsNames([e.value.mosaicIdGet,e.value.mosaicIdGive]),v=await o.chainAPI.assetAPI.getMosaics([e.value.mosaicIdGet,e.value.mosaicIdGive]);e.value.mosaicGetName=l[0].names.length?l[0].names[0].name:e.value.mosaicIdGet.toHex(),e.value.mosaicGiveName=l[1].names.length?l[1].names[0].name:e.value.mosaicIdGive.toHex(),e.value.mosaicGetDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGet.toHex()).divisibility,e.value.mosaicGiveDivisibility=v.find(r=>r.mosaicId.toHex()==e.value.mosaicIdGive.toHex()).divisibility,C.value=e.value.initialMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)/(e.value.initialMosaicGetAmount.compact()/Math.pow(10,e.value.mosaicGetDivisibility))},ee=async a=>{try{const l=(await o.chainAPI.accountAPI.getAccountInfo(n.Address.createFromRawAddress(a))).mosaics.find(v=>v.id.toHex()==e.value.mosaicIdGet.toHex());if(!l){k.value=0;return}k.value=l.amount.compact()/Math.pow(10,e.value.mosaicGetDivisibility)}catch{k.value=0}};K(c,a=>{isNaN(parseFloat(a))&&(c.value="0")}),K([G,M],([a,i])=>{k.value=0,a!=null&&i==null?ee(a):a!=null&&i!=null&&ee(i)});const Ce=K(o,async(a,i)=>{a.isReady&&(await Pe(),Ce())},{immediate:!0}),Ve=a=>{const i=x.currentLoggedInWallet.accounts.find(l=>l.address==a)||x.currentLoggedInWallet.others.find(l=>l.address==a);return i?i.balance:0},Be=Oe(),Ue=async()=>{if(G.value==null){h.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(parseFloat(c.value)<T.value[0]/Math.pow(10,e.value.mosaicGetDivisibility)){h.add({severity:"error",summary:"Error",detail:"Less than minimum offer amount",group:"br-custom",life:1e3});return}if(parseFloat(c.value)-_.value>k.value){h.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))/Math.pow(10,e.value.mosaicGiveDivisibility)>e.value.currentMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)){h.add({severity:"error",summary:"Error",detail:"Exceed available amount of "+u(e.value.mosaicGiveName),group:"br-custom",life:1e3});return}const a=Ve(G.value);if(A.value&&a<R.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()&&!A.value&&a<R.value){h.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(N.value.length<8){h.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!Le.verifyWalletPassword(x.currentLoggedInWallet.name,j.chainNetworkName,N.value)){h.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const i=x.currentLoggedInWallet.accounts.find(m=>m.address==G.value),l=n.PlaceSdaExchangeOfferTransaction.create(n.Deadline.create(),[new n.SdaExchangeOffer(e.value.mosaicIdGet,n.UInt64.fromUint(Math.trunc((parseFloat(c.value)-_.value)*Math.pow(10,e.value.mosaicGetDivisibility))),e.value.mosaicIdGive,n.UInt64.fromUint(Math.trunc(D.value*Math.pow(10,e.value.mosaicGetDivisibility))),n.UInt64.fromUint(57600))],o.networkType),v=Le.decryptPrivateKey(new n.Password(N.value),i.encrypted,i.iv);N.value="";const r=n.Account.createFromPrivateKeyV1(v,o.networkType),f=j.currentNetworkProfile.generationHash;if(A.value){const m=[...x.currentLoggedInWallet.accounts,...x.currentLoggedInWallet.others].find(W=>W.address==M.value),b=[l.toAggregateV1(n.PublicAccount.createFromPublicKey(m.publicKey,o.networkType))],V=o.buildTxn.aggregateBonded(b),H=r.preV2Sign(V,f),B=O.lockFundTx(H),U=r.preV2Sign(B,f);O.announceLF_AND_addAutoAnnounceABT(U,H)}else{const m=r.preV2Sign(l,f);await O.announceTransaction(m)}Be.push({name:"ViewAccountPendingTransactions",params:{address:r.address.plain()}})};return(a,i)=>{var v,r,f,m,b,V,H,B,U,W,te,ae,ie,se,oe,le,ne,ce,re,ue,de,ve,me,pe,ge,ye,fe,he,be,xe,_e,we,Ge,Me,Te,Ae,Ie,ke,Fe,De,Ne;const l=Ke("router-link");return g(),y("div",null,[t("div",et,[t("div",tt,[at,G.value?w("v-if",!0):(g(),y("div",it,"Select Account to Create / Initiate Transaction")),S(Ye),S(Je,{class:"md:mt-3","selected-address":G.value},null,8,["selected-address"]),st,t("div",null,s(Math.trunc(C.value*Math.pow(10,(v=e.value)==null?void 0:v.mosaicGiveDivisibility))/Math.pow(10,(r=e.value)==null?void 0:r.mosaicGiveDivisibility))+" "+s(u((f=e.value)==null?void 0:f.mosaicGiveName))+"/"+s(u((m=e.value)==null?void 0:m.mosaicGetName)),1),ot,t("div",null,s(d(p).toCurrencyFormat(((b=e.value)==null?void 0:b.currentMosaicGiveAmount.compact())/Math.pow(10,(V=e.value)==null?void 0:V.mosaicGiveDivisibility),(H=e.value)==null?void 0:H.mosaicGiveDivisibility))+" "+s(u((B=e.value)==null?void 0:B.mosaicGiveName)),1),lt,t("div",null,s(d(p).toCurrencyFormat(T.value[0]/Math.pow(10,(U=e.value)==null?void 0:U.mosaicGetDivisibility),(W=e.value)==null?void 0:W.mosaicGetDivisibility))+" "+s(u((te=e.value)==null?void 0:te.mosaicGetName))+" : "+s(d(p).toCurrencyFormat(T.value[1]/Math.pow(10,(ae=e.value)==null?void 0:ae.mosaicGiveDivisibility),(ie=e.value)==null?void 0:ie.mosaicGiveDivisibility))+" "+s(u((se=e.value)==null?void 0:se.mosaicGiveName)),1),t("div",nt,"Amount to give ("+s(u((oe=e.value)==null?void 0:oe.mosaicGetName))+") ",1),S(Qe,{placeholder:"Asset Amount",modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=$=>c.value=$),decimal:((le=e.value)==null?void 0:le.mosaicGetDivisibility)??0},null,8,["modelValue","decimal"]),parseFloat(c.value)>k.value?(g(),y("div",ct,"Insufficient Balance")):w("v-if",!0),parseFloat(c.value)<T.value[0]/Math.pow(10,(ne=e.value)==null?void 0:ne.mosaicGetDivisibility)?(g(),y("div",rt,"Less than minimum offer amount")):w("v-if",!0),t("div",ut,"Available to give: "+s(d(p).toCurrencyFormat(k.value,(ce=e.value)==null?void 0:ce.mosaicGetDivisibility))+" "+s(u((re=e.value)==null?void 0:re.mosaicGetName)),1),t("div",dt,[t("div",vt," I will receive "+s(d(p).toCurrencyFormat(D.value,(ue=e.value)==null?void 0:ue.mosaicGiveDivisibility))+" "+s(u((de=e.value)==null?void 0:de.mosaicGiveName)),1),Math.trunc(D.value*Math.pow(10,(ve=e.value)==null?void 0:ve.mosaicGiveDivisibility))/Math.pow(10,(me=e.value)==null?void 0:me.mosaicGiveDivisibility)>((pe=e.value)==null?void 0:pe.currentMosaicGiveAmount.compact())/Math.pow(10,(ge=e.value)==null?void 0:ge.mosaicGiveDivisibility)?(g(),y("div",mt," (Exceed Available Amount of "+s(u((ye=e.value)==null?void 0:ye.mosaicGiveName))+")",1)):w("v-if",!0)]),Math.trunc(_.value*Math.pow(10,(fe=e.value)==null?void 0:fe.mosaicGetDivisibility))/Math.pow(10,(he=e.value)==null?void 0:he.mosaicGetDivisibility)>0?(g(),y("div",pt,s(d(p).toCurrencyFormat(_.value,(be=e.value)==null?void 0:be.mosaicGetDivisibility))+" "+s(u((xe=e.value)==null?void 0:xe.mosaicGetName))+" will be ignored ",1)):w("v-if",!0),gt,parseFloat(c.value)>=T.value[0]/Math.pow(10,(_e=e.value)==null?void 0:_e.mosaicGetDivisibility)?(g(),y("div",yt,s(d(p).toCurrencyFormat(parseFloat(c.value)-_.value,(we=e.value)==null?void 0:we.mosaicGetDivisibility))+" "+s(u((Ge=e.value)==null?void 0:Ge.mosaicGetName))+" : "+s(d(p).toCurrencyFormat(D.value,(Me=e.value)==null?void 0:Me.mosaicGiveDivisibility))+" "+s(u((Te=e.value)==null?void 0:Te.mosaicGiveName)),1)):(g(),y("div",ft," 0 "+s(u((Ae=e.value)==null?void 0:Ae.mosaicGetName))+" : 0 "+s(u((Ie=e.value)==null?void 0:Ie.mosaicGiveName)),1))]),t("div",ht,[M.value?(g(),y("div",bt,[t("div",xt,s(a.$t("general.multisigAcc")),1),t("div",_t,[t("div",wt,s(a.$t("general.currentBalance")),1),t("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:Z(M.value)},null,8,Gt),t("div",Mt,[t("div",Tt,s(d(o).nativeToken.label),1),At])]),t("div",It,[kt,t("span",Ft,s(d(p).toCurrencyFormat(parseFloat(c.value)-_.value,(ke=e.value)==null?void 0:ke.mosaicGetDivisibility)),1),t("span",Dt,s(u((Fe=e.value)==null?void 0:Fe.mosaicGetName)),1)]),Nt])):w("v-if",!0),t("div",Lt,s(a.$t("general.signerAcc")),1),t("div",Et,[t("div",Ht,s(a.$t("general.currentBalance")),1),t("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:Z(G.value)},null,8,St),t("div",Pt,[t("div",Ct,s(d(o).nativeToken.label),1),Vt])]),Bt,M.value?w("v-if",!0):(g(),y("div",Ut,[t("div",Wt,[$t,t("span",Ot,s(d(p).toCurrencyFormat(parseFloat(c.value)-_.value,(De=e.value)==null?void 0:De.mosaicGetDivisibility)),1),t("span",Kt,s(u((Ne=e.value)==null?void 0:Ne.mosaicGetName)),1)])])),t("div",Rt,[t("div",jt,s(A.value?a.$t("general.aggregateFee"):a.$t("general.transactionFee")),1),t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(P.value)},null,8,Xt),t("div",qt,s(d(o).nativeToken.label),1)]),A.value?(g(),y("div",zt,[t("div",Jt,s(a.$t("general.lockFund")),1),t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(z.value??0)},null,8,Qt),t("div",Yt,s(d(o).nativeToken.label),1)])):w("v-if",!0),A.value?(g(),y("div",Zt,[t("div",ea,s(a.$t("general.lockFundTxFee")),1),t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(J.value??0)},null,8,ta),t("div",aa,s(d(o).nativeToken.label),1)])):w("v-if",!0),ia,t("div",sa,[oa,t("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(R.value)},null,8,la),t("div",na,s(d(o).nativeToken.label),1)]),t("div",ca,s(a.$t("general.enterPasswordContinue")),1),S(Ze,{placeholder:a.$t("general.enterPassword"),modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=$=>N.value=$),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),t("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:i[2]||(i[2]=$=>Ue())}," Sell "),t("div",ra,[S(l,{to:{name:"ViewExchangeListing"},class:"content-center text-xs text-white underline"},{default:Re(()=>[je(s(a.$t("general.cancel")),1)]),_:1})])])])])}}}),fa=ze(ua,[["__file","/home/runner/work/web-wallet-vuejs/web-wallet-vuejs/src/modules/services/submodule/exchange/ViewExchange.vue"]]);export{fa as default};
