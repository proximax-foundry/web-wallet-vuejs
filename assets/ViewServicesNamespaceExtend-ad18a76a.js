import{_ as pe,u as xe,l as we,A as Ce,r as n,c as l,n as i,b3 as De,b4 as Ne,B as d,G as Te,aX as Fe,H as c,R as Se,ai as X,w as T,D as Le,a as F,am as B,b5 as le,i as E,o as u,b as g,e as a,t as s,m as S,f as w,x as Y,P as Ae,aa as Ie,F as Pe,g as Me,v as Be,z as Ee}from"./index-8d23d87a.js";import{_ as Ve}from"./PasswordInput.vue_vue_type_script_setup_true_lang-fc574f23.js";import{D as Ue}from"./DurationInputClean-a8915350.js";import{_ as He}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-cafcdf69.js";import{N as L}from"./namespaceUtils-6560ac56.js";import{t as Re}from"./jdenticon-module-54356f71.js";import{M as We}from"./multisigUtils-f1d25cc1.js";import{T as V}from"./transactionState-98aacb40.js";import{_ as je}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const ze={name:"ViewServicesNamespaceExtend",components:{PasswordInput:Ve,DurationInputClean:Ue,TransactionFeeDisplay:He},props:{namespaceId:String,address:String},setup(o){xe();const h=we();Ce();const q=n(null),e=n(!1),m=n("1"),J=n(""),k=n(!1),C=n(!1),U=n(!1),y=n(""),v=n(!1),H=n(!1),_=n(""),A=n(0),R=n(0),I=n(0),W=n(!1),D=l(()=>i.currentNetworkProfileConfig?Math.floor(De.configReturn(i.currentNetworkProfileConfig.maxNamespaceDuration,Ne.DAY)):0),re=l(()=>d.readBlockHeight),ie=l(()=>d.nativeToken.label);(async()=>{const t=Te.buildAPIEndpoint(i.selectedAPIEndpoint,i.currentNetworkProfile?i.currentNetworkProfile.httpPort:3e3),r=new Fe(t);A.value=await r.chainAPI.getBlockchainHeight()})();const ce=l(()=>{let t=[];const r=L.listRootNamespaces(x.value);return t.push.apply(t,r),t}),de=l(()=>d.nativeToken.label),P=l(()=>i.currentNetworkProfileConfig?m.value>0?c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*L.calculateDuration(m.value),d.nativeToken.divisibility):c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,d.nativeToken.divisibility):0),ue=l(()=>c.toCurrencyFormat(P.value,6)),ge=l(()=>i.currentNetworkProfileConfig?c.convertToExact(i.currentNetworkProfileConfig.lockedFundsPerAggregate,d.nativeToken.divisibility):0),me=l(()=>i.currentNetworkProfileConfig?c.amountFormatterSimple(i.currentNetworkProfileConfig.lockedFundsPerAggregate,d.nativeToken.divisibility):0),j=l(()=>i.currentNetworkProfile?c.convertToExact(Se.getLockFundFee(),d.nativeToken.divisibility):0),M=l(()=>(f.value?f.value.cosignerList.length:0)==0&&X(x.value)),ve=n(j.value.toString()),z=l(()=>ge.value+j.value),fe=l(()=>!(!e.value&&!se.value&&!M.value)),Q=n(""),x=n(""),G=n(""),Z=n(""),K=l(()=>T.currentLoggedInWallet?T.currentLoggedInWallet.selectDefaultAccount():null),be=n(K.value?X(K.value.address):!1),$=c.createAddress(o.address).plain();let b=l(()=>T.currentLoggedInWallet?T.currentLoggedInWallet.accounts.find(t=>t.address==$)||T.currentLoggedInWallet.others.find(t=>t.address==$):null);b.value&&(Q.value=b.value.name,x.value=b.value.address,G.value=c.toCurrencyFormat(b.value.balance,d.nativeToken.divisibility),Z.value=b.value.balance);let ee=new Le("ThemeStyleConfig");ee.init();const he=n(Re(o.address,40,ee.jdenticonConfig));if(b.value){let t=b.value.namespaces.find(r=>r.idHex===o.namespaceId);if(t!=null){R.value=t.endHeight;const r=t.name.split(".");r.length>1?y.value=r[0]:y.value=t.name}}const te=n("0"),N=n(0);try{te.value=c.convertToCurrency(L.getRootNamespaceTransactionFee(y.value,m.value),d.nativeToken.divisibility),N.value=c.convertToExact(L.getRootNamespaceTransactionFee(y.value,m.value),d.nativeToken.divisibility)}catch{}let O=!1;F(m,t=>{if(t>D.value)m.value=D.value;else{let r=R.value-A.value,p=0;I.value=Math.ceil(r/(24*60*4)),parseInt(t)+I.value>D.value?(p=D.value-I.value,m.value=p.toString(),W.value=!0,O=!0):(O||(W.value=!1),O=!1)}});const ke=()=>{m.value="1"},ae=l(()=>X(c.createAddress(o.address).plain())?parseFloat(z.value)+P.value+N.value:P.value+N.value),ye=l(()=>c.amountFormatterSimple(ae.value,0));F(ae,t=>{G.value<t&&!M.value?k.value=!0:k.value=!1}),F(re,t=>{A.value=t});const _e=()=>{const r=d.buildTxn.registerRootNamespace(y.value,Ee.UInt64.fromUint(L.calculateDuration(Number(m.value)))).serialize();oe.value?(V.selectedAddress=oe.value,V.selectedMultisigAddress=x.value):V.selectedAddress=x.value,V.unsignedTransactionPayload=r,h.push({name:"ViewConfirmTransaction"})},f=l(()=>{if(b.value)if(i.currentNetworkProfileConfig){let t=We.getCosignerInWallet(b.value?b.value.publicKey:""),r=[];return t.cosignerList.forEach(p=>{r.push({publicKey:p,name:B(p).name,balance:B(p).balance,address:B(p).address})}),t.cosignerList=r,{hasCosigner:t.hasCosigner,cosignerList:t.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});_.value=f.value&&f.value.cosignerList.length>0?f.value.cosignerList[0].address:"",F(f,t=>{t&&t.cosignerList.length>0&&(_.value=t.cosignerList.length>0?f.value.cosignerList[0].address:"")});const ne=l(()=>{let t=le(_.value)?le(_.value).balance:0;return c.toCurrencyFormat(t)}),se=l(()=>_.value.length<=0?Z.value<N.value:Number(ne.value)<N.value+z.value);F(M,t=>{t?(k.value=!0,C.value=!0):(k.value=!1,C.value=!1)});const oe=l(()=>f.value.cosignerList.length>0?f.value.cosignerList.length>1?_.value:B(f.value.cosignerList[0].publicKey).address:"");return{namespaceSelect:q,selectedAccName:Q,selectedAccAdd:x,balance:G,showNoBalance:se,err:J,disableCreate:fe,showPasswdError:U,disabledPassword:k,showDuration:v,disabledDuration:C,duration:m,showDurationErr:e,isMultiSigBool:be,rentalFee:P,rentalFeeCurrency:ue,lockFundTxFee:j,lockFundCurrency:me,currencyName:de,lockFundTxFeeCurrency:ve,lockFundTotalFee:z,totalFeeFormatted:ye,selectNamespace:y,namespaceOption:ce,extendNamespace:_e,transactionFee:te,getMultiSigCosigner:f,cosignerBalanceInsufficient:H,cosignerAddress:_,isNotCosigner:M,block:A,endBlock:R,numDaysleft:I,showMaxDaysLabel:W,svgString:he,Helper:c,currentNativeTokenName:ie,maxDurationInDays:D,setDefaultDuration:ke,checkCosignBalance:ne}}},Ge={class:"w-10/12 ml-auto mr-auto"},Oe={class:"border filter shadow-lg xl:grid xl:grid-cols-3 mt-8"},Xe={class:"xl:col-span-2 p-6 lg:p-12"},Ye={class:"lg:flex lg:justify-between lg:items-center"},qe={class:"font-semibold mb-4 inline-block mt-1"},Je={class:"flex items-center"},Qe=["innerHTML"],Ze={class:"ml-2"},Ke={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},$e={class:"font-bold text-black text-sm"},et={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},tt={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},at={class:"inline-block text-xs"},nt={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},st={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},ot={class:"inline-block text-xs"},lt={key:2,class:"error error_box"},rt={class:"text-right w-full"},it={key:0,class:"inline-block"},ct={class:"text-tsm text-left mt-3"},dt={key:0,class:"font-bold"},ut={key:0,class:"error"},gt={key:1,class:"font-bold"},mt=["value"],vt={key:2,class:"error"},ft={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},bt=a("img",{src:je},null,-1),ht={class:"ml-1"},kt={class:"uppercase text-blue-primary font-semibold text-xxs"},yt={class:"text-black text-sm font-bold"},_t={key:3,class:"text-xs inline-block text-gray-400"},pt={class:"bg-navy-primary py-6 px-12 xl:col-span-1"},xt=["disabled"],wt={class:"text-center"};function Ct(o,h,q,e,m,J){const k=E("font-awesome-icon"),C=E("DurationInputClean"),U=E("TransactionFeeDisplay"),y=E("router-link");return u(),g("div",null,[a("div",Ge,[a("div",Oe,[a("div",Xe,[a("div",Ye,[a("div",qe,s(o.$t("general.extendDuration")),1),a("div",Je,[a("div",{innerHTML:e.svgString,class:"inline-block"},null,8,Qe),a("div",Ze,[a("div",Ke,s(o.$t("namespace.namespaceCreatedBy")),1),a("div",$e,s(e.selectedAccName),1)])])]),e.showNoBalance?(u(),g("div",et,[a("div",tt,[S(k,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),a("div",at,s(o.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(u(),g("div",nt,[a("div",st,[S(k,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),a("div",ot,s(o.$t("general.noCosigner")),1)])):w("",!0),e.err!=""?(u(),g("div",lt,s(e.err),1)):w("",!0),a("div",rt,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(u(),g("div",it,[a("div",ct,[Y(s(o.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(u(),g("span",dt,[Y(s(e.getMultiSigCosigner.cosignerList[0].name)+" ("+s(o.$t("general.balance"))+": "+s(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+s(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(u(),g("span",ut,"- "+s(o.$t("general.insufficientBalance")),1)):w("",!0)])):(u(),g("span",gt,[Ae(a("select",{"onUpdate:modelValue":h[0]||(h[0]=v=>e.cosignerAddress=v)},[(u(!0),g(Pe,null,Me(e.getMultiSigCosigner.cosignerList,(v,H)=>(u(),g("option",{value:v.address,key:H},s(v.name)+" ("+s(o.$t("general.balance"))+": "+s(v.balance)+" "+s(e.currentNativeTokenName)+")",9,mt))),128))],512),[[Ie,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(u(),g("div",vt,"- "+s(o.$t("general.insufficientBalance")),1)):w("",!0)])])):w("",!0)]),a("div",ft,[bt,a("div",ht,[a("div",kt,s(o.$t("general.namespace")),1),a("div",yt,s(e.selectNamespace),1)])]),S(C,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":h[1]||(h[1]=v=>e.duration=v),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:o.$t("namespace.duration"),showError:e.showDurationErr,toolTip:o.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+o.$t("general.year"):""} (${e.maxDurationInDays}`+o.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(u(),g("div",_t,s(o.$t("namespace.durationMsg2"))+" "+s(e.maxDurationInDays-e.numDaysleft)+" "+s(o.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):w("",!0)]),a("div",pt,[S(U,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),a("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:h[2]||(h[2]=(...v)=>e.extendNamespace&&e.extendNamespace(...v))},s(o.$t("general.extendDuration")),9,xt),a("div",wt,[S(y,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Be(()=>[Y(s(o.$t("general.cancel")),1)]),_:1})])])])])])}const Et=pe(ze,[["render",Ct]]);export{Et as default};
