import{d as H,r as I,o as M,f as b,l,b as n,s as w,t as _,v as h,e as d,i as T,I as L,J as V,_ as D,g as v,c as C,w as K,A as f,D as $,x as u}from"./index-ac085045.js";import{_ as E}from"./icon-plus-7207f329.js";import{a as R,A as W,_ as F}from"./AccountTabs.vue_vue_type_script_setup_true_lang-d29b9a74.js";import{s as P,a as Q}from"./column.esm-a17d958d.js";import{U as B}from"./UTF8-62cc6a5f.js";import"./jdenticon-module-2a95d186.js";import"./functions-c0137ee2.js";import"./TextInput-f71c8b4b.js";import"./TextInputClean-6fd2d429.js";import"./icon-key-5b3f7dda.js";const N=r=>(L("data-v-cc8d5c31"),r=r(),V(),r),O={class:"flex"},Z={key:0,class:"ml-3 text-gray-400 font-semibold"},z={key:0,class:"flex"},J=N(()=>d("div",{class:"ml-3 text-gray-400 font-semibold"},"utf-8",-1)),j={class:"text-xs"},q=N(()=>d("img",{src:R,title:"Update Metadata",class:"inline-block w-3 h-3 text-black cursor-pointer ml-1"},null,-1)),G=H({__name:"AccountMetadataDatatable",props:{accMetadata:Array,publicKey:String},setup(r){return(p,c)=>{const m=I("router-link");return M(),b("div",null,[l(h(Q),{value:r.accMetadata,paginator:!0,rows:10,dataKey:"id",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink  RowsPerPageDropdown",rowsPerPageOptions:[10,20,30,40,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries",responsiveLayout:"scroll"},{empty:n(()=>[w(_(p.$t("general.noRecord")),1)]),loading:n(()=>[w(_(p.$t("dashboard.fetchingTx")),1)]),default:n(()=>[l(h(P),{field:"scopedMetadataKey",header:"Scoped Metadata Key"},{body:n(({data:a})=>[d("div",O,[d("div",null,_(a.scopedMetadataKeyHex),1),a.scopedMetadataKeyUtf8?(M(),b("div",Z,"hex")):T("",!0)]),a.scopedMetadataKeyUtf8?(M(),b("div",z,[d("div",null,_(a.scopedMetadataKeyUtf8),1),J])):T("",!0)]),_:1}),l(h(P),{field:"currentValue",header:"Current Value"},{body:n(({data:a})=>[d("span",j,_(a.value),1)]),_:1}),l(h(P),{field:"action",header:"Action"},{body:n(({data:a})=>[l(m,{to:{name:"ViewUpdateAccountMetadata",params:{targetPublicKey:r.publicKey,scopedMetadataKey:a.scopedMetadataKeyUtf8?a.scopedMetadataKeyUtf8:a.scopedMetadataKeyHex}}},{default:n(()=>[q]),_:2},1032,["to"])]),_:1})]),_:1},8,["value"])])}}});const X=D(G,[["__scopeId","data-v-cc8d5c31"]]),Y={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},ee={class:"border-2 border-t-0"},te=d("button",{class:"mx-6 my-4 blue-btn py-3 px-3 flex items-center"},[d("img",{src:E,class:"inline-block w-4 h-4 mr-2"}),w("Create New Account Metadata")],-1),pe=H({__name:"ViewAccountMetadata",props:{address:String},setup(r){const p=r;v(0);const c=C(()=>{if(!K.currentLoggedInWallet)return null;let e=K.currentLoggedInWallet.accounts.find(t=>t.address==p.address)||K.currentLoggedInWallet.others.find(t=>t.address==p.address);return e||null});C(()=>c.value?c.value.getDirectParentMultisig().length>0:!1);const m=v([]);v([]),v([]);const a=e=>new Promise(t=>setTimeout(t,e)),S=async()=>{if(!c.value)return;let e=new u.MetadataQueryParams;e.metadataType=u.MetadataType.ACCOUNT,e.pageSize=100,e.pageNumber=1,e.targetKey=u.PublicAccount.createFromPublicKey(c.value.publicKey,f.networkType);let t=await f.chainAPI.metadataAPI.searchMetadatas(e);for(let s=0;s<t.metadataEntries.length;s++){let o=t.metadataEntries;m.value.push({scopedMetadataKeyUtf8:o[s].scopedMetadataKey.toHex()==g(o[s].scopedMetadataKey.toHex())?null:g(o[s].scopedMetadataKey.toHex()),scopedMetadataKeyHex:o[s].scopedMetadataKey.toHex(),value:o[s].value})}let x=t.pagination.totalPages;await a(250);for(let s=2;s<=x;s++){let o=new u.MetadataQueryParams;o.metadataType=u.MetadataType.ACCOUNT,o.pageSize=100,o.pageNumber=s,o.targetKey=c.value.publicKey;let k=await f.chainAPI.metadataAPI.searchMetadatas(o);for(let i=0;i<k.metadataEntries.length;i++){let y=k.metadataEntries;m.value.push({scopedMetadataKeyUtf8:y[i].scopedMetadataKey.toHex()==g(y[i].scopedMetadataKey.toHex())?null:g(y[i].scopedMetadataKey.toHex()),scopedMetadataKeyHex:y[i].scopedMetadataKey.toHex(),value:y[i].value}),await a(250)}}},A=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=A(e)),e),g=e=>{e=A(e);let t=u.Convert.hexToUint8(e);return B.isNotUTF8(t)||(e=u.Convert.decodeHexToUtf8(e)),e},U=async()=>{S()};if(f.isReady)U();else{let e=$(f,t=>{t.isReady&&(U(),e())})}return(e,t)=>{const x=I("router-link");return M(),b("div",null,[d("div",Y,[l(W,{address:r.address,class:"mb-6"},null,8,["address"]),l(F,{address:r.address,selected:"metadata"},null,8,["address"]),d("div",ee,[l(X,{publicKey:c.value?c.value.publicKey:"0".repeat(64),accMetadata:m.value},null,8,["publicKey","accMetadata"]),l(x,{to:{name:"ViewUpdateAccountMetadata",params:{targetPublicKey:c.value?c.value.publicKey:"0".repeat(64)}}},{default:n(()=>[te]),_:1},8,["to"])])])])}}});export{pe as default};
