import{l as Ue,r as m,D as We,c as g,w as c,H as F,B as f,a as C,u as De,n as H,S as Ne,z as r,am as P,_ as Be,i as W,M as Ee,b as i,e as l,m as w,v as ce,t as p,f as M,x as $,O as E,aa as Re,F as ie,g as de,V as ue,o as d}from"./index-a7bd293d.js";import{_ as Oe}from"./PasswordInput.vue_vue_type_script_setup_true_lang-61464eaa.js";import{M as ee}from"./multisigUtils-ddfb552f.js";import{A as Qe,_ as ze}from"./AccountTabs.vue_vue_type_script_setup_true_lang-bb98f6c2.js";import{M as Ze}from"./MetadataInput-4f07fa00.js";import{_ as je}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-9fd5f882.js";import{t as Xe}from"./jdenticon-module-47969ba4.js";import{U as Ge}from"./UTF8-8a7c1d70.js";import{T as R}from"./transactionState-f260aa09.js";import{_ as qe}from"./chevron_left-0423cb29.js";import"./functions-7f44688c.js";import"./TextInput-a8db8c59.js";import"./TextInputClean-5d9a10eb.js";import"./icon-key-5b3f7dda.js";import"./icon-info-8b4f1351.js";import"./proximax-logo-ecfc3767.js";const Je={name:"ViewUpdateAccountMetadata",props:{targetPublicKey:String,scopedMetadataKey:String},components:{AccountComponent:Qe,MetadataInput:Ze,PasswordInput:Oe,AccountTabs:ze,TransactionFeeDisplay:je},setup(o){const v=Ue();let O=m(!1),t=m(!0),k=m(1),b=m(null),K=m(!1),T=m(""),u=m(""),y=m(null),h,D,s,x;const _=m(""),I=m(""),te=new We("ThemeStyleConfig");te.init();const ge=g(()=>Xe(y.value?y.value.address:"",40,te.jdenticonConfig)),ve=g(()=>y.value?c.currentLoggedInWallet.convertAddressToName(y.value.address,!0):""),ae=m([]),N=c.currentLoggedInWallet?c.currentLoggedInWallet.selectDefaultAccount():null,Q=m(N?N.address:""),ye=m(F.toCurrencyFormat(N?N.balance:0,f.nativeToken.divisibility)),le=e=>(e.endsWith("00")&&(e=e.substring(0,e.length-2),e=le(e)),e),z=e=>{e=le(e);let n=r.Convert.hexToUint8(e);return Ge.isNotUTF8(n)||(e=r.Convert.decodeHexToUtf8(e)),e},me=()=>{let e=new r.MetadataQueryParams;e.metadataType=r.MetadataType.ACCOUNT,e.targetKey=b.value,f.chainAPI.metadataAPI.searchMetadatas(e).then(n=>{n.metadataEntries.forEach(a=>{ae.value.push({value:a.scopedMetadataKey.toHex()==z(a.scopedMetadataKey.toHex())?a.scopedMetadataKey.toHex():z(a.scopedMetadataKey.toHex()),type:a.scopedMetadataKey.toHex()==z(a.scopedMetadataKey.toHex())?2:1})})})},fe=g(()=>y.value?y.value.address:"0".repeat(40)),pe=()=>{o.targetPublicKey.length===64&&r.Convert.isHexString(o.targetPublicKey)&&(b.value=r.PublicAccount.createFromPublicKey(o.targetPublicKey,f.networkType),h.targetPublicKey(b.value)),c.currentLoggedInWallet&&(y.value=c.currentLoggedInWallet.accounts.find(e=>e.publicKey===o.targetPublicKey)||c.currentLoggedInWallet.others.find(e=>e.publicKey===o.targetPublicKey),y.value&&(K.value=!!y.value.getDirectParentMultisig().length))},be=g(()=>c.currentLoggedInWallet&&b.value?c.currentLoggedInWallet.others.find(e=>e.publicKey===o.targetPublicKey):null);C(be,async e=>{if(e){if(!c.currentLoggedInWallet)return;y.value=c.currentLoggedInWallet.accounts.find(n=>n.publicKey===o.targetPublicKey)||c.currentLoggedInWallet.others.find(n=>n.publicKey===o.targetPublicKey),y.value&&(K.value=!!y.value.getDirectParentMultisig().length)}},{deep:!0});const he=()=>{if(o.scopedMetadataKey)if(t.value=!1,u.value=o.scopedMetadataKey,o.scopedMetadataKey.length===16&&r.Convert.isHexString(o.scopedMetadataKey))k.value=2,T.value=o.scopedMetadataKey,h.scopedMetadataKey(r.UInt64.fromHex(T.value));else{let e=r.Convert.utf8ToHex(o.scopedMetadataKey);const n=e.length/2;e.length&&n<=8&&(k.value=1,e.length/2<8&&(e=e+"00".repeat(8-n)),T.value=e,h.scopedMetadataKey(r.UInt64.fromHex(T.value)))}},xe=async()=>{h=f.buildTxn.accountMetadataBuilder();const e=await f.chainAPI.nodeAPI.getNodeTime();D=f.buildTxn.aggregateBondedBuilder(new r.UInt64(e.sendTimeStamp))},_e=async()=>{if(b.value&&T.value){let e=new r.MetadataQueryParams;e.metadataType=r.MetadataType.ACCOUNT,e.targetKey=b.value,e.scopedMetadataKey=r.UInt64.fromHex(T.value);let n=await f.chainAPI.metadataAPI.searchMetadatas(e);n.metadataEntries.length&&(_.value=n.metadataEntries[0].value)}h.oldValue(_.value)},Me=()=>{h.value(I.value)},Z=()=>{s=h.calculateDifferences().build()},j=()=>{s&&(x=D.innerTransactions([s.toAggregateV1(b.value)]).build())},X=()=>{x&&(S.value=x.maxFee.compact()/Math.pow(10,f.nativeToken.divisibility))},Ke=g(()=>f.nativeToken.label);De();const Te=m(""),ke=c.currentLoggedInWallet?c.currentLoggedInWallet.name:"",G=g(()=>H.currentNetworkProfileConfig?F.convertToExact(H.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),Ae=g(()=>H.currentNetworkProfileConfig?F.convertToCurrency(H.currentNetworkProfileConfig.lockedFundsPerAggregate,f.nativeToken.divisibility):0),q=g(()=>H.currentNetworkProfile?F.convertToExact(Ne.getLockFundFee(),f.nativeToken.divisibility):0),we=m(!1),J=g(()=>k.value==1?r.Convert.utf8ToHex(u.value).length/2>8:u.value.length>16?!0:u.value.length%2===1),ne=g(()=>Ie.value<Y.value),Ce=g(()=>J.value==!0||u.value==""||I.value==""||ne.value==!0),L=g(()=>{if(!c.currentLoggedInWallet)return[];let e=c.currentLoggedInWallet.accounts.map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!!a.getDirectParentMultisig().length})),n=c.currentLoggedInWallet.others.filter(a=>a.type==="MULTISIG").map(a=>({name:a.name,balance:a.balance,address:a.address,publicKey:a.publicKey,isMultisig:!0}));return e.concat(n)});C(k,e=>{se(),e==2&&(r.Convert.isHexString(u.value)||(u.value=""))});const se=async()=>{if(J.value||u.value.length==0)return;let e="";if(k.value==1){let B=r.Convert.utf8ToHex(u.value);e=B+"00".repeat((16-B.length)/2)}else e="00".repeat((16-u.value.length)/2)+u.value;let n=new r.MetadataQueryParams;n.targetKey=b.value,n.metadataType=r.MetadataType.ACCOUNT,n.scopedMetadataKey=r.UInt64.fromHex(e);let a=await f.chainAPI.metadataAPI.searchMetadatas(n);a.metadataEntries.length?_.value=a.metadataEntries[0].value:_.value=""},Pe=async()=>{if(!c.currentLoggedInWallet)return;let e="",n;if(k.value==1){let V=r.Convert.utf8ToHex(u.value);e=V+"00".repeat((16-V.length)/2)}else e="00".repeat((16-u.value.length)/2)+u.value;let a=h.targetPublicKey(b.value).scopedMetadataKey(r.UInt64.fromHex(e)).value(I.value).oldValue(_.value).calculateDifferences().build(),B=f.buildTxn.aggregateCompleteBuilder().innerTransactions([a.toAggregateV1(b.value)]).build().serialize(),re=c.currentLoggedInWallet.accounts.find(V=>V.publicKey==b.value.publicKey).address;if(K.value){let V=c.currentLoggedInWallet.accounts.find(Le=>Le.publicKey==A.value).address;n=a.toAggregateV1(b.value).serialize(),R.selectedAddress=V,R.selectedMultisigAddress=re}else n=B,R.selectedAddress=re;u.value="",_.value="",I.value="",R.unsignedTransactionPayload=n,v.push({name:"ViewConfirmTransaction"})},S=m(0),Y=g(()=>{let e=f.nativeToken.divisibility;return K.value?e==0?Math.trunc(G.value+q.value+S.value):Math.round((G.value+q.value+S.value)*Math.pow(10,e))/Math.pow(10,e):S.value}),U=g(()=>!c.currentLoggedInWallet||!b.value?[]:ee.getCosignerInWallet(o.targetPublicKey).cosignerList.length?L.value?ee.getCosignerInWallet(o.targetPublicKey).cosignerList.map(e=>{let n=L.value.find(a=>a.publicKey==e);return{name:n.name,publicKey:e,balance:n.balance}}):[]:[]),A=m("");U.value.length>0&&(A.value=U.value[0].publicKey),C(()=>U,e=>{e.value.length&&(A.value=U.value[0].publicKey)},{deep:!0});const Ie=g(()=>c.currentLoggedInWallet?K.value?A.value?P(A.value).balance:0:y.value?y.value.balance:0:0),Se=g(()=>S.value.toString()),Ve=g(()=>F.amountFormatterSimple(Y.value,0)),Fe=g(()=>{if(H.currentNetworkProfileConfig){let e=ee.getCosignerInWallet(L.value.find(a=>a.address==Q.value)?L.value.find(a=>a.address==Q.value).publicKey:""),n=[];return e.cosignerList.forEach(a=>{n.push({publicKey:a,name:P(a).name,balance:P(a).balance,address:P(a).address})}),e.cosignerList=n,e}else return{hasCosigner:!1,cosignerList:[]}}),He=g(()=>{let e=P(A.value)?P(A.value).balance:0;return F.toCurrencyFormat(e,3)});C(_,e=>{h.oldValue(e),Z(),j(),X()}),C(I,e=>{h.value(e),Z(),j(),X()}),C(u,e=>{e==""&&(_.value="")});const oe=async()=>{await xe(),pe(),await he(),await _e(),await Me(),Z(),j(),X(),me()};if(f.isReady)oe();else{let e=C(f,n=>{n.isReady&&(oe(),e())})}return{findAcc:P,totalFee:Y,err:Te,showPasswdError:we,accounts:L,updateMetadata:Pe,targetAccIsMultisig:K,lockFundCurrency:Ae,lockFund:G,aggregateFee:S,lockFundTxFee:q,walletName:ke,currentNativeTokenName:Ke,oldValue:_,newValue:I,cosigners:U,scopedMetadataKeyType:k,svgString:ge,accountName:ve,accountAddress:fe,disableAddBtn:Ce,showBalanceErr:ne,showScopedKeyErr:J,inputScopedMetadataKey:u,checkOldValue:se,selectedCosigner:A,showKeys:O,existingScopedMetadataKeys:ae,scopedMetadataKeySelectable:t,scopedMetadataKeyHex:T,transactionFee:Se,totalFeeFormatted:Ve,selectedAccAdd:Q,accBalance:ye,getMultiSigCosigner:Fe,checkCosignBalance:He}}},Ye={class:"flex cursor-pointer"},$e=l("img",{src:qe},null,-1),et={class:"lg:w-9/12 ml-2 mr-2 lg:ml-auto lg:mr-auto mt-5"},tt={class:"border-2 border-t-0 filter shadow-lg lg:grid lg:grid-cols-5"},at={class:"lg:col-span-3 py-6 px-6"},lt={class:"pl-6"},nt={key:0,class:"error error_box mb-5"},st={key:0,class:"text-left mt-2 mb-5"},ot={key:0},rt={class:"text-tsm"},ct={key:0,class:"font-bold"},it={key:1,class:"font-bold"},dt=["value"],ut={key:1,class:"error"},gt=l("div",{class:"font-semibold mb-4"},"Update Account Metadata",-1),vt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},yt={class:"flex items-center gap-2"},mt=["innerHTML"],ft={class:"flex flex-col gap-0.5"},pt=l("div",{class:"uppercase text-xxs text-blue-primary"},"Selected Account",-1),bt={class:"font-semibold"},ht={key:1,class:"mt-2"},xt=["onClick"],_t={key:0,class:"text-xs py-2 bg-gray-100 pl-2 w-full"},Mt={key:1,class:"text-xs py-2 pl-2 w-full"},Kt={key:2,class:"ml-auto pr-2 text-xxs py-2 font-semibold uppercase text-blue-primary bg-gray-100"},Tt={key:3,class:"ml-auto mr-2 text-xxs py-2 font-semibold uppercase text-blue-primary"},kt={key:2},At={class:"flex gap-3"},wt={class:"flex gap-2"},Ct=l("label",{for:"regular"},"UTF-8",-1),Pt={class:"flex gap-2"},It=l("label",{for:"hexa"},"Hexadecimal",-1),St={key:3,class:"my-3"},Vt={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Ft={class:"flex flex-col gap-0.5"},Ht=l("div",{class:"uppercase text-xxs text-blue-primary"},"Selected Scoped Metadata Key",-1),Lt={class:"flex"},Ut={class:"font-semibold"},Wt={class:"ml-3 text-gray-400 font-semibold"},Dt={class:"flex"},Nt={key:0,class:"font-semibold"},Bt={key:1,class:"ml-3 text-gray-400 font-semibold"},Et={class:"border border-blue-300 rounded-md p-3 mt-3 bg-blue-50"},Rt=l("div",{class:"uppercase text-xxs text-blue-primary"},"CURRENT VALUE",-1),Ot={class:"font-semibold"},Qt={class:"bg-navy-primary p-6 lg:col-span-2"},zt=["disabled"],Zt={class:"text-center"};function jt(o,v,O,t,k,b){const K=W("router-link"),T=W("AccountComponent"),u=W("AccountTabs"),y=W("MetadataInput"),h=W("TransactionFeeDisplay"),D=Ee("debounce");return d(),i("div",null,[l("div",Ye,[$e,w(K,{to:{name:"ViewDashboard"},class:"text-blue-primary text-xs mt-0.5"},{default:ce(()=>[$(p(o.$t("general.back")),1)]),_:1})]),l("div",et,[w(T,{address:t.accountAddress,class:"mb-10"},null,8,["address"]),w(u,{address:t.accountAddress,selected:"metadata"},null,8,["address"]),l("div",tt,[l("div",at,[l("div",lt,[t.err!=""?(d(),i("div",nt,p(t.err),1)):M("",!0)]),t.targetAccIsMultisig?(d(),i("div",st,[t.cosigners.length>0?(d(),i("div",ot,[l("div",rt,[$(p(o.$t("general.initiateBy"))+": ",1),t.cosigners.length==1?(d(),i("span",ct,p(t.cosigners[0].name),1)):(d(),i("span",it,[E(l("select",{class:"","onUpdate:modelValue":v[0]||(v[0]=s=>t.selectedCosigner=s)},[(d(!0),i(ie,null,de(t.cosigners,(s,x)=>(d(),i("option",{value:t.findAcc(s.publicKey).publicKey,key:x},p(s.name),9,dt))),128))],512),[[Re,t.selectedCosigner]])]))])])):(d(),i("div",ut,p(o.$t("general.noCosigner")),1))])):M("",!0),gt,l("div",vt,[l("div",yt,[l("div",{innerHTML:t.svgString},null,8,mt),l("div",ft,[pt,l("div",bt,p(t.accountName),1)])])]),t.existingScopedMetadataKeys.length&&t.scopedMetadataKeySelectable?(d(),i("div",ht,[l("div",{onClick:v[1]||(v[1]=s=>t.showKeys=!t.showKeys),class:"text-blue-primary text-xs cursor-pointer mb-1.5"},"Select Existing Scoped Metadata Key"),(d(!0),i(ie,null,de(t.existingScopedMetadataKeys,(s,x)=>(d(),i("div",{key:x},[t.showKeys?(d(),i("div",{key:0,class:"flex justify-center cursor-pointer",onClick:_=>(t.scopedMetadataKeyType=s.type,t.inputScopedMetadataKey=s.value,t.checkOldValue(),t.showKeys=!1)},[x%2==0?(d(),i("div",_t,p(s.value),1)):M("",!0),x%2==1?(d(),i("div",Mt,p(s.value),1)):M("",!0),x%2==0?(d(),i("div",Kt,p(o.$t("general.select")),1)):M("",!0),x%2==1?(d(),i("div",Tt,p(o.$t("general.select")),1)):M("",!0)],8,xt)):M("",!0)]))),128))])):M("",!0),t.scopedMetadataKeySelectable?(d(),i("div",kt,[E(w(y,{hex:t.scopedMetadataKeyType==2,class:"mt-5",modelValue:t.inputScopedMetadataKey,"onUpdate:modelValue":v[2]||(v[2]=s=>t.inputScopedMetadataKey=s),placeholder:"Scoped Metadata Key",toolTip:`${t.scopedMetadataKeyType==1?"Accepts up to 8 bytes":"Accepts up to 16 hexadecimals"}`,showError:t.showScopedKeyErr,errorMessage:`${t.scopedMetadataKeyType==1?"Exceeded 8 bytes":t.inputScopedMetadataKey.length>16?"Exceeded 16 hexadecimals":"Input needs to be even number"}`},null,8,["hex","modelValue","toolTip","showError","errorMessage"]),[[D,t.checkOldValue,"1000"]]),l("div",At,[l("div",wt,[E(l("input",{type:"radio",id:"regular",value:"1","onUpdate:modelValue":v[3]||(v[3]=s=>t.scopedMetadataKeyType=s)},null,512),[[ue,t.scopedMetadataKeyType]]),Ct]),l("div",Pt,[E(l("input",{type:"radio",id:"hexa",value:"2","onUpdate:modelValue":v[4]||(v[4]=s=>t.scopedMetadataKeyType=s)},null,512),[[ue,t.scopedMetadataKeyType]]),It])]),w(y,{class:"mt-2",modelValue:t.oldValue,"onUpdate:modelValue":v[5]||(v[5]=s=>t.oldValue=s),disabled:!0,placeholder:"Current Value"},null,8,["modelValue"])])):(d(),i("div",St,[l("div",Vt,[l("div",Ft,[Ht,l("div",Lt,[l("div",Ut,p(O.scopedMetadataKey),1),l("div",Wt,p(t.scopedMetadataKeyType==1?"UTF-8":"HEX"),1)]),l("div",Dt,[t.scopedMetadataKeyType==1?(d(),i("div",Nt,p(t.scopedMetadataKeyHex),1)):M("",!0),t.scopedMetadataKeyType==1?(d(),i("div",Bt,"HEX")):M("",!0)])])]),l("div",Et,[Rt,l("div",Ot,p(t.oldValue),1)])])),w(y,{class:"mt-2",modelValue:t.newValue,"onUpdate:modelValue":v[6]||(v[6]=s=>t.newValue=s),placeholder:"New Value"},null,8,["modelValue"])]),l("div",Qt,[w(h,{"transaction-fee":t.transactionFee,"total-fee-formatted":t.totalFeeFormatted,"get-multi-sig-cosigner":t.getMultiSigCosigner,"check-cosign-balance":t.checkCosignBalance,"lock-fund-currency":String(t.lockFundCurrency),"lock-fund-tx-fee":String(t.lockFundTxFee),balance:t.accBalance,"selected-acc-add":t.selectedAccAdd},null,8,["transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("button",{type:"submit",class:"w-full blue-btn px-3 py-3 mt-3 disabled:opacity-50 disabled:cursor-auto",onClick:v[7]||(v[7]=s=>t.updateMetadata()),disabled:t.disableAddBtn}," Update Account Metadata ",8,zt),l("div",Zt,[w(K,{to:{name:"ViewAccountMetadata",params:{address:t.accountAddress}},class:"content-center text-xs text-white underline"},{default:ce(()=>[$(p(o.$t("general.cancel")),1)]),_:1},8,["to"])])])])])])}const da=Be(Je,[["render",jt]]);export{da as default};
