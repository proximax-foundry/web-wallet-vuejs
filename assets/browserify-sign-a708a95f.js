import{r as q}from"./safe-buffer-c463177b.js";import{r as N}from"./create-hash-92c04a28.js";import{r as T}from"./readable-stream-2241ee9e.js";import{r as U}from"./inherits-804453d8.js";import{r as F}from"./create-hmac-e8b5ea4a.js";import{r as O}from"./browserify-rsa-bfbdcbb6.js";import{r as V}from"./elliptic-75e883ee.js";import{r as K}from"./bn.js-1ae23332.js";import{r as $}from"./parse-asn1-465c125b.js";const z={sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},G={sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},J={sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},Q={sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},X={sign:"ecdsa",hash:"sha256",id:""},Y={sign:"ecdsa",hash:"sha224",id:""},Z={sign:"ecdsa",hash:"sha384",id:""},rr={sign:"ecdsa",hash:"sha512",id:""},er={sign:"dsa",hash:"sha1",id:""},ar={sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},tr={sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},j={sha224WithRSAEncryption:z,"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:G,"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:J,"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:Q,"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:X,sha224:Y,sha384:Z,sha512:rr,"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:er,"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:ar,"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:tr,"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}};var k,x;function gr(){return x||(x=1,k=j),k}var b={exports:{}};const M={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"};var I;function ir(){if(I)return b.exports;I=1;var h=q().Buffer,p=F(),S=O(),R=V().ec,A=K(),_=$(),l=M;function y(r,e,t,i,v){var u=_(e);if(u.curve){if(i!=="ecdsa"&&i!=="ecdsa/rsa")throw new Error("wrong private key type");return w(r,u)}else if(u.type==="dsa"){if(i!=="dsa")throw new Error("wrong private key type");return o(r,u,t)}else if(i!=="rsa"&&i!=="ecdsa/rsa")throw new Error("wrong private key type");r=h.concat([v,r]);for(var E=u.modulus.byteLength(),f=[0,1];r.length+f.length+1<E;)f.push(255);f.push(0);for(var g=-1;++g<r.length;)f.push(r[g]);var W=S(f,u);return W}function w(r,e){var t=l[e.curve.join(".")];if(!t)throw new Error("unknown curve "+e.curve.join("."));var i=new R(t),v=i.keyFromPrivate(e.privateKey),u=v.sign(r);return h.from(u.toDER())}function o(r,e,t){for(var i=e.params.priv_key,v=e.params.p,u=e.params.q,E=e.params.g,f=new A(0),g,W=a(r,u).mod(u),H=!1,C=s(i,u,r,t);H===!1;)g=d(u,C,t),f=m(E,g,v,u),H=g.invm(u).imul(W.add(i.mul(f))).mod(u),H.cmpn(0)===0&&(H=!1,f=new A(0));return c(f,H)}function c(r,e){r=r.toArray(),e=e.toArray(),r[0]&128&&(r=[0].concat(r)),e[0]&128&&(e=[0].concat(e));var t=r.length+e.length+4,i=[48,t,2,r.length];return i=i.concat(r,[2,e.length],e),h.from(i)}function s(r,e,t,i){if(r=h.from(r.toArray()),r.length<e.byteLength()){var v=h.alloc(e.byteLength()-r.length);r=h.concat([v,r])}var u=t.length,E=n(t,e),f=h.alloc(u);f.fill(1);var g=h.alloc(u);return g=p(i,g).update(f).update(h.from([0])).update(r).update(E).digest(),f=p(i,g).update(f).digest(),g=p(i,g).update(f).update(h.from([1])).update(r).update(E).digest(),f=p(i,g).update(f).digest(),{k:g,v:f}}function a(r,e){var t=new A(r),i=(r.length<<3)-e.bitLength();return i>0&&t.ishrn(i),t}function n(r,e){r=a(r,e),r=r.mod(e);var t=h.from(r.toArray());if(t.length<e.byteLength()){var i=h.alloc(e.byteLength()-t.length);t=h.concat([i,t])}return t}function d(r,e,t){var i,v;do{for(i=h.alloc(0);i.length*8<r.bitLength();)e.v=p(t,e.k).update(e.v).digest(),i=h.concat([i,e.v]);v=a(i,r),e.k=p(t,e.k).update(e.v).update(h.from([0])).digest(),e.v=p(t,e.k).update(e.v).digest()}while(v.cmp(r)!==-1);return v}function m(r,e,t,i){return r.toRed(A.mont(t)).redPow(e).fromRed().mod(i)}return b.exports=y,b.exports.getKey=s,b.exports.makeKey=d,b.exports}var D,L;function sr(){if(L)return D;L=1;var h=q().Buffer,p=K(),S=V().ec,R=$(),A=M;function _(o,c,s,a,n){var d=R(s);if(d.type==="ec"){if(a!=="ecdsa"&&a!=="ecdsa/rsa")throw new Error("wrong public key type");return l(o,c,d)}else if(d.type==="dsa"){if(a!=="dsa")throw new Error("wrong public key type");return y(o,c,d)}else if(a!=="rsa"&&a!=="ecdsa/rsa")throw new Error("wrong public key type");c=h.concat([n,c]);for(var m=d.modulus.byteLength(),r=[1],e=0;c.length+r.length+2<m;)r.push(255),e++;r.push(0);for(var t=-1;++t<c.length;)r.push(c[t]);r=h.from(r);var i=p.mont(d.modulus);o=new p(o).toRed(i),o=o.redPow(new p(d.publicExponent)),o=h.from(o.fromRed().toArray());var v=e<8?1:0;for(m=Math.min(o.length,r.length),o.length!==r.length&&(v=1),t=-1;++t<m;)v|=o[t]^r[t];return v===0}function l(o,c,s){var a=A[s.data.algorithm.curve.join(".")];if(!a)throw new Error("unknown curve "+s.data.algorithm.curve.join("."));var n=new S(a),d=s.data.subjectPrivateKey.data;return n.verify(c,o,d)}function y(o,c,s){var a=s.data.p,n=s.data.q,d=s.data.g,m=s.data.pub_key,r=R.signature.decode(o,"der"),e=r.s,t=r.r;w(e,n),w(t,n);var i=p.mont(a),v=e.invm(n),u=d.toRed(i).redPow(new p(c).mul(v).mod(n)).fromRed().mul(m.toRed(i).redPow(t.mul(v).mod(n)).fromRed()).mod(a).mod(n);return u.cmp(t)===0}function w(o,c){if(o.cmpn(0)<=0)throw new Error("invalid sig");if(o.cmp(c)>=c)throw new Error("invalid sig")}return D=_,D}var B,P;function mr(){if(P)return B;P=1;var h=q().Buffer,p=N(),S=T(),R=U(),A=ir(),_=sr(),l=j;Object.keys(l).forEach(function(s){l[s].id=h.from(l[s].id,"hex"),l[s.toLowerCase()]=l[s]});function y(s){S.Writable.call(this);var a=l[s];if(!a)throw new Error("Unknown message digest");this._hashType=a.hash,this._hash=p(a.hash),this._tag=a.id,this._signType=a.sign}R(y,S.Writable),y.prototype._write=function(a,n,d){this._hash.update(a),d()},y.prototype.update=function(a,n){return typeof a=="string"&&(a=h.from(a,n)),this._hash.update(a),this},y.prototype.sign=function(a,n){this.end();var d=this._hash.digest(),m=A(d,a,this._hashType,this._signType,this._tag);return n?m.toString(n):m};function w(s){S.Writable.call(this);var a=l[s];if(!a)throw new Error("Unknown message digest");this._hash=p(a.hash),this._tag=a.id,this._signType=a.sign}R(w,S.Writable),w.prototype._write=function(a,n,d){this._hash.update(a),d()},w.prototype.update=function(a,n){return typeof a=="string"&&(a=h.from(a,n)),this._hash.update(a),this},w.prototype.verify=function(a,n,d){typeof n=="string"&&(n=h.from(n,d)),this.end();var m=this._hash.digest();return _(n,m,a,this._signType,this._tag)};function o(s){return new y(s)}function c(s){return new w(s)}return B={Sign:o,Verify:c,createSign:o,createVerify:c},B}export{gr as a,mr as r};
