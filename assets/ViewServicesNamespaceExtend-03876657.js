import{_ as xe,j as we,k as Ce,y as De,g as a,c as o,n as i,bb as Te,bc as Ne,A as u,G as Fe,b5 as Le,H as c,B as Se,as as Q,w as N,K as Ae,D as F,aw as E,bd as re,r as L,o as d,a as Ie,b as Y,e as l,t as n,f,l as S,i as w,s as q,Q as Pe,am as Me,F as Be,M as Ee,x as Ve}from"./index-f4fa05bb.js";import{T as Ue}from"./TransactionLayout-4fe4075f.js";import{D as He}from"./DurationInputClean-a905886e.js";import{_ as Re}from"./TransactionFeeDisplay.vue_vue_type_script_setup_true_lang-76415d7e.js";import{N as A}from"./namespaceUtils-6413f3af.js";import{t as We}from"./jdenticon-module-14cc3de9.js";import{M as je}from"./multisigUtils-5932eec1.js";import{T as V}from"./transactionState-bc435c31.js";import{_ as ze}from"./icon-namespace-e5424a8b.js";import"./icon-info-8b4f1351.js";import"./TransactionFeeLayout.vue_vue_type_script_setup_true_lang-32d1fb88.js";import"./proximax-logo-ecfc3767.js";const Ge={name:"ViewServicesNamespaceExtend",components:{DurationInputClean:He,TransactionFeeDisplay:Re,TransactionLayout:Ue},props:{namespaceId:String,address:String},setup(s){we();const k=Ce();De();const J=a(null),e=a(!1),g=a("1"),K=a(""),y=a(!1),C=a(!1),U=a(!1),p=a(""),H=a(!1),m=a(!1),h=a(""),I=a(0),R=a(0),P=a(0),W=a(!1),D=o(()=>i.currentNetworkProfileConfig?Math.floor(Te.configReturn(i.currentNetworkProfileConfig.maxNamespaceDuration,Ne.DAY)):0),ie=o(()=>u.readBlockHeight),ce=o(()=>u.nativeToken.label);(async()=>{const t=Fe.buildAPIEndpoint(i.selectedAPIEndpoint,i.currentNetworkProfile?i.currentNetworkProfile.httpPort:3e3),r=new Le(t);I.value=await r.chainAPI.getBlockchainHeight()})();const ue=o(()=>{let t=[];const r=A.listRootNamespaces(x.value);return t.push.apply(t,r),t}),de=o(()=>u.nativeToken.label),M=o(()=>i.currentNetworkProfileConfig?g.value>0?c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock*A.calculateDuration(g.value),u.nativeToken.divisibility):c.convertToExact(i.currentNetworkProfileConfig.rootNamespaceRentalFeePerBlock,u.nativeToken.divisibility):0),ge=o(()=>c.toCurrencyFormat(M.value,6)),me=o(()=>i.currentNetworkProfileConfig?c.convertToExact(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),ve=o(()=>i.currentNetworkProfileConfig?c.amountFormatterSimple(i.currentNetworkProfileConfig.lockedFundsPerAggregate,u.nativeToken.divisibility):0),j=o(()=>i.currentNetworkProfile?c.convertToExact(Se.getLockFundFee(),u.nativeToken.divisibility):0),B=o(()=>(v.value?v.value.cosignerList.length:0)==0&&Q(x.value)),fe=a(j.value.toString()),z=o(()=>me.value+j.value),be=o(()=>!(!e.value&&!oe.value&&!B.value)),X=a(""),x=a(""),G=a(""),Z=a(""),$=o(()=>N.currentLoggedInWallet?N.currentLoggedInWallet.selectDefaultAccount():null),he=a($.value?Q($.value.address):!1),ee=c.createAddress(s.address).plain();let b=o(()=>N.currentLoggedInWallet?N.currentLoggedInWallet.accounts.find(t=>t.address==ee)||N.currentLoggedInWallet.others.find(t=>t.address==ee):null);b.value&&(X.value=b.value.name,x.value=b.value.address,G.value=c.toCurrencyFormat(b.value.balance,u.nativeToken.divisibility),Z.value=b.value.balance);let te=new Ae("ThemeStyleConfig");te.init();const ke=a(We(s.address,40,te.jdenticonConfig));if(b.value){let t=b.value.namespaces.find(r=>r.idHex===s.namespaceId);if(t!=null){R.value=t.endHeight;const r=t.name.split(".");r.length>1?p.value=r[0]:p.value=t.name}}const ae=a("0"),T=a(0);try{ae.value=c.convertToCurrency(A.getRootNamespaceTransactionFee(p.value,g.value),u.nativeToken.divisibility),T.value=c.convertToExact(A.getRootNamespaceTransactionFee(p.value,g.value),u.nativeToken.divisibility)}catch{}let O=!1;F(g,t=>{if(t>D.value)g.value=D.value;else{let r=R.value-I.value,_=0;P.value=Math.ceil(r/(24*60*4)),parseInt(t)+P.value>D.value?(_=D.value-P.value,g.value=_.toString(),W.value=!0,O=!0):(O||(W.value=!1),O=!1)}});const ye=()=>{g.value="1"},ne=o(()=>Q(c.createAddress(s.address).plain())?parseFloat(z.value)+M.value+T.value:M.value+T.value),pe=o(()=>c.amountFormatterSimple(ne.value,0));F(ne,t=>{G.value<t&&!B.value?y.value=!0:y.value=!1}),F(ie,t=>{I.value=t});const _e=()=>{const r=u.buildTxn.registerRootNamespace(p.value,Ve.UInt64.fromUint(A.calculateDuration(Number(g.value)))).serialize();le.value?(V.selectedAddress=le.value,V.selectedMultisigAddress=x.value):V.selectedAddress=x.value,V.unsignedTransactionPayload=r,k.push({name:"ViewConfirmTransaction"})},v=o(()=>{if(b.value)if(i.currentNetworkProfileConfig){let t=je.getCosignerInWallet(b.value?b.value.publicKey:""),r=[];return t.cosignerList.forEach(_=>{r.push({publicKey:_,name:E(_).name,balance:E(_).balance,address:E(_).address})}),t.cosignerList=r,{hasCosigner:t.hasCosigner,cosignerList:t.cosignerList}}else return{hasCosigner:!1,cosignerList:[]}});h.value=v.value&&v.value.cosignerList.length>0?v.value.cosignerList[0].address:"",F(v,t=>{t&&t.cosignerList.length>0&&(h.value=t.cosignerList.length>0?v.value.cosignerList[0].address:"")});const se=o(()=>{let t=re(h.value)?re(h.value).balance:0;return c.toCurrencyFormat(t)}),oe=o(()=>h.value.length<=0?Z.value<T.value:Number(se.value)<T.value+z.value);F(B,t=>{t?(y.value=!0,C.value=!0):(y.value=!1,C.value=!1)});const le=o(()=>v.value.cosignerList.length>0?v.value.cosignerList.length>1?h.value:E(v.value.cosignerList[0].publicKey).address:"");return{namespaceSelect:J,selectedAccName:X,selectedAccAdd:x,balance:G,showNoBalance:oe,err:K,disableCreate:be,showPasswdError:U,disabledPassword:y,showDuration:H,disabledDuration:C,duration:g,showDurationErr:e,isMultiSigBool:he,rentalFee:M,rentalFeeCurrency:ge,lockFundTxFee:j,lockFundCurrency:ve,currencyName:de,lockFundTxFeeCurrency:fe,lockFundTotalFee:z,totalFeeFormatted:pe,selectNamespace:p,namespaceOption:ue,extendNamespace:_e,transactionFee:ae,getMultiSigCosigner:v,cosignerBalanceInsufficient:m,cosignerAddress:h,isNotCosigner:B,block:I,endBlock:R,numDaysleft:P,showMaxDaysLabel:W,svgString:ke,Helper:c,currentNativeTokenName:ce,maxDurationInDays:D,setDefaultDuration:ye,checkCosignBalance:se}}},Oe={class:"lg:flex lg:justify-between lg:items-center"},Qe={class:"font-semibold mb-4 inline-block mt-1"},Ye={class:"flex items-center"},qe=["innerHTML"],Je={class:"ml-2"},Ke={class:"text-blue-primary text-xxs font-bold uppercase mb-1"},Xe={class:"font-bold text-black text-sm"},Ze={key:0,class:"rounded-md bg-red-200 w-full p-2 flex items-center justify-center"},$e={class:"rounded-full w-5 h-5 border border-red-500 inline-block relative mr-2"},et={class:"inline-block text-xs"},tt={key:1,class:"rounded-md bg-yellow-200 w-full p-2 flex items-center justify-center"},at={class:"rounded-full w-5 h-5 bg-yellow-100 inline-block relative mr-2"},nt={class:"inline-block text-xs"},st={key:2,class:"error error_box"},ot={class:"text-right w-full"},lt={key:0,class:"inline-block"},rt={class:"text-tsm text-left mt-3"},it={key:0,class:"font-bold"},ct={key:0,class:"error"},ut={key:1,class:"font-bold"},dt=["value"],gt={key:2,class:"error"},mt={class:"border border-blue-primary p-4 bg-blue-100 flex items-center rounded mt-5"},vt=l("img",{src:ze},null,-1),ft={class:"ml-1"},bt={class:"uppercase text-blue-primary font-semibold text-xxs"},ht={class:"text-black text-sm font-bold"},kt={key:3,class:"text-xs inline-block text-gray-400"},yt=["disabled"],pt={class:"text-center"};function _t(s,k,J,e,g,K){const y=L("font-awesome-icon"),C=L("DurationInputClean"),U=L("TransactionFeeDisplay"),p=L("router-link"),H=L("TransactionLayout");return d(),Ie(H,{class:"mt-8"},{white:Y(()=>[l("div",Oe,[l("div",Qe,n(s.$t("general.extendDuration")),1),l("div",Ye,[l("div",{innerHTML:e.svgString,class:"inline-block"},null,8,qe),l("div",Je,[l("div",Ke,n(s.$t("namespace.namespaceCreatedBy")),1),l("div",Xe,n(e.selectedAccName),1)])])]),e.showNoBalance?(d(),f("div",Ze,[l("div",$e,[S(y,{icon:"times",class:"text-red-500 h-3 w-3 absolute",style:{top:"3px",left:"4px"}})]),l("div",et,n(s.$t("general.insufficientBalance")),1)])):e.isNotCosigner?(d(),f("div",tt,[l("div",at,[S(y,{icon:"exclamation",class:"text-yellow-500 h-3 w-3 absolute",style:{top:"5px",left:"7px"}})]),l("div",nt,n(s.$t("general.noCosigner")),1)])):w("",!0),e.err!=""?(d(),f("div",st,n(e.err),1)):w("",!0),l("div",ot,[(e.getMultiSigCosigner?e.getMultiSigCosigner.cosignerList.length:0>0)?(d(),f("div",lt,[l("div",rt,[q(n(s.$t("general.initiateBy"))+": ",1),e.getMultiSigCosigner.cosignerList.length==1?(d(),f("span",it,[q(n(e.getMultiSigCosigner.cosignerList[0].name)+" ("+n(s.$t("general.balance"))+": "+n(e.Helper.amountFormatterSimple(e.getMultiSigCosigner.cosignerList[0].balance,0))+" "+n(e.currentNativeTokenName)+") ",1),e.getMultiSigCosigner.cosignerList[0].balance<e.lockFundTotalFee?(d(),f("span",ct,"- "+n(s.$t("general.insufficientBalance")),1)):w("",!0)])):(d(),f("span",ut,[Pe(l("select",{"onUpdate:modelValue":k[0]||(k[0]=m=>e.cosignerAddress=m)},[(d(!0),f(Be,null,Ee(e.getMultiSigCosigner.cosignerList,(m,h)=>(d(),f("option",{value:m.address,key:h},n(m.name)+" ("+n(s.$t("general.balance"))+": "+n(m.balance)+" "+n(e.currentNativeTokenName)+") ",9,dt))),128))],512),[[Me,e.cosignerAddress]])])),e.cosignerBalanceInsufficient?(d(),f("div",gt," - "+n(s.$t("general.insufficientBalance")),1)):w("",!0)])])):w("",!0)]),l("div",mt,[vt,l("div",ft,[l("div",bt,n(s.$t("general.namespace")),1),l("div",ht,n(e.selectNamespace),1)])]),S(C,{class:"mt-5",disabled:e.disabledDuration,modelValue:e.duration,"onUpdate:modelValue":k[1]||(k[1]=m=>e.duration=m),onSetDefaultDuration:e.setDefaultDuration,max:e.maxDurationInDays,placeholder:s.$t("namespace.duration"),showError:e.showDurationErr,toolTip:s.$t("namespace.durationMsg")+`<br>${e.maxDurationInDays===365?"1 "+s.$t("general.year"):""} (${e.maxDurationInDays}`+s.$t("general.day",e.maxDurationInDays)+")."},null,8,["disabled","modelValue","onSetDefaultDuration","max","placeholder","showError","toolTip"]),e.showMaxDaysLabel?(d(),f("div",kt,n(s.$t("namespace.durationMsg2"))+" "+n(e.maxDurationInDays-e.numDaysleft)+" "+n(s.$t("general.day",e.maxDurationInDays-e.numDaysleft)),1)):w("",!0)]),navy:Y(()=>[S(U,{"namespace-rental-fee-currency":e.rentalFeeCurrency,"transaction-fee":e.transactionFee,"total-fee-formatted":e.totalFeeFormatted,"get-multi-sig-cosigner":e.getMultiSigCosigner,"check-cosign-balance":e.checkCosignBalance,"lock-fund-currency":e.lockFundCurrency,"lock-fund-tx-fee":String(e.lockFundTxFee),balance:e.balance,"selected-acc-add":e.selectedAccAdd},null,8,["namespace-rental-fee-currency","transaction-fee","total-fee-formatted","get-multi-sig-cosigner","check-cosign-balance","lock-fund-currency","lock-fund-tx-fee","balance","selected-acc-add"]),l("button",{type:"submit",class:"mt-3 w-full blue-btn py-4 disabled:opacity-50 disabled:cursor-auto text-white",disabled:e.disableCreate,onClick:k[2]||(k[2]=(...m)=>e.extendNamespace&&e.extendNamespace(...m))},n(s.$t("general.extendDuration")),9,yt),l("div",pt,[S(p,{to:{name:"ViewDashboard"},class:"content-center text-xs text-white border-b-2 border-white"},{default:Y(()=>[q(n(s.$t("general.cancel")),1)]),_:1})])]),_:1})}const Mt=xe(Ge,[["render",_t]]);export{Mt as default};
