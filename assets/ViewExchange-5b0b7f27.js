import{d as He,c as M,g as F,H as y,n as j,A as o,B as W,x as r,w as h,y as Pe,D as O,k as Se,r as Ce,o as f,a as Be,b as X,e as i,f as b,i as G,l as P,t as s,v,s as Ve,E as Ue,W as Te,bf as $e}from"./index-2c45a7ef.js";import{_ as Ae}from"./proximax-logo-ecfc3767.js";import{I as We}from"./InputAmount-e423e8ca.js";import{_ as Oe}from"./SelectInputAccount.vue_vue_type_script_setup_true_lang-9ac7dc2f.js";import{_ as Ke}from"./SelectInputMultisigAccount.vue_vue_type_script_setup_true_lang-eb3b8820.js";import{T as Re}from"./TransactionLayout-d00a15b3.js";import{_ as je}from"./PasswordInput.vue_vue_type_script_setup_true_lang-9ce324d9.js";import"./jdenticon-module-eb1215b2.js";const Xe={key:0,class:"text-xs mt-3 text-blue-primary"},qe={class:"text-blue-primary mt-3"},ze={key:1,class:"text-red-500 text-xs"},Je={key:2,class:"text-red-500 text-xs"},Qe={class:"mt-2 text-xs text-gray-600"},Ye={class:"flex mt-2"},Ze={class:"text-gray-600 text-xs"},et={key:0,class:"text-red-500 text-xs ml-2"},tt={key:3,class:"text-gray-600 text-xs mt-2"},at={key:4},it={key:5},st={key:0},ot={class:"font-bold text-xs text-blue-primary uppercase"},lt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},nt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},rt=["innerHTML"],ct={class:"flex"},ut={class:"ml-1 text-blue-400 font-bold"},dt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},vt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},mt={class:"ml-1 text-blue-400 text-xs"},pt={class:"font-bold text-xs text-blue-primary uppercase"},gt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1"},yt={class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"},ft=["innerHTML"],bt={class:"flex"},xt={class:"ml-1 text-blue-400 font-bold"},ht={key:1},wt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 text-gray-200 my-1 items-center"},Gt={class:"ml-auto lg:col-span-2 col-span-3 font-semibold"},_t={class:"ml-1 text-blue-400 text-xs"},Tt={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},At={class:"font-semibold lg:col-span-2 col-span-3"},It=["innerHTML"],Mt={class:"ml-1 text-blue-400"},kt={key:2,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs"},Ft={class:"font-semibold lg:col-span-2 col-span-3"},Dt=["innerHTML"],Lt={class:"ml-1 text-blue-400"},Nt={key:3,class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Et={class:"font-semibold lg:col-span-2 col-span-3"},Ht=["innerHTML"],Pt={class:"ml-1 text-blue-400"},St={class:"lg:grid lg:grid-cols-5 grid grid-cols-7 justify-between items-center text-gray-200 text-xs py-2"},Ct=["innerHTML"],Bt={class:"ml-1 text-blue-400"},Vt={class:"font-semibold text-xs text-white mb-1.5"},Ut={class:"text-center"},Jt=He({__name:"ViewExchange",props:{type:String,owner:String,pair:String},setup(Ie){const q=(a,t)=>{const l=(d,g)=>g===0?d:l(g,d%g),u=l(a,t),n=a/u,p=t/u;return[n,p]},w=M(()=>{var a,t,l;return parseFloat(c.value)<A.value[0]/Math.pow(10,(a=e.value)==null?void 0:a.mosaicGetDivisibility)?0:parseFloat(c.value)*Math.pow(10,(t=e.value)==null?void 0:t.mosaicGetDivisibility)%A.value[0]/Math.pow(10,(l=e.value)==null?void 0:l.mosaicGetDivisibility)}),Me=[{namespace:"prx.xpx",name:"XPX"},{namespace:"prx.metx",name:"METX"},{namespace:"xarcade.xar",name:"XAR"}],c=F("0"),D=M(()=>parseFloat(c.value)*R.value-w.value*R.value),z=Ue().appContext.config.globalProperties.emitter,L=F(""),_=F(null),T=F(null),J=M(()=>y.convertToExact(j.currentNetworkProfileConfig.lockedFundsPerAggregate,o.nativeToken.divisibility)),Q=M(()=>y.convertToExact(W.getLockFundFee(),o.nativeToken.divisibility)),S=M(()=>{var u,n,p,d;if(!o.isReady)return 0;const a=r.PlaceSdaExchangeOfferTransaction.create(r.Deadline.create(),[new r.SdaExchangeOffer(new r.MosaicId(o.nativeToken.assetId),r.UInt64.fromUint(parseFloat(c.value)*Math.pow(10,((u=e.value)==null?void 0:u.mosaicGetDivisibility)??0)),new r.MosaicId(o.nativeToken.assetId),r.UInt64.fromUint(D.value*Math.pow(10,((n=e.value)==null?void 0:n.mosaicGiveDivisibility)??0)),(p=e.value)==null?void 0:p.deadline)],o.networkType);if(!I.value)return((d=a.maxFee)==null?void 0:d.compact())/Math.pow(10,o.nativeToken.divisibility);const t=[...h.currentLoggedInWallet.accounts,...h.currentLoggedInWallet.others].find(g=>g.address==T.value),l=[a.toAggregateV1(r.PublicAccount.createFromPublicKey(t.publicKey,o.networkType))];return o.buildTxn.aggregateBonded(l).maxFee.compact()/Math.pow(10,o.nativeToken.divisibility)});z.on("select-account",a=>{_.value=a}),z.on("select-multisig-account",a=>{T.value=a});const m=a=>{const t=Me.find(l=>l.namespace==a);return t?t.name:a},K=M(()=>I.value?Math.round((J.value+Q.value+S.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()?Math.round((parseFloat(c.value)-w.value+S.value)*Math.pow(10,o.nativeToken.divisibility))/Math.pow(10,o.nativeToken.divisibility):S.value),N=Ie,e=F(null),R=F(0),x=Pe(),Y=N.pair.split("/")[N.type=="Sell"?0:1],Z=N.pair.split("/")[N.type=="Sell"?1:0],k=F(0),ee=a=>{const t=h.currentLoggedInWallet.accounts.find(l=>l.address==a)||h.currentLoggedInWallet.others.find(l=>l.address==a);return t?E(t.balance):0},E=a=>{let t=a.toString().split(".");return t[1]!=null?'<span class="font-semibold text-sm">'+t[0]+'</span>.<span class="font-semibold text-xs">'+t[1]+"</span>":'<span class="font-semibold text-sm">'+t[0]+"</span>"},A=M(()=>{if(!e.value)return q(0,0);const a=e.value.initialMosaicGiveAmount.compact(),t=e.value.initialMosaicGetAmount.compact();return q(t,a)});O(e,a=>{a.mosaicGetDivisibility&&(c.value=(A.value[0]/Math.pow(10,a.mosaicGetDivisibility)).toString())},{deep:!0});const I=M(()=>T.value!=null),ke=async()=>{if(!Y||!Z){x.add({severity:"error",summary:"Error",detail:"Invalid",group:"br-custom",life:1e3});return}const a=new r.ExchangeSdaHttp(o.nodeFullURL),t=await $e(a.getAccountSdaExchangeOffers(r.Address.createFromRawAddress(N.owner)));if(e.value=t.sdaOfferBalances.find(n=>n.mosaicIdGive.toHex()==Y&&n.mosaicIdGet.toHex()==Z),!e.value){x.add({severity:"error",summary:"Error",detail:"Offer not found",group:"br-custom",life:1e3});return}const l=await o.chainAPI.assetAPI.getMosaicsNames([e.value.mosaicIdGet,e.value.mosaicIdGive]),u=await o.chainAPI.assetAPI.getMosaics([e.value.mosaicIdGet,e.value.mosaicIdGive]);e.value.mosaicGetName=l[0].names.length?l[0].names[0].name:e.value.mosaicIdGet.toHex(),e.value.mosaicGiveName=l[1].names.length?l[1].names[0].name:e.value.mosaicIdGive.toHex(),e.value.mosaicGetDivisibility=u.find(n=>n.mosaicId.toHex()==e.value.mosaicIdGet.toHex()).divisibility,e.value.mosaicGiveDivisibility=u.find(n=>n.mosaicId.toHex()==e.value.mosaicIdGive.toHex()).divisibility,R.value=e.value.initialMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)/(e.value.initialMosaicGetAmount.compact()/Math.pow(10,e.value.mosaicGetDivisibility))},te=async a=>{try{const l=(await o.chainAPI.accountAPI.getAccountInfo(r.Address.createFromRawAddress(a))).mosaics.find(u=>u.id.toHex()==e.value.mosaicIdGet.toHex());if(!l){k.value=0;return}k.value=l.amount.compact()/Math.pow(10,e.value.mosaicGetDivisibility)}catch{k.value=0}};O(c,a=>{isNaN(parseFloat(a))&&(c.value="0")}),O([_,T],([a,t])=>{k.value=0,a!=null&&t==null?te(a):a!=null&&t!=null&&te(t)});const Fe=O(o,async(a,t)=>{a.isReady&&(await ke(),Fe())},{immediate:!0}),De=a=>{const t=h.currentLoggedInWallet.accounts.find(l=>l.address==a)||h.currentLoggedInWallet.others.find(l=>l.address==a);return t?t.balance:0},Le=Se(),Ne=async()=>{if(_.value==null){x.add({severity:"error",summary:"Error",detail:"Account is not selected",group:"br-custom",life:1e3});return}if(parseFloat(c.value)<A.value[0]/Math.pow(10,e.value.mosaicGetDivisibility)){x.add({severity:"error",summary:"Error",detail:"Less than minimum offer amount",group:"br-custom",life:1e3});return}if(parseFloat(c.value)-w.value>k.value){x.add({severity:"error",summary:"Error",detail:"Insufficient balance",group:"br-custom",life:1e3});return}if(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))/Math.pow(10,e.value.mosaicGiveDivisibility)>e.value.currentMosaicGiveAmount.compact()/Math.pow(10,e.value.mosaicGiveDivisibility)){x.add({severity:"error",summary:"Error",detail:"Exceed available amount of "+m(e.value.mosaicGiveName),group:"br-custom",life:1e3});return}const a=De(_.value);if(I.value&&a<K.value){x.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(e.value&&e.value.mosaicIdGet.id.toHex().toLowerCase()==o.nativeToken.assetId.toLowerCase()&&!I.value&&a<K.value){x.add({severity:"error",summary:"Error",detail:"Insufficient Balance",group:"br-custom",life:1e3});return}if(L.value.length<8){x.add({severity:"error",summary:"Error",detail:"password must be at least 8 characters",group:"br-custom",life:1e3});return}if(!Te.verifyWalletPassword(h.currentLoggedInWallet.name,j.chainNetworkName,L.value)){x.add({severity:"error",summary:"Error",detail:"Incorrect password",group:"br-custom",life:1e3});return}const t=h.currentLoggedInWallet.accounts.find(d=>d.address==_.value),l=r.PlaceSdaExchangeOfferTransaction.create(r.Deadline.create(),[new r.SdaExchangeOffer(e.value.mosaicIdGet,r.UInt64.fromUint(Math.trunc((parseFloat(c.value)-w.value)*Math.pow(10,e.value.mosaicGetDivisibility))),e.value.mosaicIdGive,r.UInt64.fromUint(Math.trunc(D.value*Math.pow(10,e.value.mosaicGiveDivisibility))),r.UInt64.fromUint(57600))],o.networkType),u=Te.decryptPrivateKey(new r.Password(L.value),t.encrypted,t.iv);L.value="";const n=r.Account.createFromPrivateKeyV1(u,o.networkType),p=j.currentNetworkProfile.generationHash;if(I.value){const d=[...h.currentLoggedInWallet.accounts,...h.currentLoggedInWallet.others].find($=>$.address==T.value),g=[l.toAggregateV1(r.PublicAccount.createFromPublicKey(d.publicKey,o.networkType))],C=await o.chainAPI.nodeAPI.getNodeTime(),B=o.buildTxn.aggregateBonded(g,new r.UInt64(C.sendTimeStamp)),H=n.preV2Sign(B,p),V=W.lockFundTx(H),U=n.preV2Sign(V,p);W.announceLF_AND_addAutoAnnounceABT(U,H)}else{const d=n.preV2Sign(l,p);await W.announceTransaction(d)}Le.push({name:"ViewAccountPendingTransactions",params:{address:n.address.plain()}})};return(a,t)=>{const l=Ce("router-link");return f(),Be(Re,{class:"mt-8"},{white:X(()=>{var u,n,p,d,g,C,B,H,V,U,$,ae,ie,se,oe,le,ne,re,ce,ue,de,ve,me,pe,ge,ye,fe,be,xe,he,we,Ge,_e;return[t[3]||(t[3]=i("div",null,"SDA-SDA Exchange",-1)),_.value?G("",!0):(f(),b("div",Xe," Select Account to Create / Initiate Transaction ")),P(Oe),P(Ke,{class:"md:mt-3","selected-address":_.value},null,8,["selected-address"]),t[4]||(t[4]=i("div",{class:"text-blue-primary mt-3"},"Available Amount",-1)),i("div",null,s(v(y).toCurrencyFormat(((u=e.value)==null?void 0:u.currentMosaicGiveAmount.compact())/Math.pow(10,(n=e.value)==null?void 0:n.mosaicGiveDivisibility),(p=e.value)==null?void 0:p.mosaicGiveDivisibility))+" "+s(m((d=e.value)==null?void 0:d.mosaicGiveName)),1),t[5]||(t[5]=i("div",{class:"text-blue-primary mt-3"},"Minimum Offer",-1)),i("div",null,s(v(y).toCurrencyFormat(A.value[0]/Math.pow(10,(g=e.value)==null?void 0:g.mosaicGetDivisibility),(C=e.value)==null?void 0:C.mosaicGetDivisibility))+" "+s(m((B=e.value)==null?void 0:B.mosaicGetName))+" : "+s(v(y).toCurrencyFormat(A.value[1]/Math.pow(10,(H=e.value)==null?void 0:H.mosaicGiveDivisibility),(V=e.value)==null?void 0:V.mosaicGiveDivisibility))+" "+s(m((U=e.value)==null?void 0:U.mosaicGiveName)),1),i("div",qe," Amount to give ("+s(m(($=e.value)==null?void 0:$.mosaicGetName))+") ",1),P(We,{placeholder:"Asset Amount",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=Ee=>c.value=Ee),decimal:((ae=e.value)==null?void 0:ae.mosaicGetDivisibility)??0},null,8,["modelValue","decimal"]),parseFloat(c.value)>k.value?(f(),b("div",ze," Insufficient Balance ")):G("",!0),parseFloat(c.value)<A.value[0]/Math.pow(10,(ie=e.value)==null?void 0:ie.mosaicGetDivisibility)?(f(),b("div",Je," Less than minimum offer amount ")):G("",!0),i("div",Qe," Available to give: "+s(v(y).toCurrencyFormat(k.value,(se=e.value)==null?void 0:se.mosaicGetDivisibility))+" "+s(m((oe=e.value)==null?void 0:oe.mosaicGetName)),1),i("div",Ye,[i("div",Ze," I will receive "+s(v(y).toCurrencyFormat(D.value,(le=e.value)==null?void 0:le.mosaicGiveDivisibility))+" "+s(m((ne=e.value)==null?void 0:ne.mosaicGiveName)),1),Math.trunc(D.value*Math.pow(10,(re=e.value)==null?void 0:re.mosaicGiveDivisibility))/Math.pow(10,(ce=e.value)==null?void 0:ce.mosaicGiveDivisibility)>((ue=e.value)==null?void 0:ue.currentMosaicGiveAmount.compact())/Math.pow(10,(de=e.value)==null?void 0:de.mosaicGiveDivisibility)?(f(),b("div",et," (Exceed Available Amount of "+s(m((ve=e.value)==null?void 0:ve.mosaicGiveName))+") ",1)):G("",!0)]),Math.trunc(w.value*Math.pow(10,(me=e.value)==null?void 0:me.mosaicGetDivisibility))/Math.pow(10,(pe=e.value)==null?void 0:pe.mosaicGetDivisibility)>0?(f(),b("div",tt,s(v(y).toCurrencyFormat(w.value,(ge=e.value)==null?void 0:ge.mosaicGetDivisibility))+" "+s(m((ye=e.value)==null?void 0:ye.mosaicGetName))+" will be ignored ",1)):G("",!0),t[6]||(t[6]=i("div",{class:"text-blue-primary mt-3"},"Actual offer",-1)),parseFloat(c.value)>=A.value[0]/Math.pow(10,(fe=e.value)==null?void 0:fe.mosaicGetDivisibility)?(f(),b("div",at,s(v(y).toCurrencyFormat(parseFloat(c.value)-w.value,(be=e.value)==null?void 0:be.mosaicGetDivisibility))+" "+s(m((xe=e.value)==null?void 0:xe.mosaicGetName))+" : "+s(v(y).toCurrencyFormat(D.value,(he=e.value)==null?void 0:he.mosaicGiveDivisibility))+" "+s(m((we=e.value)==null?void 0:we.mosaicGiveName)),1)):(f(),b("div",it," 0 "+s(m((Ge=e.value)==null?void 0:Ge.mosaicGetName))+" : 0 "+s(m((_e=e.value)==null?void 0:_e.mosaicGiveName)),1))]}),navy:X(()=>{var u,n,p,d;return[T.value?(f(),b("div",st,[i("div",ot,s(a.$t("general.multisigAcc")),1),i("div",lt,[i("div",nt,s(a.$t("general.currentBalance")),1),i("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:ee(T.value)},null,8,rt),i("div",ct,[i("div",ut,s(v(o).nativeToken.label),1),t[7]||(t[7]=i("img",{src:Ae,class:"ml-1 h-5 w-5 mt-0.5"},null,-1))])]),i("div",dt,[t[8]||(t[8]=i("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give ",-1)),i("span",vt,s(v(y).toCurrencyFormat(parseFloat(c.value)-w.value,(u=e.value)==null?void 0:u.mosaicGetDivisibility)),1),i("span",mt,s(m((n=e.value)==null?void 0:n.mosaicGetName)),1)]),t[9]||(t[9]=i("div",{class:"border-b-2 border-gray-600 my-2"},null,-1))])):G("",!0),i("div",pt,s(a.$t("general.signerAcc")),1),i("div",gt,[i("div",yt,s(a.$t("general.currentBalance")),1),i("span",{class:"ml-auto lg:col-span-2 col-span-3",innerHTML:ee(_.value)},null,8,ft),i("div",bt,[i("div",xt,s(v(o).nativeToken.label),1),t[10]||(t[10]=i("img",{src:Ae,class:"ml-1 h-5 w-5 mt-0.5"},null,-1))])]),t[13]||(t[13]=i("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1)),T.value?G("",!0):(f(),b("div",ht,[i("div",wt,[t[11]||(t[11]=i("div",{class:"font-semibold text-xxs mt-2 lg:col-span-2 col-span-3 text-blue-primary uppercase"}," Asset to Give ",-1)),i("span",Gt,s(v(y).toCurrencyFormat(parseFloat(c.value)-w.value,(p=e.value)==null?void 0:p.mosaicGetDivisibility)),1),i("span",_t,s(m((d=e.value)==null?void 0:d.mosaicGetName)),1)])])),i("div",Tt,[i("div",At,s(I.value?a.$t("general.aggregateFee"):a.$t("general.transactionFee")),1),i("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(S.value)},null,8,It),i("div",Mt,s(v(o).nativeToken.label),1)]),I.value?(f(),b("div",kt,[i("div",Ft,s(a.$t("general.lockFund")),1),i("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(J.value??0)},null,8,Dt),i("div",Lt,s(v(o).nativeToken.label),1)])):G("",!0),I.value?(f(),b("div",Nt,[i("div",Et,s(a.$t("general.lockFundTxFee")),1),i("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(Q.value??0)},null,8,Ht),i("div",Pt,s(v(o).nativeToken.label),1)])):G("",!0),t[14]||(t[14]=i("div",{class:"border-b-2 border-gray-600 mt-2"},null,-1)),i("div",St,[t[12]||(t[12]=i("div",{class:"font-semibold lg:col-span-2 col-span-3 uppercase"}," Total ",-1)),i("div",{class:"lg:col-span-2 col-span-3 ml-auto",innerHTML:E(K.value)},null,8,Ct),i("div",Bt,s(v(o).nativeToken.label),1)]),i("div",Vt,s(a.$t("general.enterPasswordContinue")),1),P(je,{placeholder:a.$t("general.enterPassword"),modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=g=>L.value=g),icon:"lock",class:"mt-5 mb-3"},null,8,["placeholder","modelValue"]),i("button",{class:"w-full blue-btn px-3 py-3 disabled:opacity-50 disabled:cursor-auto",onClick:t[2]||(t[2]=g=>Ne())}," Sell "),i("div",Ut,[P(l,{to:{name:"ViewExchangeListing"},class:"content-center text-xs text-white underline"},{default:X(()=>[Ve(s(a.$t("general.cancel")),1)]),_:1})])]}),_:1})}}});export{Jt as default};
